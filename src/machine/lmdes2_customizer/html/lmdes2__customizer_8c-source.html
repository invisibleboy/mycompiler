<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lmdes2_customizer: lmdes2_customizer.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>lmdes2_customizer.c</h1><a href="lmdes2__customizer_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*****************************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *                    Illinois Open Source License</span>
<a name="l00004"></a>00004 <span class="comment"> *                     University of Illinois/NCSA</span>
<a name="l00005"></a>00005 <span class="comment"> *                         Open Source License</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (c) 2004, The University of Illinois at Urbana-Champaign.</span>
<a name="l00008"></a>00008 <span class="comment"> * All rights reserved.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Developed by:             </span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *              IMPACT Research Group</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *              University of Illinois at Urbana-Champaign</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *              http://www.crhc.uiuc.edu/IMPACT</span>
<a name="l00017"></a>00017 <span class="comment"> *              http://www.gelato.org</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * Permission is hereby granted, free of charge, to any person</span>
<a name="l00020"></a>00020 <span class="comment"> * obtaining a copy of this software and associated documentation</span>
<a name="l00021"></a>00021 <span class="comment"> * files (the "Software"), to deal with the Software without</span>
<a name="l00022"></a>00022 <span class="comment"> * restriction, including without limitation the rights to use, copy,</span>
<a name="l00023"></a>00023 <span class="comment"> * modify, merge, publish, distribute, sublicense, and/or sell copies</span>
<a name="l00024"></a>00024 <span class="comment"> * of the Software, and to permit persons to whom the Software is</span>
<a name="l00025"></a>00025 <span class="comment"> * furnished to do so, subject to the following conditions:</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * Redistributions of source code must retain the above copyright</span>
<a name="l00028"></a>00028 <span class="comment"> * notice, this list of conditions and the following disclaimers.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00031"></a>00031 <span class="comment"> * notice, this list of conditions and the following disclaimers in</span>
<a name="l00032"></a>00032 <span class="comment"> * the documentation and/or other materials provided with the</span>
<a name="l00033"></a>00033 <span class="comment"> * distribution.</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> * Neither the names of the IMPACT Research Group, the University of</span>
<a name="l00036"></a>00036 <span class="comment"> * Illinois, nor the names of its contributors may be used to endorse</span>
<a name="l00037"></a>00037 <span class="comment"> * or promote products derived from this Software without specific</span>
<a name="l00038"></a>00038 <span class="comment"> * prior written permission.  THE SOFTWARE IS PROVIDED "AS IS",</span>
<a name="l00039"></a>00039 <span class="comment"> * WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT</span>
<a name="l00040"></a>00040 <span class="comment"> * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A</span>
<a name="l00041"></a>00041 <span class="comment"> * PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE</span>
<a name="l00042"></a>00042 <span class="comment"> * CONTRIBUTORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES</span>
<a name="l00043"></a>00043 <span class="comment"> * OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<a name="l00044"></a>00044 <span class="comment"> * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE</span>
<a name="l00045"></a>00045 <span class="comment"> * OR THE USE OR OTHER DEALINGS WITH THE SOFTWARE.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment">\*****************************************************************************/</span>
<a name="l00048"></a>00048 <span class="comment">/*****************************************************************************\</span>
<a name="l00049"></a>00049 <span class="comment"> *      File:   lmdes2_customizer.c</span>
<a name="l00050"></a>00050 <span class="comment"> *      Author: John C. Gyllenhaal, Wen-mei Hwu</span>
<a name="l00051"></a>00051 <span class="comment"> *      Creation Date:  Aug. 1995</span>
<a name="l00052"></a>00052 <span class="comment">\*****************************************************************************/</span>
<a name="l00053"></a>00053 <span class="comment">/* 11/14/02 REK Cleaning up this code so that it does not try to access a </span>
<a name="l00054"></a>00054 <span class="comment"> *              32 bit integer as a 64 bit pointer. */</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/* 10/29/02 REK Adding config.h */</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;library/i_error.h&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;library/l_alloc_new.h&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;library/dynamic_symbol.h&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;library/heap.h&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/* Turn on error checking in lmdes */</span>
<a name="l00072"></a>00072 <span class="preprocessor">#undef MD_DEBUG_MACROS</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#include &lt;library/md.h&gt;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* 11/14/02 REK A struct that simply contains two pointers.  It can be used</span>
<a name="l00076"></a>00076 <span class="comment"> *              to maintain a mapping from 'from' to 'to'. */</span>
<a name="l00077"></a><a class="code" href="structPointer__Mapping.html">00077</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a>
<a name="l00078"></a>00078 {
<a name="l00079"></a><a class="code" href="structPointer__Mapping.html#661c5e8b6062b1e7d04fdcfd8f2df2c4">00079</a>   <span class="keywordtype">void</span> *<a class="code" href="structPointer__Mapping.html#661c5e8b6062b1e7d04fdcfd8f2df2c4">from</a>;
<a name="l00080"></a><a class="code" href="structPointer__Mapping.html#78ef5abc3b5cb05326bb41277ec887e3">00080</a>   <span class="keywordtype">void</span> *<a class="code" href="structPointer__Mapping.html#78ef5abc3b5cb05326bb41277ec887e3">to</a>;
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 <a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="lmdes2__customizer_8c.html#d2fffad840fe164eb77141c323a1bc9b">00084</a> <span class="preprocessor">#define SLOT_RESOURCE           0x00000001</span>
<a name="l00085"></a><a class="code" href="structResource__Info.html">00085</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structResource__Info.html">Resource_Info</a>
<a name="l00086"></a>00086 {
<a name="l00087"></a><a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">00087</a>   <span class="keywordtype">char</span> *<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>;
<a name="l00088"></a><a class="code" href="structResource__Info.html#a13a7304c90dda9445585f943726e69a">00088</a>   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="code" href="structResource__Info.html#a13a7304c90dda9445585f943726e69a">resource_entry</a>;
<a name="l00089"></a><a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">00089</a>   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>; <span class="comment">/* indexed by usage time */</span>
<a name="l00090"></a><a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">00090</a>   <span class="keywordtype">int</span> <a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a>;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 <a class="code" href="structResource__Info.html">Resource_Info</a>;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="comment">/* Used for finding the minimum cover for the forbidden latencies */</span>
<a name="l00095"></a><a class="code" href="structPair__Node.html">00095</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPair__Node.html">Pair_Node</a>
<a name="l00096"></a>00096 {
<a name="l00097"></a><a class="code" href="structPair__Node.html#9791ae4ee8b004db541141a808b74b95">00097</a>   <a class="code" href="structResource__Info.html">Resource_Info</a> *<a class="code" href="structPair__Node.html#9791ae4ee8b004db541141a808b74b95">resource</a>;
<a name="l00098"></a><a class="code" href="structPair__Node.html#0794150083c96d6831c84db393e034c8">00098</a>   <span class="keywordtype">int</span> <a class="code" href="structPair__Node.html#0794150083c96d6831c84db393e034c8">time1</a>;
<a name="l00099"></a><a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">00099</a>   <span class="keyword">struct </span><a class="code" href="structPair__Node.html">Pair_Node</a> *<a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">next</a>;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 <a class="code" href="structPair__Node.html">Pair_Node</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">/* Used to build a content-addressable entry table */</span>
<a name="l00104"></a><a class="code" href="structENTRY__Contents__Table.html">00104</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a>
<a name="l00105"></a>00105 {
<a name="l00106"></a><a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">00106</a>   <span class="keywordtype">char</span> *<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>;           <span class="comment">/* Content field to ignore */</span>
<a name="l00107"></a><a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">00107</a>   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a>; <span class="comment">/* Used to find contents */</span>
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 <a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">/* Used to store list of entries with same hash value for</span>
<a name="l00112"></a>00112 <span class="comment"> *  ENTRY_Contents_Table</span>
<a name="l00113"></a>00113 <span class="comment"> */</span>
<a name="l00114"></a><a class="code" href="structENTRY__Contents__Node.html">00114</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a>
<a name="l00115"></a>00115 {
<a name="l00116"></a><a class="code" href="structENTRY__Contents__Node.html#1aadfd826769ae425301e7786df83b85">00116</a>   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="code" href="structENTRY__Contents__Node.html#1aadfd826769ae425301e7786df83b85">entry</a>;
<a name="l00117"></a><a class="code" href="structENTRY__Contents__Node.html#9a1cf42f115da41c98d28ff488611a8f">00117</a>   <span class="keyword">struct </span><a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *<a class="code" href="structENTRY__Contents__Node.html#9a1cf42f115da41c98d28ff488611a8f">next_node</a>;
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 <a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/* Set to 1 to get a zillion messages from the optimizations */</span>
<a name="l00122"></a><a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">00122</a> <span class="preprocessor">#define DEBUG_OPTI 0</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00124"></a>00124 <span class="comment">/* Set to 1 to get some indication where in the opti process the </span>
<a name="l00125"></a>00125 <span class="comment"> * custimizer is.</span>
<a name="l00126"></a>00126 <span class="comment"> */</span>
<a name="l00127"></a><a class="code" href="lmdes2__customizer_8c.html#c6d967d290f940fb8143bf141f311a2a">00127</a> <span class="preprocessor">#define VERBOSE_OPTI 0</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="comment">/* Set to 1 to get some of the optimizations stats as the</span>
<a name="l00130"></a>00130 <span class="comment"> * mdes is being customized.</span>
<a name="l00131"></a>00131 <span class="comment"> */</span>
<a name="l00132"></a><a class="code" href="lmdes2__customizer_8c.html#a0fa4d0652fbff641ed614b478884266">00132</a> <span class="preprocessor">#define VERBOSE_STATS 0</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a>00134 <span class="comment">/* Prototype of header file reader */</span>
<a name="l00135"></a>00135 <span class="keyword">extern</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *<a class="code" href="header__reader2_8c.html#33574aec74728b493ce42679b1c18d10">read_header_file</a> (<span class="keywordtype">char</span> *file_name,
<a name="l00136"></a>00136                                               <span class="keywordtype">int</span> print_warnings);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/* Internal prototypes */</span>
<a name="l00139"></a>00139 <span class="keywordtype">void</span> <a class="code" href="lmdes2__customizer_8c.html#325650c03d399b4e850fe3a9bda3df17">customize_md</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md);
<a name="l00140"></a>00140 <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">eliminate_redundant_new_entries_only</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry1, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry2,
<a name="l00143"></a>00143                           <span class="keywordtype">char</span> *ignore_field);
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="lmdes2__customizer_8c.html#289c5900d90626d909f0a85d5a0ed61d">00145</a> <span class="keywordtype">char</span> *<a class="code" href="lmdes2__customizer_8c.html#289c5900d90626d909f0a85d5a0ed61d">program_name</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/* Command line parameters */</span>
<a name="l00148"></a><a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">00148</a> <span class="keywordtype">char</span> *<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00149"></a><a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">00149</a> <span class="keywordtype">char</span> *<a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a><a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">00150</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">using_stdin</a> = 0;
<a name="l00151"></a><a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">00151</a> <span class="keywordtype">char</span> *<a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00152"></a><a class="code" href="lmdes2__customizer_8c.html#f81839da89e889adb517d1fc96a456f9">00152</a> <span class="keywordtype">char</span> *<a class="code" href="lmdes2__customizer_8c.html#f81839da89e889adb517d1fc96a456f9">input_mode</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00153"></a><a class="code" href="lmdes2__customizer_8c.html#bbe586720dc5d6766839fbdc260002c1">00153</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#bbe586720dc5d6766839fbdc260002c1">output_page_width</a> = 80;
<a name="l00154"></a><a class="code" href="lmdes2__customizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">00154</a> <span class="keywordtype">int</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 0;
<a name="l00155"></a><a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">00155</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a> = 0;
<a name="l00156"></a><a class="code" href="lmdes2__customizer_8c.html#b8dfd5ac67573c68c04e14078ea2aeee">00156</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#b8dfd5ac67573c68c04e14078ea2aeee">tree_opti</a> = 1;
<a name="l00157"></a><a class="code" href="lmdes2__customizer_8c.html#b5d3cfa3af0f0d0f3aae26ebc6253224">00157</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#b5d3cfa3af0f0d0f3aae26ebc6253224">place_slots_first</a> = 0;
<a name="l00158"></a><a class="code" href="lmdes2__customizer_8c.html#0464ae67d9a81d2af58909687534f835">00158</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#0464ae67d9a81d2af58909687534f835">static_stats</a> = 0;
<a name="l00159"></a><a class="code" href="lmdes2__customizer_8c.html#34ea62a4bb6a61dc0899f0f65c9b8f46">00159</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#34ea62a4bb6a61dc0899f0f65c9b8f46">print_trees</a> = 0;
<a name="l00160"></a><a class="code" href="lmdes2__customizer_8c.html#138a3fb2763ae65b4e1a58716ed69355">00160</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#138a3fb2763ae65b4e1a58716ed69355">resource_minimization</a> = 1;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">/* Optimization levels:</span>
<a name="l00163"></a>00163 <span class="comment"> * </span>
<a name="l00164"></a>00164 <span class="comment"> * 0 No optimizations at all, minimal transformations to make MDES work.</span>
<a name="l00165"></a>00165 <span class="comment"> * 1 Run classical optimizations (common-subexpression, dead code removal)</span>
<a name="l00166"></a>00166 <span class="comment"> * 2 Use bit-field representation (no bit-field optis)</span>
<a name="l00167"></a>00167 <span class="comment"> * 3 Do general bit-field optimizations (zero-time transformation,</span>
<a name="l00168"></a>00168 <span class="comment"> *   resource minimization, reorder usage checks to check cycle 0 first)</span>
<a name="l00169"></a>00169 <span class="comment"> * 4 Do some AND/OR tree optiminzations (OR-tree reordering)</span>
<a name="l00170"></a>00170 <span class="comment"> * 5 Do all AND/OR tree optimizations (Also move common usages around)</span>
<a name="l00171"></a>00171 <span class="comment"> *   (Level 4 was found to yield the best average dynamic performance)</span>
<a name="l00172"></a>00172 <span class="comment"> * </span>
<a name="l00173"></a>00173 <span class="comment"> * Some of the individual optis (-no_minimizationand -no_tree_opti) </span>
<a name="l00174"></a>00174 <span class="comment"> * can be turned off with a separate flags.</span>
<a name="l00175"></a>00175 <span class="comment"> *</span>
<a name="l00176"></a>00176 <span class="comment"> * Expanding tables out into OR-Trees (-expand) is orthogonal to the above.</span>
<a name="l00177"></a>00177 <span class="comment"> * AND/OR tree optimizations automatically turned of if expanding tables</span>
<a name="l00178"></a>00178 <span class="comment"> * since can hurt or unexpand tables.</span>
<a name="l00179"></a>00179 <span class="comment"> */</span>
<a name="l00180"></a><a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">00180</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 4;             <span class="comment">/* Level 4 yields best average performance */</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">/* Global variables */</span>
<a name="l00184"></a><a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">00184</a> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct__L__Alloc__Pool.html">L_Alloc_Pool</a> *<a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">ENTRY_Contents_Table_pool</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00185"></a><a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">00185</a> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct__L__Alloc__Pool.html">L_Alloc_Pool</a> *<a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">ENTRY_Contents_Node_pool</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">/* Table of header file tables */</span>
<a name="l00188"></a><a class="code" href="lmdes2__customizer_8c.html#f225bb0e4137fd9f5fc16ee72bfbd988">00188</a> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *<a class="code" href="lmdes2__customizer_8c.html#f225bb0e4137fd9f5fc16ee72bfbd988">header_table_table</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">/* A string map used for renaming */</span>
<a name="l00191"></a><a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">00191</a> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *<a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">rename_table</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">/* Number of errors that occurred using header file */</span>
<a name="l00194"></a><a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">00194</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">header_errors</a> = 0;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="comment">/* Number of errors that occurred during customization (after header file</span>
<a name="l00197"></a>00197 <span class="comment"> * annotations).</span>
<a name="l00198"></a>00198 <span class="comment"> */</span>
<a name="l00199"></a><a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">00199</a> <span class="keywordtype">int</span> <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a> = 0;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keywordtype">void</span> <a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">print_generating_set</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * generating_set,
<a name="l00203"></a>00203                            <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> ** unit_array, <span class="keywordtype">int</span> committed);
<a name="l00204"></a>00204 <span class="keywordtype">void</span> <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l00205"></a>00205                    <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keywordtype">void</span> <a class="code" href="lmdes2__customizer_8c.html#a2b1793d18fb89fc6b66c789c85cc39a">print_table_trees</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="comment">/* Error routine, fmt and trailing args are the same as printf.</span>
<a name="l00210"></a>00210 <span class="comment"> * Adds header message identifying error as coming from IMPACT hmdes2</span>
<a name="l00211"></a>00211 <span class="comment"> * customizer.</span>
<a name="l00212"></a>00212 <span class="comment"> *</span>
<a name="l00213"></a>00213 <span class="comment"> * Exits with value 1.</span>
<a name="l00214"></a>00214 <span class="comment"> */</span>
<a name="l00215"></a>00215 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00216"></a><a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">00216</a> <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *fmt, ...)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218   va_list args;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   <span class="comment">/* Print error message header.</span>
<a name="l00221"></a>00221 <span class="comment">   * Allow NULL to be passed in for md</span>
<a name="l00222"></a>00222 <span class="comment">   */</span>
<a name="l00223"></a>00223   fprintf (stderr, <span class="stringliteral">"\nIMPACT hmdes2 customizer error"</span>);
<a name="l00224"></a>00224   <span class="keywordflow">if</span> (md == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00225"></a>00225     fprintf (stderr, <span class="stringliteral">":\n"</span>);
<a name="l00226"></a>00226   <span class="keywordflow">else</span>
<a name="l00227"></a>00227     fprintf (stderr, <span class="stringliteral">" (in \"%s\"):\n"</span>, md-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html#3897d56c1462bdc067453fe3a7d61131">name</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">/* Print out error message */</span>
<a name="l00230"></a>00230   va_start (args, fmt);
<a name="l00231"></a>00231   vfprintf (stderr, fmt, args);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   va_end (args);
<a name="l00234"></a>00234   fprintf (stderr, <span class="stringliteral">"\n"</span>);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   exit (1);
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="keywordtype">void</span>
<a name="l00240"></a><a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">00240</a> <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (FILE * out)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242   <span class="keyword">static</span> <span class="keywordtype">int</span> count = 0;
<a name="l00243"></a>00243   <span class="keywordtype">char</span> time_buf[100];
<a name="l00244"></a>00244   time_t cur_time;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   count++;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   cur_time = time (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00249"></a>00249   strftime (time_buf, <span class="keyword">sizeof</span> (time_buf),
<a name="l00250"></a>00250             <span class="stringliteral">"%H:%M:%S %p, %A %B %d"</span>, localtime (&amp;cur_time));
<a name="l00251"></a>00251   fprintf (out, <span class="stringliteral">"Time stamp %i: %s\n"</span>, count, time_buf);
<a name="l00252"></a>00252   fflush (out);
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="keywordtype">void</span>
<a name="l00256"></a><a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">00256</a> <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="keywordtype">char</span> *fmt, ...)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258   va_list args;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="comment">/* Print out error message if fmt is not NULL */</span>
<a name="l00261"></a>00261   <span class="keywordflow">if</span> (fmt != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       fprintf (stderr, <span class="stringliteral">"\nError: "</span>);
<a name="l00264"></a>00264       va_start (args, fmt);
<a name="l00265"></a>00265       vfprintf (stderr, fmt, args);
<a name="l00266"></a>00266       va_end (args);
<a name="l00267"></a>00267       fprintf (stderr, <span class="stringliteral">"\n"</span>);
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   fprintf (stderr, <span class="stringliteral">"\n"</span>);
<a name="l00271"></a>00271   fprintf (stderr, <span class="stringliteral">"usage: %s [options] [input_file]\n\n"</span>, <a class="code" href="lmdes2__customizer_8c.html#289c5900d90626d909f0a85d5a0ed61d">program_name</a>);
<a name="l00272"></a>00272   fprintf (stderr, <span class="stringliteral">"options:\n"</span>);
<a name="l00273"></a>00273   fprintf (stderr,
<a name="l00274"></a>00274            <span class="stringliteral">"  -On               where n is opti level (0-5), default 4\n"</span>);
<a name="l00275"></a>00275   fprintf (stderr,
<a name="l00276"></a>00276            <span class="stringliteral">"  -expand           expands all the table variations out\n"</span>);
<a name="l00277"></a>00277   fprintf (stderr,
<a name="l00278"></a>00278            <span class="stringliteral">"  -no_tree_opti     turn off AND/OR tree opti (tree opti may "</span>
<a name="l00279"></a>00279                                 <span class="stringliteral">"undo -expand)\n"</span>);
<a name="l00280"></a>00280   fprintf (stderr,
<a name="l00281"></a>00281            <span class="stringliteral">"  -static_stats     prints static stats about the optimized "</span>
<a name="l00282"></a>00282                                <span class="stringliteral">"mdes\n"</span>);
<a name="l00283"></a>00283   fprintf (stderr, <span class="stringliteral">"  -print_trees      prints the and/or trees to stdout\n"</span>);
<a name="l00284"></a>00284   fprintf (stderr,
<a name="l00285"></a>00285            <span class="stringliteral">"  -no_minimization  do not apply resource minimization "</span>
<a name="l00286"></a>00286                                <span class="stringliteral">"techniques\n"</span>);
<a name="l00287"></a>00287   fprintf (stderr,
<a name="l00288"></a>00288            <span class="stringliteral">"  -o output_file    outputs to output_file instead of to standard "</span>
<a name="l00289"></a>00289                                <span class="stringliteral">"output.\n"</span>);
<a name="l00290"></a>00290   fprintf (stderr,
<a name="l00291"></a>00291            <span class="stringliteral">"  -stdin            reads lmdes from standard input instead of "</span>
<a name="l00292"></a>00292                                 <span class="stringliteral">"input_file.\n"</span>);
<a name="l00293"></a>00293   fprintf (stderr,
<a name="l00294"></a>00294            <span class="stringliteral">"  -hmdes            output compiled hmdes instead of lmdes.\n"</span>);
<a name="l00295"></a>00295   fprintf (stderr,
<a name="l00296"></a>00296            <span class="stringliteral">"  -width int        sets page width for -hmdes output.\n"</span>);
<a name="l00297"></a>00297   fprintf (stderr,
<a name="l00298"></a>00298            <span class="stringliteral">"  -verbose          prints customization steps to stdout.\n"</span>);
<a name="l00299"></a>00299   fprintf (stderr, <span class="stringliteral">"\n"</span>);
<a name="l00300"></a>00300   fprintf (stderr, <span class="stringliteral">"debug options:\n"</span>);
<a name="l00301"></a>00301   fprintf (stderr,
<a name="l00302"></a>00302            <span class="stringliteral">"  -bypass_alloc     use malloc instead of alloc routines.\n"</span>);
<a name="l00303"></a>00303   fprintf (stderr, <span class="stringliteral">"\n"</span>);
<a name="l00304"></a>00304   exit (1);
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="keywordtype">void</span>
<a name="l00308"></a><a class="code" href="lmdes2__customizer_8c.html#b5ad1e75f3e95a8372855846f911efe1">00308</a> <a class="code" href="lmdes2__customizer_8c.html#b5ad1e75f3e95a8372855846f911efe1">read_command_line_parameters</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **arg_ptr)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310   <span class="keywordtype">char</span> *end_ptr;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <span class="comment">/* Get program name for error messages */</span>
<a name="l00313"></a>00313   <a class="code" href="lmdes2__customizer_8c.html#289c5900d90626d909f0a85d5a0ed61d">program_name</a> = strdup (*arg_ptr);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315   <span class="comment">/* Start parsing arguments at first argument */</span>
<a name="l00316"></a>00316   arg_ptr++;
<a name="l00317"></a>00317   <span class="keywordflow">for</span> (; *arg_ptr != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; arg_ptr++)
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319       <span class="comment">/* If first character is a '-', must be an option */</span>
<a name="l00320"></a>00320       <span class="keywordflow">if</span> ((*arg_ptr)[0] == <span class="charliteral">'-'</span>)
<a name="l00321"></a>00321         {
<a name="l00322"></a>00322           <span class="comment">/* Get output file */</span>
<a name="l00323"></a>00323           <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-o"</span>) == 0)
<a name="l00324"></a>00324             {
<a name="l00325"></a>00325               <span class="comment">/* Make sure -o not specified twice */</span>
<a name="l00326"></a>00326               <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00327"></a>00327                 {
<a name="l00328"></a>00328                   <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"-o option specified twice."</span>);
<a name="l00329"></a>00329                 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331               <span class="comment">/* Get output file name, expect it to be non-NULL */</span>
<a name="l00332"></a>00332               arg_ptr++;
<a name="l00333"></a>00333               <span class="keywordflow">if</span> (*arg_ptr == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00334"></a>00334                 {
<a name="l00335"></a>00335                   <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"expected '-o output_file'.\n"</span>);
<a name="l00336"></a>00336                 }
<a name="l00337"></a>00337               <a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> = strdup (*arg_ptr);
<a name="l00338"></a>00338             }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340           <span class="comment">/* Get opti-level */</span>
<a name="l00341"></a>00341           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*arg_ptr)[1] == <span class="charliteral">'O'</span>)
<a name="l00342"></a>00342             {
<a name="l00343"></a>00343               <span class="keywordflow">switch</span> ((*arg_ptr)[2])
<a name="l00344"></a>00344                 {
<a name="l00345"></a>00345                 <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
<a name="l00346"></a>00346                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 0;
<a name="l00347"></a>00347                   <span class="keywordflow">break</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                 <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
<a name="l00350"></a>00350                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 1;
<a name="l00351"></a>00351                   <span class="keywordflow">break</span>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                 <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
<a name="l00354"></a>00354                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 2;
<a name="l00355"></a>00355                   <span class="keywordflow">break</span>;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357                 <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
<a name="l00358"></a>00358                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 3;
<a name="l00359"></a>00359                   <span class="keywordflow">break</span>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361                 <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
<a name="l00362"></a>00362                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 4;
<a name="l00363"></a>00363                   <span class="keywordflow">break</span>;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365                 <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
<a name="l00366"></a>00366                   <a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> = 5;
<a name="l00367"></a>00367                   <span class="keywordflow">break</span>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                 <span class="keywordflow">default</span>:
<a name="l00370"></a>00370                   <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a>
<a name="l00371"></a>00371                     (<span class="stringliteral">"Invalid opti level specified '%s', level 0-5 expected."</span>,
<a name="l00372"></a>00372                      *arg_ptr);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374                 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376               <span class="comment">/* Better be null after number */</span>
<a name="l00377"></a>00377               <span class="keywordflow">if</span> ((*arg_ptr)[3] != 0)
<a name="l00378"></a>00378                 <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"Invalid opti level specifier '%s'.\n"</span>,
<a name="l00379"></a>00379                              *arg_ptr);
<a name="l00380"></a>00380             }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382           <span class="comment">/* Get the -expand flag */</span>
<a name="l00383"></a>00383           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-expand"</span>) == 0)
<a name="l00384"></a>00384             {
<a name="l00385"></a>00385               <a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a> = 1;
<a name="l00386"></a>00386             }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388           <span class="comment">/* Get the -no_tree_opti flag */</span>
<a name="l00389"></a>00389           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-no_tree_opti"</span>) == 0)
<a name="l00390"></a>00390             {
<a name="l00391"></a>00391               printf (<span class="stringliteral">"&gt; No AND/OR tree optimizations will be performed.\n"</span>);
<a name="l00392"></a>00392               <a class="code" href="lmdes2__customizer_8c.html#b8dfd5ac67573c68c04e14078ea2aeee">tree_opti</a> = 0;
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395           <span class="comment">/* Get the -static_stats flag */</span>
<a name="l00396"></a>00396           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-static_stats"</span>) == 0)
<a name="l00397"></a>00397             {
<a name="l00398"></a>00398               <a class="code" href="lmdes2__customizer_8c.html#0464ae67d9a81d2af58909687534f835">static_stats</a> = 1;
<a name="l00399"></a>00399             }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401           <span class="comment">/* Get the -print_trees flag */</span>
<a name="l00402"></a>00402           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-print_trees"</span>) == 0)
<a name="l00403"></a>00403             {
<a name="l00404"></a>00404               <a class="code" href="lmdes2__customizer_8c.html#34ea62a4bb6a61dc0899f0f65c9b8f46">print_trees</a> = 1;
<a name="l00405"></a>00405             }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407           <span class="comment">/* Get -no_minimization flag */</span>
<a name="l00408"></a>00408           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-no_minimization"</span>) == 0)
<a name="l00409"></a>00409             {
<a name="l00410"></a>00410               <a class="code" href="lmdes2__customizer_8c.html#138a3fb2763ae65b4e1a58716ed69355">resource_minimization</a> = 0;
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413           <span class="comment">/* Get -stdin flag */</span>
<a name="l00414"></a>00414           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-stdin"</span>) == 0)
<a name="l00415"></a>00415             {
<a name="l00416"></a>00416               <a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">using_stdin</a> = 1;
<a name="l00417"></a>00417             }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419           <span class="comment">/* Get -hmdes flag */</span>
<a name="l00420"></a>00420           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-hmdes"</span>) == 0)
<a name="l00421"></a>00421             {
<a name="l00422"></a>00422               <span class="comment">/* Make sure some other output mode is not specified */</span>
<a name="l00423"></a>00423               <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00424"></a>00424                 <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"output mode specified twice '%s' and '%s'."</span>,
<a name="l00425"></a>00425                              <a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a>, *arg_ptr);
<a name="l00426"></a>00426               <a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a> = strdup (*arg_ptr);
<a name="l00427"></a>00427             }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429           <span class="comment">/* Get -width n flag */</span>
<a name="l00430"></a>00430           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-width"</span>) == 0)
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432               <span class="comment">/* Get width argument, expect it to be non-NULL */</span>
<a name="l00433"></a>00433               arg_ptr++;
<a name="l00434"></a>00434               <span class="keywordflow">if</span> (*arg_ptr == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00435"></a>00435                 {
<a name="l00436"></a>00436                   <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"expected '-width int'.\n"</span>);
<a name="l00437"></a>00437                 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439               <a class="code" href="lmdes2__customizer_8c.html#bbe586720dc5d6766839fbdc260002c1">output_page_width</a> = strtol (*arg_ptr, &amp;end_ptr, 10);
<a name="l00440"></a>00440               <span class="keywordflow">if</span> (*end_ptr != 0)
<a name="l00441"></a>00441                 {
<a name="l00442"></a>00442                   <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"expected '-width int'.\n"</span>);
<a name="l00443"></a>00443                 }
<a name="l00444"></a>00444             }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446           <span class="comment">/* Get -verbose flag */</span>
<a name="l00447"></a>00447           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-verbose"</span>) == 0)
<a name="l00448"></a>00448             {
<a name="l00449"></a>00449               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 1;
<a name="l00450"></a>00450             }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452           <span class="comment">/* Get -bypass_alloc flag */</span>
<a name="l00453"></a>00453           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg_ptr, <span class="stringliteral">"-bypass_alloc"</span>) == 0)
<a name="l00454"></a>00454             {
<a name="l00455"></a>00455               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#a3b32dfd5d5c937e01c07ffd52c4ecda">bypass_alloc_routines</a> = 1;
<a name="l00456"></a>00456             }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458           <span class="keywordflow">else</span>
<a name="l00459"></a>00459             {
<a name="l00460"></a>00460               <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"unknown command line option '%s'.\n"</span>, *arg_ptr);
<a name="l00461"></a>00461             }
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464       <span class="comment">/* Otherwise, must be file name (can only be one of command line) */</span>
<a name="l00465"></a>00465       <span class="keywordflow">else</span>
<a name="l00466"></a>00466         {
<a name="l00467"></a>00467           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00468"></a>00468             {
<a name="l00469"></a>00469               <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"only one input file may be specified.\n"</span>);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471             }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473           <span class="comment">/* Get input file name */</span>
<a name="l00474"></a>00474           <a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> = strdup (*arg_ptr);
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="comment">/* Make sure input file has been specified */</span>
<a name="l00479"></a>00479   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; !<a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">using_stdin</a>)
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481       <span class="comment">/* Print error only if they specified something */</span>
<a name="l00482"></a>00482       <span class="keywordflow">if</span> (argc &gt; 1)
<a name="l00483"></a>00483         {
<a name="l00484"></a>00484           <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"input_file or -stdin must be specified.\n"</span>);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486       <span class="keywordflow">else</span>
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488           <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="comment">/* Make sure input_file and -stdin have not both been specified */</span>
<a name="l00493"></a>00493   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; <a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">using_stdin</a>)
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495       <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a> (<span class="stringliteral">"may not specify both input_file and -stdin.\n"</span>);
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498   <span class="comment">/* Make sure input and output file are not the same */</span>
<a name="l00499"></a>00499   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l00500"></a>00500       (strcmp (<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a>, <a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a>) == 0))
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502       <a class="code" href="lmdes2__customizer_8c.html#62ac7a1cfa066f61a3317977c936b8f2">print_usage</a>
<a name="l00503"></a>00503         (<span class="stringliteral">"may not specify input file (%s) that is the same as output file."</span>,
<a name="l00504"></a>00504          input_file_name);
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="keywordtype">int</span>
<a name="l00510"></a><a class="code" href="lmdes2__customizer_8c.html#3c04138a5bfe5d72780bb7e82a18e627">00510</a> <a class="code" href="lmdes2__customizer_8c.html#3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512   FILE *in;
<a name="l00513"></a>00513   FILE *out;
<a name="l00514"></a>00514   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> *md;
<a name="l00515"></a>00515   <span class="keywordtype">int</span> error_count;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517   <span class="comment">/* Read command line arguments and input file name */</span>
<a name="l00518"></a>00518   <a class="code" href="lmdes2__customizer_8c.html#b5ad1e75f3e95a8372855846f911efe1">read_command_line_parameters</a> (argc, argv);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="comment">/* Open input file */</span>
<a name="l00521"></a>00521   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#bc340a0cfa46e3f25a4d1adab28331c0">using_stdin</a>)
<a name="l00522"></a>00522     {
<a name="l00523"></a>00523       <a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a> = strdup (<span class="stringliteral">"(stdin)"</span>);
<a name="l00524"></a>00524       in = stdin;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526   <span class="keywordflow">else</span>
<a name="l00527"></a>00527     {
<a name="l00528"></a>00528       <span class="keywordflow">if</span> ((in = fopen (<a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a>, <span class="stringliteral">"r"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00529"></a>00529         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Unable to open input file '%s'."</span>, input_file_name);
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="comment">/* Open output file */</span>
<a name="l00533"></a>00533   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00534"></a>00534     {
<a name="l00535"></a>00535       <a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a> = strdup (<span class="stringliteral">"(stdout)"</span>);
<a name="l00536"></a>00536       out = stdout;
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538   <span class="keywordflow">else</span>
<a name="l00539"></a>00539     {
<a name="l00540"></a>00540       <span class="keywordflow">if</span> ((out = fopen (<a class="code" href="lmdes2__customizer_8c.html#cdcd0d11bb729145f180d52a0755cddf">output_file_name</a>, <span class="stringliteral">"w"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00541"></a>00541         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Unable to open output file '%s'."</span>, output_file_name);
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544   <span class="comment">/* Read in lmdes */</span>
<a name="l00545"></a>00545   md = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#0574c5322b5fd565ffc5adfc2e6e8614">MD_read_md</a> (in, <a class="code" href="lmdes2__customizer_8c.html#a91ff4ee3ee60baee9c097d4da3e3d18">input_file_name</a>);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00548"></a>00548     printf (<span class="stringliteral">"Checking lmdes2 for consistency before customization.\n\n"</span>);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   <span class="comment">/* Check md for consistency before customizing */</span>
<a name="l00551"></a>00551   <span class="keywordflow">if</span> ((error_count = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c8488b1c9a90e9b52187a89338183b2c">MD_check_md</a> (stderr, md)) != 0)
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l00554"></a>00554               <span class="stringliteral">"%i inconsistencies found before customization!\n"</span>
<a name="l00555"></a>00555               <span class="stringliteral">"Cannot customize."</span>,
<a name="l00556"></a>00556               error_count);
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="comment">/* Customize md for IMPACT */</span>
<a name="l00560"></a>00560   <a class="code" href="lmdes2__customizer_8c.html#325650c03d399b4e850fe3a9bda3df17">customize_md</a> (md);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="comment">/* Code stable. Don't check for now to speed up */</span>
<a name="l00563"></a>00563 <span class="preprocessor">#if 0</span>
<a name="l00564"></a>00564 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00565"></a>00565     printf (<span class="stringliteral">"\nChecking lmdes2 for consistency after customization.\n"</span>);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   <span class="comment">/* Check md for consistency after customizing */</span>
<a name="l00568"></a>00568   <span class="keywordflow">if</span> ((error_count = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c8488b1c9a90e9b52187a89338183b2c">MD_check_md</a> (stderr, md)) != 0)
<a name="l00569"></a>00569     {
<a name="l00570"></a>00570       fprintf (stderr,
<a name="l00571"></a>00571                <span class="stringliteral">"Error after customizing '%s':\n  %i inconsistencies found!\n"</span>,
<a name="l00572"></a>00572                md-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html#3897d56c1462bdc067453fe3a7d61131">name</a>, error_count);
<a name="l00573"></a>00573       fprintf (stderr,
<a name="l00574"></a>00574                <span class="stringliteral">"  Either the customizer should have punted before now or\nthe "</span>
<a name="l00575"></a>00575                <span class="stringliteral">"customization program needs to be fixed!\n"</span>);
<a name="l00576"></a>00576       fprintf (stderr,
<a name="l00577"></a>00577                <span class="stringliteral">"  Writing customized version anyway (for debugging only)!\n"</span>);
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579 <span class="preprocessor">#endif</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>
<a name="l00581"></a>00581   <span class="comment">/* Print out lmdes in form desired */</span>
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00583"></a>00583     {
<a name="l00584"></a>00584       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#08198a382f6e7b587c2a239dcb3af660">MD_write_md</a> (out, md);
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="code" href="lmdes2__customizer_8c.html#14a61661c70b91f945e8456ead9fb6c1">output_mode</a>, <span class="stringliteral">"-hmdes"</span>) == 0)
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588       <span class="comment">/* Print out section and entry declarations so, combined with the</span>
<a name="l00589"></a>00589 <span class="comment">       * output of MD_print_md, the output will be a legal hmdes file.</span>
<a name="l00590"></a>00590 <span class="comment">       */</span>
<a name="l00591"></a>00591       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f8bca4aa4b831162fb2d76ba4a86d6aa">MD_print_md_declarations</a> (out, md, 80);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <span class="comment">/* Put blank line after declarations */</span>
<a name="l00594"></a>00594       putc (<span class="charliteral">'\n'</span>, out);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a9df1e553926805d90c54daf8439c069">MD_print_md</a> (out, md, 80);
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598   <span class="keywordflow">else</span>
<a name="l00599"></a>00599     {
<a name="l00600"></a>00600       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Unknown output mode '%s'."</span>, output_mode);
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603   <span class="comment">/* Free output mode */</span>
<a name="l00604"></a>00604   <span class="keywordflow">if</span> (output_mode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00605"></a>00605     free (output_mode);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="comment">/* About to end anyway, don't spend time to delete structures */</span>
<a name="l00608"></a>00608 <span class="preprocessor">#if 0</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>  <span class="comment">/* Free the database */</span>
<a name="l00610"></a>00610   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#99c47f09ca8903d26efed1efe24e352e">MD_delete_md</a> (md);
<a name="l00611"></a>00611 <span class="preprocessor">#endif</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>
<a name="l00613"></a>00613   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00614"></a>00614     printf (<span class="stringliteral">"Customization complete.\n"</span>);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">/* Close input and output (may be stdin/stdout) */</span>
<a name="l00617"></a>00617   fclose (in);
<a name="l00618"></a>00618   fclose (out);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="keywordflow">return</span> (0);
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="keywordtype">void</span>
<a name="l00624"></a><a class="code" href="lmdes2__customizer_8c.html#335c1116a90b866de4a2951d0bb9eca0">00624</a> <a class="code" href="lmdes2__customizer_8c.html#335c1116a90b866de4a2951d0bb9eca0">read_header_tables</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *parm_section;
<a name="l00627"></a>00627   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *value_field_decl;
<a name="l00628"></a>00628   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *header_entry;
<a name="l00629"></a>00629   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *value_field;
<a name="l00630"></a>00630   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *table;
<a name="l00631"></a>00631   <span class="keywordtype">char</span> *header_name;
<a name="l00632"></a>00632   <span class="keywordtype">int</span> i;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="comment">/* Get the parameter section from database */</span>
<a name="l00635"></a>00635   <span class="keywordflow">if</span> ((parm_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, <span class="stringliteral">"Parameter"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00636"></a>00636     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'Parameter' section expected in hmdes2."</span>);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="comment">/* Get the value field declaration (so can find field) */</span>
<a name="l00639"></a>00639   <span class="keywordflow">if</span> ((value_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (parm_section, <span class="stringliteral">"value"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l00642"></a>00642               <span class="stringliteral">"'value' field declaration expected in 'Parameter' section."</span>);
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="comment">/* Get the entry that lists the header table names */</span>
<a name="l00646"></a>00646   header_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ed997dd6e6244f22cfadf1befbd1a630">MD_find_entry</a> (parm_section, <span class="stringliteral">"customization_headers"</span>);
<a name="l00647"></a>00647   <span class="keywordflow">if</span> (header_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l00650"></a>00650               <span class="stringliteral">"'customization_headers' entry expected in '%s' section."</span>,
<a name="l00651"></a>00651               parm_section-&gt;name);
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="comment">/* Get the value field */</span>
<a name="l00655"></a>00655   <span class="keywordflow">if</span> ((value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (header_entry, value_field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'value' field expected in %s-&gt;%s"</span>, parm_section-&gt;name,
<a name="l00658"></a>00658               header_entry-&gt;name);
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <span class="comment">/* Expect at least one name in field */</span>
<a name="l00662"></a>00662   <span class="keywordflow">if</span> (value_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &lt; 0)
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l00665"></a>00665               <span class="stringliteral">"At least one header file must be specified in\n%s-&gt;%s-&gt;%s."</span>,
<a name="l00666"></a>00666               parm_section-&gt;name, header_entry-&gt;name,
<a name="l00667"></a>00667               value_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#507895b2c7e647afd56840a2a0cd2136">decl</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <span class="comment">/* Create table of header tables */</span>
<a name="l00671"></a>00671   <a class="code" href="lmdes2__customizer_8c.html#f225bb0e4137fd9f5fc16ee72bfbd988">header_table_table</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#28305366471c84770b5d9e0a2de17974">STRING_new_symbol_table</a> (<span class="stringliteral">"Header Table"</span>, 64);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <span class="comment">/* Read in headers specified */</span>
<a name="l00674"></a>00674   <span class="keywordflow">for</span> (i = 0; i &lt;= value_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l00675"></a>00675     {
<a name="l00676"></a>00676       header_name = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#071dc413a821b518ca716a2a4fdb638a">MD_get_string</a> (value_field, i);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/execute_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00679"></a>00679         printf (<span class="stringliteral">"Reading '%s'.\n"</span>, header_name);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="comment">/* If have not already read this header file, read it in */</span>
<a name="l00682"></a>00682       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#37705fddebdfab067437338d4063abbe">STRING_find_symbol</a> (<a class="code" href="lmdes2__customizer_8c.html#f225bb0e4137fd9f5fc16ee72bfbd988">header_table_table</a>, header_name) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684           <span class="comment">/* Read in header table */</span>
<a name="l00685"></a>00685           table = <a class="code" href="header__reader2_8c.html#33574aec74728b493ce42679b1c18d10">read_header_file</a> (header_name, verbose);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687           <span class="comment">/* Add to table of tables */</span>
<a name="l00688"></a>00688           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#3a03bfbed0ac7378507b799366f99c83">STRING_add_symbol</a> (header_table_table, header_name, (<span class="keywordtype">void</span> *) table);
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691       <span class="comment">/* Otherwise, punt that name specified twice */</span>
<a name="l00692"></a>00692       <span class="keywordflow">else</span>
<a name="l00693"></a>00693         {
<a name="l00694"></a>00694           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[%i]:\n  '%s' specified twice."</span>,
<a name="l00695"></a>00695                   parm_section-&gt;name, header_entry-&gt;name,
<a name="l00696"></a>00696                   value_field-&gt;decl-&gt;name, i, header_name);
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a><a class="code" href="lmdes2__customizer_8c.html#9cf0008f332fed26b2b4149b66205559">00701</a> <span class="preprocessor">#define MAX_IDENT_LEN   (100+1)</span>
<a name="l00702"></a>00702 <span class="preprocessor"></span>
<a name="l00703"></a>00703 <span class="keywordtype">int</span>
<a name="l00704"></a><a class="code" href="lmdes2__customizer_8c.html#3104e311f120343924d365c7d4a9f816">00704</a> <a class="code" href="lmdes2__customizer_8c.html#3104e311f120343924d365c7d4a9f816">find_header_value</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct@1.html#37bcc8711ce73b1674632b61832d13b2">name</a>, <span class="keywordtype">int</span> *value)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *table;
<a name="l00707"></a>00707   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html">STRING_Symbol</a> *symbol;
<a name="l00708"></a>00708   <span class="keywordtype">char</span> *val_str, *end_ptr;
<a name="l00709"></a>00709   <span class="keywordtype">char</span> *prev_def, *prev_str;
<a name="l00710"></a>00710   <span class="keywordtype">int</span> prev_val;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   prev_def = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00713"></a>00713   prev_str = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00714"></a>00714   prev_val = -1;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <span class="comment">/* Search all header files for name */</span>
<a name="l00717"></a>00717   <span class="keywordflow">for</span> (symbol = <a class="code" href="lmdes2__customizer_8c.html#f225bb0e4137fd9f5fc16ee72bfbd988">header_table_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html#c7a0ee13203010e88bafefe25538a7bc">head_symbol</a>; symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00718"></a>00718        symbol = symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#afd60379fc4913c72b86a10dd48d9ac7">next_symbol</a>)
<a name="l00719"></a>00719     {
<a name="l00720"></a>00720       table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol__Table.html">STRING_Symbol_Table</a> *) symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#1cffd5937e773a688315d44a0fd8d50f">data</a>;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722       val_str = (<span class="keywordtype">char</span> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#da0f492911e7e3f00b09b45442a17637">STRING_find_symbol_data</a> (table, name);
<a name="l00723"></a>00723 
<a name="l00724"></a>00724       <span class="keywordflow">if</span> (val_str == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00725"></a>00725         <span class="keywordflow">continue</span>;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727       <span class="comment">/* Try to convert to an int */</span>
<a name="l00728"></a>00728       *value = strtol (val_str, &amp;end_ptr, 0);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730       <span class="keywordflow">if</span> ((*end_ptr != 0) || (val_str[0] == 0))
<a name="l00731"></a>00731         {
<a name="l00732"></a>00732           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s value '%s' expected to be an int in\n'%s'."</span>,
<a name="l00733"></a>00733                   name, val_str, table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html#3897d56c1462bdc067453fe3a7d61131">name</a>);
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736       <span class="comment">/* Detect if defined to two different values set for name */</span>
<a name="l00737"></a>00737       <span class="keywordflow">if</span> (prev_def == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00738"></a>00738         {
<a name="l00739"></a>00739           prev_def = table-&gt;name;
<a name="l00740"></a>00740           prev_val = *value;
<a name="l00741"></a>00741           prev_str = val_str;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743       <span class="keywordflow">else</span>
<a name="l00744"></a>00744         {
<a name="l00745"></a>00745           <span class="keywordflow">if</span> (prev_val != *value)
<a name="l00746"></a>00746             {
<a name="l00747"></a>00747               fprintf (stderr,
<a name="l00748"></a>00748                        <span class="stringliteral">"Error, %s defined to two different values in "</span>
<a name="l00749"></a>00749                        <span class="stringliteral">"header files:\n '%s' defines as '%s'\n '%s' defines "</span>
<a name="l00750"></a>00750                        <span class="stringliteral">"as '%s'\n\n"</span>,
<a name="l00751"></a>00751                        name, prev_def, prev_str, table-&gt;name, val_str);
<a name="l00752"></a>00752               <a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">header_errors</a>++;
<a name="l00753"></a>00753             }
<a name="l00754"></a>00754         }
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757   <span class="keywordflow">if</span> (prev_def != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00758"></a>00758     <span class="keywordflow">return</span> (1);
<a name="l00759"></a>00759   <span class="keywordflow">else</span>
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761       *value = -1;
<a name="l00762"></a>00762       <span class="keywordflow">return</span> (0);
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="comment">/* Annotates the values associated with the entry's name by searching</span>
<a name="l00767"></a>00767 <span class="comment"> * the header files using the 'prefix' prefixed to the entrys name.</span>
<a name="l00768"></a>00768 <span class="comment"> * Puts this INT into the 'field_name' field.</span>
<a name="l00769"></a>00769 <span class="comment"> *</span>
<a name="l00770"></a>00770 <span class="comment"> * If value not found in header file and 'required' set, gives error.</span>
<a name="l00771"></a>00771 <span class="comment"> */</span>
<a name="l00772"></a>00772 <span class="keywordtype">void</span>
<a name="l00773"></a><a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">00773</a> <a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">annotate_header_values</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name,
<a name="l00774"></a>00774                         <span class="keywordtype">char</span> *prefix, <span class="keywordtype">int</span> required)
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l00777"></a>00777   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l00778"></a>00778   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l00779"></a>00779   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l00780"></a>00780   <span class="keywordtype">char</span> name_buf[<a class="code" href="lmdes2__customizer_8c.html#9cf0008f332fed26b2b4149b66205559">MAX_IDENT_LEN</a> + 50];
<a name="l00781"></a>00781   <span class="keywordtype">int</span> value;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="comment">/* The prefix better be less than 50 characters (so will fit in name_buf) */</span>
<a name="l00785"></a>00785   <span class="keywordflow">if</span> (strlen (prefix) &gt;= 50)
<a name="l00786"></a>00786     {
<a name="l00787"></a>00787       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Prefix '%s' for section '%s' too long!"</span>, prefix,
<a name="l00788"></a>00788               section_name);
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   <span class="comment">/* Get the section we are annotating from database */</span>
<a name="l00793"></a>00793   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00794"></a>00794     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <span class="comment">/* Delete all existing fields of 'field_name'(if exist), by deleting</span>
<a name="l00797"></a>00797 <span class="comment">   * field declaration.</span>
<a name="l00798"></a>00798 <span class="comment">   */</span>
<a name="l00799"></a>00799   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, field_name);
<a name="l00800"></a>00800   <span class="keywordflow">if</span> (field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00801"></a>00801     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (field_decl);
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   <span class="comment">/* Create new OPTIONAL or REQUIRED field declaration that has 1 int in it.</span>
<a name="l00805"></a>00805 <span class="comment">   */</span>
<a name="l00806"></a>00806   <span class="keywordflow">if</span> (required)
<a name="l00807"></a>00807     {
<a name="l00808"></a>00808       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, field_name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810   <span class="keywordflow">else</span>
<a name="l00811"></a>00811     {
<a name="l00812"></a>00812       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, field_name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>);
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (field_decl, 0);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="comment">/* Scan all entries and look for corresponding #defines in the header</span>
<a name="l00817"></a>00817 <span class="comment">   * files.</span>
<a name="l00818"></a>00818 <span class="comment">   */</span>
<a name="l00819"></a>00819   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00820"></a>00820        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l00821"></a>00821     {
<a name="l00822"></a>00822       <span class="comment">/* Make sure length of entry name is less than MAX_IDENT_LEN */</span>
<a name="l00823"></a>00823       <span class="keywordflow">if</span> (strlen (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name) &gt;= <a class="code" href="lmdes2__customizer_8c.html#9cf0008f332fed26b2b4149b66205559">MAX_IDENT_LEN</a>)
<a name="l00824"></a>00824         {
<a name="l00825"></a>00825           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l00826"></a>00826                   <span class="stringliteral">"Section %s: '%s' exceeds the %i char max impossed for "</span>
<a name="l00827"></a>00827                   <span class="stringliteral">"sanities sake!"</span>,
<a name="l00828"></a>00828                   section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, <a class="code" href="lmdes2__customizer_8c.html#9cf0008f332fed26b2b4149b66205559">MAX_IDENT_LEN</a> - 1);
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831       <span class="comment">/* Add prefix for search */</span>
<a name="l00832"></a>00832       sprintf (name_buf, <span class="stringliteral">"%s%s"</span>, prefix, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834       <span class="comment">/* If value found, add lcode_id field with the value found */</span>
<a name="l00835"></a>00835       <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#3104e311f120343924d365c7d4a9f816">find_header_value</a> (md, name_buf, &amp;value))
<a name="l00836"></a>00836         {
<a name="l00837"></a>00837           field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl, 1);
<a name="l00838"></a>00838           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (field, 0, value);
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (required)
<a name="l00841"></a>00841         {
<a name="l00842"></a>00842           fprintf (stderr,
<a name="l00843"></a>00843                    <span class="stringliteral">"Error customizing %s-&gt;%s:\n  '%s' not found in any of "</span>
<a name="l00844"></a>00844                    <span class="stringliteral">"the header files!\n\n"</span>,
<a name="l00845"></a>00845                    section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, name_buf);
<a name="l00846"></a>00846           <a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">header_errors</a>++;
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 <span class="comment">/* 20020822 SZU</span>
<a name="l00852"></a>00852 <span class="comment"> * Assign hash number field to the section in new field 'hash'.</span>
<a name="l00853"></a>00853 <span class="comment"> *</span>
<a name="l00854"></a>00854 <span class="comment"> * Originally for Operation section to provide hash number for latency classes.</span>
<a name="l00855"></a>00855 <span class="comment"> */</span>
<a name="l00856"></a>00856 <span class="keywordtype">void</span>
<a name="l00857"></a><a class="code" href="lmdes2__customizer_8c.html#9269b069890aaa0c3eadf5b9e64e2a72">00857</a> <a class="code" href="lmdes2__customizer_8c.html#9269b069890aaa0c3eadf5b9e64e2a72">annotate_hash</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name)
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l00860"></a>00860   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *dest_field_decl;
<a name="l00861"></a>00861   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *dest_field;
<a name="l00862"></a>00862   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l00863"></a>00863   <span class="keywordtype">int</span> index;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865   <span class="comment">/* Get the section we are annotating from database */</span>
<a name="l00866"></a>00866   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00867"></a>00867     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869   <span class="comment">/* Delete all existing field of 'hash', by deleting the field declaration. */</span>
<a name="l00870"></a>00870   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"hash"</span>);
<a name="l00871"></a>00871   <span class="keywordflow">if</span> (dest_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00872"></a>00872     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (dest_field_decl);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="comment">/* Create new field of name 'hash' that has int in it. */</span>
<a name="l00875"></a>00875   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, <span class="stringliteral">"hash"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l00876"></a>00876   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 0);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   index = 0;
<a name="l00879"></a>00879   <span class="comment">/* Scan all entries in section */</span>
<a name="l00880"></a>00880   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00881"></a>00881        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l00882"></a>00882     {
<a name="l00883"></a>00883       dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, dest_field_decl, 1);
<a name="l00884"></a>00884       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, index);
<a name="l00885"></a>00885       index++;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889 <span class="comment">/* 20020822 SZU</span>
<a name="l00890"></a>00890 <span class="comment"> * New version of annotate_latency_class.</span>
<a name="l00891"></a>00891 <span class="comment"> * Instead of storing string, store hash number of Operation.</span>
<a name="l00892"></a>00892 <span class="comment"> * Hash number done by annotate_hash function.</span>
<a name="l00893"></a>00893 <span class="comment"> *</span>
<a name="l00894"></a>00894 <span class="comment"> * Originally for the latency class in IMPACT_Operation and Prod_Cons_Latency.</span>
<a name="l00895"></a>00895 <span class="comment"> * Preserve latency class information, which is based on either Operation</span>
<a name="l00896"></a>00896 <span class="comment"> * or Scheduling Alternative.</span>
<a name="l00897"></a>00897 <span class="comment"> *</span>
<a name="l00898"></a>00898 <span class="comment"> * src_field_name is the name of the field in the section that has the latency</span>
<a name="l00899"></a>00899 <span class="comment"> * class info.</span>
<a name="l00900"></a>00900 <span class="comment"> * dest_field_name is the field in which the info will be preserved.</span>
<a name="l00901"></a>00901 <span class="comment"> * Instead of storing the name in a string, the info now stores a hash number,</span>
<a name="l00902"></a>00902 <span class="comment"> * determined via annotate_hash function.</span>
<a name="l00903"></a>00903 <span class="comment"> */</span>
<a name="l00904"></a>00904 <span class="keywordtype">void</span>
<a name="l00905"></a><a class="code" href="lmdes2__customizer_8c.html#4f7bcf59270a7e4092afdc10b639fc36">00905</a> <a class="code" href="lmdes2__customizer_8c.html#4f7bcf59270a7e4092afdc10b639fc36">annotate_latency_class</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *src_field_name,
<a name="l00906"></a>00906                         <span class="keywordtype">char</span> *dest_field_name)
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l00909"></a>00909   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *src_field_decl, *dest_field_decl, *hash_field_decl;
<a name="l00910"></a>00910   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *src_field, *dest_field, *hash_field;
<a name="l00911"></a>00911   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *src_entry, *value_entry;
<a name="l00912"></a>00912   <span class="keywordtype">int</span> index, hash;
<a name="l00913"></a>00913   
<a name="l00914"></a>00914   <span class="comment">/* Get the sections we are annotating from database */</span>
<a name="l00915"></a>00915   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00916"></a>00916     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918   <span class="comment">/* Get the field that the latency classes will come from */</span>
<a name="l00919"></a>00919   src_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, src_field_name);
<a name="l00920"></a>00920   <span class="keywordflow">if</span> (src_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00921"></a>00921     {
<a name="l00922"></a>00922       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in section '%s' not found."</span>,
<a name="l00923"></a>00923               src_field_name, section_name);
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926   <span class="comment">/* Delete all existing field of 'dest_field_name', by deleting</span>
<a name="l00927"></a>00927 <span class="comment">   * the field declaration.</span>
<a name="l00928"></a>00928 <span class="comment">   */</span>
<a name="l00929"></a>00929   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, dest_field_name);
<a name="l00930"></a>00930   <span class="keywordflow">if</span> (dest_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00931"></a>00931     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (dest_field_decl);
<a name="l00932"></a>00932 
<a name="l00933"></a>00933   <span class="comment">/* Create new field of name 'dest_field_name' that has int in it. */</span>
<a name="l00934"></a>00934   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, dest_field_name,
<a name="l00935"></a>00935                                            <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l00936"></a>00936   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 0);
<a name="l00937"></a>00937   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 1);
<a name="l00938"></a>00938   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#b337c713035473e4b06c4125538f2a99">MD_kleene_star_requirement</a> (dest_field_decl, 1);
<a name="l00939"></a>00939 
<a name="l00940"></a>00940   <span class="comment">/* Scan all entries in section */</span>
<a name="l00941"></a>00941   <span class="keywordflow">for</span> (src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); src_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00942"></a>00942        src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (src_entry))
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944       <span class="comment">/* Get the src_field in order to read the links */</span>
<a name="l00945"></a>00945       src_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, src_field_decl);
<a name="l00946"></a>00946 
<a name="l00947"></a>00947       <span class="comment">/* Process the links in the src field */</span>
<a name="l00948"></a>00948       <span class="keywordflow">if</span> (src_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00949"></a>00949         {
<a name="l00950"></a>00950           <span class="comment">/* Create destination field for this entry */</span>
<a name="l00951"></a>00951           dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (src_entry, dest_field_decl, 1);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953           <span class="keywordflow">for</span> (index = 0; index &lt;= src_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l00954"></a>00954             {
<a name="l00955"></a>00955               <span class="comment">/* Get the target of this link */</span>
<a name="l00956"></a>00956               value_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_field, index);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958               <span class="comment">/* Must not be NULL */</span>
<a name="l00959"></a>00959               <span class="keywordflow">if</span> (value_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00960"></a>00960                 {
<a name="l00961"></a>00961                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[%i] NULL, not a link as expected."</span>,
<a name="l00962"></a>00962                           section-&gt;name, src_entry-&gt;name,
<a name="l00963"></a>00963                           src_field_name, index);
<a name="l00964"></a>00964                 }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966               hash_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (value_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>,
<a name="l00967"></a>00967                                                     <span class="stringliteral">"hash"</span>);
<a name="l00968"></a>00968               hash_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (value_entry, hash_field_decl);
<a name="l00969"></a>00969               hash = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (hash_field, 0);
<a name="l00970"></a>00970 
<a name="l00971"></a>00971               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, hash);
<a name="l00972"></a>00972             }
<a name="l00973"></a>00973         }
<a name="l00974"></a>00974     }
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977 <span class="keywordtype">void</span>
<a name="l00978"></a><a class="code" href="lmdes2__customizer_8c.html#8d183a09983eb17f4c21eba43c6ac1cc">00978</a> <a class="code" href="lmdes2__customizer_8c.html#8d183a09983eb17f4c21eba43c6ac1cc">convert_to_bit_representation</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *src_section_name,
<a name="l00979"></a>00979                                <span class="keywordtype">char</span> *src_field_name,
<a name="l00980"></a>00980                                <span class="keywordtype">char</span> *value_section_name,
<a name="l00981"></a>00981                                <span class="keywordtype">char</span> *value_field_name, <span class="keywordtype">char</span> *dest_field_name)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *src_section, *value_section;
<a name="l00984"></a>00984   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *src_field_decl, *value_field_decl, *dest_field_decl;
<a name="l00985"></a>00985   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *src_entry, *value_entry;
<a name="l00986"></a>00986   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *src_field, *value_field, *dest_field;
<a name="l00987"></a>00987   <span class="keywordtype">int</span> bit_representation, bit_value, i;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989   <span class="comment">/* Get the section we are converting */</span>
<a name="l00990"></a>00990   <span class="keywordflow">if</span> ((src_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, src_section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00991"></a>00991     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, src_section_name);
<a name="l00992"></a>00992 
<a name="l00993"></a>00993   <span class="comment">/* Get the field we are converting */</span>
<a name="l00994"></a>00994   src_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, src_field_name);
<a name="l00995"></a>00995   <span class="keywordflow">if</span> (src_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00996"></a>00996     {
<a name="l00997"></a>00997       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, src_field_name,
<a name="l00998"></a>00998               src_section_name);
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001   <span class="comment">/* Expect field to be a kleene starred link to another section */</span>
<a name="l01002"></a>01002   <span class="keywordflow">if</span> ((src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01003"></a>01003       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01004"></a>01004       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l01005"></a>01005       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a> != 1))
<a name="l01006"></a>01006     {
<a name="l01007"></a>01007       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01008"></a>01008               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single "</span>
<a name="l01009"></a>01009               <span class="stringliteral">"kleene_starred link to section '%s'."</span>,
<a name="l01010"></a>01010               src_section_name, src_field_name, value_section_name);
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013   <span class="comment">/* Get the section that the values are coming from */</span>
<a name="l01014"></a>01014   value_section = src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0];
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   <span class="comment">/* Make sure this where we expect the values to come from */</span>
<a name="l01017"></a>01017   <span class="keywordflow">if</span> (strcmp (value_section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, value_section_name) != 0)
<a name="l01018"></a>01018     {
<a name="l01019"></a>01019       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01020"></a>01020               <span class="stringliteral">"Expected '%s-&gt;%s' to link to section '%s'\nnot section '%s'."</span>,
<a name="l01021"></a>01021               src_section_name, src_field_name, value_section_name,
<a name="l01022"></a>01022               value_section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025   <span class="comment">/* Get the field that the values will come from */</span>
<a name="l01026"></a>01026   value_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (value_section, value_field_name);
<a name="l01027"></a>01027   <span class="keywordflow">if</span> (value_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01028"></a>01028     {
<a name="l01029"></a>01029       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in section '%s' not found."</span>,
<a name="l01030"></a>01030               value_field_name, value_section_name);
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033   <span class="comment">/* Expect the value field to be a single int value */</span>
<a name="l01034"></a>01034   <span class="keywordflow">if</span> ((value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01035"></a>01035       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01036"></a>01036       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>))
<a name="l01037"></a>01037     {
<a name="l01038"></a>01038       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01039"></a>01039               <span class="stringliteral">"Error using field '%s-&gt;%s':\nExpected a single INT."</span>,
<a name="l01040"></a>01040               value_section_name, value_field_name);
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043   <span class="comment">/* Delete all existing field of 'dest_field_name', by deleting</span>
<a name="l01044"></a>01044 <span class="comment">   * the field declaration.</span>
<a name="l01045"></a>01045 <span class="comment">   */</span>
<a name="l01046"></a>01046   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, dest_field_name);
<a name="l01047"></a>01047   <span class="keywordflow">if</span> (dest_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01048"></a>01048     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (dest_field_decl);
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   <span class="comment">/* Create new REQUIRED field of name 'dest_field_name' that</span>
<a name="l01051"></a>01051 <span class="comment">   * has one INT in it.</span>
<a name="l01052"></a>01052 <span class="comment">   */</span>
<a name="l01053"></a>01053   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (src_section, dest_field_name,
<a name="l01054"></a>01054                                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l01055"></a>01055   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 0);
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <span class="comment">/* Finally, convert each the src_field LINKS into one INT, using</span>
<a name="l01058"></a>01058 <span class="comment">   * the bit value in value_field</span>
<a name="l01059"></a>01059 <span class="comment">   */</span>
<a name="l01060"></a>01060   <span class="keywordflow">for</span> (src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (src_section); src_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01061"></a>01061        src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (src_entry))
<a name="l01062"></a>01062     {
<a name="l01063"></a>01063       <span class="comment">/* Get the src_field in order to read the links */</span>
<a name="l01064"></a>01064       src_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, src_field_decl);
<a name="l01065"></a>01065 
<a name="l01066"></a>01066       <span class="comment">/* By default, the bit representation is 0 if the src_field</span>
<a name="l01067"></a>01067 <span class="comment">       * is not specified.</span>
<a name="l01068"></a>01068 <span class="comment">       */</span>
<a name="l01069"></a>01069       bit_representation = 0;
<a name="l01070"></a>01070 
<a name="l01071"></a>01071       <span class="comment">/* Process the links in the src field if specified */</span>
<a name="l01072"></a>01072       <span class="keywordflow">if</span> (src_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01073"></a>01073         {
<a name="l01074"></a>01074           <span class="keywordflow">for</span> (i = 0; i &lt;= src_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01075"></a>01075             {
<a name="l01076"></a>01076               <span class="comment">/* Get the target of this link */</span>
<a name="l01077"></a>01077               value_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_field, i);
<a name="l01078"></a>01078 
<a name="l01079"></a>01079               <span class="comment">/* Must not be NULL */</span>
<a name="l01080"></a>01080               <span class="keywordflow">if</span> (value_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01081"></a>01081                 {
<a name="l01082"></a>01082                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[i] NULL, not a link as expected."</span>,
<a name="l01083"></a>01083                           src_section-&gt;name, src_entry-&gt;name,
<a name="l01084"></a>01084                           src_field_name, i);
<a name="l01085"></a>01085                 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087               <span class="comment">/* Get the value field from the value entry */</span>
<a name="l01088"></a>01088               value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (value_entry, value_field_decl);
<a name="l01089"></a>01089 
<a name="l01090"></a>01090               <span class="comment">/* Must not be NULL */</span>
<a name="l01091"></a>01091               <span class="keywordflow">if</span> (value_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01092"></a>01092                 {
<a name="l01093"></a>01093                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s not found."</span>,
<a name="l01094"></a>01094                           value_section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, value_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l01095"></a>01095                           value_field_name);
<a name="l01096"></a>01096                 }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098               <span class="comment">/* Get the bit value from the value field */</span>
<a name="l01099"></a>01099               bit_value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (value_field, 0);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101               <span class="comment">/* Or into bit_representation */</span>
<a name="l01102"></a>01102               bit_representation |= bit_value;
<a name="l01103"></a>01103             }
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106       <span class="comment">/* Create destination field with bit representation */</span>
<a name="l01107"></a>01107       dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (src_entry, dest_field_decl, 1);
<a name="l01108"></a>01108       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, 0, bit_representation);
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 <span class="comment">/* Does a depth first recursive search to add all children reached by</span>
<a name="l01114"></a>01114 <span class="comment"> * the entry's field and places pointer the those children's entry pointers</span>
<a name="l01115"></a>01115 <span class="comment"> * into the child_table.</span>
<a name="l01116"></a>01116 <span class="comment"> */</span>
<a name="l01117"></a>01117 <span class="keywordtype">void</span>
<a name="l01118"></a><a class="code" href="lmdes2__customizer_8c.html#f1a4477e115e0eba3990744a657173c2">01118</a> <a class="code" href="lmdes2__customizer_8c.html#f1a4477e115e0eba3990744a657173c2">find_children</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * child_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>,
<a name="l01119"></a>01119                <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> * field_decl)
<a name="l01120"></a>01120 {
<a name="l01121"></a>01121   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *child_entry;
<a name="l01122"></a>01122   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01123"></a>01123   <span class="keywordtype">int</span> i;
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <span class="comment">/* Get the entry's field.  If doesn't exists, done */</span>
<a name="l01126"></a>01126   <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01127"></a>01127     <span class="keywordflow">return</span>;
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   <span class="comment">/* Recursively add any children reached by each link */</span>
<a name="l01130"></a>01130   <span class="keywordflow">for</span> (i = 0; i &lt;= field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01131"></a>01131     {
<a name="l01132"></a>01132       child_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (field, i);
<a name="l01133"></a>01133 
<a name="l01134"></a>01134       <span class="comment">/* If child already in table, do nothing and goto next child */</span>
<a name="l01135"></a>01135       <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l01136"></a>01136 <span class="comment">       *              the address of child_entry before looking it up. */</span>
<a name="l01137"></a>01137       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (child_table, 
<a name="l01138"></a>01138                            ((<span class="keywordtype">long</span>) child_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01139"></a>01139         <span class="keywordflow">continue</span>;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141       <span class="comment">/* Add this child to the table and recursively find it's children */</span>
<a name="l01142"></a>01142       <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l01143"></a>01143 <span class="comment">       *              the address of child_entry before looking it up. */</span>
<a name="l01144"></a>01144       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (child_table, ((<span class="keywordtype">long</span>) child_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff), 
<a name="l01145"></a>01145                       (<span class="keywordtype">void</span> *) child_entry);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147       <a class="code" href="lmdes2__customizer_8c.html#f1a4477e115e0eba3990744a657173c2">find_children</a> (child_table, child_entry, field_decl);
<a name="l01148"></a>01148     }
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152 <span class="keywordtype">void</span>
<a name="l01153"></a><a class="code" href="lmdes2__customizer_8c.html#63b739f1e28f24f379411fb7743e6b44">01153</a> <a class="code" href="lmdes2__customizer_8c.html#63b739f1e28f24f379411fb7743e6b44">add_all_children_to_list</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01156"></a>01156   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01157"></a>01157   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, *child_entry;
<a name="l01158"></a>01158   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01159"></a>01159   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *child_table;
<a name="l01160"></a>01160   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *child_symbol;
<a name="l01161"></a>01161   <span class="keywordtype">int</span> i;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 
<a name="l01164"></a>01164   <span class="comment">/* Get the section we are customizing */</span>
<a name="l01165"></a>01165   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01166"></a>01166     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l01167"></a>01167 
<a name="l01168"></a>01168   <span class="comment">/* Get the declaration of the field we are expanding */</span>
<a name="l01169"></a>01169   <span class="keywordflow">if</span> ((field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, field_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01170"></a>01170     {
<a name="l01171"></a>01171       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' not found for section '%s'."</span>, field_name,
<a name="l01172"></a>01172               section_name);
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175   <span class="comment">/* Expect field to be a kleened starred link to the same section */</span>
<a name="l01176"></a>01176   <span class="keywordflow">if</span> ((field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01177"></a>01177       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01178"></a>01178       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l01179"></a>01179       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a> != 1) ||
<a name="l01180"></a>01180       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != section))
<a name="l01181"></a>01181     {
<a name="l01182"></a>01182       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01183"></a>01183               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpect a single "</span>
<a name="l01184"></a>01184               <span class="stringliteral">"kleene_starred link to section '%s'."</span>,
<a name="l01185"></a>01185               section_name, field_name, section_name);
<a name="l01186"></a>01186     }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   <span class="comment">/* Create child table to hold all the children */</span>
<a name="l01189"></a>01189   child_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"child table"</span>, 0);
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="comment">/* Expand "field_name" for each entry, so that all the indirect children</span>
<a name="l01192"></a>01192 <span class="comment">   * are pointed to the list.</span>
<a name="l01193"></a>01193 <span class="comment">   */</span>
<a name="l01194"></a>01194   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01195"></a>01195        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l01196"></a>01196     {
<a name="l01197"></a>01197       <span class="comment">/* If the field is not defined, do nothing and goto next entry */</span>
<a name="l01198"></a>01198       <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01199"></a>01199         <span class="keywordflow">continue</span>;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01202"></a>01202       <span class="comment">/* Do a depth first recursive search to find all the children</span>
<a name="l01203"></a>01203 <span class="comment">       * reached by this entry.</span>
<a name="l01204"></a>01204 <span class="comment">       */</span>
<a name="l01205"></a>01205       <a class="code" href="lmdes2__customizer_8c.html#f1a4477e115e0eba3990744a657173c2">find_children</a> (child_table, entry, field_decl);
<a name="l01206"></a>01206 
<a name="l01207"></a>01207       <span class="comment">/* Remove all the children already in field */</span>
<a name="l01208"></a>01208       <span class="keywordflow">for</span> (i = 0; i &lt;= field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01209"></a>01209         {
<a name="l01210"></a>01210           child_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (field, i);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212           <span class="comment">/* Find child by using address of child */</span>
<a name="l01213"></a>01213           <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l01214"></a>01214 <span class="comment">           *              the address of child_entry before looking it up. */</span>
<a name="l01215"></a>01215           child_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (child_table, 
<a name="l01216"></a>01216                                           ((<span class="keywordtype">long</span>) child_entry &amp; \
<a name="l01217"></a>01217                                            (<span class="keywordtype">long</span>) 0xffffffff));
<a name="l01218"></a>01218 
<a name="l01219"></a>01219           <span class="comment">/* Remove child already in field from table */</span>
<a name="l01220"></a>01220           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#84cc47e8a94e9d12339fe6824c406c6e">INT_delete_symbol</a> (child_symbol, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01221"></a>01221         }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223       <span class="comment">/* Add the remaining children in the table to the field,</span>
<a name="l01224"></a>01224 <span class="comment">       * removing them from the table as they are processed</span>
<a name="l01225"></a>01225 <span class="comment">       */</span>
<a name="l01226"></a>01226       <span class="keywordflow">while</span> ((child_symbol = child_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01227"></a>01227         {
<a name="l01228"></a>01228           child_entry = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) child_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230           <span class="comment">/* Add child to end of field */</span>
<a name="l01231"></a>01231           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (field, field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, child_entry);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233           <span class="comment">/* Remove child entry from child table, do not delete</span>
<a name="l01234"></a>01234 <span class="comment">           * the child entry!</span>
<a name="l01235"></a>01235 <span class="comment">           */</span>
<a name="l01236"></a>01236           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#84cc47e8a94e9d12339fe6824c406c6e">INT_delete_symbol</a> (child_symbol, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238       <span class="comment">/* The child table is empty at this point */</span>
<a name="l01239"></a>01239     }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="comment">/* Free the child table */</span>
<a name="l01242"></a>01242   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (child_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01243"></a>01243 }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 <span class="keywordtype">void</span>
<a name="l01246"></a><a class="code" href="lmdes2__customizer_8c.html#21573698051dc7050183b82a6f62e003">01246</a> <a class="code" href="lmdes2__customizer_8c.html#21573698051dc7050183b82a6f62e003">convert_to_int_list</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *src_section_name, <span class="keywordtype">char</span> *src_field_name,
<a name="l01247"></a>01247                      <span class="keywordtype">char</span> *value_section_name, <span class="keywordtype">char</span> *value_field_name,
<a name="l01248"></a>01248                      <span class="keywordtype">char</span> *dest_field_name)
<a name="l01249"></a>01249 {
<a name="l01250"></a>01250   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *src_section, *value_section;
<a name="l01251"></a>01251   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *src_field_decl, *value_field_decl, *dest_field_decl;
<a name="l01252"></a>01252   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *src_entry, *value_entry;
<a name="l01253"></a>01253   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *src_field, *value_field, *dest_field;
<a name="l01254"></a>01254   <span class="keywordtype">int</span> value, i;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256   <span class="comment">/* Get the section we are converting */</span>
<a name="l01257"></a>01257   <span class="keywordflow">if</span> ((src_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, src_section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01258"></a>01258     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, src_section_name);
<a name="l01259"></a>01259 
<a name="l01260"></a>01260   <span class="comment">/* Get the section we are getting the values from */</span>
<a name="l01261"></a>01261   <span class="keywordflow">if</span> ((value_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, value_section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01262"></a>01262     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, value_section_name);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264   <span class="comment">/* Get the field we are converting */</span>
<a name="l01265"></a>01265   src_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, src_field_name);
<a name="l01266"></a>01266   <span class="keywordflow">if</span> (src_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01267"></a>01267     {
<a name="l01268"></a>01268       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, src_field_name,
<a name="l01269"></a>01269               src_section_name);
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   <span class="comment">/* Expect field to be a kleene starred link to another section */</span>
<a name="l01273"></a>01273   <span class="keywordflow">if</span> ((src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01274"></a>01274       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01275"></a>01275       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l01276"></a>01276       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a> != 1) ||
<a name="l01277"></a>01277       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != value_section))
<a name="l01278"></a>01278     {
<a name="l01279"></a>01279       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01280"></a>01280               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single "</span>
<a name="l01281"></a>01281               <span class="stringliteral">"kleene_starred link to section '%s'."</span>,
<a name="l01282"></a>01282               src_section_name, src_field_name, value_section_name);
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284 
<a name="l01285"></a>01285   <span class="comment">/* Get the field that the values will come from */</span>
<a name="l01286"></a>01286   value_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (value_section, value_field_name);
<a name="l01287"></a>01287   <span class="keywordflow">if</span> (value_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01288"></a>01288     {
<a name="l01289"></a>01289       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in section '%s' not found."</span>,
<a name="l01290"></a>01290               value_field_name, value_section_name);
<a name="l01291"></a>01291     }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293   <span class="comment">/* Expect the value field to be a single int value */</span>
<a name="l01294"></a>01294   <span class="keywordflow">if</span> ((value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01295"></a>01295       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01296"></a>01296       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>))
<a name="l01297"></a>01297     {
<a name="l01298"></a>01298       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01299"></a>01299               <span class="stringliteral">"Error using field '%s-&gt;%s':\nExpected a single INT."</span>,
<a name="l01300"></a>01300               value_section_name, value_field_name);
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   <span class="comment">/* Delete all existing field of 'dest_field_name', by deleting</span>
<a name="l01304"></a>01304 <span class="comment">   * the field declaration.</span>
<a name="l01305"></a>01305 <span class="comment">   */</span>
<a name="l01306"></a>01306   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, dest_field_name);
<a name="l01307"></a>01307   <span class="keywordflow">if</span> (dest_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01308"></a>01308     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (dest_field_decl);
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="comment">/* Create new REQUIRED field of name 'dest_field_name' that</span>
<a name="l01311"></a>01311 <span class="comment">   * has zero or more INTs in it.</span>
<a name="l01312"></a>01312 <span class="comment">   */</span>
<a name="l01313"></a>01313   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (src_section, dest_field_name,
<a name="l01314"></a>01314                                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l01315"></a>01315   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 0);
<a name="l01316"></a>01316   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#b337c713035473e4b06c4125538f2a99">MD_kleene_star_requirement</a> (dest_field_decl, 0);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318 
<a name="l01319"></a>01319   <span class="comment">/* Finally, convert each the src_field LINKS into an INT, and</span>
<a name="l01320"></a>01320 <span class="comment">   * place that INT in the dest_field list.</span>
<a name="l01321"></a>01321 <span class="comment">   */</span>
<a name="l01322"></a>01322   <span class="keywordflow">for</span> (src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (src_section); src_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01323"></a>01323        src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (src_entry))
<a name="l01324"></a>01324     {
<a name="l01325"></a>01325       <span class="comment">/* Get the src_field in order to read the links */</span>
<a name="l01326"></a>01326       src_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, src_field_decl);
<a name="l01327"></a>01327 
<a name="l01328"></a>01328       <span class="comment">/* Create destination field for this entry */</span>
<a name="l01329"></a>01329       dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (src_entry, dest_field_decl, 1);
<a name="l01330"></a>01330 
<a name="l01331"></a>01331       <span class="comment">/* Process the links in the src field if specified */</span>
<a name="l01332"></a>01332       <span class="keywordflow">if</span> (src_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01333"></a>01333         {
<a name="l01334"></a>01334           <span class="keywordflow">for</span> (i = 0; i &lt;= src_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01335"></a>01335             {
<a name="l01336"></a>01336               <span class="comment">/* Get the target of this link */</span>
<a name="l01337"></a>01337               value_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_field, i);
<a name="l01338"></a>01338 
<a name="l01339"></a>01339               <span class="comment">/* Must not be NULL */</span>
<a name="l01340"></a>01340               <span class="keywordflow">if</span> (value_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01341"></a>01341                 {
<a name="l01342"></a>01342                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[i] NULL, not a link as expected."</span>,
<a name="l01343"></a>01343                           src_section-&gt;name, src_entry-&gt;name,
<a name="l01344"></a>01344                           src_field_name, i);
<a name="l01345"></a>01345                 }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347               <span class="comment">/* Get the value field from the value entry */</span>
<a name="l01348"></a>01348               value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (value_entry, value_field_decl);
<a name="l01349"></a>01349 
<a name="l01350"></a>01350               <span class="comment">/* Skip if value NULL */</span>
<a name="l01351"></a>01351               <span class="keywordflow">if</span> (value_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01352"></a>01352                 <span class="keywordflow">continue</span>;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354               <span class="comment">/* Get the value from the value field */</span>
<a name="l01355"></a>01355               value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (value_field, 0);
<a name="l01356"></a>01356 
<a name="l01357"></a>01357               <span class="comment">/* Add int to dest field */</span>
<a name="l01358"></a>01358               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l01359"></a>01359                           value);
<a name="l01360"></a>01360             }
<a name="l01361"></a>01361         }
<a name="l01362"></a>01362     }
<a name="l01363"></a>01363 }
<a name="l01364"></a>01364 
<a name="l01365"></a>01365 <span class="keywordtype">void</span>
<a name="l01366"></a><a class="code" href="lmdes2__customizer_8c.html#634270b643e7deeab2184f71ca619024">01366</a> <a class="code" href="lmdes2__customizer_8c.html#634270b643e7deeab2184f71ca619024">convert_to_int_list_all_targets</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *src_section_name,
<a name="l01367"></a>01367                                  <span class="keywordtype">char</span> *src_field_name,
<a name="l01368"></a>01368                                  <span class="keywordtype">char</span> *value_field_name,
<a name="l01369"></a>01369                                  <span class="keywordtype">char</span> *dest_field_name)
<a name="l01370"></a>01370 {
<a name="l01371"></a>01371   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *src_section;
<a name="l01372"></a>01372   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *src_field_decl, *value_field_decl, *dest_field_decl;
<a name="l01373"></a>01373   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *src_entry, *value_entry;
<a name="l01374"></a>01374   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *src_field, *value_field, *dest_field;
<a name="l01375"></a>01375   <span class="keywordtype">int</span> value, i;
<a name="l01376"></a>01376 
<a name="l01377"></a>01377   <span class="comment">/* Get the section we are converting */</span>
<a name="l01378"></a>01378   <span class="keywordflow">if</span> ((src_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, src_section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01379"></a>01379     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, src_section_name);
<a name="l01380"></a>01380 
<a name="l01381"></a>01381   <span class="comment">/* Get the field we are converting */</span>
<a name="l01382"></a>01382   src_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, src_field_name);
<a name="l01383"></a>01383   <span class="keywordflow">if</span> (src_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01384"></a>01384     {
<a name="l01385"></a>01385       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, src_field_name,
<a name="l01386"></a>01386               src_section_name);
<a name="l01387"></a>01387     }
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <span class="comment">/* Expect field to be a kleene starred link to this section */</span>
<a name="l01390"></a>01390   <span class="keywordflow">if</span> ((src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01391"></a>01391       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01392"></a>01392       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l01393"></a>01393       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a> != 1) ||
<a name="l01394"></a>01394       (src_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != src_section))
<a name="l01395"></a>01395     {
<a name="l01396"></a>01396       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01397"></a>01397               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single "</span>
<a name="l01398"></a>01398               <span class="stringliteral">"kleene_starred link to section '%s'."</span>,
<a name="l01399"></a>01399               src_section_name, src_field_name, src_section_name);
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402   <span class="comment">/* Get the field that the values will come from */</span>
<a name="l01403"></a>01403   value_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, value_field_name);
<a name="l01404"></a>01404   <span class="keywordflow">if</span> (value_field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01405"></a>01405     {
<a name="l01406"></a>01406       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in section '%s' not found."</span>,
<a name="l01407"></a>01407               value_field_name, src_section_name);
<a name="l01408"></a>01408     }
<a name="l01409"></a>01409 
<a name="l01410"></a>01410   <span class="comment">/* Expect the value field to be a single int value */</span>
<a name="l01411"></a>01411   <span class="keywordflow">if</span> ((value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01412"></a>01412       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01413"></a>01413       (value_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>))
<a name="l01414"></a>01414     {
<a name="l01415"></a>01415       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01416"></a>01416               <span class="stringliteral">"Error using field '%s-&gt;%s':\nExpected a single INT."</span>,
<a name="l01417"></a>01417               src_section_name, value_field_name);
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420   <span class="comment">/* Delete all existing field of 'dest_field_name', by deleting</span>
<a name="l01421"></a>01421 <span class="comment">   * the field declaration.</span>
<a name="l01422"></a>01422 <span class="comment">   */</span>
<a name="l01423"></a>01423   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (src_section, dest_field_name);
<a name="l01424"></a>01424   <span class="keywordflow">if</span> (dest_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01425"></a>01425     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (dest_field_decl);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427   <span class="comment">/* Create new REQUIRED field of name 'dest_field_name' that</span>
<a name="l01428"></a>01428 <span class="comment">   * has one or more INTs in it.</span>
<a name="l01429"></a>01429 <span class="comment">   */</span>
<a name="l01430"></a>01430   dest_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (src_section, dest_field_name,
<a name="l01431"></a>01431                                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l01432"></a>01432   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 0);
<a name="l01433"></a>01433   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (dest_field_decl, 1);
<a name="l01434"></a>01434   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#b337c713035473e4b06c4125538f2a99">MD_kleene_star_requirement</a> (dest_field_decl, 1);
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 
<a name="l01437"></a>01437   <span class="comment">/* Finally, convert each the src_field LINKS into an INT, and</span>
<a name="l01438"></a>01438 <span class="comment">   * place that INT in the dest_field list.</span>
<a name="l01439"></a>01439 <span class="comment">   *</span>
<a name="l01440"></a>01440 <span class="comment">   * Add src_entry's value first (if any) and prevent it from being</span>
<a name="l01441"></a>01441 <span class="comment">   * added twice.</span>
<a name="l01442"></a>01442 <span class="comment">   */</span>
<a name="l01443"></a>01443   <span class="keywordflow">for</span> (src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (src_section); src_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01444"></a>01444        src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (src_entry))
<a name="l01445"></a>01445     {
<a name="l01446"></a>01446       <span class="comment">/* Get the src_field in order to read the links */</span>
<a name="l01447"></a>01447       src_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, src_field_decl);
<a name="l01448"></a>01448 
<a name="l01449"></a>01449       <span class="comment">/* Create destination field for this entry */</span>
<a name="l01450"></a>01450       dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (src_entry, dest_field_decl, 1);
<a name="l01451"></a>01451 
<a name="l01452"></a>01452       <span class="comment">/* Add this entry's value if it has one */</span>
<a name="l01453"></a>01453       value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, value_field_decl);
<a name="l01454"></a>01454       <span class="keywordflow">if</span> (value_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01455"></a>01455         {
<a name="l01456"></a>01456           value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (value_field, 0);
<a name="l01457"></a>01457           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, value);
<a name="l01458"></a>01458         }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460       <span class="comment">/* Process the links in the src field if specified */</span>
<a name="l01461"></a>01461       <span class="keywordflow">if</span> (src_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01462"></a>01462         {
<a name="l01463"></a>01463           <span class="keywordflow">for</span> (i = 0; i &lt;= src_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01464"></a>01464             {
<a name="l01465"></a>01465               <span class="comment">/* Get the target of this link */</span>
<a name="l01466"></a>01466               value_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_field, i);
<a name="l01467"></a>01467 
<a name="l01468"></a>01468               <span class="comment">/* Must not be NULL */</span>
<a name="l01469"></a>01469               <span class="keywordflow">if</span> (value_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01470"></a>01470                 {
<a name="l01471"></a>01471                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[i] NULL, not a link as expected."</span>,
<a name="l01472"></a>01472                           src_section-&gt;name, src_entry-&gt;name,
<a name="l01473"></a>01473                           src_field_name, i);
<a name="l01474"></a>01474                 }
<a name="l01475"></a>01475 
<a name="l01476"></a>01476               <span class="comment">/* If value points to src entry, skip, already added */</span>
<a name="l01477"></a>01477               <span class="keywordflow">if</span> (value_entry == src_entry)
<a name="l01478"></a>01478                 <span class="keywordflow">continue</span>;
<a name="l01479"></a>01479 
<a name="l01480"></a>01480               <span class="comment">/* Get the value field from the value entry */</span>
<a name="l01481"></a>01481               value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (value_entry, value_field_decl);
<a name="l01482"></a>01482 
<a name="l01483"></a>01483               <span class="comment">/* Skip if value NULL */</span>
<a name="l01484"></a>01484               <span class="keywordflow">if</span> (value_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01485"></a>01485                 <span class="keywordflow">continue</span>;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487               <span class="comment">/* Get the value from the value field */</span>
<a name="l01488"></a>01488               value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (value_field, 0);
<a name="l01489"></a>01489 
<a name="l01490"></a>01490               <span class="comment">/* Add int to dest field */</span>
<a name="l01491"></a>01491               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (dest_field, dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l01492"></a>01492                           value);
<a name="l01493"></a>01493             }
<a name="l01494"></a>01494         }
<a name="l01495"></a>01495 
<a name="l01496"></a>01496       <span class="comment">/* Make sure at least one value specified for dest_field */</span>
<a name="l01497"></a>01497       <span class="keywordflow">if</span> (dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> == -1)
<a name="l01498"></a>01498         {
<a name="l01499"></a>01499           fprintf (stderr,
<a name="l01500"></a>01500                    <span class="stringliteral">"Error %s-&gt;%s:\n"</span>
<a name="l01501"></a>01501                    <span class="stringliteral">"  Unable to build a proper '%s' field!\n"</span>,
<a name="l01502"></a>01502                    src_section_name, src_entry-&gt;name, dest_field_name);
<a name="l01503"></a>01503 
<a name="l01504"></a>01504           fprintf (stderr,
<a name="l01505"></a>01505                    <span class="stringliteral">"\n"</span>
<a name="l01506"></a>01506                    <span class="stringliteral">"  The %s field contains all the MDES_OPERAND_xxx ids\n"</span>
<a name="l01507"></a>01507                    <span class="stringliteral">"  that map to this entry.  Make sure MDES_OPERAND_%s (or a"</span>
<a name="l01508"></a>01508                    <span class="stringliteral">"  \n a more specific operand) is #defined in one of the "</span>
<a name="l01509"></a>01509                    <span class="stringliteral">"  specifed\nC header files! If this operand/field type "</span>
<a name="l01510"></a>01510                    <span class="stringliteral">"  is no longer\n"</span>
<a name="l01511"></a>01511                    <span class="stringliteral">"  supported by IMPACT, delete it.\n\n"</span>,
<a name="l01512"></a>01512                    dest_field_name, src_entry-&gt;name);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01515"></a>01515         }
<a name="l01516"></a>01516     }
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519 <span class="comment">/* Checks that the INT values found in the field 'field_name' fall within</span>
<a name="l01520"></a>01520 <span class="comment"> * the given bounds.  Assumes field has only on argument and it is an INT</span>
<a name="l01521"></a>01521 <span class="comment"> */</span>
<a name="l01522"></a>01522 <span class="keywordtype">void</span>
<a name="l01523"></a><a class="code" href="lmdes2__customizer_8c.html#41d1d44089b9ab6bbc29aa96db125b25">01523</a> <a class="code" href="lmdes2__customizer_8c.html#41d1d44089b9ab6bbc29aa96db125b25">check_int_bounds</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name,
<a name="l01524"></a>01524                   <span class="keywordtype">int</span> lower_bound, <span class="keywordtype">int</span> upper_bound)
<a name="l01525"></a>01525 {
<a name="l01526"></a>01526   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01527"></a>01527   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01528"></a>01528   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l01529"></a>01529   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01530"></a>01530   <span class="keywordtype">int</span> value;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532   <span class="comment">/* Get the section we are converting */</span>
<a name="l01533"></a>01533   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01534"></a>01534     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l01535"></a>01535 
<a name="l01536"></a>01536   <span class="comment">/* Get the field we are checking the INT bounds of */</span>
<a name="l01537"></a>01537   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, field_name);
<a name="l01538"></a>01538   <span class="keywordflow">if</span> (field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01539"></a>01539     {
<a name="l01540"></a>01540       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, field_name,
<a name="l01541"></a>01541               section_name);
<a name="l01542"></a>01542     }
<a name="l01543"></a>01543 
<a name="l01544"></a>01544   <span class="comment">/* Expect field to require exactly one INT value */</span>
<a name="l01545"></a>01545   <span class="keywordflow">if</span> ((field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01546"></a>01546       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01547"></a>01547       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>))
<a name="l01548"></a>01548     {
<a name="l01549"></a>01549       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01550"></a>01550               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single INT value"</span>,
<a name="l01551"></a>01551               section_name, field_name);
<a name="l01552"></a>01552     }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554   <span class="comment">/* Check all fields in section */</span>
<a name="l01555"></a>01555   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01556"></a>01556        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l01557"></a>01557     {
<a name="l01558"></a>01558       <span class="comment">/* Get the INT field if it exists */</span>
<a name="l01559"></a>01559       <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01560"></a>01560         <span class="keywordflow">continue</span>;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562       <span class="comment">/* Get it's value */</span>
<a name="l01563"></a>01563       value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (field, 0);
<a name="l01564"></a>01564 
<a name="l01565"></a>01565       <span class="comment">/* Check bounds */</span>
<a name="l01566"></a>01566       <span class="keywordflow">if</span> ((value &lt; lower_bound) || (value &gt; upper_bound))
<a name="l01567"></a>01567         {
<a name="l01568"></a>01568           fprintf (stderr,
<a name="l01569"></a>01569                    <span class="stringliteral">"Value of '%s-&gt;%s-&gt;%s', %i, out of bounds:\n  Value must "</span>
<a name="l01570"></a>01570                    <span class="stringliteral">"fall between %i and %i.\n\n"</span>,
<a name="l01571"></a>01571                    section_name, entry-&gt;name, field_name, value,
<a name="l01572"></a>01572                    lower_bound, upper_bound);
<a name="l01573"></a>01573           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01574"></a>01574         }
<a name="l01575"></a>01575     }
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 <span class="comment">/* Checks proc_opcs to make sure non-negative and not huge.</span>
<a name="l01579"></a>01579 <span class="comment"> * Also checks to make sure multiple entries do not get the same proc_opc.</span>
<a name="l01580"></a>01580 <span class="comment"> */</span>
<a name="l01581"></a>01581 <span class="keywordtype">void</span>
<a name="l01582"></a><a class="code" href="lmdes2__customizer_8c.html#9bfc7ce417705fe84aae84f4d1403015">01582</a> <a class="code" href="lmdes2__customizer_8c.html#9bfc7ce417705fe84aae84f4d1403015">check_proc_opcs</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l01583"></a>01583 {
<a name="l01584"></a>01584   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01585"></a>01585   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01586"></a>01586   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, *conflict;
<a name="l01587"></a>01587   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01588"></a>01588   <span class="keywordtype">int</span> proc_opc;
<a name="l01589"></a>01589   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *opc_table;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="comment">/* Create a table of proc_opc's */</span>
<a name="l01592"></a>01592   opc_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"proc_opc"</span>, 250);
<a name="l01593"></a>01593 
<a name="l01594"></a>01594   <span class="comment">/* Get the section we are converting */</span>
<a name="l01595"></a>01595   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01596"></a>01596     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, <span class="stringliteral">"IMPACT_Operation"</span>);
<a name="l01597"></a>01597 
<a name="l01598"></a>01598   <span class="comment">/* Get the field we are checking the INT bounds of */</span>
<a name="l01599"></a>01599   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"proc_opc"</span>);
<a name="l01600"></a>01600   <span class="keywordflow">if</span> (field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01601"></a>01601     {
<a name="l01602"></a>01602       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, <span class="stringliteral">"proc_opc"</span>,
<a name="l01603"></a>01603               <span class="stringliteral">"IMPACT_Operation"</span>);
<a name="l01604"></a>01604     }
<a name="l01605"></a>01605 
<a name="l01606"></a>01606   <span class="comment">/* Expect field to require exactly one INT value */</span>
<a name="l01607"></a>01607   <span class="keywordflow">if</span> ((field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01608"></a>01608       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01609"></a>01609       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>))
<a name="l01610"></a>01610     {
<a name="l01611"></a>01611       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01612"></a>01612               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single INT value"</span>,
<a name="l01613"></a>01613               <span class="stringliteral">"IMPACT_Operation"</span>, <span class="stringliteral">"proc_opc"</span>);
<a name="l01614"></a>01614     }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616   <span class="comment">/* Check all fields in section */</span>
<a name="l01617"></a>01617   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01618"></a>01618        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l01619"></a>01619     {
<a name="l01620"></a>01620       <span class="comment">/* Get the INT field if it exists */</span>
<a name="l01621"></a>01621       <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01622"></a>01622         {
<a name="l01623"></a>01623           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"IMPACT_Operation-&gt;%s: field 'proc_opc' not found!"</span>,
<a name="l01624"></a>01624                   entry-&gt;name);
<a name="l01625"></a>01625         }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627       <span class="comment">/* Get it's proc_opc */</span>
<a name="l01628"></a>01628       proc_opc = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (field, 0);
<a name="l01629"></a>01629 
<a name="l01630"></a>01630       <span class="comment">/* Check bounds */</span>
<a name="l01631"></a>01631       <span class="keywordflow">if</span> (proc_opc &lt; 0)
<a name="l01632"></a>01632         {
<a name="l01633"></a>01633           fprintf (stderr,
<a name="l01634"></a>01634                    <span class="stringliteral">"IMPACT_Operation-&gt;%s: proc_opc (%i) may not be negative!\n"</span>
<a name="l01635"></a>01635                    <span class="stringliteral">"\n"</span>,
<a name="l01636"></a>01636                    entry-&gt;name, proc_opc);
<a name="l01637"></a>01637           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01638"></a>01638         }
<a name="l01639"></a>01639       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (proc_opc &gt; 16384)
<a name="l01640"></a>01640         {
<a name="l01641"></a>01641           fprintf (stderr,
<a name="l01642"></a>01642                    <span class="stringliteral">"IMPACT_Operation-&gt;%s: proc_opc (%i) may not be &gt; 16384!\n"</span>
<a name="l01643"></a>01643                    <span class="stringliteral">"\n"</span>,
<a name="l01644"></a>01644                    entry-&gt;name, proc_opc);
<a name="l01645"></a>01645           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01646"></a>01646 
<a name="l01647"></a>01647         }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649       <span class="comment">/* See if there is another operation with this opcode */</span>
<a name="l01650"></a>01650       conflict = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (opc_table, proc_opc);
<a name="l01651"></a>01651       <span class="keywordflow">if</span> (conflict != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01652"></a>01652         {
<a name="l01653"></a>01653           fprintf (stderr,
<a name="l01654"></a>01654                    <span class="stringliteral">"IMPACT_Operation-&gt;%s and IMPACT_Operation-&gt;%s both have "</span>
<a name="l01655"></a>01655                    <span class="stringliteral">"proc_opc %i!\n\n"</span>,
<a name="l01656"></a>01656                    entry-&gt;name, conflict-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, proc_opc);
<a name="l01657"></a>01657 
<a name="l01658"></a>01658           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01659"></a>01659         }
<a name="l01660"></a>01660       <span class="keywordflow">else</span>
<a name="l01661"></a>01661         {
<a name="l01662"></a>01662           <span class="comment">/* Add this opcode to the table */</span>
<a name="l01663"></a>01663           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (opc_table, proc_opc, (<span class="keywordtype">void</span> *) entry);
<a name="l01664"></a>01664         }
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666 
<a name="l01667"></a>01667   <span class="comment">/* Delete the proc_opc table */</span>
<a name="l01668"></a>01668   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (opc_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01669"></a>01669 }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671 <span class="comment">/* Scheduler uses unsigned short (was char) to store table options selected.</span>
<a name="l01672"></a>01672 <span class="comment"> * So make sure that there are less than 65536 (was 256) elements (options)</span>
<a name="l01673"></a>01673 <span class="comment"> * in the one_of field for each Table_Option entry.</span>
<a name="l01674"></a>01674 <span class="comment"> * </span>
<a name="l01675"></a>01675 <span class="comment"> * One could write a routine in this customizer to break up </span>
<a name="l01676"></a>01676 <span class="comment"> * alternatives that have such table options into multiple alternatives,</span>
<a name="l01677"></a>01677 <span class="comment"> * each using a subset of the options.  I have better things to do than</span>
<a name="l01678"></a>01678 <span class="comment"> * putting in special purpose code for this obscure case. :) -JCG 3/5/96</span>
<a name="l01679"></a>01679 <span class="comment"> *</span>
<a name="l01680"></a>01680 <span class="comment"> * In order to support fully expanding out reservation trees,</span>
<a name="l01681"></a>01681 <span class="comment"> * I bit the bullet and increased the data size to unsigned short. -JCG 3/27/96</span>
<a name="l01682"></a>01682 <span class="comment"> */</span>
<a name="l01683"></a>01683 <span class="keywordtype">void</span>
<a name="l01684"></a><a class="code" href="lmdes2__customizer_8c.html#d7581428a805b5351485f9d09da4aad0">01684</a> <a class="code" href="lmdes2__customizer_8c.html#d7581428a805b5351485f9d09da4aad0">check_table_option_count</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l01685"></a>01685 {
<a name="l01686"></a>01686   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01687"></a>01687   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01688"></a>01688   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l01689"></a>01689   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691   <span class="comment">/* Get the Table_Option section */</span>
<a name="l01692"></a>01692   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01693"></a>01693     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'Table_Option' section expected in hmdes2."</span>);
<a name="l01694"></a>01694 
<a name="l01695"></a>01695   <span class="comment">/* Get the one_of field */</span>
<a name="l01696"></a>01696   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"one_of"</span>);
<a name="l01697"></a>01697   <span class="keywordflow">if</span> (field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01698"></a>01698     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field 'one_of' in 'Table_Option' section not found."</span>);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700   <span class="comment">/* Check every entry's one_of field */</span>
<a name="l01701"></a>01701   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01702"></a>01702        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l01703"></a>01703     {
<a name="l01704"></a>01704       <span class="comment">/* Get the one_of field */</span>
<a name="l01705"></a>01705       <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01706"></a>01706         {
<a name="l01707"></a>01707           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Table_Option-&gt;%s-&gt;one_of: field expected."</span>,
<a name="l01708"></a>01708                   entry-&gt;name);
<a name="l01709"></a>01709         }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711       <span class="comment">/* Make sure there are not too many options */</span>
<a name="l01712"></a>01712       <span class="keywordflow">if</span> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &gt;= 65536)
<a name="l01713"></a>01713         {
<a name="l01714"></a>01714           fprintf (stderr,
<a name="l01715"></a>01715                    <span class="stringliteral">"Table_Option-&gt;%s-&gt;one_of[%i]:\n Only 65536 options "</span>
<a name="l01716"></a>01716                    <span class="stringliteral">"allowed in Table_Option.\n\n"</span>,
<a name="l01717"></a>01717                    entry-&gt;name, field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l01718"></a>01718           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01719"></a>01719         }
<a name="l01720"></a>01720     }
<a name="l01721"></a>01721 
<a name="l01722"></a>01722 }
<a name="l01723"></a>01723 
<a name="l01724"></a>01724 
<a name="l01725"></a>01725 <span class="keywordtype">void</span>
<a name="l01726"></a><a class="code" href="lmdes2__customizer_8c.html#6740c00001d924e1656171ce296a54d0">01726</a> <a class="code" href="lmdes2__customizer_8c.html#6740c00001d924e1656171ce296a54d0">check_bidirectional_links</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name)
<a name="l01727"></a>01727 {
<a name="l01728"></a>01728   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01729"></a>01729   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01730"></a>01730   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *src_entry, *dest_entry, *target_entry;
<a name="l01731"></a>01731   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *src_field, *dest_field;
<a name="l01732"></a>01732   <span class="keywordtype">int</span> i, j;
<a name="l01733"></a>01733 
<a name="l01734"></a>01734   <span class="comment">/* Get the section we are converting */</span>
<a name="l01735"></a>01735   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01736"></a>01736     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l01737"></a>01737 
<a name="l01738"></a>01738   <span class="comment">/* Get the field we are checking the bidirectinoal links of */</span>
<a name="l01739"></a>01739   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, field_name);
<a name="l01740"></a>01740   <span class="keywordflow">if</span> (field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01741"></a>01741     {
<a name="l01742"></a>01742       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, field_name,
<a name="l01743"></a>01743               section_name);
<a name="l01744"></a>01744     }
<a name="l01745"></a>01745 
<a name="l01746"></a>01746   <span class="comment">/* Expect field to be a kleene starred link to this section */</span>
<a name="l01747"></a>01747   <span class="keywordflow">if</span> ((field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> &gt; 1) ||
<a name="l01748"></a>01748       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l01749"></a>01749       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l01750"></a>01750       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a> != 1) ||
<a name="l01751"></a>01751       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != section))
<a name="l01752"></a>01752     {
<a name="l01753"></a>01753       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l01754"></a>01754               <span class="stringliteral">"Error customizing field '%s-&gt;%s':\nExpected a single "</span>
<a name="l01755"></a>01755               <span class="stringliteral">"kleene_starred link to section '%s'."</span>,
<a name="l01756"></a>01756               section_name, field_name, section_name);
<a name="l01757"></a>01757     }
<a name="l01758"></a>01758 
<a name="l01759"></a>01759   <span class="comment">/* Finally, check to make sure every entry that is linked to, has</span>
<a name="l01760"></a>01760 <span class="comment">   * a link back to the entry.</span>
<a name="l01761"></a>01761 <span class="comment">   */</span>
<a name="l01762"></a>01762   <span class="keywordflow">for</span> (src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); src_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01763"></a>01763        src_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (src_entry))
<a name="l01764"></a>01764     {
<a name="l01765"></a>01765       <span class="comment">/* Get the src_field in order to read the links */</span>
<a name="l01766"></a>01766       src_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (src_entry, field_decl);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768 
<a name="l01769"></a>01769       <span class="comment">/* Process the links in the src field if specified */</span>
<a name="l01770"></a>01770       <span class="keywordflow">if</span> (src_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01771"></a>01771         {
<a name="l01772"></a>01772           <span class="keywordflow">for</span> (i = 0; i &lt;= src_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l01773"></a>01773             {
<a name="l01774"></a>01774               <span class="comment">/* Get the target of this link */</span>
<a name="l01775"></a>01775               dest_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_field, i);
<a name="l01776"></a>01776 
<a name="l01777"></a>01777               <span class="comment">/* Must not be NULL */</span>
<a name="l01778"></a>01778               <span class="keywordflow">if</span> (dest_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01779"></a>01779                 {
<a name="l01780"></a>01780                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"%s-&gt;%s-&gt;%s[i] NULL, not a link as expected."</span>,
<a name="l01781"></a>01781                           section-&gt;name, src_entry-&gt;name, field_name, i);
<a name="l01782"></a>01782                 }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784               <span class="comment">/* Get the value field from the value entry */</span>
<a name="l01785"></a>01785               dest_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (dest_entry, field_decl);
<a name="l01786"></a>01786 
<a name="l01787"></a>01787 
<a name="l01788"></a>01788               target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01789"></a>01789               <span class="comment">/* Find link back to src_entry */</span>
<a name="l01790"></a>01790               <span class="keywordflow">for</span> (j = 0; j &lt;= dest_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; j++)
<a name="l01791"></a>01791                 {
<a name="l01792"></a>01792                   <span class="comment">/* Get link target */</span>
<a name="l01793"></a>01793                   target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (dest_field, j);
<a name="l01794"></a>01794 
<a name="l01795"></a>01795                   <span class="comment">/* If target matches src, then everything ok, stop */</span>
<a name="l01796"></a>01796                   <span class="keywordflow">if</span> (target_entry == src_entry)
<a name="l01797"></a>01797                     {
<a name="l01798"></a>01798                       <span class="keywordflow">break</span>;
<a name="l01799"></a>01799                     }
<a name="l01800"></a>01800                 }
<a name="l01801"></a>01801 
<a name="l01802"></a>01802               <span class="comment">/* Error if target_entry != src_entry */</span>
<a name="l01803"></a>01803               <span class="keywordflow">if</span> (target_entry != src_entry)
<a name="l01804"></a>01804                 {
<a name="l01805"></a>01805                   fprintf (stderr,
<a name="l01806"></a>01806                            <span class="stringliteral">"%s-&gt;%s-&gt;%s[%i]:\n  Specifies '%s' but\n  '%s-&gt;%s' "</span>
<a name="l01807"></a>01807                            <span class="stringliteral">"does not specify '%s'\n\n"</span>,
<a name="l01808"></a>01808                            section_name, src_entry-&gt;name, field_name, i,
<a name="l01809"></a>01809                            dest_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, section_name, dest_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l01810"></a>01810                            src_entry-&gt;name);
<a name="l01811"></a>01811                   <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l01812"></a>01812                 }
<a name="l01813"></a>01813             }
<a name="l01814"></a>01814         }
<a name="l01815"></a>01815     }
<a name="l01816"></a>01816 }
<a name="l01817"></a>01817 
<a name="l01818"></a>01818 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *
<a name="l01819"></a><a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">01819</a> <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name)
<a name="l01820"></a>01820 {
<a name="l01821"></a>01821   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823   <span class="keywordflow">if</span> ((section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, section_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01824"></a>01824     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"'%s' section expected in hmdes2."</span>, section_name);
<a name="l01825"></a>01825 
<a name="l01826"></a>01826   <span class="keywordflow">return</span> (section);
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a>01829 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *
<a name="l01830"></a><a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">01830</a> <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> * section, <span class="keywordtype">char</span> *field_name)
<a name="l01831"></a>01831 {
<a name="l01832"></a>01832   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834   field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, field_name);
<a name="l01835"></a>01835   <span class="keywordflow">if</span> (field_decl == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01836"></a>01836     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l01837"></a>01837             <span class="stringliteral">"Field '%s' in '%s' section not found."</span>, field_name,
<a name="l01838"></a>01838             section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l01839"></a>01839 
<a name="l01840"></a>01840   <span class="keywordflow">return</span> (field_decl);
<a name="l01841"></a>01841 }
<a name="l01842"></a>01842 
<a name="l01843"></a>01843 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *
<a name="l01844"></a><a class="code" href="lmdes2__customizer_8c.html#dfba5ab2edf1d22c8eef8e33bfbb4e8f">01844</a> <a class="code" href="lmdes2__customizer_8c.html#dfba5ab2edf1d22c8eef8e33bfbb4e8f">CU_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> * field_decl)
<a name="l01845"></a>01845 {
<a name="l01846"></a>01846   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848   <span class="comment">/* Get the one_of field */</span>
<a name="l01849"></a>01849   <span class="keywordflow">if</span> ((field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01850"></a>01850     {
<a name="l01851"></a>01851       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry-&gt;section-&gt;md,
<a name="l01852"></a>01852               <span class="stringliteral">"%s-&gt;%s-&gt;%s: field expected."</span>, entry-&gt;section-&gt;name,
<a name="l01853"></a>01853               entry-&gt;name, field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l01854"></a>01854     }
<a name="l01855"></a>01855   <span class="keywordflow">return</span> (field);
<a name="l01856"></a>01856 }
<a name="l01857"></a>01857 
<a name="l01858"></a>01858 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *
<a name="l01859"></a><a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">01859</a> <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="keywordtype">char</span> *field_name)
<a name="l01860"></a>01860 {
<a name="l01861"></a>01861   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01862"></a>01862   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l01863"></a>01863 
<a name="l01864"></a>01864   field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section, field_name);
<a name="l01865"></a>01865   field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867   <span class="keywordflow">return</span> (field);
<a name="l01868"></a>01868 }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870 <span class="comment">/* Creates a unique name from the base_name by tacking on ~#.</span>
<a name="l01871"></a>01871 <span class="comment"> * Scans md to make sure this name has not been used before.</span>
<a name="l01872"></a>01872 <span class="comment"> * OLD METHOD: Tries to pick the lowest number that has not been used</span>
<a name="l01873"></a>01873 <span class="comment"> *             (I think the result is easier to read than using an ever</span>
<a name="l01874"></a>01874 <span class="comment"> *              increasing number (which would have less conflicts)) </span>
<a name="l01875"></a>01875 <span class="comment"> *</span>
<a name="l01876"></a>01876 <span class="comment"> * NEW METHOD: The old method takes way too long for really complicated</span>
<a name="l01877"></a>01877 <span class="comment"> *             machine descriptions (runs for days).  Try to keep a</span>
<a name="l01878"></a>01878 <span class="comment"> *             counter for each base name.</span>
<a name="l01879"></a>01879 <span class="comment"> *</span>
<a name="l01880"></a>01880 <span class="comment"> * I want to be able to renaming on any entry the customizer modifies/creates.</span>
<a name="l01881"></a>01881 <span class="comment"> * So I am passing the entry to be renamed to allow the entry to get the</span>
<a name="l01882"></a>01882 <span class="comment"> * "same" name as it currently has (if it has been already touched).</span>
<a name="l01883"></a>01883 <span class="comment"> * So bla will become bla~1 and stay there.  bla~2 will only be created</span>
<a name="l01884"></a>01884 <span class="comment"> * if bla (or bla~1) is duplicated.  Set 'entry' to NULL if want to</span>
<a name="l01885"></a>01885 <span class="comment"> * force a renaming.</span>
<a name="l01886"></a>01886 <span class="comment"> */</span>
<a name="l01887"></a>01887 <span class="keywordtype">void</span>
<a name="l01888"></a><a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">01888</a> <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="keywordtype">char</span> *base_name,
<a name="l01889"></a>01889                     <span class="keywordtype">char</span> *new_name)
<a name="l01890"></a>01890 {
<a name="l01891"></a>01891   <span class="keywordtype">int</span> rename_id;
<a name="l01892"></a>01892   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01893"></a>01893   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *conflicting_entry;
<a name="l01894"></a>01894   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html">STRING_Symbol</a> *rename_symbol;
<a name="l01895"></a>01895   <span class="keywordtype">int</span> unique;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897   <span class="comment">/* Get the last renaming id for this base_name, if none, </span>
<a name="l01898"></a>01898 <span class="comment">   * start at 1.</span>
<a name="l01899"></a>01899 <span class="comment">   */</span>
<a name="l01900"></a>01900   <span class="keywordflow">if</span> ((rename_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#37705fddebdfab067437338d4063abbe">STRING_find_symbol</a> (<a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">rename_table</a>, base_name)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01901"></a>01901     {
<a name="l01902"></a>01902       rename_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#3a03bfbed0ac7378507b799366f99c83">STRING_add_symbol</a> (rename_table, base_name, (<span class="keywordtype">void</span> *) 1);
<a name="l01903"></a>01903     }
<a name="l01904"></a>01904 
<a name="l01905"></a>01905   <span class="comment">/* Use the last free number for this symbol */</span>
<a name="l01906"></a>01906 <span class="preprocessor">#ifdef LP64_ARCHITECTURE</span>
<a name="l01907"></a>01907 <span class="preprocessor"></span>  rename_id = (int)((<span class="keywordtype">long</span>) rename_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#1cffd5937e773a688315d44a0fd8d50f">data</a>);
<a name="l01908"></a>01908 <span class="preprocessor">#else</span>
<a name="l01909"></a>01909 <span class="preprocessor"></span>  rename_id = (int) rename_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#1cffd5937e773a688315d44a0fd8d50f">data</a>;
<a name="l01910"></a>01910 #endif
<a name="l01911"></a>01911 
<a name="l01912"></a>01912   <span class="comment">/* Keep renaming until find a unique name in the md */</span>
<a name="l01913"></a>01913   unique = 0;
<a name="l01914"></a>01914   while (!unique)
<a name="l01915"></a>01915     {
<a name="l01916"></a>01916       <span class="comment">/* Create new name */</span>
<a name="l01917"></a>01917       sprintf (new_name, <span class="stringliteral">"%s~%i"</span>, base_name, rename_id);
<a name="l01918"></a>01918       rename_id++;
<a name="l01919"></a>01919 
<a name="l01920"></a>01920       <span class="comment">/* Search md for same name, assume unique to start with */</span>
<a name="l01921"></a>01921       unique = 1;
<a name="l01922"></a>01922       <span class="keywordflow">for</span> (section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#80898363bd87b2073facc7280db90304">MD_first_section</a> (md); section != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01923"></a>01923            section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#e663f86a14d893405f3f150ba80ba952">MD_next_section</a> (section))
<a name="l01924"></a>01924         {
<a name="l01925"></a>01925           <span class="comment">/* Name has conflict if entry already exists with this</span>
<a name="l01926"></a>01926 <span class="comment">           * name and it is not the entry we are renaming.</span>
<a name="l01927"></a>01927 <span class="comment">           * 'entry' may be NULL if want to force renaming.</span>
<a name="l01928"></a>01928 <span class="comment">           */</span>
<a name="l01929"></a>01929           conflicting_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ed997dd6e6244f22cfadf1befbd1a630">MD_find_entry</a> (section, new_name);
<a name="l01930"></a>01930           <span class="keywordflow">if</span> ((conflicting_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (conflicting_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l01931"></a>01931             {
<a name="l01932"></a>01932               <span class="comment">/* Debug */</span>
<a name="l01933"></a>01933 <span class="preprocessor">#if 0</span>
<a name="l01934"></a>01934 <span class="preprocessor"></span>              printf (<span class="stringliteral">"Renaming conflicts with %s-&gt;%s\n"</span>,
<a name="l01935"></a>01935                       section-&gt;name, new_name);
<a name="l01936"></a>01936 <span class="preprocessor">#endif</span>
<a name="l01937"></a>01937 <span class="preprocessor"></span>
<a name="l01938"></a>01938               <span class="comment">/* Conflict found, try another name */</span>
<a name="l01939"></a>01939               unique = 0;
<a name="l01940"></a>01940               <span class="keywordflow">break</span>;
<a name="l01941"></a>01941             }
<a name="l01942"></a>01942         }
<a name="l01943"></a>01943     }
<a name="l01944"></a>01944 
<a name="l01945"></a>01945   <span class="comment">/* Make sure we haven't gone past 2 billion (will run out of bits soon) */</span>
<a name="l01946"></a>01946   <span class="keywordflow">if</span> (rename_id &gt; 2000000000)
<a name="l01947"></a>01947     {
<a name="l01948"></a>01948       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__error_8c.html#04f215f17936ffe11d70fef75a9f2185">I_punt</a> (<span class="stringliteral">"CU_get_unique_name: id too big (%i)\n"</span>, rename_id);
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950 
<a name="l01951"></a>01951   <span class="comment">/* Update the symbol entry */</span>
<a name="l01952"></a>01952 <span class="preprocessor">#if LP64_ARCHITECTURE</span>
<a name="l01953"></a>01953 <span class="preprocessor"></span>  rename_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#1cffd5937e773a688315d44a0fd8d50f">data</a> = (<span class="keywordtype">void</span> *)((<span class="keywordtype">long</span>) rename_id);
<a name="l01954"></a>01954 <span class="preprocessor">#else</span>
<a name="l01955"></a>01955 <span class="preprocessor"></span>  rename_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structSTRING__Symbol.html#1cffd5937e773a688315d44a0fd8d50f">data</a> = (<span class="keywordtype">void</span> *) rename_id;
<a name="l01956"></a>01956 <span class="preprocessor">#endif</span>
<a name="l01957"></a>01957 <span class="preprocessor"></span>}
<a name="l01958"></a>01958 
<a name="l01959"></a>01959 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *
<a name="l01960"></a><a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">01960</a> <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * orig_entry)
<a name="l01961"></a>01961 {
<a name="l01962"></a>01962   <span class="keywordtype">char</span> new_name[4000], *orig_name;      <span class="comment">/* Assume sane sized names */</span>
<a name="l01963"></a>01963   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l01964"></a>01964   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_entry;
<a name="l01965"></a>01965   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l01966"></a>01966   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *orig_field, *new_field;
<a name="l01967"></a>01967   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html">MD_Element</a> *element;
<a name="l01968"></a>01968   <span class="keywordtype">int</span> index;
<a name="l01969"></a>01969 
<a name="l01970"></a>01970   <span class="comment">/* Get this entry's section for ease of use */</span>
<a name="l01971"></a>01971   section = orig_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973   <span class="comment">/* Use the name in orig_entry-&gt;original_name if exists.</span>
<a name="l01974"></a>01974 <span class="comment">   * This prevents getting bla~1~1~1~1... after multiple dups.</span>
<a name="l01975"></a>01975 <span class="comment">   */</span>
<a name="l01976"></a>01976   orig_name = orig_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>;
<a name="l01977"></a>01977   <span class="keywordflow">if</span> ((field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"original_name"</span>)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01978"></a>01978     {
<a name="l01979"></a>01979       <span class="keywordflow">if</span> ((orig_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (orig_entry, field_decl)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01980"></a>01980         {
<a name="l01981"></a>01981           orig_name = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#071dc413a821b518ca716a2a4fdb638a">MD_get_string</a> (orig_field, 0);
<a name="l01982"></a>01982         }
<a name="l01983"></a>01983     }
<a name="l01984"></a>01984 
<a name="l01985"></a>01985   <span class="comment">/* Get a new name for the new entry (force a new name) */</span>
<a name="l01986"></a>01986   <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (section-&gt;md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, orig_name, new_name);
<a name="l01987"></a>01987 
<a name="l01988"></a>01988   <span class="comment">/* Create new entry in this section */</span>
<a name="l01989"></a>01989   new_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (section, new_name);
<a name="l01990"></a>01990 
<a name="l01991"></a>01991   <span class="comment">/* Copy all the field information to the new entry */</span>
<a name="l01992"></a>01992   <span class="keywordflow">for</span> (field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#ec8db6e1a71d3ca153e81e270872e8a4">MD_first_field_decl</a> (section); field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01993"></a>01993        field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a1591f954c0b8b00c6a22356c02024ff">MD_next_field_decl</a> (field_decl))
<a name="l01994"></a>01994     {
<a name="l01995"></a>01995       <span class="comment">/* Does this field exist in the original? If not, go to next one */</span>
<a name="l01996"></a>01996       <span class="keywordflow">if</span> ((orig_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (orig_entry, field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01997"></a>01997         <span class="keywordflow">continue</span>;
<a name="l01998"></a>01998 
<a name="l01999"></a>01999       <span class="comment">/* Create this field in new entry */</span>
<a name="l02000"></a>02000       new_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_entry, field_decl, 0);
<a name="l02001"></a>02001 
<a name="l02002"></a>02002       <span class="comment">/* Copy the field's contents */</span>
<a name="l02003"></a>02003       <span class="keywordflow">for</span> (index = 0; index &lt;= orig_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02004"></a>02004         {
<a name="l02005"></a>02005           <span class="comment">/* Copy element only if not NULL */</span>
<a name="l02006"></a>02006           <span class="keywordflow">if</span> ((element = orig_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[index]) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02007"></a>02007             {
<a name="l02008"></a>02008               switch (element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>)
<a name="l02009"></a>02009                 {
<a name="l02010"></a>02010                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>:
<a name="l02011"></a>02011                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (new_field, index,
<a name="l02012"></a>02012                               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (orig_field, index));
<a name="l02013"></a>02013                   <span class="keywordflow">break</span>;
<a name="l02014"></a>02014 
<a name="l02015"></a>02015                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d613c66d34f25d733291ba6118f1e2cd">MD_DOUBLE</a>:
<a name="l02016"></a>02016                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c47e98c68b31487a4b7958ca8be2f337">MD_set_double</a> (new_field, index,
<a name="l02017"></a>02017                                  <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#649cf2eb5f9d69a1c2902fbb1718e63e">MD_get_double</a> (orig_field, index));
<a name="l02018"></a>02018                   <span class="keywordflow">break</span>;
<a name="l02019"></a>02019 
<a name="l02020"></a>02020                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#00aaba1fc61d6e7046112b9477287b70">MD_STRING</a>:
<a name="l02021"></a>02021                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ce4e2520515e16050f27d7b86196e82a">MD_set_string</a> (new_field, index,
<a name="l02022"></a>02022                                  <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#071dc413a821b518ca716a2a4fdb638a">MD_get_string</a> (orig_field, index));
<a name="l02023"></a>02023                   <span class="keywordflow">break</span>;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>:
<a name="l02026"></a>02026                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (new_field, index,
<a name="l02027"></a>02027                                <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (orig_field, index));
<a name="l02028"></a>02028                   <span class="keywordflow">break</span>;
<a name="l02029"></a>02029 
<a name="l02030"></a>02030                 <span class="keywordflow">default</span>:
<a name="l02031"></a>02031                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (section-&gt;md,
<a name="l02032"></a>02032                           <span class="stringliteral">"CU_dup_entry: Unknown element type %i"</span>,
<a name="l02033"></a>02033                           element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>);
<a name="l02034"></a>02034                 }
<a name="l02035"></a>02035             }
<a name="l02036"></a>02036         }
<a name="l02037"></a>02037     }
<a name="l02038"></a>02038 
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <span class="comment">/* Create (if necessary) a orignal_name field to track where this new entry</span>
<a name="l02041"></a>02041 <span class="comment">   * came from.  Punt if orignal_name field declaration is not</span>
<a name="l02042"></a>02042 <span class="comment">   * what we expect.</span>
<a name="l02043"></a>02043 <span class="comment">   */</span>
<a name="l02044"></a>02044   <span class="keywordflow">if</span> ((field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"original_name"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02045"></a>02045     {
<a name="l02046"></a>02046       <span class="comment">/* Create an optional 'original_name' field that takes one STRING */</span>
<a name="l02047"></a>02047       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, <span class="stringliteral">"original_name"</span>,
<a name="l02048"></a>02048                                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>);
<a name="l02049"></a>02049       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a96bd277bec6297de1464775cba610de">MD_require_string</a> (field_decl, 0);
<a name="l02050"></a>02050     }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052   <span class="comment">/* Check that the field is what we expected </span>
<a name="l02053"></a>02053 <span class="comment">   * (don't put in else to make sure this check is consistent with the</span>
<a name="l02054"></a>02054 <span class="comment">   *  above field creation)</span>
<a name="l02055"></a>02055 <span class="comment">   */</span>
<a name="l02056"></a>02056   <span class="keywordflow">if</span> ((field_decl-&gt;max_require_index != 0) ||
<a name="l02057"></a>02057       (field_decl-&gt;type != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>) ||
<a name="l02058"></a>02058       (field_decl-&gt;kleene_starred_req != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l02059"></a>02059       (field_decl-&gt;require[0]-&gt;type != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#00aaba1fc61d6e7046112b9477287b70">MD_STRING</a>))
<a name="l02060"></a>02060     {
<a name="l02061"></a>02061       fprintf (stderr,
<a name="l02062"></a>02062                <span class="stringliteral">"CU_dup_entry: Field %s-&gt;%s is not what is expected:\n"</span>,
<a name="l02063"></a>02063                section-&gt;name, field_decl-&gt;name);
<a name="l02064"></a>02064       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#da54c72928268acad4526ab846aa837d">MD_print_field_decl</a> (stderr, field_decl, 80);
<a name="l02065"></a>02065       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (section-&gt;md,
<a name="l02066"></a>02066               <span class="stringliteral">"Please change mdes or change field used (%s) by customizer.\n"</span>,
<a name="l02067"></a>02067               field_decl-&gt;name);
<a name="l02068"></a>02068     }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070   <span class="comment">/* Set original name (if necessary). </span>
<a name="l02071"></a>02071 <span class="comment">   * Keep original name from orig_entry if there is one.</span>
<a name="l02072"></a>02072 <span class="comment">   */</span>
<a name="l02073"></a>02073   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (new_entry, field_decl) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02074"></a>02074     {
<a name="l02075"></a>02075       new_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_entry, field_decl, 1);
<a name="l02076"></a>02076       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ce4e2520515e16050f27d7b86196e82a">MD_set_string</a> (new_field, 0, orig_entry-&gt;name);
<a name="l02077"></a>02077     }
<a name="l02078"></a>02078 
<a name="l02079"></a>02079   <span class="keywordflow">return</span> (new_entry);
<a name="l02080"></a>02080 }
<a name="l02081"></a>02081 
<a name="l02082"></a>02082 <span class="keywordtype">void</span>
<a name="l02083"></a><a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">02083</a> <a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">CU_rename_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="keywordtype">char</span> *new_name)
<a name="l02084"></a>02084 {
<a name="l02085"></a>02085   <span class="keywordtype">char</span> unique_name[4000];       <span class="comment">/* Assume sane sized names */</span>
<a name="l02086"></a>02086   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l02087"></a>02087   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l02088"></a>02088   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *orig_field, *new_field;
<a name="l02089"></a>02089 
<a name="l02090"></a>02090   <span class="comment">/* Get this entry's section for ease of use */</span>
<a name="l02091"></a>02091   section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section;
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <span class="comment">/* Use new_name as starting point if not NULL, otherwise</span>
<a name="l02094"></a>02094 <span class="comment">   * use the entry's original name as a starting point.</span>
<a name="l02095"></a>02095 <span class="comment">   */</span>
<a name="l02096"></a>02096   <span class="keywordflow">if</span> (new_name == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02097"></a>02097     {
<a name="l02098"></a>02098       <span class="comment">/* Use the name in entry-&gt;original_name if exists.</span>
<a name="l02099"></a>02099 <span class="comment">       * This prevents getting bla~1~1~1~1... after multiple dups/renames.</span>
<a name="l02100"></a>02100 <span class="comment">       */</span>
<a name="l02101"></a>02101       new_name = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name;
<a name="l02102"></a>02102       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"original_name"</span>);
<a name="l02103"></a>02103       <span class="keywordflow">if</span> (field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02104"></a>02104         {
<a name="l02105"></a>02105           <span class="keywordflow">if</span> ((orig_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02106"></a>02106             {
<a name="l02107"></a>02107               new_name = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#071dc413a821b518ca716a2a4fdb638a">MD_get_string</a> (orig_field, 0);
<a name="l02108"></a>02108             }
<a name="l02109"></a>02109         }
<a name="l02110"></a>02110     }
<a name="l02111"></a>02111 
<a name="l02112"></a>02112   <span class="comment">/* Get a new name for the new entry */</span>
<a name="l02113"></a>02113   <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, new_name, unique_name);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115   <span class="comment">/* Create (if necessary) a orignal_name field to track what this entry</span>
<a name="l02116"></a>02116 <span class="comment">   * was originally named.  Punt if orignal_name field declaration is not</span>
<a name="l02117"></a>02117 <span class="comment">   * what we expect.</span>
<a name="l02118"></a>02118 <span class="comment">   */</span>
<a name="l02119"></a>02119   <span class="keywordflow">if</span> ((field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"original_name"</span>)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02120"></a>02120     {
<a name="l02121"></a>02121       <span class="comment">/* Create an optional 'original_name' field that takes one STRING */</span>
<a name="l02122"></a>02122       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (section, <span class="stringliteral">"original_name"</span>,
<a name="l02123"></a>02123                                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>);
<a name="l02124"></a>02124       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a96bd277bec6297de1464775cba610de">MD_require_string</a> (field_decl, 0);
<a name="l02125"></a>02125     }
<a name="l02126"></a>02126 
<a name="l02127"></a>02127   <span class="comment">/* Check that the field is what we expected </span>
<a name="l02128"></a>02128 <span class="comment">   * (don't put in else to make sure this check is consistent with the</span>
<a name="l02129"></a>02129 <span class="comment">   *  above field creation)</span>
<a name="l02130"></a>02130 <span class="comment">   */</span>
<a name="l02131"></a>02131   <span class="keywordflow">if</span> ((field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> != 0) ||
<a name="l02132"></a>02132       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#4fe7866fe91318b8730183542d2040cd">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>) ||
<a name="l02133"></a>02133       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#c2dff0726ae0fa2813377e968ca3dfab">kleene_starred_req</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l02134"></a>02134       (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#00aaba1fc61d6e7046112b9477287b70">MD_STRING</a>))
<a name="l02135"></a>02135     {
<a name="l02136"></a>02136       fprintf (stderr,
<a name="l02137"></a>02137                <span class="stringliteral">"CU_rename_entry: Field %s-&gt;%s is not what is expected:\n"</span>,
<a name="l02138"></a>02138                section-&gt;name, field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l02139"></a>02139       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#da54c72928268acad4526ab846aa837d">MD_print_field_decl</a> (stderr, field_decl, 80);
<a name="l02140"></a>02140       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (section-&gt;md,
<a name="l02141"></a>02141               <span class="stringliteral">"Please change mdes or change field used (%s) by customizer.\n"</span>,
<a name="l02142"></a>02142               field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l02143"></a>02143     }
<a name="l02144"></a>02144 
<a name="l02145"></a>02145   <span class="comment">/* Set original name (if necessary). </span>
<a name="l02146"></a>02146 <span class="comment">   * Keep original name from entry if there is one.</span>
<a name="l02147"></a>02147 <span class="comment">   */</span>
<a name="l02148"></a>02148   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02149"></a>02149     {
<a name="l02150"></a>02150       new_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (entry, field_decl, 1);
<a name="l02151"></a>02151       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ce4e2520515e16050f27d7b86196e82a">MD_set_string</a> (new_field, 0, entry-&gt;name);
<a name="l02152"></a>02152     }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154   <span class="comment">/* Rename the entry */</span>
<a name="l02155"></a>02155   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#21f5e11ef45622d57325c409ba6a486c">MD_rename_entry</a> (entry, unique_name);
<a name="l02156"></a>02156 }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158 <span class="comment">/* Adds link at the given index, shifting all links at or after that</span>
<a name="l02159"></a>02159 <span class="comment"> * index to the right.</span>
<a name="l02160"></a>02160 <span class="comment"> */</span>
<a name="l02161"></a>02161 <span class="keywordtype">void</span>
<a name="l02162"></a><a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">02162</a> <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> * field, <span class="keywordtype">int</span> at_index, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * new_link)
<a name="l02163"></a>02163 {
<a name="l02164"></a>02164   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html">MD_Element</a> *element;
<a name="l02165"></a>02165   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target_entry;
<a name="l02166"></a>02166   <span class="keywordtype">int</span> index;
<a name="l02167"></a>02167 
<a name="l02168"></a>02168   <span class="comment">/* Shift the elements to the right starting at at_index */</span>
<a name="l02169"></a>02169   <span class="keywordflow">for</span> (index = field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index &gt;= at_index; index--)
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171       <span class="comment">/* Don't expect element to be NULL */</span>
<a name="l02172"></a>02172       <span class="keywordflow">if</span> ((element = field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[index]) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02173"></a>02173         {
<a name="l02174"></a>02174           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02175"></a>02175                   <span class="stringliteral">"CU_add_link_at: NULL links in list not supported!"</span>);
<a name="l02176"></a>02176         }
<a name="l02177"></a>02177 
<a name="l02178"></a>02178       <span class="comment">/* Must be a link */</span>
<a name="l02179"></a>02179       <span class="keywordflow">if</span> (element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l02180"></a>02180         {
<a name="l02181"></a>02181           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02182"></a>02182                   <span class="stringliteral">"CU_add_link_at: Link expected not type '%i'"</span>,
<a name="l02183"></a>02183                   element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>);
<a name="l02184"></a>02184         }
<a name="l02185"></a>02185 
<a name="l02186"></a>02186       target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (field, index);
<a name="l02187"></a>02187       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (field, index + 1, target_entry);
<a name="l02188"></a>02188     }
<a name="l02189"></a>02189 
<a name="l02190"></a>02190   <span class="comment">/* Set the element at the list the new link */</span>
<a name="l02191"></a>02191   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (field, at_index, new_link);
<a name="l02192"></a>02192 }
<a name="l02193"></a>02193 
<a name="l02194"></a>02194 <span class="comment">/* Deletes link at the given index, shifting all links after that</span>
<a name="l02195"></a>02195 <span class="comment"> * index to the left (so there is no hole left).</span>
<a name="l02196"></a>02196 <span class="comment"> */</span>
<a name="l02197"></a>02197 <span class="keywordtype">void</span>
<a name="l02198"></a><a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">02198</a> <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> * field, <span class="keywordtype">int</span> at_index)
<a name="l02199"></a>02199 {
<a name="l02200"></a>02200   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html">MD_Element</a> *element;
<a name="l02201"></a>02201   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target_entry;
<a name="l02202"></a>02202   <span class="keywordtype">int</span> index;
<a name="l02203"></a>02203 
<a name="l02204"></a>02204   <span class="comment">/* Better be a link at the index specified */</span>
<a name="l02205"></a>02205   <span class="keywordflow">if</span> (at_index &gt; field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>)
<a name="l02206"></a>02206     {
<a name="l02207"></a>02207       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02208"></a>02208               <span class="stringliteral">"CU_delete_link_at: at_index %i out of bounds!"</span>, at_index);
<a name="l02209"></a>02209     }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211   <span class="keywordflow">if</span> ((element = field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[at_index]) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02212"></a>02212     {
<a name="l02213"></a>02213       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02214"></a>02214               <span class="stringliteral">"CU_delete_link_at: Attempting to delete NULL link at index %i!"</span>,
<a name="l02215"></a>02215               at_index);
<a name="l02216"></a>02216     }
<a name="l02217"></a>02217   <span class="keywordflow">if</span> (element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l02218"></a>02218     {
<a name="l02219"></a>02219       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02220"></a>02220               <span class="stringliteral">"CU_delete_link_at: %s-&gt;%s-&gt;%s[%i] not a link!"</span>,
<a name="l02221"></a>02221               field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l02222"></a>02222               field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#507895b2c7e647afd56840a2a0cd2136">decl</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>, at_index);
<a name="l02223"></a>02223     }
<a name="l02224"></a>02224 
<a name="l02225"></a>02225   <span class="comment">/* Shift the elements to the left starting at at_index+1 */</span>
<a name="l02226"></a>02226   <span class="keywordflow">for</span> (index = at_index + 1; index &lt;= field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02227"></a>02227     {
<a name="l02228"></a>02228       <span class="comment">/* Don't expect element to be NULL */</span>
<a name="l02229"></a>02229       <span class="keywordflow">if</span> ((element = field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[index]) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02230"></a>02230         {
<a name="l02231"></a>02231           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02232"></a>02232                   <span class="stringliteral">"CU_delete_link_at: NULL links in list not supported!"</span>);
<a name="l02233"></a>02233         }
<a name="l02234"></a>02234 
<a name="l02235"></a>02235       <span class="comment">/* Must be a link */</span>
<a name="l02236"></a>02236       <span class="keywordflow">if</span> (element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l02237"></a>02237         {
<a name="l02238"></a>02238           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02239"></a>02239                   <span class="stringliteral">"CU_delete_link_at: Link expected not type '%i'"</span>,
<a name="l02240"></a>02240                   element-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>);
<a name="l02241"></a>02241         }
<a name="l02242"></a>02242 
<a name="l02243"></a>02243       target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (field, index);
<a name="l02244"></a>02244       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (field, index - 1, target_entry);
<a name="l02245"></a>02245     }
<a name="l02246"></a>02246 
<a name="l02247"></a>02247   <span class="comment">/* Delete the link at the end of the list (it is now a duplicate) */</span>
<a name="l02248"></a>02248   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (field, field-&gt;max_element_index);
<a name="l02249"></a>02249 }
<a name="l02250"></a>02250 
<a name="l02251"></a>02251 <span class="comment">/* Duplicates a Scheduling_Alternative, modifying any Operations pointing</span>
<a name="l02252"></a>02252 <span class="comment"> * at this alternative so that the new alternative is placed immediately</span>
<a name="l02253"></a>02253 <span class="comment"> * after the original in the operation's alt list.</span>
<a name="l02254"></a>02254 <span class="comment"> *</span>
<a name="l02255"></a>02255 <span class="comment"> * Rename (add ~#) both the original and new alts to show that the customizer</span>
<a name="l02256"></a>02256 <span class="comment"> * may have changed their behavior.</span>
<a name="l02257"></a>02257 <span class="comment"> */</span>
<a name="l02258"></a>02258 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *
<a name="l02259"></a><a class="code" href="lmdes2__customizer_8c.html#21fc335b4dfe1e7941cdc26722a47457">02259</a> <a class="code" href="lmdes2__customizer_8c.html#21fc335b4dfe1e7941cdc26722a47457">CU_dup_alt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * orig_alt)
<a name="l02260"></a>02260 {
<a name="l02261"></a>02261   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_alt, *operation_entry, *test_alt;
<a name="l02262"></a>02262   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *operation_section;
<a name="l02263"></a>02263   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *alt_field_decl;
<a name="l02264"></a>02264   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *alt_field;
<a name="l02265"></a>02265   <span class="keywordtype">int</span> index;
<a name="l02266"></a>02266 
<a name="l02267"></a>02267   <span class="comment">/* Make sure really passed a scheduling alt */</span>
<a name="l02268"></a>02268   <span class="keywordflow">if</span> (strcmp (orig_alt-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Scheduling_Alternative"</span>) != 0)
<a name="l02269"></a>02269     {
<a name="l02270"></a>02270       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (orig_alt-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02271"></a>02271               <span class="stringliteral">"CU_dup_alt:\n  Expecting Scheduling_Alternative entry "</span>
<a name="l02272"></a>02272               <span class="stringliteral">"not '%s-&gt;%s'"</span>,
<a name="l02273"></a>02273               orig_alt-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, orig_alt-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02274"></a>02274     }
<a name="l02275"></a>02275 
<a name="l02276"></a>02276   <span class="comment">/* Rename the original alt (add ~#) */</span>
<a name="l02277"></a>02277   <a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">CU_rename_entry</a> (orig_alt, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02278"></a>02278 
<a name="l02279"></a>02279   <span class="comment">/* Create the new alt */</span>
<a name="l02280"></a>02280   new_alt = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (orig_alt);
<a name="l02281"></a>02281 
<a name="l02282"></a>02282   <span class="comment">/* Get the operation section and it's alt field declaration */</span>
<a name="l02283"></a>02283   operation_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (orig_alt-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>, <span class="stringliteral">"Operation"</span>);
<a name="l02284"></a>02284   alt_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (operation_section, <span class="stringliteral">"alt"</span>);
<a name="l02285"></a>02285 
<a name="l02286"></a>02286   <span class="comment">/* Scan the Operation section for uses of the orig_alt */</span>
<a name="l02287"></a>02287   <span class="keywordflow">for</span> (operation_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (operation_section);
<a name="l02288"></a>02288        operation_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02289"></a>02289        operation_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (operation_entry))
<a name="l02290"></a>02290     {
<a name="l02291"></a>02291       <span class="comment">/* Get the alt field */</span>
<a name="l02292"></a>02292       alt_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (operation_entry, alt_field_decl);
<a name="l02293"></a>02293 
<a name="l02294"></a>02294       <span class="comment">/* Scan alt field for matches */</span>
<a name="l02295"></a>02295       <span class="keywordflow">for</span> (index = 0; index &lt;= alt_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02296"></a>02296         {
<a name="l02297"></a>02297           test_alt = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index);
<a name="l02298"></a>02298 
<a name="l02299"></a>02299           <span class="keywordflow">if</span> (orig_alt == test_alt)
<a name="l02300"></a>02300             {
<a name="l02301"></a>02301               <span class="comment">/* Make a place for the new alt in the alt field,</span>
<a name="l02302"></a>02302 <span class="comment">               * and place the new_alt there</span>
<a name="l02303"></a>02303 <span class="comment">               */</span>
<a name="l02304"></a>02304               <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (alt_field, index + 1, new_alt);
<a name="l02305"></a>02305             }
<a name="l02306"></a>02306         }
<a name="l02307"></a>02307     }
<a name="l02308"></a>02308 
<a name="l02309"></a>02309   <span class="keywordflow">return</span> (new_alt);
<a name="l02310"></a>02310 }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312 <span class="comment">/* Duplicates a Reservation_Table entry so that the original entry then the</span>
<a name="l02313"></a>02313 <span class="comment"> * new entry will be attempted when scheduling.  This will cause the</span>
<a name="l02314"></a>02314 <span class="comment"> * relevent scheduling alts to be duplicated and the relevent operation</span>
<a name="l02315"></a>02315 <span class="comment"> * alt lists to be adjusted.</span>
<a name="l02316"></a>02316 <span class="comment"> *</span>
<a name="l02317"></a>02317 <span class="comment"> * Rename (add ~#) both the original and new alts to show that the customizer</span>
<a name="l02318"></a>02318 <span class="comment"> * may have changed their behavior.</span>
<a name="l02319"></a>02319 <span class="comment"> */</span>
<a name="l02320"></a>02320 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *
<a name="l02321"></a><a class="code" href="lmdes2__customizer_8c.html#ba4d5d0af6041b1626b8cd7186b2e73f">02321</a> <a class="code" href="lmdes2__customizer_8c.html#ba4d5d0af6041b1626b8cd7186b2e73f">CU_dup_res_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * orig_res_table)
<a name="l02322"></a>02322 {
<a name="l02323"></a>02323   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_res_table, *orig_alt_entry, *new_alt_entry, *test_res_table;
<a name="l02324"></a>02324   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *alt_section;
<a name="l02325"></a>02325   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *resv_field_decl;
<a name="l02326"></a>02326   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *resv_field;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   <span class="comment">/* Make sure really passed a reservation table entry */</span>
<a name="l02329"></a>02329   <span class="keywordflow">if</span> (strcmp (orig_res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Reservation_Table"</span>) != 0)
<a name="l02330"></a>02330     {
<a name="l02331"></a>02331       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (orig_res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02332"></a>02332               <span class="stringliteral">"CU_dup_res_table:\n  Expecting Reservation_Table entry "</span>
<a name="l02333"></a>02333               <span class="stringliteral">"not '%s-&gt;%s'"</span>,
<a name="l02334"></a>02334               orig_res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, orig_res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02335"></a>02335     }
<a name="l02336"></a>02336 
<a name="l02337"></a>02337   <span class="comment">/* Rename the original reseravation table (add ~#) */</span>
<a name="l02338"></a>02338   <a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">CU_rename_entry</a> (orig_res_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02339"></a>02339 
<a name="l02340"></a>02340   <span class="comment">/* Create the new res table */</span>
<a name="l02341"></a>02341   new_res_table = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (orig_res_table);
<a name="l02342"></a>02342 
<a name="l02343"></a>02343   <span class="comment">/* Get the operation section and it's alt field declaration */</span>
<a name="l02344"></a>02344   alt_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (orig_res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02345"></a>02345                                  <span class="stringliteral">"Scheduling_Alternative"</span>);
<a name="l02346"></a>02346   resv_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (alt_section, <span class="stringliteral">"resv"</span>);
<a name="l02347"></a>02347 
<a name="l02348"></a>02348   <span class="comment">/* Scan the alt section for uses of the orig_res_table */</span>
<a name="l02349"></a>02349   <span class="keywordflow">for</span> (orig_alt_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (alt_section);
<a name="l02350"></a>02350        orig_alt_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02351"></a>02351        orig_alt_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (orig_alt_entry))
<a name="l02352"></a>02352     {
<a name="l02353"></a>02353       <span class="comment">/* Get the resv field */</span>
<a name="l02354"></a>02354       resv_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (orig_alt_entry, resv_field_decl);
<a name="l02355"></a>02355 
<a name="l02356"></a>02356       <span class="comment">/* Does this alt point at the res_table */</span>
<a name="l02357"></a>02357       test_res_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (resv_field, 0);
<a name="l02358"></a>02358       <span class="keywordflow">if</span> (orig_res_table == test_res_table)
<a name="l02359"></a>02359         {
<a name="l02360"></a>02360           <span class="comment">/* If so, duplicate the alt entry and point at new res_table */</span>
<a name="l02361"></a>02361           new_alt_entry = <a class="code" href="lmdes2__customizer_8c.html#21fc335b4dfe1e7941cdc26722a47457">CU_dup_alt</a> (orig_alt_entry);
<a name="l02362"></a>02362           resv_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (new_alt_entry, resv_field_decl);
<a name="l02363"></a>02363           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (resv_field, 0, new_res_table);
<a name="l02364"></a>02364         }
<a name="l02365"></a>02365     }
<a name="l02366"></a>02366 
<a name="l02367"></a>02367   <span class="keywordflow">return</span> (new_res_table);
<a name="l02368"></a>02368 }
<a name="l02369"></a>02369 
<a name="l02370"></a>02370 <span class="comment">/* Duplicates a Resource Usage entry so that both the original entry then the</span>
<a name="l02371"></a>02371 <span class="comment"> * new entry will be required when scheduling.  This will cause the</span>
<a name="l02372"></a>02372 <span class="comment"> * relevent resource_unit-&gt;use() fields to be adjusted.  This must</span>
<a name="l02373"></a>02373 <span class="comment"> * be run after CU_homogenize_table_options() and </span>
<a name="l02374"></a>02374 <span class="comment"> * CU_consolidate_res_table_usages() to prevent resource usages from</span>
<a name="l02375"></a>02375 <span class="comment"> * appearing in table options or res tables!  </span>
<a name="l02376"></a>02376 <span class="comment"> *</span>
<a name="l02377"></a>02377 <span class="comment"> * Rename (add ~#) both the original and new rus to show that the customizer</span>
<a name="l02378"></a>02378 <span class="comment"> * may have changed their behavior.</span>
<a name="l02379"></a>02379 <span class="comment"> */</span>
<a name="l02380"></a>02380 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *
<a name="l02381"></a><a class="code" href="lmdes2__customizer_8c.html#5908c785db2a738c076ba133610e281f">02381</a> <a class="code" href="lmdes2__customizer_8c.html#5908c785db2a738c076ba133610e281f">CU_dup_resource_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * orig_ru)
<a name="l02382"></a>02382 {
<a name="l02383"></a>02383   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_ru, *unit_entry, *test_ru;
<a name="l02384"></a>02384   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section;
<a name="l02385"></a>02385   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *use_field_decl;
<a name="l02386"></a>02386   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field;
<a name="l02387"></a>02387   <span class="keywordtype">int</span> index;
<a name="l02388"></a>02388 
<a name="l02389"></a>02389   <span class="comment">/* Make sure really passed a resource usage entry */</span>
<a name="l02390"></a>02390   <span class="keywordflow">if</span> (strcmp (orig_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Usage"</span>) != 0)
<a name="l02391"></a>02391     {
<a name="l02392"></a>02392       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (orig_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02393"></a>02393               <span class="stringliteral">"CU_dup_resource_usage:\n"</span>
<a name="l02394"></a>02394               <span class="stringliteral">"  Expecting Reservation_Table entry not '%s-&gt;%s'"</span>,
<a name="l02395"></a>02395               orig_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, orig_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02396"></a>02396     }
<a name="l02397"></a>02397 
<a name="l02398"></a>02398   <span class="comment">/* Rename the original resource usage (add ~#) */</span>
<a name="l02399"></a>02399   <a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">CU_rename_entry</a> (orig_ru, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02400"></a>02400 
<a name="l02401"></a>02401   <span class="comment">/* Create the new resource usage */</span>
<a name="l02402"></a>02402   new_ru = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (orig_ru);
<a name="l02403"></a>02403 
<a name="l02404"></a>02404   <span class="comment">/* Get the resource unit section and it's use field declaration */</span>
<a name="l02405"></a>02405   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (orig_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l02406"></a>02406   use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (unit_section, <span class="stringliteral">"use"</span>);
<a name="l02407"></a>02407 
<a name="l02408"></a>02408   <span class="comment">/* Scan the resource unit section for uses of the orig_ru */</span>
<a name="l02409"></a>02409   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02410"></a>02410        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l02411"></a>02411     {
<a name="l02412"></a>02412       <span class="comment">/* Get the use field */</span>
<a name="l02413"></a>02413       use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (unit_entry, use_field_decl);
<a name="l02414"></a>02414 
<a name="l02415"></a>02415       <span class="comment">/* Scan use field for uses of orig_ru, scan backwards so we</span>
<a name="l02416"></a>02416 <span class="comment">       * can easily add new_ru if found.</span>
<a name="l02417"></a>02417 <span class="comment">       */</span>
<a name="l02418"></a>02418       <span class="keywordflow">for</span> (index = use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index &gt;= 0; index--)
<a name="l02419"></a>02419         {
<a name="l02420"></a>02420           <span class="comment">/* Does this use[index]t point at the orig_ru */</span>
<a name="l02421"></a>02421           test_ru = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index);
<a name="l02422"></a>02422           <span class="keywordflow">if</span> (orig_ru == test_ru)
<a name="l02423"></a>02423             {
<a name="l02424"></a>02424               <span class="comment">/* If so, add new_ru after it */</span>
<a name="l02425"></a>02425               <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (use_field, index + 1, new_ru);
<a name="l02426"></a>02426 
<a name="l02427"></a>02427 <span class="preprocessor">#if 0</span>
<a name="l02428"></a>02428 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l02429"></a>02429               printf (<span class="stringliteral">"  Adding '%s' to %s-&gt;use[%i]\n"</span>,
<a name="l02430"></a>02430                       new_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, unit_entry-&gt;name, index + 1);
<a name="l02431"></a>02431 <span class="preprocessor">#endif</span>
<a name="l02432"></a>02432 <span class="preprocessor"></span>            }
<a name="l02433"></a>02433         }
<a name="l02434"></a>02434     }
<a name="l02435"></a>02435 
<a name="l02436"></a>02436   <span class="comment">/* Need to scan if there are links from somewhere else to this orig_ru! */</span>
<a name="l02437"></a>02437 
<a name="l02438"></a>02438   <span class="comment">/* Return the new_ru */</span>
<a name="l02439"></a>02439   <span class="keywordflow">return</span> (new_ru);
<a name="l02440"></a>02440 }
<a name="l02441"></a>02441 
<a name="l02442"></a>02442 <span class="comment">/* Returns the smallest slot used in time 0, or -1 if no slot found</span>
<a name="l02443"></a>02443 <span class="comment"> * (slots may not be negative).</span>
<a name="l02444"></a>02444 <span class="comment"> */</span>
<a name="l02445"></a>02445 <span class="keywordtype">int</span>
<a name="l02446"></a><a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">02446</a> <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field, *time_field, *slot_field;
<a name="l02449"></a>02449   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *slot_field_decl;
<a name="l02450"></a>02450   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *sub_entry, *resource_entry;
<a name="l02451"></a>02451   <span class="keywordtype">int</span> index, time;
<a name="l02452"></a>02452   <span class="keywordtype">int</span> entry_slot, sub_entry_slot;
<a name="l02453"></a>02453 
<a name="l02454"></a>02454   <span class="comment">/* Initially, no slot is specified */</span>
<a name="l02455"></a>02455   entry_slot = -1;
<a name="l02456"></a>02456 
<a name="l02457"></a>02457   <span class="comment">/* Recurse until entry is a Resource_Usage entry */</span>
<a name="l02458"></a>02458 
<a name="l02459"></a>02459   <span class="comment">/* Handle if entry is a Table_Option */</span>
<a name="l02460"></a>02460   <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l02461"></a>02461     {
<a name="l02462"></a>02462       <span class="comment">/* Overlaps if any option overlaps */</span>
<a name="l02463"></a>02463       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"one_of"</span>);
<a name="l02464"></a>02464       <span class="keywordflow">for</span> (index = 0; index &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02465"></a>02465         {
<a name="l02466"></a>02466           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index);
<a name="l02467"></a>02467           sub_entry_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (sub_entry);
<a name="l02468"></a>02468 
<a name="l02469"></a>02469           <span class="comment">/* Update entry_slot if necessary */</span>
<a name="l02470"></a>02470           <span class="keywordflow">if</span> (sub_entry_slot != -1)
<a name="l02471"></a>02471             {
<a name="l02472"></a>02472               <span class="keywordflow">if</span> ((entry_slot == -1) || (sub_entry_slot &lt; entry_slot))
<a name="l02473"></a>02473                 entry_slot = sub_entry_slot;
<a name="l02474"></a>02474             }
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476 
<a name="l02477"></a>02477       <span class="comment">/* Return the smallest slot found (or -1 if no slot found) */</span>
<a name="l02478"></a>02478       <span class="keywordflow">return</span> (entry_slot);
<a name="l02479"></a>02479     }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481   <span class="comment">/* Handle if entry is a Resource_Unit */</span>
<a name="l02482"></a>02482   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l02483"></a>02483     {
<a name="l02484"></a>02484       <span class="comment">/* Overlaps if any resource usage overlaps */</span>
<a name="l02485"></a>02485       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l02486"></a>02486       <span class="keywordflow">for</span> (index = 0; index &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02487"></a>02487         {
<a name="l02488"></a>02488           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index);
<a name="l02489"></a>02489           sub_entry_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (sub_entry);
<a name="l02490"></a>02490 
<a name="l02491"></a>02491           <span class="comment">/* Update entry_slot (if necessary) */</span>
<a name="l02492"></a>02492           <span class="keywordflow">if</span> (sub_entry_slot != -1)
<a name="l02493"></a>02493             {
<a name="l02494"></a>02494               <span class="keywordflow">if</span> ((entry_slot == -1) || (sub_entry_slot &lt; entry_slot))
<a name="l02495"></a>02495                 entry_slot = sub_entry_slot;
<a name="l02496"></a>02496             }
<a name="l02497"></a>02497         }
<a name="l02498"></a>02498       <span class="comment">/* Return the smallest slot found (or -1 if no slot found) */</span>
<a name="l02499"></a>02499       <span class="keywordflow">return</span> (entry_slot);
<a name="l02500"></a>02500     }
<a name="l02501"></a>02501 
<a name="l02502"></a>02502   <span class="comment">/* Entry1 better be a Resource Usage entry if we got here */</span>
<a name="l02503"></a>02503   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) != 0)
<a name="l02504"></a>02504     {
<a name="l02505"></a>02505       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;md,
<a name="l02506"></a>02506               <span class="stringliteral">"CU_get_slot:\n  Expecting Resource_Usage entry not '%s-&gt;%s'"</span>,
<a name="l02507"></a>02507               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name);
<a name="l02508"></a>02508 
<a name="l02509"></a>02509       <span class="comment">/* To make lint happy */</span>
<a name="l02510"></a>02510       <span class="keywordflow">return</span> (-1);
<a name="l02511"></a>02511     }
<a name="l02512"></a>02512 
<a name="l02513"></a>02513   <span class="comment">/* At this point, entry is a resource usage.  Get slot info if any </span>
<a name="l02514"></a>02514 <span class="comment">   * for a usage at time 0</span>
<a name="l02515"></a>02515 <span class="comment">   */</span>
<a name="l02516"></a>02516 
<a name="l02517"></a>02517   <span class="comment">/* Get the slot used (if any) by this resource usage */</span>
<a name="l02518"></a>02518   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l02519"></a>02519 
<a name="l02520"></a>02520   <span class="comment">/* Get the minimum slot used the the use_field */</span>
<a name="l02521"></a>02521   entry_slot = -1;
<a name="l02522"></a>02522   <span class="keywordflow">for</span> (index = 0; index &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02523"></a>02523     {
<a name="l02524"></a>02524       resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index);
<a name="l02525"></a>02525       slot_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (resource_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>, <span class="stringliteral">"slot"</span>);
<a name="l02526"></a>02526       slot_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (resource_entry, slot_field_decl);
<a name="l02527"></a>02527       <span class="keywordflow">if</span> (slot_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02528"></a>02528         <span class="keywordflow">continue</span>;
<a name="l02529"></a>02529 
<a name="l02530"></a>02530       <span class="comment">/* Get the slot that is used (if the resource is used at time 0) */</span>
<a name="l02531"></a>02531       sub_entry_slot = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (slot_field, 0);
<a name="l02532"></a>02532 
<a name="l02533"></a>02533       <span class="comment">/* Set entry_slot if not previous set or this sub_slot is smaller */</span>
<a name="l02534"></a>02534       <span class="keywordflow">if</span> ((entry_slot == -1) || (sub_entry_slot &lt; entry_slot))
<a name="l02535"></a>02535         entry_slot = sub_entry_slot;
<a name="l02536"></a>02536     }
<a name="l02537"></a>02537 
<a name="l02538"></a>02538   <span class="comment">/* Return -1 now if no slot specified */</span>
<a name="l02539"></a>02539   <span class="keywordflow">if</span> (entry_slot == -1)
<a name="l02540"></a>02540     <span class="keywordflow">return</span> (-1);
<a name="l02541"></a>02541 
<a name="l02542"></a>02542   <span class="comment">/* Use this slot if time 0 appears in time field */</span>
<a name="l02543"></a>02543   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"time"</span>);
<a name="l02544"></a>02544   <span class="keywordflow">for</span> (index = 0; index &lt;= time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02545"></a>02545     {
<a name="l02546"></a>02546       time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, index);
<a name="l02547"></a>02547       <span class="keywordflow">if</span> (time == 0)
<a name="l02548"></a>02548         <span class="keywordflow">return</span> (entry_slot);
<a name="l02549"></a>02549 
<a name="l02550"></a>02550     }
<a name="l02551"></a>02551 
<a name="l02552"></a>02552   <span class="comment">/* If we got here, the slot was not used at time 0 */</span>
<a name="l02553"></a>02553   <span class="keywordflow">return</span> (-1);
<a name="l02554"></a>02554 }
<a name="l02555"></a>02555 
<a name="l02556"></a>02556 <span class="comment">/* Returns the minimum usage time of all the resources usages in this entry</span>
<a name="l02557"></a>02557 <span class="comment"> * (may be negative)</span>
<a name="l02558"></a>02558 <span class="comment"> */</span>
<a name="l02559"></a>02559 <span class="keywordtype">int</span>
<a name="l02560"></a><a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">02560</a> <a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">CU_get_min_time</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l02561"></a>02561 {
<a name="l02562"></a>02562   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field, *time_field;
<a name="l02563"></a>02563   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *sub_entry;
<a name="l02564"></a>02564   <span class="keywordtype">int</span> index, time, min_time, sub_min_time;
<a name="l02565"></a>02565 
<a name="l02566"></a>02566   <span class="comment">/* Set min_time to very large number initially (just for sanity) */</span>
<a name="l02567"></a>02567   min_time = 1000000000;
<a name="l02568"></a>02568 
<a name="l02569"></a>02569   <span class="comment">/* Recurse until entry is a Resource_Usage entry */</span>
<a name="l02570"></a>02570 
<a name="l02571"></a>02571   <span class="comment">/* Handle if entry is a Table_Option */</span>
<a name="l02572"></a>02572   <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l02573"></a>02573     {
<a name="l02574"></a>02574       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"one_of"</span>);
<a name="l02575"></a>02575       <span class="keywordflow">for</span> (index = 0; index &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02576"></a>02576         {
<a name="l02577"></a>02577           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index);
<a name="l02578"></a>02578           sub_min_time = <a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">CU_get_min_time</a> (sub_entry);
<a name="l02579"></a>02579 
<a name="l02580"></a>02580           <span class="comment">/* Update min_time if necessary */</span>
<a name="l02581"></a>02581           <span class="keywordflow">if</span> ((index == 0) || (sub_min_time &lt; min_time))
<a name="l02582"></a>02582             min_time = sub_min_time;
<a name="l02583"></a>02583         }
<a name="l02584"></a>02584 
<a name="l02585"></a>02585       <span class="comment">/* Return the minimum usage time found */</span>
<a name="l02586"></a>02586       <span class="keywordflow">return</span> (min_time);
<a name="l02587"></a>02587     }
<a name="l02588"></a>02588 
<a name="l02589"></a>02589   <span class="comment">/* Handle if entry is a Resource_Unit */</span>
<a name="l02590"></a>02590   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l02591"></a>02591     {
<a name="l02592"></a>02592       <span class="comment">/* Overlaps if any resource usage overlaps */</span>
<a name="l02593"></a>02593       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l02594"></a>02594       <span class="keywordflow">for</span> (index = 0; index &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02595"></a>02595         {
<a name="l02596"></a>02596           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index);
<a name="l02597"></a>02597           sub_min_time = <a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">CU_get_min_time</a> (sub_entry);
<a name="l02598"></a>02598 
<a name="l02599"></a>02599           <span class="comment">/* Update min_time (if necessary) */</span>
<a name="l02600"></a>02600           <span class="keywordflow">if</span> ((index == 0) || (sub_min_time &lt; min_time))
<a name="l02601"></a>02601             min_time = sub_min_time;
<a name="l02602"></a>02602         }
<a name="l02603"></a>02603 
<a name="l02604"></a>02604       <span class="comment">/* Return the minimum usage time found */</span>
<a name="l02605"></a>02605       <span class="keywordflow">return</span> (min_time);
<a name="l02606"></a>02606     }
<a name="l02607"></a>02607 
<a name="l02608"></a>02608   <span class="comment">/* Entry1 better be a Resource Usage entry if we got here */</span>
<a name="l02609"></a>02609   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) != 0)
<a name="l02610"></a>02610     {
<a name="l02611"></a>02611       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;md,
<a name="l02612"></a>02612               <span class="stringliteral">"CU_get_min_time:\n  Expecting Resource_Usage entry "</span>
<a name="l02613"></a>02613               <span class="stringliteral">"not '%s-&gt;%s'"</span>,
<a name="l02614"></a>02614               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name);
<a name="l02615"></a>02615 
<a name="l02616"></a>02616       <span class="comment">/* To make lint happy */</span>
<a name="l02617"></a>02617       <span class="keywordflow">return</span> (-1);
<a name="l02618"></a>02618     }
<a name="l02619"></a>02619 
<a name="l02620"></a>02620   <span class="comment">/* At this point, entry is a resource usage.  Get minimum usage time */</span>
<a name="l02621"></a>02621   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"time"</span>);
<a name="l02622"></a>02622   <span class="keywordflow">for</span> (index = 0; index &lt;= time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l02623"></a>02623     {
<a name="l02624"></a>02624       time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, index);
<a name="l02625"></a>02625 
<a name="l02626"></a>02626       <span class="keywordflow">if</span> ((index == 0) || (time &lt; min_time))
<a name="l02627"></a>02627         min_time = time;
<a name="l02628"></a>02628     }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630   <span class="comment">/* Return the minimum usage time found */</span>
<a name="l02631"></a>02631   <span class="keywordflow">return</span> (min_time);
<a name="l02632"></a>02632 }
<a name="l02633"></a>02633 
<a name="l02634"></a>02634 <span class="comment">/* Determines if two entries (Table_Option, Resource_Unit, or Resource_Usage) </span>
<a name="l02635"></a>02635 <span class="comment"> * have an overlapping resource usage (could use a resource at the same time).</span>
<a name="l02636"></a>02636 <span class="comment"> * Returns 1 if so, 0 otherwise</span>
<a name="l02637"></a>02637 <span class="comment"> */</span>
<a name="l02638"></a>02638 <span class="keywordtype">int</span>
<a name="l02639"></a><a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">02639</a> <a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry1, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry2)
<a name="l02640"></a>02640 {
<a name="l02641"></a>02641   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field1, *use_field1, *use_field2;
<a name="l02642"></a>02642   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *time_field1, *time_field2;
<a name="l02643"></a>02643   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *sub_entry, *resource_entry1, *resource_entry2;
<a name="l02644"></a>02644   <span class="keywordtype">int</span> index1, index2, time1, time2;
<a name="l02645"></a>02645   <span class="keywordtype">int</span> resource_overlaps;
<a name="l02646"></a>02646 
<a name="l02647"></a>02647   <span class="comment">/* Recurse until both entry1 and entry2 are Resource_Usage entries</span>
<a name="l02648"></a>02648 <span class="comment">   * Recurse on entry1 first, then when it is reduced, reduce </span>
<a name="l02649"></a>02649 <span class="comment">   * entry2 by swapping places with entry1 and recursing.</span>
<a name="l02650"></a>02650 <span class="comment">   */</span>
<a name="l02651"></a>02651   <span class="comment">/* Handle if entry1 is a Table_Option */</span>
<a name="l02652"></a>02652   <span class="keywordflow">if</span> (strcmp (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l02653"></a>02653     {
<a name="l02654"></a>02654       <span class="comment">/* Overlaps if any option overlaps */</span>
<a name="l02655"></a>02655       one_of_field1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"one_of"</span>);
<a name="l02656"></a>02656       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l02657"></a>02657         {
<a name="l02658"></a>02658           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field1, index1);
<a name="l02659"></a>02659           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (sub_entry, entry2))
<a name="l02660"></a>02660             <span class="keywordflow">return</span> (1);
<a name="l02661"></a>02661         }
<a name="l02662"></a>02662       <span class="comment">/* If got here, none of the options overlap */</span>
<a name="l02663"></a>02663       <span class="keywordflow">return</span> (0);
<a name="l02664"></a>02664     }
<a name="l02665"></a>02665 
<a name="l02666"></a>02666   <span class="comment">/* Handle if entry1 is a Resource_Unit */</span>
<a name="l02667"></a>02667   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l02668"></a>02668     {
<a name="l02669"></a>02669       <span class="comment">/* Overlaps if any resource usage overlaps */</span>
<a name="l02670"></a>02670       use_field1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"use"</span>);
<a name="l02671"></a>02671       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l02672"></a>02672         {
<a name="l02673"></a>02673           sub_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field1, index1);
<a name="l02674"></a>02674           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (sub_entry, entry2))
<a name="l02675"></a>02675             <span class="keywordflow">return</span> (1);
<a name="l02676"></a>02676         }
<a name="l02677"></a>02677       <span class="comment">/* If got here, none of the resource usages overlap */</span>
<a name="l02678"></a>02678       <span class="keywordflow">return</span> (0);
<a name="l02679"></a>02679     }
<a name="l02680"></a>02680 
<a name="l02681"></a>02681   <span class="comment">/* Entry1 better be a Resource Usage entry if we got here */</span>
<a name="l02682"></a>02682   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry1-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) != 0)
<a name="l02683"></a>02683     {
<a name="l02684"></a>02684       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry1-&gt;section-&gt;md,
<a name="l02685"></a>02685               <span class="stringliteral">"CU_overlapping_resource_usage:\n  Expecting Resource_Usage "</span>
<a name="l02686"></a>02686               <span class="stringliteral">"entry not '%s-&gt;%s'"</span>,
<a name="l02687"></a>02687               entry1-&gt;section-&gt;name, entry1-&gt;name);
<a name="l02688"></a>02688 
<a name="l02689"></a>02689       <span class="comment">/* To make lint happy */</span>
<a name="l02690"></a>02690       return (-1);
<a name="l02691"></a>02691     }
<a name="l02692"></a>02692 
<a name="l02693"></a>02693   <span class="comment">/* If Entry2 not a Resource Usage, swap entry1 and entry2 and recurse */</span>
<a name="l02694"></a>02694   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry2-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) != 0)
<a name="l02695"></a>02695     {
<a name="l02696"></a>02696       return (<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (entry2, entry1));
<a name="l02697"></a>02697     }
<a name="l02698"></a>02698 
<a name="l02699"></a>02699   <span class="comment">/* At this point, both entry1 and entry2 are resource usages</span>
<a name="l02700"></a>02700 <span class="comment">   * Compare the resource used and the time for overlap </span>
<a name="l02701"></a>02701 <span class="comment">   */</span>
<a name="l02702"></a>02702   use_field1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"use"</span>);
<a name="l02703"></a>02703   use_field2 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry2, <span class="stringliteral">"use"</span>);
<a name="l02704"></a>02704 
<a name="l02705"></a>02705   <span class="comment">/* Determine if at least one of the resources overlap */</span>
<a name="l02706"></a>02706   resource_overlaps = 0;
<a name="l02707"></a>02707   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field1-&gt;max_element_index; index1++)
<a name="l02708"></a>02708     {
<a name="l02709"></a>02709       resource_entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field1, index1);
<a name="l02710"></a>02710       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= use_field2-&gt;max_element_index; index2++)
<a name="l02711"></a>02711         {
<a name="l02712"></a>02712           resource_entry2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field2, index2);
<a name="l02713"></a>02713 
<a name="l02714"></a>02714           <span class="keywordflow">if</span> (resource_entry1 == resource_entry2)
<a name="l02715"></a>02715             {
<a name="l02716"></a>02716               <span class="comment">/* Flag that overlap detected */</span>
<a name="l02717"></a>02717               resource_overlaps = 1;
<a name="l02718"></a>02718 
<a name="l02719"></a>02719 <span class="preprocessor">#if 0</span>
<a name="l02720"></a>02720 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l02721"></a>02721               printf (<span class="stringliteral">"%s-&gt;use[%i] overlaps %s-&gt;use[%i] for %s\n"</span>,
<a name="l02722"></a>02722                       entry1-&gt;name, index1, entry2-&gt;name, index2,
<a name="l02723"></a>02723                       resource_entry1-&gt;name);
<a name="l02724"></a>02724 <span class="preprocessor">#endif</span>
<a name="l02725"></a>02725 <span class="preprocessor"></span>
<a name="l02726"></a>02726               <span class="comment">/* Break out of loop */</span>
<a name="l02727"></a>02727               index1 = use_field1-&gt;max_element_index + 1;
<a name="l02728"></a>02728               <span class="keywordflow">break</span>;
<a name="l02729"></a>02729             }
<a name="l02730"></a>02730         }
<a name="l02731"></a>02731     }
<a name="l02732"></a>02732   <span class="comment">/* They don't overlap if they don't use the same resource */</span>
<a name="l02733"></a>02733   <span class="keywordflow">if</span> (!resource_overlaps)
<a name="l02734"></a>02734     <span class="keywordflow">return</span> (0);
<a name="l02735"></a>02735 
<a name="l02736"></a>02736   time_field1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"time"</span>);
<a name="l02737"></a>02737   time_field2 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry2, <span class="stringliteral">"time"</span>);
<a name="l02738"></a>02738 
<a name="l02739"></a>02739   <span class="comment">/* They overlap if they have a common usage time */</span>
<a name="l02740"></a>02740   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= time_field1-&gt;max_element_index; index1++)
<a name="l02741"></a>02741     {
<a name="l02742"></a>02742       time1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field1, index1);
<a name="l02743"></a>02743       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= time_field2-&gt;max_element_index; index2++)
<a name="l02744"></a>02744         {
<a name="l02745"></a>02745           time2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field2, index2);
<a name="l02746"></a>02746 
<a name="l02747"></a>02747           <span class="keywordflow">if</span> (time1 == time2)
<a name="l02748"></a>02748             {
<a name="l02749"></a>02749 #<span class="keywordflow">if</span> 0
<a name="l02750"></a>02750               <span class="comment">/* Debug */</span>
<a name="l02751"></a>02751               printf (<span class="stringliteral">"%s overlaps %s at time %i\n"</span>,
<a name="l02752"></a>02752                       entry1-&gt;name, entry2-&gt;name, time1);
<a name="l02753"></a>02753 #endif
<a name="l02754"></a>02754               return (1);
<a name="l02755"></a>02755             }
<a name="l02756"></a>02756         }
<a name="l02757"></a>02757     }
<a name="l02758"></a>02758 
<a name="l02759"></a>02759   <span class="comment">/* If we got here, they don't overlap */</span>
<a name="l02760"></a>02760   <span class="keywordflow">return</span> (0);
<a name="l02761"></a>02761 }
<a name="l02762"></a>02762 
<a name="l02763"></a>02763 <span class="keywordtype">int</span>
<a name="l02764"></a><a class="code" href="lmdes2__customizer_8c.html#5b210418b87ea11a38a9685106fcadb0">02764</a> <a class="code" href="lmdes2__customizer_8c.html#5b210418b87ea11a38a9685106fcadb0">CU_make_res_table_orthogonal</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * res_table)
<a name="l02765"></a>02765 {
<a name="l02766"></a>02766   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field, *new_use_field, *one_of_field;
<a name="l02767"></a>02767   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *entry1, *entry2, *new_res_table, *target_entry, *last_table;
<a name="l02768"></a>02768   <span class="keywordtype">int</span> index1, index2, i, num_added;
<a name="l02769"></a>02769 
<a name="l02770"></a>02770   <span class="comment">/* Initially, no entries have been added */</span>
<a name="l02771"></a>02771   num_added = 0;
<a name="l02772"></a>02772 
<a name="l02773"></a>02773   <span class="comment">/* Make sure we are passed a Reservation_Table entry */</span>
<a name="l02774"></a>02774   <span class="keywordflow">if</span> (strcmp (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Reservation_Table"</span>) != 0)
<a name="l02775"></a>02775     {
<a name="l02776"></a>02776       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02777"></a>02777               <span class="stringliteral">"CU_make_res_table_orthogonal: res table expected not '%s-&gt;%s'!"</span>,
<a name="l02778"></a>02778               res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02779"></a>02779     }
<a name="l02780"></a>02780 
<a name="l02781"></a>02781   <span class="comment">/* Search use field for overlapping resource usages */</span>
<a name="l02782"></a>02782   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (res_table, <span class="stringliteral">"use"</span>);
<a name="l02783"></a>02783 
<a name="l02784"></a>02784   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l02785"></a>02785     {
<a name="l02786"></a>02786       entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l02787"></a>02787 
<a name="l02788"></a>02788       <span class="keywordflow">for</span> (index2 = index1 + 1; index2 &lt;= use_field-&gt;max_element_index;
<a name="l02789"></a>02789            index2++)
<a name="l02790"></a>02790         {
<a name="l02791"></a>02791           entry2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l02792"></a>02792 
<a name="l02793"></a>02793           <span class="comment">/* Only process entries that overlap */</span>
<a name="l02794"></a>02794           <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (entry1, entry2))
<a name="l02795"></a>02795             <span class="keywordflow">continue</span>;
<a name="l02796"></a>02796 
<a name="l02797"></a>02797 <span class="preprocessor">#if 0</span>
<a name="l02798"></a>02798 <span class="preprocessor"></span>          <span class="comment">/* Debug */</span>
<a name="l02799"></a>02799           printf
<a name="l02800"></a>02800             (<span class="stringliteral">"%s-&gt;%s needs expansion:\n  %i:%s-&gt;%s overlaps\n   %i:%s-&gt;%s\n\n"</span>,
<a name="l02801"></a>02801              res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index1,
<a name="l02802"></a>02802              entry1-&gt;section-&gt;name, entry1-&gt;name, index2,
<a name="l02803"></a>02803              entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02804"></a>02804 <span class="preprocessor">#endif</span>
<a name="l02805"></a>02805 <span class="preprocessor"></span>
<a name="l02806"></a>02806           <span class="comment">/* If entry1 is a table option, break up into reservation</span>
<a name="l02807"></a>02807 <span class="comment">           * tables, one for each option, and recurse</span>
<a name="l02808"></a>02808 <span class="comment">           */</span>
<a name="l02809"></a>02809           <span class="keywordflow">if</span> (strcmp (entry1-&gt;section-&gt;name, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l02810"></a>02810             {
<a name="l02811"></a>02811               <span class="comment">/* Set to NULL so we don't use without initializing */</span>
<a name="l02812"></a>02812               last_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02813"></a>02813 
<a name="l02814"></a>02814               <span class="comment">/* Get the one_of_field */</span>
<a name="l02815"></a>02815               one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"one_of"</span>);
<a name="l02816"></a>02816 
<a name="l02817"></a>02817               <span class="comment">/* Create a new res_table for each entry in the one_of</span>
<a name="l02818"></a>02818 <span class="comment">               * field, recurse and process these res_tables</span>
<a name="l02819"></a>02819 <span class="comment">               */</span>
<a name="l02820"></a>02820               <span class="keywordflow">for</span> (i = 0; i &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i++)
<a name="l02821"></a>02821                 {
<a name="l02822"></a>02822                   <span class="comment">/* Get the target of this option */</span>
<a name="l02823"></a>02823                   target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, i);
<a name="l02824"></a>02824 
<a name="l02825"></a>02825                   <span class="comment">/* Use this res_table for the first option and </span>
<a name="l02826"></a>02826 <span class="comment">                   * create a new res tables for the rest</span>
<a name="l02827"></a>02827 <span class="comment">                   */</span>
<a name="l02828"></a>02828                   <span class="keywordflow">if</span> (i == 0)
<a name="l02829"></a>02829                     {
<a name="l02830"></a>02830                       <span class="comment">/* Make this res table reflect the choice of the</span>
<a name="l02831"></a>02831 <span class="comment">                       * first option.</span>
<a name="l02832"></a>02832 <span class="comment">                       */</span>
<a name="l02833"></a>02833                       new_res_table = res_table;
<a name="l02834"></a>02834 
<a name="l02835"></a>02835                       <span class="comment">/* This option is now entry1 */</span>
<a name="l02836"></a>02836                       entry1 = target_entry;
<a name="l02837"></a>02837 
<a name="l02838"></a>02838                       <span class="comment">/* Rename (add ~#) to show customizer has modified */</span>
<a name="l02839"></a>02839                       <a class="code" href="lmdes2__customizer_8c.html#1a485003e9cc947cf64e3769e68af28e">CU_rename_entry</a> (res_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02840"></a>02840                     }
<a name="l02841"></a>02841                   <span class="keywordflow">else</span>
<a name="l02842"></a>02842                     {
<a name="l02843"></a>02843                       <span class="comment">/* Duplicate the last res table processed so that</span>
<a name="l02844"></a>02844 <span class="comment">                       * it will be placed after it in the alt() field.</span>
<a name="l02845"></a>02845 <span class="comment">                       * Required to keep proper ordering!</span>
<a name="l02846"></a>02846 <span class="comment">                       */</span>
<a name="l02847"></a>02847                       new_res_table = <a class="code" href="lmdes2__customizer_8c.html#ba4d5d0af6041b1626b8cd7186b2e73f">CU_dup_res_table</a> (last_table);
<a name="l02848"></a>02848                       num_added++;
<a name="l02849"></a>02849                     }
<a name="l02850"></a>02850 
<a name="l02851"></a>02851                   <span class="comment">/* Set last table for next iteration */</span>
<a name="l02852"></a>02852                   last_table = new_res_table;
<a name="l02853"></a>02853 
<a name="l02854"></a>02854                   <span class="comment">/* Get the use field for the new res table */</span>
<a name="l02855"></a>02855                   new_use_field =
<a name="l02856"></a>02856                     <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_res_table, <span class="stringliteral">"use"</span>);
<a name="l02857"></a>02857 
<a name="l02858"></a>02858                   <span class="comment">/* Change the option to the suboption in this use */</span>
<a name="l02859"></a>02859                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (new_use_field, index1, target_entry);
<a name="l02860"></a>02860 
<a name="l02861"></a>02861                   <span class="comment">/* Do not recurse here on the new entries created!!!</span>
<a name="l02862"></a>02862 <span class="comment">                   * We are copying res_table (which we modifiy slightly </span>
<a name="l02863"></a>02863 <span class="comment">                   * for i==0), and recursing destroys necessary info</span>
<a name="l02864"></a>02864 <span class="comment">                   * before we have made the other copys! -JCG</span>
<a name="l02865"></a>02865 <span class="comment">                   */</span>
<a name="l02866"></a>02866                 }
<a name="l02867"></a>02867 
<a name="l02868"></a>02868               <span class="comment">/* Recurse on this modified res_table to handle stripping</span>
<a name="l02869"></a>02869 <span class="comment">               * out the conflicting uses below and to handle any</span>
<a name="l02870"></a>02870 <span class="comment">               * other new res tables that need to be created.</span>
<a name="l02871"></a>02871 <span class="comment">               *</span>
<a name="l02872"></a>02872 <span class="comment">               * Need to externally call this function for the entries</span>
<a name="l02873"></a>02873 <span class="comment">               * created, since they are probably not orthoginal.</span>
<a name="l02874"></a>02874 <span class="comment">               */</span>
<a name="l02875"></a>02875               num_added += <a class="code" href="lmdes2__customizer_8c.html#5b210418b87ea11a38a9685106fcadb0">CU_make_res_table_orthogonal</a> (res_table);
<a name="l02876"></a>02876               <span class="keywordflow">return</span> (num_added);
<a name="l02877"></a>02877             }
<a name="l02878"></a>02878 
<a name="l02879"></a>02879           <span class="comment">/* entry1 resources are always used (not a table option),</span>
<a name="l02880"></a>02880 <span class="comment">           * remove the table options from entry2 that conflict with </span>
<a name="l02881"></a>02881 <span class="comment">           * entry1</span>
<a name="l02882"></a>02882 <span class="comment">           */</span>
<a name="l02883"></a>02883           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l02884"></a>02884             {
<a name="l02885"></a>02885               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_option;
<a name="l02886"></a>02886 
<a name="l02887"></a>02887               <span class="comment">/* Create a new option entry that we can modify */</span>
<a name="l02888"></a>02888               new_option = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (entry2);
<a name="l02889"></a>02889 
<a name="l02890"></a>02890               <span class="comment">/* Get the one_of_field */</span>
<a name="l02891"></a>02891               one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_option, <span class="stringliteral">"one_of"</span>);
<a name="l02892"></a>02892 
<a name="l02893"></a>02893               <span class="comment">/* Delete the options that conflict (overlap) with entry1.</span>
<a name="l02894"></a>02894 <span class="comment">               * Scan backwards since we are deleting entries.</span>
<a name="l02895"></a>02895 <span class="comment">               */</span>
<a name="l02896"></a>02896               <span class="keywordflow">for</span> (i = one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i &gt;= 0; i--)
<a name="l02897"></a>02897                 {
<a name="l02898"></a>02898                   <span class="comment">/* Get the target of this option */</span>
<a name="l02899"></a>02899                   target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, i);
<a name="l02900"></a>02900 
<a name="l02901"></a>02901                   <span class="comment">/* Delete it if it conflicts (overlaps) with entry1 */</span>
<a name="l02902"></a>02902                   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (entry1, target_entry))
<a name="l02903"></a>02903                     {
<a name="l02904"></a>02904                       <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (one_of_field, i);
<a name="l02905"></a>02905                     }
<a name="l02906"></a>02906                 }
<a name="l02907"></a>02907 
<a name="l02908"></a>02908               <span class="comment">/* If we end up with an empty option, they have written</span>
<a name="l02909"></a>02909 <span class="comment">               * their mdes strangely so that depending on the options</span>
<a name="l02910"></a>02910 <span class="comment">               * picked early, it is not possible to schedule the operation!</span>
<a name="l02911"></a>02911 <span class="comment">               */</span>
<a name="l02912"></a>02912               <span class="keywordflow">if</span> (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &lt; 0)
<a name="l02913"></a>02913                 {
<a name="l02914"></a>02914                   fprintf (stderr,
<a name="l02915"></a>02915                            <span class="stringliteral">"Error:  %s-&gt;%s is not possible to schedule!\n"</span>
<a name="l02916"></a>02916                            <span class="stringliteral">"After expansion, it has the following form:\n\n"</span>,
<a name="l02917"></a>02917                            res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02918"></a>02918 
<a name="l02919"></a>02919                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#abcdd59628e0ae0a22502255751bdc72">MD_print_entry</a> (stderr, res_table, 80);
<a name="l02920"></a>02920 
<a name="l02921"></a>02921                   fprintf (stderr,
<a name="l02922"></a>02922                            <span class="stringliteral">"\n%s-&gt;use[%i] (%s) cannot be satisified:\n\n"</span>,
<a name="l02923"></a>02923                            res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index2, entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02924"></a>02924 
<a name="l02925"></a>02925                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#abcdd59628e0ae0a22502255751bdc72">MD_print_entry</a> (stderr, entry2, 80);
<a name="l02926"></a>02926 
<a name="l02927"></a>02927                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02928"></a>02928                           <span class="stringliteral">"Please rewrite this reservation table "</span>
<a name="l02929"></a>02929                           <span class="stringliteral">"(or the table this entry\nwas derived from) "</span>
<a name="l02930"></a>02930                           <span class="stringliteral">"so that it is possible to schedule!\n"</span>);
<a name="l02931"></a>02931                 }
<a name="l02932"></a>02932 
<a name="l02933"></a>02933               <span class="comment">/* Place the new set of options at index2,</span>
<a name="l02934"></a>02934 <span class="comment">               * If only one option is left, then just place that</span>
<a name="l02935"></a>02935 <span class="comment">               * option at index2</span>
<a name="l02936"></a>02936 <span class="comment">               */</span>
<a name="l02937"></a>02937               <span class="keywordflow">if</span> (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l02938"></a>02938                 {
<a name="l02939"></a>02939                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, index2, new_option);
<a name="l02940"></a>02940                 }
<a name="l02941"></a>02941               <span class="keywordflow">else</span>
<a name="l02942"></a>02942                 {
<a name="l02943"></a>02943                   <span class="comment">/* Get the single target of this option */</span>
<a name="l02944"></a>02944                   target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, 0);
<a name="l02945"></a>02945                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, index2, target_entry);
<a name="l02946"></a>02946 
<a name="l02947"></a>02947                   <span class="comment">/* Don't need the new option now */</span>
<a name="l02948"></a>02948                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (new_option);
<a name="l02949"></a>02949                 }
<a name="l02950"></a>02950             }
<a name="l02951"></a>02951 
<a name="l02952"></a>02952           <span class="comment">/* If entry2 is not a table option, then the scheduler</span>
<a name="l02953"></a>02953 <span class="comment">           * will never be able to schedule this reservation table!</span>
<a name="l02954"></a>02954 <span class="comment">           */</span>
<a name="l02955"></a>02955           <span class="keywordflow">else</span>
<a name="l02956"></a>02956             {
<a name="l02957"></a>02957               fprintf (stderr,
<a name="l02958"></a>02958                        <span class="stringliteral">"Error:  %s-&gt;%s is not possible to schedule!\n"</span>
<a name="l02959"></a>02959                        <span class="stringliteral">"After expansion, it has the following form:\n\n"</span>,
<a name="l02960"></a>02960                        res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02961"></a>02961 
<a name="l02962"></a>02962               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#abcdd59628e0ae0a22502255751bdc72">MD_print_entry</a> (stderr, res_table, 80);
<a name="l02963"></a>02963 
<a name="l02964"></a>02964               fprintf (stderr,
<a name="l02965"></a>02965                        <span class="stringliteral">"\n%s-&gt;use[%i] (%s) cannot be satisified:\n\n"</span>,
<a name="l02966"></a>02966                        res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index2, entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l02967"></a>02967 
<a name="l02968"></a>02968               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#abcdd59628e0ae0a22502255751bdc72">MD_print_entry</a> (stderr, entry2, 80);
<a name="l02969"></a>02969 
<a name="l02970"></a>02970               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l02971"></a>02971                       <span class="stringliteral">"Please rewrite this reservation table "</span>
<a name="l02972"></a>02972                       <span class="stringliteral">"(or the table this entry\nwas derived from) "</span>
<a name="l02973"></a>02973                       <span class="stringliteral">"so that it is possible to schedule!\n"</span>);
<a name="l02974"></a>02974             }
<a name="l02975"></a>02975         }
<a name="l02976"></a>02976     }
<a name="l02977"></a>02977 
<a name="l02978"></a>02978   <span class="comment">/* If got here, no entries were added becuase of this call */</span>
<a name="l02979"></a>02979   <span class="keywordflow">return</span> (0);
<a name="l02980"></a>02980 }
<a name="l02981"></a>02981 
<a name="l02982"></a>02982 <span class="comment">/* Groups all resource usages that are not part of a table option</span>
<a name="l02983"></a>02983 <span class="comment"> * into one consolidated unit (for better scheduling efficiency).</span>
<a name="l02984"></a>02984 <span class="comment"> * Will convert table options with just one option into an unconditional</span>
<a name="l02985"></a>02985 <span class="comment"> * resource usage.</span>
<a name="l02986"></a>02986 <span class="comment"> * Will reorder/add/remove links in res_table-&gt;use().  </span>
<a name="l02987"></a>02987 <span class="comment"> * Need to run after CU_make_res_table_orthoginal</span>
<a name="l02988"></a>02988 <span class="comment"> * and before specifying which choice specifies the slot!</span>
<a name="l02989"></a>02989 <span class="comment"> */</span>
<a name="l02990"></a>02990 <span class="keywordtype">void</span>
<a name="l02991"></a><a class="code" href="lmdes2__customizer_8c.html#0ef75bfb7f290b6513271853e6fd74fc">02991</a> <a class="code" href="lmdes2__customizer_8c.html#0ef75bfb7f290b6513271853e6fd74fc">CU_consolidate_res_table_usages</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * res_table)
<a name="l02992"></a>02992 {
<a name="l02993"></a>02993   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_unit_section;
<a name="l02994"></a>02994   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *rt_use_field, *new_use_field, *old_use_field, *one_of_field;
<a name="l02995"></a>02995   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *use_field_decl;
<a name="l02996"></a>02996   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *entry1, *new_unit, *target_entry;
<a name="l02997"></a>02997   <span class="keywordtype">int</span> index1, index2, unit_count, ru_count, consolidated_index;
<a name="l02998"></a>02998   <span class="keywordtype">char</span> base_name[5000], unit_name[5000];
<a name="l02999"></a>02999 
<a name="l03000"></a>03000   <span class="comment">/* Make sure we are passed a Reservation_Table entry */</span>
<a name="l03001"></a>03001   <span class="keywordflow">if</span> (strcmp (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Reservation_Table"</span>) != 0)
<a name="l03002"></a>03002     {
<a name="l03003"></a>03003       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l03004"></a>03004               <span class="stringliteral">"CU_consolidate_res_table_usages: res table expected "</span>
<a name="l03005"></a>03005               <span class="stringliteral">"not '%s-&gt;%s'!"</span>,
<a name="l03006"></a>03006               res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03007"></a>03007     }
<a name="l03008"></a>03008 
<a name="l03009"></a>03009   <span class="comment">/* Search multiple unconditional use field to consolidate.</span>
<a name="l03010"></a>03010 <span class="comment">   * Convert any one option table option's to an unconditional usage</span>
<a name="l03011"></a>03011 <span class="comment">   */</span>
<a name="l03012"></a>03012   unit_count = 0;
<a name="l03013"></a>03013   ru_count = 0;
<a name="l03014"></a>03014   rt_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (res_table, <span class="stringliteral">"use"</span>);
<a name="l03015"></a>03015   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= rt_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03016"></a>03016     {
<a name="l03017"></a>03017       <span class="comment">/* Get the table option or unconditional usage */</span>
<a name="l03018"></a>03018       entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (rt_use_field, index1);
<a name="l03019"></a>03019 
<a name="l03020"></a>03020       <span class="comment">/* If it is a table option and has only one option, convert */</span>
<a name="l03021"></a>03021       <span class="keywordflow">if</span> (strcmp (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l03022"></a>03022         {
<a name="l03023"></a>03023           <span class="comment">/* Get the one_of_field */</span>
<a name="l03024"></a>03024           one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"one_of"</span>);
<a name="l03025"></a>03025 
<a name="l03026"></a>03026           <span class="comment">/* Convert to unconditional usage if has only one option */</span>
<a name="l03027"></a>03027           <span class="keywordflow">if</span> (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> == 0)
<a name="l03028"></a>03028             {
<a name="l03029"></a>03029               target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, 0);
<a name="l03030"></a>03030               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (rt_use_field, index1, target_entry);
<a name="l03031"></a>03031 
<a name="l03032"></a>03032 <span class="preprocessor">#if 0</span>
<a name="l03033"></a>03033 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l03034"></a>03034               printf (<span class="stringliteral">"%s-&gt;use[%i] changed to %s\n"</span>, res_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l03035"></a>03035                       index1, target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03036"></a>03036 <span class="preprocessor">#endif</span>
<a name="l03037"></a>03037 <span class="preprocessor"></span>
<a name="l03038"></a>03038               <span class="comment">/* Counts as an unconditional usage */</span>
<a name="l03039"></a>03039               <span class="keywordflow">if</span> (strcmp (target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l03040"></a>03040                 unit_count++;
<a name="l03041"></a>03041               <span class="keywordflow">else</span>
<a name="l03042"></a>03042                 ru_count++;
<a name="l03043"></a>03043             }
<a name="l03044"></a>03044         }
<a name="l03045"></a>03045       <span class="comment">/* Otherwise it is an unconditional usage */</span>
<a name="l03046"></a>03046       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry1-&gt;section-&gt;name, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l03047"></a>03047         unit_count++;
<a name="l03048"></a>03048       <span class="keywordflow">else</span>
<a name="l03049"></a>03049         ru_count++;
<a name="l03050"></a>03050 
<a name="l03051"></a>03051     }
<a name="l03052"></a>03052 
<a name="l03053"></a>03053   <span class="comment">/* Consolidate if have one or more resource usages or </span>
<a name="l03054"></a>03054 <span class="comment">   * more than one unit or resource usages</span>
<a name="l03055"></a>03055 <span class="comment">   */</span>
<a name="l03056"></a>03056   <span class="keywordflow">if</span> ((ru_count &gt;= 1) || ((ru_count + unit_count) &gt;= 2))
<a name="l03057"></a>03057     {
<a name="l03058"></a>03058       resource_unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (res_table-&gt;section-&gt;md,
<a name="l03059"></a>03059                                                <span class="stringliteral">"Resource_Unit"</span>);
<a name="l03060"></a>03060 
<a name="l03061"></a>03061       sprintf (base_name, <span class="stringliteral">"U_%s"</span>, res_table-&gt;name);
<a name="l03062"></a>03062       <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (res_table-&gt;section-&gt;md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, base_name, unit_name);
<a name="l03063"></a>03063 
<a name="l03064"></a>03064       new_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (resource_unit_section, unit_name);
<a name="l03065"></a>03065 
<a name="l03066"></a>03066 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03067"></a>03067 <span class="preprocessor"></span>      <span class="comment">/* Debug */</span>
<a name="l03068"></a>03068       printf (<span class="stringliteral">"Consolidating %s (%i rus %i units) into %s.\n"</span>,
<a name="l03069"></a>03069               res_table-&gt;name, ru_count, unit_count, unit_name);
<a name="l03070"></a>03070 <span class="preprocessor">#endif</span>
<a name="l03071"></a>03071 <span class="preprocessor"></span>
<a name="l03072"></a>03072       use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (new_unit-&gt;section, <span class="stringliteral">"use"</span>);
<a name="l03073"></a>03073 
<a name="l03074"></a>03074       <span class="comment">/* Create a new use field to fill with all the resource usages */</span>
<a name="l03075"></a>03075       new_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_unit, use_field_decl, 0);
<a name="l03076"></a>03076 
<a name="l03077"></a>03077       <span class="comment">/* Get the earliest index of the use we are replacing, so we</span>
<a name="l03078"></a>03078 <span class="comment">       * can place the consolidated unit in the use list there.</span>
<a name="l03079"></a>03079 <span class="comment">       */</span>
<a name="l03080"></a>03080       consolidated_index = 0;
<a name="l03081"></a>03081 
<a name="l03082"></a>03082       <span class="comment">/* Scan links in reverse order since we will be deleting as we go */</span>
<a name="l03083"></a>03083       <span class="keywordflow">for</span> (index1 = rt_use_field-&gt;max_element_index; index1 &gt;= 0; index1--)
<a name="l03084"></a>03084         {
<a name="l03085"></a>03085           <span class="comment">/* Get the table option or unconditional usage */</span>
<a name="l03086"></a>03086           entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (rt_use_field, index1);
<a name="l03087"></a>03087 
<a name="l03088"></a>03088           <span class="keywordflow">if</span> (strcmp (entry1-&gt;section-&gt;name, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l03089"></a>03089             {
<a name="l03090"></a>03090               <span class="comment">/* Put all the resource usages in the resource unit</span>
<a name="l03091"></a>03091 <span class="comment">               * into the new unit.</span>
<a name="l03092"></a>03092 <span class="comment">               */</span>
<a name="l03093"></a>03093               old_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (entry1, <span class="stringliteral">"use"</span>);
<a name="l03094"></a>03094 
<a name="l03095"></a>03095               <span class="comment">/* Go in reverse order so added in the proper order to</span>
<a name="l03096"></a>03096 <span class="comment">               * the new_use_field</span>
<a name="l03097"></a>03097 <span class="comment">               */</span>
<a name="l03098"></a>03098               <span class="keywordflow">for</span> (index2 = old_use_field-&gt;max_element_index; index2 &gt;= 0;
<a name="l03099"></a>03099                    index2--)
<a name="l03100"></a>03100                 {
<a name="l03101"></a>03101                   target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (old_use_field, index2);
<a name="l03102"></a>03102 
<a name="l03103"></a>03103                   <span class="comment">/* Add resource unit directly to new use field */</span>
<a name="l03104"></a>03104                   <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (new_use_field, 0, target_entry);
<a name="l03105"></a>03105                 }
<a name="l03106"></a>03106 
<a name="l03107"></a>03107               <span class="comment">/* Delete the link be just pulled into the new_use field */</span>
<a name="l03108"></a>03108               <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (rt_use_field, index1);
<a name="l03109"></a>03109 
<a name="l03110"></a>03110               <span class="comment">/* Will place consolidated unit at the earilest index</span>
<a name="l03111"></a>03111 <span class="comment">               * of a use we have consolidated.</span>
<a name="l03112"></a>03112 <span class="comment">               */</span>
<a name="l03113"></a>03113               consolidated_index = index1;
<a name="l03114"></a>03114             }
<a name="l03115"></a>03115           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (entry1-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) == 0)
<a name="l03116"></a>03116             {
<a name="l03117"></a>03117               <span class="comment">/* Add resource unit directly to front of use list</span>
<a name="l03118"></a>03118 <span class="comment">               * (since scanning in reverse order, will end up in </span>
<a name="l03119"></a>03119 <span class="comment">               *  proper order)</span>
<a name="l03120"></a>03120 <span class="comment">               */</span>
<a name="l03121"></a>03121               <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (new_use_field, 0, entry1);
<a name="l03122"></a>03122 
<a name="l03123"></a>03123               <span class="comment">/* Delete the link be just pulled into the new_use field */</span>
<a name="l03124"></a>03124               <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (rt_use_field, index1);
<a name="l03125"></a>03125 
<a name="l03126"></a>03126               <span class="comment">/* Will place consolidated unit at the earilest index</span>
<a name="l03127"></a>03127 <span class="comment">               * of a use we have consolidated.</span>
<a name="l03128"></a>03128 <span class="comment">               */</span>
<a name="l03129"></a>03129               consolidated_index = index1;
<a name="l03130"></a>03130             }
<a name="l03131"></a>03131         }
<a name="l03132"></a>03132 
<a name="l03133"></a>03133       <span class="comment">/* Add new until to rt_use_field to replace all the indivual</span>
<a name="l03134"></a>03134 <span class="comment">       * resource usages and resource units.</span>
<a name="l03135"></a>03135 <span class="comment">       * Will place at index of earilest use that was consolidated.</span>
<a name="l03136"></a>03136 <span class="comment">       */</span>
<a name="l03137"></a>03137       <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (rt_use_field, consolidated_index, new_unit);
<a name="l03138"></a>03138     }
<a name="l03139"></a>03139 }
<a name="l03140"></a>03140 
<a name="l03141"></a>03141 <span class="keywordtype">int</span>
<a name="l03142"></a><a class="code" href="lmdes2__customizer_8c.html#aa03acc0339bfa5eb1dfac59e896fe1a">03142</a> <a class="code" href="lmdes2__customizer_8c.html#aa03acc0339bfa5eb1dfac59e896fe1a">usage_cycle_compatable</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * usage_entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry)
<a name="l03143"></a>03143 {
<a name="l03144"></a>03144   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *ru_entry;
<a name="l03145"></a>03145   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *time_field, *one_of_field, *use_field;
<a name="l03146"></a>03146   <span class="keywordtype">int</span> ru_time, usage_time, index1, index2;
<a name="l03147"></a>03147   <span class="keywordtype">int</span> found;
<a name="l03148"></a>03148 
<a name="l03149"></a>03149   <span class="comment">/* Get the time this usage uses the resource */</span>
<a name="l03150"></a>03150   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"time"</span>);
<a name="l03151"></a>03151   usage_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03152"></a>03152 
<a name="l03153"></a>03153   <span class="comment">/* Compatable if each option uses a resource at this time! */</span>
<a name="l03154"></a>03154   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l03155"></a>03155   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03156"></a>03156     {
<a name="l03157"></a>03157       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l03158"></a>03158       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03159"></a>03159 
<a name="l03160"></a>03160       <span class="comment">/* Check each use for this time, stop when find one */</span>
<a name="l03161"></a>03161       found = 0;
<a name="l03162"></a>03162       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l03163"></a>03163         {
<a name="l03164"></a>03164           ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l03165"></a>03165           time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"time"</span>);
<a name="l03166"></a>03166           ru_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03167"></a>03167 
<a name="l03168"></a>03168           <span class="keywordflow">if</span> (ru_time == usage_time)
<a name="l03169"></a>03169             {
<a name="l03170"></a>03170               found = 1;
<a name="l03171"></a>03171               <span class="keywordflow">break</span>;
<a name="l03172"></a>03172             }
<a name="l03173"></a>03173         }
<a name="l03174"></a>03174       <span class="comment">/* Return 0 if this unit does not use a resource at this time */</span>
<a name="l03175"></a>03175       <span class="keywordflow">if</span> (!found)
<a name="l03176"></a>03176         <span class="keywordflow">return</span> (0);
<a name="l03177"></a>03177     }
<a name="l03178"></a>03178 
<a name="l03179"></a>03179   <span class="comment">/* If got here, must be cycle compatable with usage */</span>
<a name="l03180"></a>03180   <span class="keywordflow">return</span> (1);
<a name="l03181"></a>03181 }
<a name="l03182"></a>03182 
<a name="l03183"></a>03183 <span class="keywordtype">int</span>
<a name="l03184"></a><a class="code" href="lmdes2__customizer_8c.html#bc7d12e76acc86904bdebd5296230f21">03184</a> <a class="code" href="lmdes2__customizer_8c.html#bc7d12e76acc86904bdebd5296230f21">usage_resource_compatable</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * usage_entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry)
<a name="l03185"></a>03185 {
<a name="l03186"></a>03186   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *ru_entry, *usage_resource, *ru_resource;
<a name="l03187"></a>03187   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *usage_use_field, *ru_use_field, *one_of_field, *unit_use_field;
<a name="l03188"></a>03188   <span class="keywordtype">int</span> index1, index2;
<a name="l03189"></a>03189   <span class="keywordtype">int</span> found;
<a name="l03190"></a>03190 
<a name="l03191"></a>03191   <span class="comment">/* Get the time this usage uses the resource */</span>
<a name="l03192"></a>03192   usage_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"use"</span>);
<a name="l03193"></a>03193   usage_resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (usage_use_field, 0);
<a name="l03194"></a>03194 
<a name="l03195"></a>03195   <span class="comment">/* Compatable if each option uses this resource at any time! */</span>
<a name="l03196"></a>03196   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l03197"></a>03197   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03198"></a>03198     {
<a name="l03199"></a>03199       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l03200"></a>03200       unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03201"></a>03201 
<a name="l03202"></a>03202       <span class="comment">/* Check each use for this time, stop when find one */</span>
<a name="l03203"></a>03203       found = 0;
<a name="l03204"></a>03204       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l03205"></a>03205         {
<a name="l03206"></a>03206           ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index2);
<a name="l03207"></a>03207           ru_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"use"</span>);
<a name="l03208"></a>03208           ru_resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (ru_use_field, 0);
<a name="l03209"></a>03209 
<a name="l03210"></a>03210           <span class="keywordflow">if</span> (ru_resource == usage_resource)
<a name="l03211"></a>03211             {
<a name="l03212"></a>03212               found = 1;
<a name="l03213"></a>03213               <span class="keywordflow">break</span>;
<a name="l03214"></a>03214             }
<a name="l03215"></a>03215         }
<a name="l03216"></a>03216       <span class="comment">/* Return 0 if this unit does not use a resource at this time */</span>
<a name="l03217"></a>03217       <span class="keywordflow">if</span> (!found)
<a name="l03218"></a>03218         <span class="keywordflow">return</span> (0);
<a name="l03219"></a>03219     }
<a name="l03220"></a>03220 
<a name="l03221"></a>03221   <span class="comment">/* If got here, must be resource compatable with usage */</span>
<a name="l03222"></a>03222   <span class="keywordflow">return</span> (1);
<a name="l03223"></a>03223 }
<a name="l03224"></a>03224 
<a name="l03225"></a>03225 <span class="keywordtype">void</span>
<a name="l03226"></a><a class="code" href="lmdes2__customizer_8c.html#ec658bc2635a4784ff353fc3cad8bb0b">03226</a> <a class="code" href="lmdes2__customizer_8c.html#ec658bc2635a4784ff353fc3cad8bb0b">distribute_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> * table_use_field, <span class="keywordtype">int</span> index,
<a name="l03227"></a>03227                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * usage_entry)
<a name="l03228"></a>03228 {
<a name="l03229"></a>03229   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *old_option_entry, *new_option_entry, *unit_entry;
<a name="l03230"></a>03230   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_unit_entry;
<a name="l03231"></a>03231   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field;
<a name="l03232"></a>03232   <span class="keywordtype">int</span> index1;
<a name="l03233"></a>03233 
<a name="l03234"></a>03234   <span class="comment">/* Create a new option entry at this index so we can modify it */</span>
<a name="l03235"></a>03235   old_option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index);
<a name="l03236"></a>03236   new_option_entry = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (old_option_entry);
<a name="l03237"></a>03237   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, index, new_option_entry);
<a name="l03238"></a>03238 
<a name="l03239"></a>03239 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03240"></a>03240 <span class="preprocessor"></span>  printf (<span class="stringliteral">"    Creating %s to distribute %s into\n"</span>,
<a name="l03241"></a>03241           new_option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03242"></a>03242 <span class="preprocessor">#endif</span>
<a name="l03243"></a>03243 <span class="preprocessor"></span>
<a name="l03244"></a>03244   <span class="comment">/* Add usage to each option */</span>
<a name="l03245"></a>03245   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l03246"></a>03246   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03247"></a>03247     {
<a name="l03248"></a>03248       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l03249"></a>03249 
<a name="l03250"></a>03250       <span class="comment">/* Duplicate this unit so we can modify it */</span>
<a name="l03251"></a>03251       new_unit_entry = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (unit_entry);
<a name="l03252"></a>03252 
<a name="l03253"></a>03253       <span class="comment">/* Set the one_of_field to the new unit */</span>
<a name="l03254"></a>03254       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (one_of_field, index1, new_unit_entry);
<a name="l03255"></a>03255 
<a name="l03256"></a>03256 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03257"></a>03257 <span class="preprocessor"></span>      printf (<span class="stringliteral">"      Placing %s into %s (index %i)\n"</span>,
<a name="l03258"></a>03258               usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, new_unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index1);
<a name="l03259"></a>03259 <span class="preprocessor">#endif</span>
<a name="l03260"></a>03260 <span class="preprocessor"></span>
<a name="l03261"></a>03261       <span class="comment">/* Get this new units use field */</span>
<a name="l03262"></a>03262       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03263"></a>03263 
<a name="l03264"></a>03264       <span class="comment">/* Add this usage to the end of the use field */</span>
<a name="l03265"></a>03265       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, usage_entry);
<a name="l03266"></a>03266     }
<a name="l03267"></a>03267 }
<a name="l03268"></a>03268 
<a name="l03269"></a>03269 <span class="keywordtype">void</span>
<a name="l03270"></a><a class="code" href="lmdes2__customizer_8c.html#edcc55f67d62d16fa42c8dc98dec4a43">03270</a> <a class="code" href="lmdes2__customizer_8c.html#edcc55f67d62d16fa42c8dc98dec4a43">CU_distribute_unconditional_usages</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * table_entry)
<a name="l03271"></a>03271 {
<a name="l03272"></a>03272   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target_entry, *unit_entry, *usage_entry, *option_entry;
<a name="l03273"></a>03273   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_unit_entry;
<a name="l03274"></a>03274   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_use_field, *unit_use_field;
<a name="l03275"></a>03275   <span class="keywordtype">int</span> index1, index2, unit_index = 0, changes;
<a name="l03276"></a>03276 
<a name="l03277"></a>03277 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03278"></a>03278 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Distributing usages in %s\n"</span>, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03279"></a>03279 <span class="preprocessor">#endif</span>
<a name="l03280"></a>03280 <span class="preprocessor"></span>
<a name="l03281"></a>03281   <span class="comment">/* Do nothing if there is only one choice */</span>
<a name="l03282"></a>03282   table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l03283"></a>03283   <span class="keywordflow">if</span> (table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> == 0)
<a name="l03284"></a>03284     {
<a name="l03285"></a>03285 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03286"></a>03286 <span class="preprocessor"></span>      printf (<span class="stringliteral">"  Only one choice\n"</span>);
<a name="l03287"></a>03287 <span class="preprocessor">#endif</span>
<a name="l03288"></a>03288 <span class="preprocessor"></span>      <span class="keywordflow">return</span>;
<a name="l03289"></a>03289     }
<a name="l03290"></a>03290 
<a name="l03291"></a>03291   <span class="comment">/* Find the consolidated unit entry (if any) in this table */</span>
<a name="l03292"></a>03292   unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03293"></a>03293   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03294"></a>03294     {
<a name="l03295"></a>03295       target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l03296"></a>03296 
<a name="l03297"></a>03297       <span class="keywordflow">if</span> (strcmp (target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l03298"></a>03298         {
<a name="l03299"></a>03299           <span class="comment">/* Better be only one unit in table (after consolidation)! */</span>
<a name="l03300"></a>03300           if (unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03301"></a>03301             {
<a name="l03302"></a>03302               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"CU_distribute_unconditional_usages:\n"</span>
<a name="l03303"></a>03303                       <span class="stringliteral">"%s has two units! %s and %s"</span>,
<a name="l03304"></a>03304                       table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l03305"></a>03305                       target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03306"></a>03306             }
<a name="l03307"></a>03307           unit_entry = target_entry;
<a name="l03308"></a>03308           unit_index = index1;
<a name="l03309"></a>03309         }
<a name="l03310"></a>03310     }
<a name="l03311"></a>03311 
<a name="l03312"></a>03312   <span class="comment">/* Do nothing if there is is no uncoditional usages */</span>
<a name="l03313"></a>03313   <span class="keywordflow">if</span> (unit_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03314"></a>03314     {
<a name="l03315"></a>03315 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l03316"></a>03316       printf (<span class="stringliteral">"  No unconditional usages\n"</span>);
<a name="l03317"></a>03317 <span class="preprocessor">#endif</span>
<a name="l03318"></a>03318 <span class="preprocessor"></span>      <span class="keywordflow">return</span>;
<a name="l03319"></a>03319     }
<a name="l03320"></a>03320 
<a name="l03321"></a>03321   <span class="comment">/* Create a new unit entry, so we can change it's contents */</span>
<a name="l03322"></a>03322   new_unit_entry = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (unit_entry);
<a name="l03323"></a>03323   changes = 0;
<a name="l03324"></a>03324 
<a name="l03325"></a>03325   <span class="comment">/* Try to find a home in one of the options for each usage in use.</span>
<a name="l03326"></a>03326 <span class="comment">   * First place resource usage in options that use resources in</span>
<a name="l03327"></a>03327 <span class="comment">   * the same cycle as the unit's resources.</span>
<a name="l03328"></a>03328 <span class="comment">   *</span>
<a name="l03329"></a>03329 <span class="comment">   * Process backward so we can delete links out of the unit_use if</span>
<a name="l03330"></a>03330 <span class="comment">   * a home is found.</span>
<a name="l03331"></a>03331 <span class="comment">   */</span>
<a name="l03332"></a>03332   unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03333"></a>03333   <span class="keywordflow">for</span> (index1 = unit_use_field-&gt;max_element_index; index1 &gt;= 0; index1--)
<a name="l03334"></a>03334     {
<a name="l03335"></a>03335       usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index1);
<a name="l03336"></a>03336 
<a name="l03337"></a>03337       <span class="comment">/* Try to find a home in one of the options */</span>
<a name="l03338"></a>03338       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= table_use_field-&gt;max_element_index; index2++)
<a name="l03339"></a>03339         {
<a name="l03340"></a>03340           option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index2);
<a name="l03341"></a>03341 
<a name="l03342"></a>03342           <span class="comment">/* The unit entry is not a table option */</span>
<a name="l03343"></a>03343           <span class="keywordflow">if</span> (option_entry == unit_entry)
<a name="l03344"></a>03344             <span class="keywordflow">continue</span>;
<a name="l03345"></a>03345 
<a name="l03346"></a>03346           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#aa03acc0339bfa5eb1dfac59e896fe1a">usage_cycle_compatable</a> (usage_entry, option_entry))
<a name="l03347"></a>03347             {
<a name="l03348"></a>03348 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l03349"></a>03349               printf (<span class="stringliteral">"%s is cycle compatable with %s\n"</span>,
<a name="l03350"></a>03350                       usage_entry-&gt;name, option_entry-&gt;name);
<a name="l03351"></a>03351 #endif
<a name="l03352"></a>03352 
<a name="l03353"></a>03353               <a class="code" href="lmdes2__customizer_8c.html#ec658bc2635a4784ff353fc3cad8bb0b">distribute_usage</a> (table_use_field, index2, usage_entry);
<a name="l03354"></a>03354 
<a name="l03355"></a>03355               <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (unit_use_field, index1);
<a name="l03356"></a>03356 
<a name="l03357"></a>03357               changes++;
<a name="l03358"></a>03358               <span class="keywordflow">break</span>;
<a name="l03359"></a>03359             }
<a name="l03360"></a>03360 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03361"></a>03361 <span class="preprocessor"></span>          <span class="keywordflow">else</span>
<a name="l03362"></a>03362             printf (<span class="stringliteral">"%s is not cycle compatable with %s\n"</span>,
<a name="l03363"></a>03363                     usage_entry-&gt;name, option_entry-&gt;name);
<a name="l03364"></a>03364 <span class="preprocessor">#endif</span>
<a name="l03365"></a>03365 <span class="preprocessor"></span>        }
<a name="l03366"></a>03366     }
<a name="l03367"></a>03367 
<a name="l03368"></a>03368   <span class="comment">/* Try to find a home in one of the options for each remaining usage in</span>
<a name="l03369"></a>03369 <span class="comment">   * use.  Now try to place in options that use the same resource.</span>
<a name="l03370"></a>03370 <span class="comment">   * This is important when doing resource minimizations.</span>
<a name="l03371"></a>03371 <span class="comment">   *</span>
<a name="l03372"></a>03372 <span class="comment">   * Process backward so we can delete links out of the unit_use if</span>
<a name="l03373"></a>03373 <span class="comment">   * a home is found.</span>
<a name="l03374"></a>03374 <span class="comment">   */</span>
<a name="l03375"></a>03375   unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03376"></a>03376   <span class="keywordflow">for</span> (index1 = unit_use_field-&gt;max_element_index; index1 &gt;= 0; index1--)
<a name="l03377"></a>03377     {
<a name="l03378"></a>03378       usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index1);
<a name="l03379"></a>03379 
<a name="l03380"></a>03380       <span class="comment">/* Try to find a home in one of the options */</span>
<a name="l03381"></a>03381       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= table_use_field-&gt;max_element_index; index2++)
<a name="l03382"></a>03382         {
<a name="l03383"></a>03383           option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index2);
<a name="l03384"></a>03384 
<a name="l03385"></a>03385           <span class="comment">/* The unit entry is not a table option */</span>
<a name="l03386"></a>03386           <span class="keywordflow">if</span> (option_entry == unit_entry)
<a name="l03387"></a>03387             <span class="keywordflow">continue</span>;
<a name="l03388"></a>03388 
<a name="l03389"></a>03389           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#bc7d12e76acc86904bdebd5296230f21">usage_resource_compatable</a> (usage_entry, option_entry))
<a name="l03390"></a>03390             {
<a name="l03391"></a>03391 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l03392"></a>03392               printf (<span class="stringliteral">"%s is resource compatable with %s\n"</span>,
<a name="l03393"></a>03393                       usage_entry-&gt;name, option_entry-&gt;name);
<a name="l03394"></a>03394 #endif
<a name="l03395"></a>03395 
<a name="l03396"></a>03396               <a class="code" href="lmdes2__customizer_8c.html#ec658bc2635a4784ff353fc3cad8bb0b">distribute_usage</a> (table_use_field, index2, usage_entry);
<a name="l03397"></a>03397 
<a name="l03398"></a>03398               <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (unit_use_field, index1);
<a name="l03399"></a>03399 
<a name="l03400"></a>03400               changes++;
<a name="l03401"></a>03401               <span class="keywordflow">break</span>;
<a name="l03402"></a>03402             }
<a name="l03403"></a>03403 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03404"></a>03404 <span class="preprocessor"></span>          <span class="keywordflow">else</span>
<a name="l03405"></a>03405             printf (<span class="stringliteral">"%s is not resource compatable with %s\n"</span>,
<a name="l03406"></a>03406                     usage_entry-&gt;name, option_entry-&gt;name);
<a name="l03407"></a>03407 <span class="preprocessor">#endif</span>
<a name="l03408"></a>03408 <span class="preprocessor"></span>        }
<a name="l03409"></a>03409     }
<a name="l03410"></a>03410 
<a name="l03411"></a>03411 
<a name="l03412"></a>03412 
<a name="l03413"></a>03413   <span class="comment">/* If the unit now has nothing in it, delete the entire unit from </span>
<a name="l03414"></a>03414 <span class="comment">   * the table.</span>
<a name="l03415"></a>03415 <span class="comment">   */</span>
<a name="l03416"></a>03416   <span class="keywordflow">if</span> (unit_use_field-&gt;max_element_index == -1)
<a name="l03417"></a>03417     {
<a name="l03418"></a>03418       <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (table_use_field, unit_index);
<a name="l03419"></a>03419       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (new_unit_entry);
<a name="l03420"></a>03420     }
<a name="l03421"></a>03421   <span class="comment">/* If the unit has changes, but is not empty, place new unit in table */</span>
<a name="l03422"></a>03422   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (changes != 0)
<a name="l03423"></a>03423     {
<a name="l03424"></a>03424       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, unit_index, new_unit_entry);
<a name="l03425"></a>03425     }
<a name="l03426"></a>03426   <span class="comment">/* if the unit hasn't changed, leave the old unit alone and</span>
<a name="l03427"></a>03427 <span class="comment">   * delete the new one</span>
<a name="l03428"></a>03428 <span class="comment">   */</span>
<a name="l03429"></a>03429   <span class="keywordflow">else</span>
<a name="l03430"></a>03430     {
<a name="l03431"></a>03431       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (new_unit_entry);
<a name="l03432"></a>03432     }
<a name="l03433"></a>03433 }
<a name="l03434"></a>03434 
<a name="l03435"></a>03435 <span class="comment">/* Change all the Table_Option-&gt;one_of() links so that they only use</span>
<a name="l03436"></a>03436 <span class="comment"> * resource units (Create resource units as necessary).  This makes</span>
<a name="l03437"></a>03437 <span class="comment"> * the mdes more uniform and facilates the bit field optimizations</span>
<a name="l03438"></a>03438 <span class="comment"> * we will be doing later.  This is transformation required in order </span>
<a name="l03439"></a>03439 <span class="comment"> * to be used by IMPACT.</span>
<a name="l03440"></a>03440 <span class="comment"> */</span>
<a name="l03441"></a>03441 <span class="keywordtype">void</span>
<a name="l03442"></a><a class="code" href="lmdes2__customizer_8c.html#722d64044c191dff9b39056217e3cb8a">03442</a> <a class="code" href="lmdes2__customizer_8c.html#722d64044c191dff9b39056217e3cb8a">CU_homogenize_table_options</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * table_option)
<a name="l03443"></a>03443 {
<a name="l03444"></a>03444   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_unit_section;
<a name="l03445"></a>03445   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target_entry, *new_unit;
<a name="l03446"></a>03446   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *use_field_decl;
<a name="l03447"></a>03447   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *new_use_field;
<a name="l03448"></a>03448   <span class="keywordtype">char</span> base_name[5000], unit_name[5000];
<a name="l03449"></a>03449   <span class="keywordtype">int</span> index;
<a name="l03450"></a>03450 
<a name="l03451"></a>03451   <span class="comment">/* Make sure we are passed a Table Option entry */</span>
<a name="l03452"></a>03452   <span class="keywordflow">if</span> (strcmp (table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) != 0)
<a name="l03453"></a>03453     {
<a name="l03454"></a>03454       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l03455"></a>03455               <span class="stringliteral">"CU_homogenize_table_options: table option expected "</span>
<a name="l03456"></a>03456               <span class="stringliteral">"not '%s-&gt;%s'!"</span>,
<a name="l03457"></a>03457               table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l03458"></a>03458     }
<a name="l03459"></a>03459 
<a name="l03460"></a>03460   <span class="comment">/* Get the one of field */</span>
<a name="l03461"></a>03461   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_option, <span class="stringliteral">"one_of"</span>);
<a name="l03462"></a>03462 
<a name="l03463"></a>03463   <span class="comment">/* Create a resource unit for each resource usage in the one_of field */</span>
<a name="l03464"></a>03464   <span class="keywordflow">for</span> (index = 0; index &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l03465"></a>03465     {
<a name="l03466"></a>03466       target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index);
<a name="l03467"></a>03467 
<a name="l03468"></a>03468       <span class="comment">/* Replace with resource unit if resource usage */</span>
<a name="l03469"></a>03469       <span class="keywordflow">if</span> (strcmp (target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Usage"</span>) == 0)
<a name="l03470"></a>03470         {
<a name="l03471"></a>03471           resource_unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l03472"></a>03472                                                    <span class="stringliteral">"Resource_Unit"</span>);
<a name="l03473"></a>03473 
<a name="l03474"></a>03474           <span class="comment">/* Create unit name from table option name and index */</span>
<a name="l03475"></a>03475           sprintf (base_name, <span class="stringliteral">"U_%s-%i"</span>, table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index);
<a name="l03476"></a>03476 
<a name="l03477"></a>03477           <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, base_name,
<a name="l03478"></a>03478                               unit_name);
<a name="l03479"></a>03479 
<a name="l03480"></a>03480           new_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (resource_unit_section, unit_name);
<a name="l03481"></a>03481 
<a name="l03482"></a>03482 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03483"></a>03483 <span class="preprocessor"></span>          <span class="comment">/* Debug */</span>
<a name="l03484"></a>03484           printf (<span class="stringliteral">"Homogenizing %s-&gt;one_of[%i] into %s.\n"</span>,
<a name="l03485"></a>03485                   table_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index, unit_name);
<a name="l03486"></a>03486 <span class="preprocessor">#endif</span>
<a name="l03487"></a>03487 <span class="preprocessor"></span>
<a name="l03488"></a>03488 
<a name="l03489"></a>03489           <span class="comment">/* Create a new use field to fill with all the resource usages */</span>
<a name="l03490"></a>03490           use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (new_unit-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>, <span class="stringliteral">"use"</span>);
<a name="l03491"></a>03491           new_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_unit, use_field_decl, 1);
<a name="l03492"></a>03492 
<a name="l03493"></a>03493           <span class="comment">/* Point unit's use field at the target entry */</span>
<a name="l03494"></a>03494           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (new_use_field, 0, target_entry);
<a name="l03495"></a>03495 
<a name="l03496"></a>03496           <span class="comment">/* Replace target_entry in table_option's one_of field with </span>
<a name="l03497"></a>03497 <span class="comment">           * new_unit.</span>
<a name="l03498"></a>03498 <span class="comment">           */</span>
<a name="l03499"></a>03499           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (one_of_field, index, new_unit);
<a name="l03500"></a>03500         }
<a name="l03501"></a>03501     }
<a name="l03502"></a>03502 }
<a name="l03503"></a>03503 
<a name="l03504"></a>03504 <span class="comment">/* Homogenize the resource usages so there is only one resource and time </span>
<a name="l03505"></a>03505 <span class="comment"> * specified for each resource usage.  This will allow them to</span>
<a name="l03506"></a>03506 <span class="comment"> * be easily combined for bit field optimizations</span>
<a name="l03507"></a>03507 <span class="comment"> */</span>
<a name="l03508"></a>03508 <span class="keywordtype">void</span>
<a name="l03509"></a><a class="code" href="lmdes2__customizer_8c.html#3332767efcdc1ab552393d010b97bf22">03509</a> <a class="code" href="lmdes2__customizer_8c.html#3332767efcdc1ab552393d010b97bf22">CU_homogenize_resource_usages</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * ru_entry)
<a name="l03510"></a>03510 {
<a name="l03511"></a>03511   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *new_ru_entry, *last_new, *target_resource;
<a name="l03512"></a>03512   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *orig_use_field, *new_use_field;
<a name="l03513"></a>03513   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *orig_time_field, *new_time_field;
<a name="l03514"></a>03514   <span class="keywordtype">int</span> index1, index2, target_time;
<a name="l03515"></a>03515 
<a name="l03516"></a>03516   orig_time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"time"</span>);
<a name="l03517"></a>03517 
<a name="l03518"></a>03518   <span class="comment">/* If have multiple times specified, create a new ru entry for</span>
<a name="l03519"></a>03519 <span class="comment">   * each time (except the first)</span>
<a name="l03520"></a>03520 <span class="comment">   */</span>
<a name="l03521"></a>03521   <span class="keywordflow">if</span> (orig_time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &gt; 0)
<a name="l03522"></a>03522     {
<a name="l03523"></a>03523       <span class="comment">/* Keep track of the entry to duplicate using last_new */</span>
<a name="l03524"></a>03524       last_new = ru_entry;
<a name="l03525"></a>03525       <span class="keywordflow">for</span> (index1 = 1; index1 &lt;= orig_time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03526"></a>03526         {
<a name="l03527"></a>03527           <span class="comment">/* Get the time we are creating this ru entry for */</span>
<a name="l03528"></a>03528           target_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (orig_time_field, index1);
<a name="l03529"></a>03529 
<a name="l03530"></a>03530           <span class="comment">/* Create new ru entry */</span>
<a name="l03531"></a>03531           new_ru_entry = <a class="code" href="lmdes2__customizer_8c.html#5908c785db2a738c076ba133610e281f">CU_dup_resource_usage</a> (last_new);
<a name="l03532"></a>03532 
<a name="l03533"></a>03533           <span class="comment">/* Duplicate this entry for the next time (if any) */</span>
<a name="l03534"></a>03534           last_new = new_ru_entry;
<a name="l03535"></a>03535 
<a name="l03536"></a>03536           <span class="comment">/* Get the new time field */</span>
<a name="l03537"></a>03537           new_time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_ru_entry, <span class="stringliteral">"time"</span>);
<a name="l03538"></a>03538 
<a name="l03539"></a>03539           <span class="comment">/* Delete all but the first time in the time field */</span>
<a name="l03540"></a>03540           <span class="keywordflow">for</span> (index2 = new_time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2 &gt;= 1;
<a name="l03541"></a>03541                index2--)
<a name="l03542"></a>03542             {
<a name="l03543"></a>03543               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (new_time_field, index2);
<a name="l03544"></a>03544             }
<a name="l03545"></a>03545 
<a name="l03546"></a>03546           <span class="comment">/* Set the first time in the time field to the target time */</span>
<a name="l03547"></a>03547           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (new_time_field, 0, target_time);
<a name="l03548"></a>03548 
<a name="l03549"></a>03549           <span class="comment">/* Delete this time from the original time field */</span>
<a name="l03550"></a>03550           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (orig_time_field, index1);
<a name="l03551"></a>03551         }
<a name="l03552"></a>03552     }
<a name="l03553"></a>03553 
<a name="l03554"></a>03554   orig_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"use"</span>);
<a name="l03555"></a>03555 
<a name="l03556"></a>03556   <span class="comment">/* If have multiple resources specified, create a new ru entry for</span>
<a name="l03557"></a>03557 <span class="comment">   * each resource (except the first)</span>
<a name="l03558"></a>03558 <span class="comment">   */</span>
<a name="l03559"></a>03559   <span class="keywordflow">if</span> (orig_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &gt; 0)
<a name="l03560"></a>03560     {
<a name="l03561"></a>03561       <span class="comment">/* Keep track of the entry to duplicate using last_new */</span>
<a name="l03562"></a>03562       last_new = ru_entry;
<a name="l03563"></a>03563       <span class="keywordflow">for</span> (index1 = 1; index1 &lt;= orig_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03564"></a>03564         {
<a name="l03565"></a>03565           <span class="comment">/* Get the resource we are creating this ru entry for */</span>
<a name="l03566"></a>03566           target_resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (orig_use_field, index1);
<a name="l03567"></a>03567 
<a name="l03568"></a>03568           <span class="comment">/* Create new ru entry */</span>
<a name="l03569"></a>03569           new_ru_entry = <a class="code" href="lmdes2__customizer_8c.html#5908c785db2a738c076ba133610e281f">CU_dup_resource_usage</a> (last_new);
<a name="l03570"></a>03570 
<a name="l03571"></a>03571           <span class="comment">/* Duplicate this entry for the next resource (if any) */</span>
<a name="l03572"></a>03572           last_new = new_ru_entry;
<a name="l03573"></a>03573 
<a name="l03574"></a>03574           <span class="comment">/* Get the new use field */</span>
<a name="l03575"></a>03575           new_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_ru_entry, <span class="stringliteral">"use"</span>);
<a name="l03576"></a>03576 
<a name="l03577"></a>03577           <span class="comment">/* Delete all but the first resource in the use field */</span>
<a name="l03578"></a>03578           <span class="keywordflow">for</span> (index2 = new_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2 &gt;= 1;
<a name="l03579"></a>03579                index2--)
<a name="l03580"></a>03580             {
<a name="l03581"></a>03581               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (new_use_field, index2);
<a name="l03582"></a>03582             }
<a name="l03583"></a>03583 
<a name="l03584"></a>03584           <span class="comment">/* Set the first resource in the use field to the target resource */</span>
<a name="l03585"></a>03585           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (new_use_field, 0, target_resource);
<a name="l03586"></a>03586 
<a name="l03587"></a>03587           <span class="comment">/* Delete this resource from the original use field */</span>
<a name="l03588"></a>03588           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (orig_use_field, index1);
<a name="l03589"></a>03589         }
<a name="l03590"></a>03590     }
<a name="l03591"></a>03591 }
<a name="l03592"></a>03592 
<a name="l03593"></a>03593     <span class="comment">/* Shift the resource times that no resource usage time is less than 0. </span>
<a name="l03594"></a>03594 <span class="comment"></span>
<a name="l03595"></a>03595 <span class="comment">     * For opti_level &lt; 3, shift all times by the same amount, so the</span>
<a name="l03596"></a>03596 <span class="comment">     * usages maintain the same relationship as the mdes specified.</span>
<a name="l03597"></a>03597 <span class="comment">     * This is equivalent to changing the point chosen for time "zero".</span>
<a name="l03598"></a>03598 <span class="comment">     *</span>
<a name="l03599"></a>03599 <span class="comment">     * For opti_level &gt;= 3, try to minimize to number of different times </span>
<a name="l03600"></a>03600 <span class="comment">     * that resources are used to try to maximize the effect of the bit </span>
<a name="l03601"></a>03601 <span class="comment">     * field optimizations.</span>
<a name="l03602"></a>03602 <span class="comment">     * As a first try, I will just move each resource usage so that it's </span>
<a name="l03603"></a>03603 <span class="comment">     * earlies usage is always time 0.</span>
<a name="l03604"></a>03604 <span class="comment">     * May want to try other methods to shifting times to see if can find</span>
<a name="l03605"></a>03605 <span class="comment">     * a better method (zero-opti seems to work best for our mdeses).</span>
<a name="l03606"></a>03606 <span class="comment">     * </span>
<a name="l03607"></a>03607 <span class="comment">     * Assumes CU_homogenize_resource_usages() has been run on all</span>
<a name="l03608"></a>03608 <span class="comment">     * the ru entries.</span>
<a name="l03609"></a>03609 <span class="comment">     * </span>
<a name="l03610"></a>03610 <span class="comment">     */</span>
<a name="l03611"></a>03611 <span class="keywordtype">void</span>
<a name="l03612"></a><a class="code" href="lmdes2__customizer_8c.html#772a2fd220caf518585c5ed7bfe622be">03612</a> <a class="code" href="lmdes2__customizer_8c.html#772a2fd220caf518585c5ed7bfe622be">CU_optimize_resource_usage_times</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l03613"></a>03613 {
<a name="l03614"></a>03614   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_section, *ru_section;
<a name="l03615"></a>03615   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource_entry, *ru_entry, *resource_used;
<a name="l03616"></a>03616   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *time_field_decl, *use_field_decl;
<a name="l03617"></a>03617   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *time_field, *use_field;
<a name="l03618"></a>03618   <span class="keywordtype">int</span> time, min_time, num_uses, global_min_time;
<a name="l03619"></a>03619 
<a name="l03620"></a>03620   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l03621"></a>03621   ru_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l03622"></a>03622   use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (ru_section, <span class="stringliteral">"use"</span>);
<a name="l03623"></a>03623   time_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (ru_section, <span class="stringliteral">"time"</span>);
<a name="l03624"></a>03624 
<a name="l03625"></a>03625 
<a name="l03626"></a>03626   <span class="comment">/* If opti_level &lt; 3, need to global min_time to shift all the</span>
<a name="l03627"></a>03627 <span class="comment">   * resources usages by.  </span>
<a name="l03628"></a>03628 <span class="comment">   */</span>
<a name="l03629"></a>03629   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &lt; 3)
<a name="l03630"></a>03630     {
<a name="l03631"></a>03631       num_uses = 0;
<a name="l03632"></a>03632       global_min_time = 100000;
<a name="l03633"></a>03633 
<a name="l03634"></a>03634       <span class="comment">/* Find the minimum use time of this resource */</span>
<a name="l03635"></a>03635       <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03636"></a>03636            ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l03637"></a>03637         {
<a name="l03638"></a>03638           <span class="comment">/* Get the resource used */</span>
<a name="l03639"></a>03639           use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, use_field_decl);
<a name="l03640"></a>03640           resource_used = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, 0);
<a name="l03641"></a>03641 
<a name="l03642"></a>03642           <span class="comment">/* Sanity check, punt if more than one resource used */</span>
<a name="l03643"></a>03643           <span class="keywordflow">if</span> (use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l03644"></a>03644             {
<a name="l03645"></a>03645               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"CU_optimize_resource_usage_times: multiple uses!"</span>);
<a name="l03646"></a>03646             }
<a name="l03647"></a>03647 
<a name="l03648"></a>03648           <span class="comment">/* Get the time this resource is used at */</span>
<a name="l03649"></a>03649           time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, time_field_decl);
<a name="l03650"></a>03650           time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03651"></a>03651 
<a name="l03652"></a>03652           <span class="comment">/* Sanity check, punt if more than one time specified */</span>
<a name="l03653"></a>03653           <span class="keywordflow">if</span> (time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l03654"></a>03654             {
<a name="l03655"></a>03655               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l03656"></a>03656                       <span class="stringliteral">"CU_optimize_resource_usage_times: multiple times!"</span>);
<a name="l03657"></a>03657             }
<a name="l03658"></a>03658 
<a name="l03659"></a>03659           <span class="comment">/* Is this a new global min time ? */</span>
<a name="l03660"></a>03660           <span class="keywordflow">if</span> ((num_uses == 0) || (time &lt; global_min_time))
<a name="l03661"></a>03661             global_min_time = time;
<a name="l03662"></a>03662           num_uses++;
<a name="l03663"></a>03663         }
<a name="l03664"></a>03664 
<a name="l03665"></a>03665       <span class="comment">/* Subtract the global_min_time from all uses of this resource, </span>
<a name="l03666"></a>03666 <span class="comment">       * so that the new global min_time will be 0.</span>
<a name="l03667"></a>03667 <span class="comment">       */</span>
<a name="l03668"></a>03668       <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03669"></a>03669            ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l03670"></a>03670         {
<a name="l03671"></a>03671           <span class="comment">/* Get the resource used */</span>
<a name="l03672"></a>03672           use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, use_field_decl);
<a name="l03673"></a>03673           resource_used = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, 0);
<a name="l03674"></a>03674 
<a name="l03675"></a>03675           <span class="comment">/* Get the time this resource is used at */</span>
<a name="l03676"></a>03676           time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, time_field_decl);
<a name="l03677"></a>03677           time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03678"></a>03678 
<a name="l03679"></a>03679           <span class="comment">/* Subtract the global min_time from this time to make the</span>
<a name="l03680"></a>03680 <span class="comment">           * the new global_min_time 0 for all resources.</span>
<a name="l03681"></a>03681 <span class="comment">           */</span>
<a name="l03682"></a>03682           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (time_field, 0, time - global_min_time);
<a name="l03683"></a>03683         }
<a name="l03684"></a>03684 
<a name="l03685"></a>03685       <span class="comment">/* Finished with optis for opti_level &lt; 3 */</span>
<a name="l03686"></a>03686       <span class="keywordflow">return</span>;
<a name="l03687"></a>03687     }
<a name="l03688"></a>03688 
<a name="l03689"></a>03689   <span class="comment">/* Otherwise, will find for each resource time sepatately</span>
<a name="l03690"></a>03690 <span class="comment">   * This is for opti_level &gt;= 3*/</span>
<a name="l03691"></a>03691   <span class="keywordflow">for</span> (resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (resource_section);
<a name="l03692"></a>03692        resource_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03693"></a>03693        resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource_entry))
<a name="l03694"></a>03694     {
<a name="l03695"></a>03695       num_uses = 0;
<a name="l03696"></a>03696       min_time = 100000;
<a name="l03697"></a>03697 
<a name="l03698"></a>03698       <span class="comment">/* Find the minimum use time of this resource */</span>
<a name="l03699"></a>03699       <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03700"></a>03700            ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l03701"></a>03701         {
<a name="l03702"></a>03702           <span class="comment">/* Get the resource used */</span>
<a name="l03703"></a>03703           use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, use_field_decl);
<a name="l03704"></a>03704           resource_used = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, 0);
<a name="l03705"></a>03705 
<a name="l03706"></a>03706           <span class="comment">/* Sanity check, punt if more than one resource used */</span>
<a name="l03707"></a>03707           <span class="keywordflow">if</span> (use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l03708"></a>03708             {
<a name="l03709"></a>03709               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"CU_optimize_resource_usage_times: multiple uses!"</span>);
<a name="l03710"></a>03710             }
<a name="l03711"></a>03711 
<a name="l03712"></a>03712           <span class="comment">/* Go to next ru if not using the resource_entry resource? */</span>
<a name="l03713"></a>03713           <span class="keywordflow">if</span> (resource_used != resource_entry)
<a name="l03714"></a>03714             <span class="keywordflow">continue</span>;
<a name="l03715"></a>03715 
<a name="l03716"></a>03716           <span class="comment">/* Get the time this resource is used at */</span>
<a name="l03717"></a>03717           time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, time_field_decl);
<a name="l03718"></a>03718           time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03719"></a>03719 
<a name="l03720"></a>03720           <span class="comment">/* Sanity check, punt if more than one time specified */</span>
<a name="l03721"></a>03721           <span class="keywordflow">if</span> (time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l03722"></a>03722             {
<a name="l03723"></a>03723               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l03724"></a>03724                       <span class="stringliteral">"CU_optimize_resource_usage_times: multiple times!"</span>);
<a name="l03725"></a>03725             }
<a name="l03726"></a>03726 
<a name="l03727"></a>03727           <span class="comment">/* Is this a new min time ? */</span>
<a name="l03728"></a>03728           <span class="keywordflow">if</span> ((num_uses == 0) || (time &lt; min_time))
<a name="l03729"></a>03729             min_time = time;
<a name="l03730"></a>03730           num_uses++;
<a name="l03731"></a>03731         }
<a name="l03732"></a>03732 
<a name="l03733"></a>03733       <span class="comment">/* If this resource is not used, or the min_time is already 0,</span>
<a name="l03734"></a>03734 <span class="comment">       * goto next resource.</span>
<a name="l03735"></a>03735 <span class="comment">       */</span>
<a name="l03736"></a>03736       <span class="keywordflow">if</span> ((num_uses == 0) || (min_time == 0))
<a name="l03737"></a>03737         <span class="keywordflow">continue</span>;
<a name="l03738"></a>03738 
<a name="l03739"></a>03739 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03740"></a>03740 <span class="preprocessor"></span>      printf (<span class="stringliteral">"Adjusting the %i uses of %s by %i cycles\n"</span>,
<a name="l03741"></a>03741               num_uses, resource_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, min_time);
<a name="l03742"></a>03742 <span class="preprocessor">#endif</span>
<a name="l03743"></a>03743 <span class="preprocessor"></span>
<a name="l03744"></a>03744       <span class="comment">/* Subtract the min_time from all uses of this resource, so that</span>
<a name="l03745"></a>03745 <span class="comment">       * the new min_time will be 0.</span>
<a name="l03746"></a>03746 <span class="comment">       */</span>
<a name="l03747"></a>03747       <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03748"></a>03748            ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l03749"></a>03749         {
<a name="l03750"></a>03750           <span class="comment">/* Get the resource used */</span>
<a name="l03751"></a>03751           use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, use_field_decl);
<a name="l03752"></a>03752           resource_used = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, 0);
<a name="l03753"></a>03753 
<a name="l03754"></a>03754           <span class="comment">/* Go to next ru if not using the resource_entry resource? */</span>
<a name="l03755"></a>03755           <span class="keywordflow">if</span> (resource_used != resource_entry)
<a name="l03756"></a>03756             <span class="keywordflow">continue</span>;
<a name="l03757"></a>03757 
<a name="l03758"></a>03758           <span class="comment">/* Get the time this resource is used at */</span>
<a name="l03759"></a>03759           time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (ru_entry, time_field_decl);
<a name="l03760"></a>03760           time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l03761"></a>03761 
<a name="l03762"></a>03762           <span class="comment">/* Subtract the min_time from this time to make the</span>
<a name="l03763"></a>03763 <span class="comment">           * the new min_time 0 for this resource.</span>
<a name="l03764"></a>03764 <span class="comment">           */</span>
<a name="l03765"></a>03765           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (time_field, 0, time - min_time);
<a name="l03766"></a>03766         }
<a name="l03767"></a>03767     }
<a name="l03768"></a>03768 }
<a name="l03769"></a>03769 
<a name="l03770"></a>03770 <span class="comment">/* Returns the first resource usage time in the time field*/</span>
<a name="l03771"></a>03771 <span class="keywordtype">int</span>
<a name="l03772"></a><a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">03772</a> <a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">CU_get_ru_time</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * ru_entry)
<a name="l03773"></a>03773 {
<a name="l03774"></a>03774   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *time_field;
<a name="l03775"></a>03775 
<a name="l03776"></a>03776   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"time"</span>);
<a name="l03777"></a>03777 
<a name="l03778"></a>03778   <span class="keywordflow">return</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0));
<a name="l03779"></a>03779 }
<a name="l03780"></a>03780 
<a name="l03781"></a>03781 <span class="comment">/* Returns the number of Tables that an entry (option/unit/ru) is used in</span>
<a name="l03782"></a>03782 <span class="comment"> * Used in CU_order_use_fields to put most_restrictive table options first.</span>
<a name="l03783"></a>03783 <span class="comment"> */</span>
<a name="l03784"></a>03784 <span class="keywordtype">int</span>
<a name="l03785"></a><a class="code" href="lmdes2__customizer_8c.html#fdf290d1fef84d92c3a52bb51e638226">03785</a> <a class="code" href="lmdes2__customizer_8c.html#fdf290d1fef84d92c3a52bb51e638226">CU_num_table_uses</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry)
<a name="l03786"></a>03786 {
<a name="l03787"></a>03787   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> *md;
<a name="l03788"></a>03788   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section;
<a name="l03789"></a>03789   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *use_field_decl;
<a name="l03790"></a>03790   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field;
<a name="l03791"></a>03791   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *target_entry;
<a name="l03792"></a>03792   <span class="keywordtype">int</span> index, use_count;
<a name="l03793"></a>03793 
<a name="l03794"></a>03794   use_count = 0;
<a name="l03795"></a>03795 
<a name="l03796"></a>03796   <span class="comment">/* Get md for ease of use */</span>
<a name="l03797"></a>03797   md = option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>;
<a name="l03798"></a>03798 
<a name="l03799"></a>03799   <span class="comment">/* Get the table section and it's use field declaration */</span>
<a name="l03800"></a>03800   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l03801"></a>03801   use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (table_section, <span class="stringliteral">"use"</span>);
<a name="l03802"></a>03802 
<a name="l03803"></a>03803   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03804"></a>03804        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l03805"></a>03805     {
<a name="l03806"></a>03806       <span class="keywordflow">if</span> ((use_field = <a class="code" href="lmdes2__customizer_8c.html#dfba5ab2edf1d22c8eef8e33bfbb4e8f">CU_find_field</a> (table_entry, use_field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03807"></a>03807         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"CU_num_tables_uses: use field not found"</span>);
<a name="l03808"></a>03808 
<a name="l03809"></a>03809       <span class="keywordflow">for</span> (index = 0; index &lt;= <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4cf11644283a4d46fb0651b48c598d2b">MD_max_element_index</a> (use_field); index++)
<a name="l03810"></a>03810         {
<a name="l03811"></a>03811           target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index);
<a name="l03812"></a>03812           <span class="keywordflow">if</span> (target_entry == option_entry)
<a name="l03813"></a>03813             use_count++;
<a name="l03814"></a>03814         }
<a name="l03815"></a>03815     }
<a name="l03816"></a>03816 
<a name="l03817"></a>03817 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03818"></a>03818 <span class="preprocessor"></span>  printf (<span class="stringliteral">"  %s has %i uses.\n"</span>, option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, use_count);
<a name="l03819"></a>03819 <span class="preprocessor">#endif</span>
<a name="l03820"></a>03820 <span class="preprocessor"></span>
<a name="l03821"></a>03821   <span class="comment">/* Return the number of tables that use this entry */</span>
<a name="l03822"></a>03822   <span class="keywordflow">return</span> (use_count);
<a name="l03823"></a>03823 }
<a name="l03824"></a>03824 
<a name="l03825"></a>03825 <span class="comment">/*</span>
<a name="l03826"></a>03826 <span class="comment"> * Applies transformations for opti_levels &gt;= 3 only.</span>
<a name="l03827"></a>03827 <span class="comment"> *</span>
<a name="l03828"></a>03828 <span class="comment"> * Sort the Reseveration_Table-&gt;use() links and Resource_Unit-&gt;use()</span>
<a name="l03829"></a>03829 <span class="comment"> * links so that resources will be distributed the same in the various</span>
<a name="l03830"></a>03830 <span class="comment"> * forms of the same table, and so that the classical optimizations</span>
<a name="l03831"></a>03831 <span class="comment"> * can detect these duplicate tables consistently.</span>
<a name="l03832"></a>03832 <span class="comment"> * </span>
<a name="l03833"></a>03833 <span class="comment"> * It also places checks near time 0 first, and reorders the</span>
<a name="l03834"></a>03834 <span class="comment"> * AND-OR trees (if opti_level &gt;= 4) to place most restrictive </span>
<a name="l03835"></a>03835 <span class="comment"> * checks first.</span>
<a name="l03836"></a>03836 <span class="comment"> *</span>
<a name="l03837"></a>03837 <span class="comment"> * if min_reorder is set to 1, reorder only if have strong heuristic</span>
<a name="l03838"></a>03838 <span class="comment"> * reason for doing so (I.e., don't reorder due to name).</span>
<a name="l03839"></a>03839 <span class="comment"> */</span>
<a name="l03840"></a>03840 <span class="keywordtype">void</span>
<a name="l03841"></a><a class="code" href="lmdes2__customizer_8c.html#09e11110f5b6a98ed4d840057dc1e125">03841</a> <a class="code" href="lmdes2__customizer_8c.html#09e11110f5b6a98ed4d840057dc1e125">CU_order_use_fields</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">int</span> min_reorder)
<a name="l03842"></a>03842 {
<a name="l03843"></a>03843   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section, *table_section;
<a name="l03844"></a>03844   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *cur_ru_entry, *ru_entry, *min_ru_entry;
<a name="l03845"></a>03845   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *cur_option_entry, *option_entry, *min_option_entry;
<a name="l03846"></a>03846   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field, *one_of_field;
<a name="l03847"></a>03847   <span class="keywordtype">int</span> index1, index2, min_index;
<a name="l03848"></a>03848   <span class="keywordtype">int</span> cur_option_count, option_count, min_count, min_ru_time, ru_time;
<a name="l03849"></a>03849   <span class="keywordtype">int</span> min_ru_slot, ru_slot, cur_ru_time, cur_ru_slot;
<a name="l03850"></a>03850   <span class="keywordtype">int</span> min_use_count, cur_use_count, use_count;
<a name="l03851"></a>03851 
<a name="l03852"></a>03852   <span class="comment">/* Only reorder resource usage if opti_level &gt;= 3 */</span>
<a name="l03853"></a>03853   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &lt; 3)
<a name="l03854"></a>03854     <span class="keywordflow">return</span>;
<a name="l03855"></a>03855 
<a name="l03856"></a>03856   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l03857"></a>03857   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03858"></a>03858        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l03859"></a>03859     {
<a name="l03860"></a>03860       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l03861"></a>03861 
<a name="l03862"></a>03862       <span class="comment">/* Do nothing if only one link */</span>
<a name="l03863"></a>03863       <span class="keywordflow">if</span> (use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &lt;= 0)
<a name="l03864"></a>03864         <span class="keywordflow">continue</span>;
<a name="l03865"></a>03865 
<a name="l03866"></a>03866       <span class="comment">/* Sort uses by usage time, then give predence to slot, then by name </span>
<a name="l03867"></a>03867 <span class="comment">       * (CU_ge_slot returns -1, unless slot specified)</span>
<a name="l03868"></a>03868 <span class="comment">       */</span>
<a name="l03869"></a>03869       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03870"></a>03870         {
<a name="l03871"></a>03871           <span class="comment">/* Get the ru entry at this index */</span>
<a name="l03872"></a>03872           cur_ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l03873"></a>03873 
<a name="l03874"></a>03874           <span class="comment">/* Set this to be the current minimum ru_entry */</span>
<a name="l03875"></a>03875           min_ru_entry = cur_ru_entry;
<a name="l03876"></a>03876           min_ru_time = <a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">CU_get_ru_time</a> (cur_ru_entry);
<a name="l03877"></a>03877           min_ru_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (cur_ru_entry);
<a name="l03878"></a>03878           min_index = index1;
<a name="l03879"></a>03879 
<a name="l03880"></a>03880           <span class="comment">/* Find the ru entry to replace this one (if any) */</span>
<a name="l03881"></a>03881           <span class="keywordflow">for</span> (index2 = index1 + 1; index2 &lt;= use_field-&gt;max_element_index;
<a name="l03882"></a>03882                index2++)
<a name="l03883"></a>03883             {
<a name="l03884"></a>03884               <span class="comment">/* Get the entry at this index */</span>
<a name="l03885"></a>03885               ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l03886"></a>03886               ru_time = <a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">CU_get_ru_time</a> (ru_entry);
<a name="l03887"></a>03887               ru_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (ru_entry);
<a name="l03888"></a>03888 
<a name="l03889"></a>03889               <span class="comment">/* Should this become the new min? */</span>
<a name="l03890"></a>03890               <span class="keywordflow">if</span> ((ru_time &lt; min_ru_time) ||
<a name="l03891"></a>03891                   ((ru_time == min_ru_time) &amp;&amp;
<a name="l03892"></a>03892                    (ru_slot &gt; min_ru_slot)) ||
<a name="l03893"></a>03893                   ((ru_time == min_ru_time) &amp;&amp;
<a name="l03894"></a>03894                    (ru_slot == min_ru_slot) &amp;&amp;
<a name="l03895"></a>03895                    (strcmp (min_ru_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, ru_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>) &gt; 0)))
<a name="l03896"></a>03896                 {
<a name="l03897"></a>03897                   min_ru_entry = ru_entry;
<a name="l03898"></a>03898                   min_ru_time = ru_time;
<a name="l03899"></a>03899                   min_ru_slot = ru_slot;
<a name="l03900"></a>03900                   min_index = index2;
<a name="l03901"></a>03901                 }
<a name="l03902"></a>03902             }
<a name="l03903"></a>03903 
<a name="l03904"></a>03904           <span class="comment">/* Swap if new min is found */</span>
<a name="l03905"></a>03905           <span class="keywordflow">if</span> (min_index != index1)
<a name="l03906"></a>03906             {
<a name="l03907"></a>03907 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l03908"></a>03908 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l03909"></a>03909               printf (<span class="stringliteral">"  Swapping %s (time %i) and %s (time %i)\n"</span>,
<a name="l03910"></a>03910                       cur_ru_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, <a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">CU_get_ru_time</a> (cur_ru_entry),
<a name="l03911"></a>03911                       min_ru_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, <a class="code" href="lmdes2__customizer_8c.html#9c7268b691bd7ad874ab904435b25527">CU_get_ru_time</a> (min_ru_entry));
<a name="l03912"></a>03912 <span class="preprocessor">#endif</span>
<a name="l03913"></a>03913 <span class="preprocessor"></span>              <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, index1, min_ru_entry);
<a name="l03914"></a>03914               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, min_index, cur_ru_entry);
<a name="l03915"></a>03915             }
<a name="l03916"></a>03916         }
<a name="l03917"></a>03917     }
<a name="l03918"></a>03918 
<a name="l03919"></a>03919   <span class="comment">/* Reorder AND/OR Trees for opti_level &gt;= 4 only */</span>
<a name="l03920"></a>03920   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &lt; 4)
<a name="l03921"></a>03921     <span class="keywordflow">return</span>;
<a name="l03922"></a>03922 
<a name="l03923"></a>03923   <span class="comment">/* Sort AND/OR trees first by minimum resource usage time, </span>
<a name="l03924"></a>03924 <span class="comment">   * then by number of options, then give preference to slot specifying</span>
<a name="l03925"></a>03925 <span class="comment">   * option, then give preference to option with the most uses in other</span>
<a name="l03926"></a>03926 <span class="comment">   * tables,then lastly by name</span>
<a name="l03927"></a>03927 <span class="comment">   */</span>
<a name="l03928"></a>03928   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l03929"></a>03929   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03930"></a>03930        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l03931"></a>03931     {
<a name="l03932"></a>03932       <span class="comment">/* Get the use field */</span>
<a name="l03933"></a>03933       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l03934"></a>03934 
<a name="l03935"></a>03935       <span class="comment">/* Do nothing if only one link */</span>
<a name="l03936"></a>03936       <span class="keywordflow">if</span> (use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> &lt;= 0)
<a name="l03937"></a>03937         <span class="keywordflow">continue</span>;
<a name="l03938"></a>03938 
<a name="l03939"></a>03939       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l03940"></a>03940         {
<a name="l03941"></a>03941           cur_option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l03942"></a>03942 
<a name="l03943"></a>03943           <span class="comment">/* Really will be an table option at this point */</span>
<a name="l03944"></a>03944           <span class="keywordflow">if</span> (strcmp (cur_option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l03945"></a>03945             {
<a name="l03946"></a>03946               one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (cur_option_entry,
<a name="l03947"></a>03947                                                     <span class="stringliteral">"one_of"</span>);
<a name="l03948"></a>03948               cur_option_count = one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l03949"></a>03949             }
<a name="l03950"></a>03950           <span class="keywordflow">else</span>
<a name="l03951"></a>03951             {
<a name="l03952"></a>03952               cur_option_count = 1;
<a name="l03953"></a>03953             }
<a name="l03954"></a>03954           cur_ru_time = <a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">CU_get_min_time</a> (cur_option_entry);
<a name="l03955"></a>03955           cur_ru_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (cur_option_entry);
<a name="l03956"></a>03956           cur_use_count = <a class="code" href="lmdes2__customizer_8c.html#fdf290d1fef84d92c3a52bb51e638226">CU_num_table_uses</a> (cur_option_entry);
<a name="l03957"></a>03957 
<a name="l03958"></a>03958           <span class="comment">/* Make this the current min entry */</span>
<a name="l03959"></a>03959           min_option_entry = cur_option_entry;
<a name="l03960"></a>03960           min_ru_time = cur_ru_time;
<a name="l03961"></a>03961           min_ru_slot = cur_ru_slot;
<a name="l03962"></a>03962           min_use_count = cur_use_count;
<a name="l03963"></a>03963           min_index = index1;
<a name="l03964"></a>03964           min_count = cur_option_count;
<a name="l03965"></a>03965 
<a name="l03966"></a>03966           <span class="comment">/* Find an option with less options, then sort by name */</span>
<a name="l03967"></a>03967           <span class="keywordflow">for</span> (index2 = index1 + 1; index2 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l03968"></a>03968                index2++)
<a name="l03969"></a>03969             {
<a name="l03970"></a>03970               option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l03971"></a>03971               <span class="keywordflow">if</span> (strcmp (option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l03972"></a>03972                 {
<a name="l03973"></a>03973                   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry,
<a name="l03974"></a>03974                                                         <span class="stringliteral">"one_of"</span>);
<a name="l03975"></a>03975                   option_count = one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l03976"></a>03976                 }
<a name="l03977"></a>03977               <span class="keywordflow">else</span>
<a name="l03978"></a>03978                 {
<a name="l03979"></a>03979                   option_count = 1;
<a name="l03980"></a>03980                 }
<a name="l03981"></a>03981 
<a name="l03982"></a>03982               ru_time = <a class="code" href="lmdes2__customizer_8c.html#04c8d543fffa447091d73d185e5e6765">CU_get_min_time</a> (option_entry);
<a name="l03983"></a>03983               ru_slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (option_entry);
<a name="l03984"></a>03984               use_count = <a class="code" href="lmdes2__customizer_8c.html#fdf290d1fef84d92c3a52bb51e638226">CU_num_table_uses</a> (option_entry);
<a name="l03985"></a>03985 
<a name="l03986"></a>03986               <span class="keywordflow">if</span> ((ru_time &lt; min_ru_time) ||
<a name="l03987"></a>03987                   ((ru_time == min_ru_time) &amp;&amp;
<a name="l03988"></a>03988                    (option_count &lt; min_count)) ||
<a name="l03989"></a>03989                   ((ru_time == min_ru_time) &amp;&amp;
<a name="l03990"></a>03990                    (option_count == min_count) &amp;&amp;
<a name="l03991"></a>03991                    (ru_slot &gt; min_ru_slot)) ||
<a name="l03992"></a>03992                   ((min_reorder == 0) &amp;&amp;
<a name="l03993"></a>03993                    (ru_time == min_ru_time) &amp;&amp;
<a name="l03994"></a>03994                    (option_count == min_count) &amp;&amp;
<a name="l03995"></a>03995                    (ru_slot == min_ru_slot) &amp;&amp;
<a name="l03996"></a>03996                    (use_count &gt; min_use_count)) ||
<a name="l03997"></a>03997                   ((min_reorder == 0) &amp;&amp;
<a name="l03998"></a>03998                    (ru_time == min_ru_time) &amp;&amp;
<a name="l03999"></a>03999                    (option_count == min_count) &amp;&amp;
<a name="l04000"></a>04000                    (ru_slot == min_ru_slot) &amp;&amp;
<a name="l04001"></a>04001                    (use_count == min_use_count) &amp;&amp;
<a name="l04002"></a>04002                    (strcmp (min_option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>) &gt; 0)))
<a name="l04003"></a>04003                 {
<a name="l04004"></a>04004                   min_option_entry = option_entry;
<a name="l04005"></a>04005                   min_ru_time = ru_time;
<a name="l04006"></a>04006                   min_ru_slot = ru_slot;
<a name="l04007"></a>04007                   min_use_count = use_count;
<a name="l04008"></a>04008                   min_index = index2;
<a name="l04009"></a>04009                   min_count = option_count;
<a name="l04010"></a>04010                 }
<a name="l04011"></a>04011             }
<a name="l04012"></a>04012 
<a name="l04013"></a>04013           <span class="comment">/* Swap if new min is found */</span>
<a name="l04014"></a>04014           <span class="keywordflow">if</span> (min_index != index1)
<a name="l04015"></a>04015             {
<a name="l04016"></a>04016 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04017"></a>04017 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l04018"></a>04018               printf
<a name="l04019"></a>04019                 (<span class="stringliteral">"  Swapping %s (time %i, options %i, slot %i, uses %i) and\n"</span>
<a name="l04020"></a>04020                  <span class="stringliteral">"%s (time %i options %i, slot %i, uses %i)\n"</span>,
<a name="l04021"></a>04021                  cur_option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, cur_ru_time, cur_option_count,
<a name="l04022"></a>04022                  cur_ru_slot, cur_use_count, min_option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l04023"></a>04023                  min_ru_time, min_count, min_ru_slot, min_use_count);
<a name="l04024"></a>04024 <span class="preprocessor">#endif</span>
<a name="l04025"></a>04025 <span class="preprocessor"></span>              <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, index1, min_option_entry);
<a name="l04026"></a>04026               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, min_index, cur_option_entry);
<a name="l04027"></a>04027             }
<a name="l04028"></a>04028         }
<a name="l04029"></a>04029     }
<a name="l04030"></a>04030 }
<a name="l04031"></a>04031 
<a name="l04032"></a>04032 <span class="comment">/*</span>
<a name="l04033"></a>04033 <span class="comment"> * Homogenize the reservation tables to make them more regular, easier</span>
<a name="l04034"></a>04034 <span class="comment"> * to optimize, and easier for the scheduler to handle.</span>
<a name="l04035"></a>04035 <span class="comment"> * </span>
<a name="l04036"></a>04036 <span class="comment"> * The most important/complicated transformation:</span>
<a name="l04037"></a>04037 <span class="comment"> *</span>
<a name="l04038"></a>04038 <span class="comment"> *   Transform reservation tables so that each table option can be tested</span>
<a name="l04039"></a>04039 <span class="comment"> *   independently to see if resources available.  This cannot be done</span>
<a name="l04040"></a>04040 <span class="comment"> *   if table options can interact with each other (try to allocate the</span>
<a name="l04041"></a>04041 <span class="comment"> *   same resource at the same time.)  For example, some</span>
<a name="l04042"></a>04042 <span class="comment"> *   reservation tables (I.e., Sparc) have something like:</span>
<a name="l04043"></a>04043 <span class="comment"> *</span>
<a name="l04044"></a>04044 <span class="comment"> *     RL_Ialu (use (RU_any_rp[0,1,2,3]_t0 RU_any_rp[0,1,2,3]_t0 ...)</span>
<a name="l04045"></a>04045 <span class="comment"> *</span>
<a name="l04046"></a>04046 <span class="comment"> *   Trying to allocate two register read ports from the same list of</span>
<a name="l04047"></a>04047 <span class="comment"> *   read ports.  Rewrite this resource tables (creating four new</span>
<a name="l04048"></a>04048 <span class="comment"> *   tables) so the scheduler does not have to deal with it (very</span>
<a name="l04049"></a>04049 <span class="comment"> *   nasty stuff to handle in the scheduler, only the core modules</span>
<a name="l04050"></a>04050 <span class="comment"> *   handled it in the version1 scheduler).</span>
<a name="l04051"></a>04051 <span class="comment"> *   </span>
<a name="l04052"></a>04052 <span class="comment"> *   If there are 4 overlapping options, will rewrite as four separate</span>
<a name="l04053"></a>04053 <span class="comment"> *   reservation tables:</span>
<a name="l04054"></a>04054 <span class="comment"> *</span>
<a name="l04055"></a>04055 <span class="comment"> *     RL_Ialu~1 (use (RU_rp[0]_t0~1 RU_any_rp[1,2,3]_t0 ..)) </span>
<a name="l04056"></a>04056 <span class="comment"> *     RL_Ialu~2 (use (RU_rp[1]_t0~1 RU_any_rp[0,2,3]_t0 ..)) </span>
<a name="l04057"></a>04057 <span class="comment"> *     RL_Ialu~3 (use (RU_rp[2]_t0~1 RU_any_rp[0,1,3]_t0 ..)) </span>
<a name="l04058"></a>04058 <span class="comment"> *     RL_Ialu~4 (use (RU_rp[3]_t0~1 RU_any_rp[0,1,2]_t0 ..)) </span>
<a name="l04059"></a>04059 <span class="comment"> *   </span>
<a name="l04060"></a>04060 <span class="comment"> *   Fix up any use of this reservation table, to use all the varations</span>
<a name="l04061"></a>04061 <span class="comment"> *   instead. (~# is added to all entries created by the customizer).</span>
<a name="l04062"></a>04062 <span class="comment"> *</span>
<a name="l04063"></a>04063 <span class="comment"> *   Recurse as necessary to handle other conflicts.  The mdes writer</span>
<a name="l04064"></a>04064 <span class="comment"> *   could probably come up with a better solution by hand, and probably</span>
<a name="l04065"></a>04065 <span class="comment"> *   should rewrite their mdes to prevent the customizer from having to</span>
<a name="l04066"></a>04066 <span class="comment"> *   do this brute force method.  For example, the above could become:</span>
<a name="l04067"></a>04067 <span class="comment"> *   </span>
<a name="l04068"></a>04068 <span class="comment"> *     RL_Ialu (use (RU_any_rp_pair_t0 ...)</span>
<a name="l04069"></a>04069 <span class="comment"> *     </span>
<a name="l04070"></a>04070 <span class="comment"> *   where any_rp_pair was rp0+rp1, rp1+rp2, or rp2+rp3.</span>
<a name="l04071"></a>04071 <span class="comment"> *</span>
<a name="l04072"></a>04072 <span class="comment"> * Other transformations to make the links more uniform:</span>
<a name="l04073"></a>04073 <span class="comment"> *   1) Consolidate all resource usages and resource units in each reservation</span>
<a name="l04074"></a>04074 <span class="comment"> *      table into one big resource unit.  This way there are only </span>
<a name="l04075"></a>04075 <span class="comment"> *      resource_unit and table_option links in the reservation table.</span>
<a name="l04076"></a>04076 <span class="comment"> *      It also facilates 3) below.</span>
<a name="l04077"></a>04077 <span class="comment"> *</span>
<a name="l04078"></a>04078 <span class="comment"> *   2) For each table option, place any resource usages into a resource unit.</span>
<a name="l04079"></a>04079 <span class="comment"> *      This way there are only resource_unit links in a table option.</span>
<a name="l04080"></a>04080 <span class="comment"> *      It also facilates 3) below.</span>
<a name="l04081"></a>04081 <span class="comment"> *   </span>
<a name="l04082"></a>04082 <span class="comment"> *   3) Break up each resource usage so that only one resource and one</span>
<a name="l04083"></a>04083 <span class="comment"> *      time is specified for each usage.  This requires adding new</span>
<a name="l04084"></a>04084 <span class="comment"> *      resource usages for each time/resource combination.  It is </span>
<a name="l04085"></a>04085 <span class="comment"> *      facilitated by 1 &amp; 2 above, since all resource usages are only</span>
<a name="l04086"></a>04086 <span class="comment"> *      in resource_unit entries, which are easy to add to!</span>
<a name="l04087"></a>04087 <span class="comment"> *      (This also facilitates bit field optimizations which will put</span>
<a name="l04088"></a>04088 <span class="comment"> *       together entries for the same cycle and the same 32-bit word)</span>
<a name="l04089"></a>04089 <span class="comment"> */</span>
<a name="l04090"></a>04090 <span class="keywordtype">void</span>
<a name="l04091"></a><a class="code" href="lmdes2__customizer_8c.html#3f2c2ef62b99bf93eba2656e2f742c67">04091</a> <a class="code" href="lmdes2__customizer_8c.html#3f2c2ef62b99bf93eba2656e2f742c67">homogenize_reservation_tables</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l04092"></a>04092 {
<a name="l04093"></a>04093   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section, *option_section, *ru_section;
<a name="l04094"></a>04094   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *option_entry, *ru_entry;
<a name="l04095"></a>04095   <span class="keywordtype">int</span> entries_added;
<a name="l04096"></a>04096 
<a name="l04097"></a>04097   <span class="comment">/* Assume no entries will be added */</span>
<a name="l04098"></a>04098   entries_added = 0;
<a name="l04099"></a>04099 
<a name="l04100"></a>04100   <span class="comment">/* Scan every reservation table entry, including those added by</span>
<a name="l04101"></a>04101 <span class="comment">   * CU_make_res_table_orthogonal(), to make (via transformations)</span>
<a name="l04102"></a>04102 <span class="comment">   * all the reservation table option orthoginal to each other.</span>
<a name="l04103"></a>04103 <span class="comment">   * See the comment at the top of this function for details.</span>
<a name="l04104"></a>04104 <span class="comment">   */</span>
<a name="l04105"></a>04105   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l04106"></a>04106   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04107"></a>04107        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l04108"></a>04108     {
<a name="l04109"></a>04109       entries_added += <a class="code" href="lmdes2__customizer_8c.html#5b210418b87ea11a38a9685106fcadb0">CU_make_res_table_orthogonal</a> (table_entry);
<a name="l04110"></a>04110       <a class="code" href="lmdes2__customizer_8c.html#0ef75bfb7f290b6513271853e6fd74fc">CU_consolidate_res_table_usages</a> (table_entry);
<a name="l04111"></a>04111     }
<a name="l04112"></a>04112 
<a name="l04113"></a>04113 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l04114"></a>04114 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (entries_added &gt; 0)
<a name="l04115"></a>04115     {
<a name="l04116"></a>04116       printf
<a name="l04117"></a>04117         (<span class="stringliteral">"&gt; Customizer created %i new reservation tables in order to simply "</span>
<a name="l04118"></a>04118          <span class="stringliteral">"scheduling.\n"</span>,
<a name="l04119"></a>04119          entries_added);
<a name="l04120"></a>04120     }
<a name="l04121"></a>04121 <span class="preprocessor">#endif</span>
<a name="l04122"></a>04122 <span class="preprocessor"></span>
<a name="l04123"></a>04123   <span class="comment">/* Change all the Table_Option entries so that they only use</span>
<a name="l04124"></a>04124 <span class="comment">   * resource units (Create units as necessary).  This makes</span>
<a name="l04125"></a>04125 <span class="comment">   * the mdes more uniform and facilates the bit field optimizations</span>
<a name="l04126"></a>04126 <span class="comment">   * we will be doing below.</span>
<a name="l04127"></a>04127 <span class="comment">   * </span>
<a name="l04128"></a>04128 <span class="comment">   * This transformation required in order for IMPACT to use mdes.</span>
<a name="l04129"></a>04129 <span class="comment">   */</span>
<a name="l04130"></a>04130   option_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l04131"></a>04131   <span class="keywordflow">for</span> (option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (option_section);
<a name="l04132"></a>04132        option_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (option_entry))
<a name="l04133"></a>04133     {
<a name="l04134"></a>04134       <a class="code" href="lmdes2__customizer_8c.html#722d64044c191dff9b39056217e3cb8a">CU_homogenize_table_options</a> (option_entry);
<a name="l04135"></a>04135     }
<a name="l04136"></a>04136 
<a name="l04137"></a>04137 
<a name="l04138"></a>04138   <span class="comment">/* Change all resource usages so that only one time is specified per</span>
<a name="l04139"></a>04139 <span class="comment">   * usage.  (Creates additional resource usages if there are multiple </span>
<a name="l04140"></a>04140 <span class="comment">   * times).  This makes the mdes more uniform and facilates the bit field </span>
<a name="l04141"></a>04141 <span class="comment">   * optimizations we will be doing below.</span>
<a name="l04142"></a>04142 <span class="comment">   *</span>
<a name="l04143"></a>04143 <span class="comment">   * This transformation required in order for IMPACT to use mdes.</span>
<a name="l04144"></a>04144 <span class="comment">   */</span>
<a name="l04145"></a>04145   ru_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l04146"></a>04146   <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04147"></a>04147        ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l04148"></a>04148     {
<a name="l04149"></a>04149       <a class="code" href="lmdes2__customizer_8c.html#3332767efcdc1ab552393d010b97bf22">CU_homogenize_resource_usages</a> (ru_entry);
<a name="l04150"></a>04150     }
<a name="l04151"></a>04151 
<a name="l04152"></a>04152   <span class="comment">/* Shift the resource times that no resource usage time is less than 0. </span>
<a name="l04153"></a>04153 <span class="comment">   * For opti_level &gt;= 3 try to minimize to number of different times that</span>
<a name="l04154"></a>04154 <span class="comment">   * resources are used to try to maximize the effect of the bit field </span>
<a name="l04155"></a>04155 <span class="comment">   * optimizations.  Will just move each resource usage so that it's </span>
<a name="l04156"></a>04156 <span class="comment">   * earlies usage is always time 0.</span>
<a name="l04157"></a>04157 <span class="comment">   *</span>
<a name="l04158"></a>04158 <span class="comment">   * IMPACT requires that all requires usage times be &gt;= 0.</span>
<a name="l04159"></a>04159 <span class="comment">   */</span>
<a name="l04160"></a>04160   <a class="code" href="lmdes2__customizer_8c.html#772a2fd220caf518585c5ed7bfe622be">CU_optimize_resource_usage_times</a> (md);
<a name="l04161"></a>04161 
<a name="l04162"></a>04162   <span class="comment">/* </span>
<a name="l04163"></a>04163 <span class="comment">   * Applies transformations for opti_levels &gt;= 3 only.</span>
<a name="l04164"></a>04164 <span class="comment">   *</span>
<a name="l04165"></a>04165 <span class="comment">   * Sort the Reseveration_Table-&gt;use() links and Resource_Unit-&gt;use()</span>
<a name="l04166"></a>04166 <span class="comment">   * links so that resources will be distributed the same in the various</span>
<a name="l04167"></a>04167 <span class="comment">   * forms of the same table, and so that the classical optimizations</span>
<a name="l04168"></a>04168 <span class="comment">   * can detect these duplicate tables consistently.</span>
<a name="l04169"></a>04169 <span class="comment">   * </span>
<a name="l04170"></a>04170 <span class="comment">   * It also places checks near time 0 first, and reorders the</span>
<a name="l04171"></a>04171 <span class="comment">   * AND-OR trees (if opti_level &gt;= 4) to place most restrictive </span>
<a name="l04172"></a>04172 <span class="comment">   * checks first.</span>
<a name="l04173"></a>04173 <span class="comment">   *</span>
<a name="l04174"></a>04174 <span class="comment">   * Don't limit the reordering.  This makes all lists have a set order,</span>
<a name="l04175"></a>04175 <span class="comment">   * so common subexpression works as well as possible.</span>
<a name="l04176"></a>04176 <span class="comment">   */</span>
<a name="l04177"></a>04177   <a class="code" href="lmdes2__customizer_8c.html#09e11110f5b6a98ed4d840057dc1e125">CU_order_use_fields</a> (md, 0);
<a name="l04178"></a>04178 
<a name="l04179"></a>04179   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 5) &amp;&amp; <a class="code" href="lmdes2__customizer_8c.html#b8dfd5ac67573c68c04e14078ea2aeee">tree_opti</a>)
<a name="l04180"></a>04180     {
<a name="l04181"></a>04181       <span class="comment">/* Distribute the unconditional usages into the different table options</span>
<a name="l04182"></a>04182 <span class="comment">       * so that they may be optimized together.</span>
<a name="l04183"></a>04183 <span class="comment">       */</span>
<a name="l04184"></a>04184       <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04185"></a>04185            table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l04186"></a>04186         {
<a name="l04187"></a>04187           <a class="code" href="lmdes2__customizer_8c.html#edcc55f67d62d16fa42c8dc98dec4a43">CU_distribute_unconditional_usages</a> (table_entry);
<a name="l04188"></a>04188         }
<a name="l04189"></a>04189     }
<a name="l04190"></a>04190 
<a name="l04191"></a>04191   <span class="comment">/* To try to make opti_level 0 comparisons as fair as possible,</span>
<a name="l04192"></a>04192 <span class="comment">   * try to minimize the number of new entries added due to the above.</span>
<a name="l04193"></a>04193 <span class="comment">   * This will only eliminate entries with a "~" in the name.</span>
<a name="l04194"></a>04194 <span class="comment">   */</span>
<a name="l04195"></a>04195   {
<a name="l04196"></a>04196     <span class="keywordtype">int</span> change;
<a name="l04197"></a>04197 
<a name="l04198"></a>04198     change = 1;
<a name="l04199"></a>04199     <span class="keywordflow">while</span> (change != 0)
<a name="l04200"></a>04200       {
<a name="l04201"></a>04201         change = 0;
<a name="l04202"></a>04202         change += <a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">eliminate_redundant_new_entries_only</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l04203"></a>04203         change += <a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">eliminate_redundant_new_entries_only</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l04204"></a>04204         change += <a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">eliminate_redundant_new_entries_only</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l04205"></a>04205       }
<a name="l04206"></a>04206   }
<a name="l04207"></a>04207 }
<a name="l04208"></a>04208 
<a name="l04209"></a>04209 <span class="comment">/* Check the resource usages and resource units to make sure that</span>
<a name="l04210"></a>04210 <span class="comment"> * they are legal (not trying to use a resource twice at the same time!)</span>
<a name="l04211"></a>04211 <span class="comment"> */</span>
<a name="l04212"></a>04212 <span class="keywordtype">void</span>
<a name="l04213"></a><a class="code" href="lmdes2__customizer_8c.html#2fcefe048bbfcd44785ed45ad58bde9d">04213</a> <a class="code" href="lmdes2__customizer_8c.html#2fcefe048bbfcd44785ed45ad58bde9d">check_for_unconditional_overlap</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l04214"></a>04214 {
<a name="l04215"></a>04215   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *ru_section, *unit_section;
<a name="l04216"></a>04216   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *ru_entry, *unit_entry, *resource1, *resource2, *ru1, *ru2;
<a name="l04217"></a>04217   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field;
<a name="l04218"></a>04218   <span class="keywordtype">int</span> index1, index2;
<a name="l04219"></a>04219 
<a name="l04220"></a>04220   <span class="comment">/* Check resource usages for multiple uses of the same resource */</span>
<a name="l04221"></a>04221   ru_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l04222"></a>04222 
<a name="l04223"></a>04223   <span class="comment">/* Scan each resource usage for the use of the same resource twice */</span>
<a name="l04224"></a>04224   <span class="keywordflow">for</span> (ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (ru_section); ru_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04225"></a>04225        ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (ru_entry))
<a name="l04226"></a>04226     {
<a name="l04227"></a>04227       <span class="comment">/* Scan all the uses for duplicates */</span>
<a name="l04228"></a>04228       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"use"</span>);
<a name="l04229"></a>04229       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04230"></a>04230         {
<a name="l04231"></a>04231           resource1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l04232"></a>04232 
<a name="l04233"></a>04233           <span class="keywordflow">for</span> (index2 = index1 + 1; index2 &lt;= use_field-&gt;max_element_index;
<a name="l04234"></a>04234                index2++)
<a name="l04235"></a>04235             {
<a name="l04236"></a>04236               resource2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l04237"></a>04237 
<a name="l04238"></a>04238               <span class="keywordflow">if</span> (resource1 == resource2)
<a name="l04239"></a>04239                 {
<a name="l04240"></a>04240                   fprintf (stderr,
<a name="l04241"></a>04241                            <span class="stringliteral">"Invalid Resource_Usage %s:\n"</span>
<a name="l04242"></a>04242                            <span class="stringliteral">"  %s is used by both use[%i] and use[%i]!\n"</span>,
<a name="l04243"></a>04243                            ru_entry-&gt;name, resource1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index1, index2);
<a name="l04244"></a>04244 
<a name="l04245"></a>04245                   <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l04246"></a>04246                 }
<a name="l04247"></a>04247             }
<a name="l04248"></a>04248         }
<a name="l04249"></a>04249     }
<a name="l04250"></a>04250 
<a name="l04251"></a>04251   <span class="comment">/* Scan each resource unit for the use of the same resource twice at the</span>
<a name="l04252"></a>04252 <span class="comment">   * same time.</span>
<a name="l04253"></a>04253 <span class="comment">   */</span>
<a name="l04254"></a>04254   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l04255"></a>04255   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04256"></a>04256        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l04257"></a>04257     {
<a name="l04258"></a>04258       <span class="comment">/* Scan all the uses for duplicates */</span>
<a name="l04259"></a>04259       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04260"></a>04260       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04261"></a>04261         {
<a name="l04262"></a>04262           ru1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l04263"></a>04263           <span class="keywordflow">for</span> (index2 = index1 + 1; index2 &lt;= use_field-&gt;max_element_index;
<a name="l04264"></a>04264                index2++)
<a name="l04265"></a>04265             {
<a name="l04266"></a>04266               ru2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l04267"></a>04267 
<a name="l04268"></a>04268               <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#409c425142d1a29b7cd608ce586bb35a">CU_overlapping_resource_usage</a> (ru1, ru2))
<a name="l04269"></a>04269                 {
<a name="l04270"></a>04270                   fprintf (stderr,
<a name="l04271"></a>04271                            <span class="stringliteral">"Invalid Resource_Unit %s:\n"</span>
<a name="l04272"></a>04272                            <span class="stringliteral">"  The same resource (at the same time) is"</span>
<a name="l04273"></a>04273                            <span class="stringliteral">" required by\n"</span>
<a name="l04274"></a>04274                            <span class="stringliteral">"  use[%i] (%s) and use[%i] (%s)!\n"</span>,
<a name="l04275"></a>04275                            unit_entry-&gt;name, index1, ru1-&gt;name,
<a name="l04276"></a>04276                            index2, ru2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04277"></a>04277 
<a name="l04278"></a>04278                   <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l04279"></a>04279                 }
<a name="l04280"></a>04280             }
<a name="l04281"></a>04281         }
<a name="l04282"></a>04282     }
<a name="l04283"></a>04283 }
<a name="l04284"></a>04284 
<a name="l04285"></a>04285 <span class="comment">/* Assign an location of each the resources in the resource map</span>
<a name="l04286"></a>04286 <span class="comment"> * used  by the scheduler manager.</span>
<a name="l04287"></a>04287 <span class="comment"> *</span>
<a name="l04288"></a>04288 <span class="comment"> * May want to do 'bit' allocation in the future to allow better</span>
<a name="l04289"></a>04289 <span class="comment"> * optimization of resource units when there are more than 32 resources.</span>
<a name="l04290"></a>04290 <span class="comment"> */</span>
<a name="l04291"></a>04291 <span class="keywordtype">int</span>
<a name="l04292"></a><a class="code" href="lmdes2__customizer_8c.html#80f65397ab1027641ff4bae7d6b48595">04292</a> <a class="code" href="lmdes2__customizer_8c.html#80f65397ab1027641ff4bae7d6b48595">assign_resource_map_locations</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l04293"></a>04293 {
<a name="l04294"></a>04294   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_section;
<a name="l04295"></a>04295   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource_entry;
<a name="l04296"></a>04296   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *location_field_decl;
<a name="l04297"></a>04297   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *location_field;
<a name="l04298"></a>04298   <span class="keywordtype">int</span> offset, index;
<a name="l04299"></a>04299 
<a name="l04300"></a>04300   <span class="comment">/* Get the resource section */</span>
<a name="l04301"></a>04301   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l04302"></a>04302 
<a name="l04303"></a>04303   <span class="comment">/* Remove any previous versions of the map_location field */</span>
<a name="l04304"></a>04304   location_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (resource_section, <span class="stringliteral">"map_location"</span>);
<a name="l04305"></a>04305   <span class="keywordflow">if</span> (location_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04306"></a>04306     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (location_field_decl);
<a name="l04307"></a>04307 
<a name="l04308"></a>04308   <span class="comment">/* Create a required field that takes two integers (the offset then</span>
<a name="l04309"></a>04309 <span class="comment">   * the index)</span>
<a name="l04310"></a>04310 <span class="comment">   */</span>
<a name="l04311"></a>04311   location_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (resource_section,
<a name="l04312"></a>04312                                            <span class="stringliteral">"map_location"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l04313"></a>04313   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (location_field_decl, 0);
<a name="l04314"></a>04314   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (location_field_decl, 1);
<a name="l04315"></a>04315 
<a name="l04316"></a>04316 
<a name="l04317"></a>04317   <span class="comment">/* Assign offset and index sequentially to the resources */</span>
<a name="l04318"></a>04318   offset = 0;
<a name="l04319"></a>04319   index = -1;
<a name="l04320"></a>04320   <span class="keywordflow">for</span> (resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (resource_section);
<a name="l04321"></a>04321        resource_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04322"></a>04322        resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource_entry))
<a name="l04323"></a>04323     {
<a name="l04324"></a>04324       <span class="comment">/* Calculate the offset/index for this resource */</span>
<a name="l04325"></a>04325       index++;
<a name="l04326"></a>04326       <span class="keywordflow">if</span> (index &gt; 31)
<a name="l04327"></a>04327         {
<a name="l04328"></a>04328           index = 0;
<a name="l04329"></a>04329           offset++;
<a name="l04330"></a>04330         }
<a name="l04331"></a>04331 
<a name="l04332"></a>04332       <span class="comment">/* Create a location field for each resource */</span>
<a name="l04333"></a>04333       location_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (resource_entry, location_field_decl, 2);
<a name="l04334"></a>04334 
<a name="l04335"></a>04335       <span class="comment">/* Set the offset and index */</span>
<a name="l04336"></a>04336       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (location_field, 0, offset);
<a name="l04337"></a>04337       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (location_field, 1, index);
<a name="l04338"></a>04338     }
<a name="l04339"></a>04339 
<a name="l04340"></a>04340   <span class="comment">/* For now, return max offset */</span>
<a name="l04341"></a>04341   <span class="keywordflow">return</span> (offset);
<a name="l04342"></a>04342 }
<a name="l04343"></a>04343 
<a name="l04344"></a>04344 <span class="keywordtype">int</span>
<a name="l04345"></a><a class="code" href="lmdes2__customizer_8c.html#9676b54b21aedb75cd1024a8d8192b82">04345</a> <a class="code" href="lmdes2__customizer_8c.html#9676b54b21aedb75cd1024a8d8192b82">usage_common_to_all_options</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * ru_entry)
<a name="l04346"></a>04346 {
<a name="l04347"></a>04347   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *usage_entry;
<a name="l04348"></a>04348   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field;
<a name="l04349"></a>04349   <span class="keywordtype">int</span> index1, index2, found;
<a name="l04350"></a>04350 
<a name="l04351"></a>04351   <span class="comment">/* Test every unit in this option to see if it has this ru_entry */</span>
<a name="l04352"></a>04352   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l04353"></a>04353   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04354"></a>04354     {
<a name="l04355"></a>04355       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l04356"></a>04356       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04357"></a>04357 
<a name="l04358"></a>04358       <span class="comment">/* See if ru_entry is in this option */</span>
<a name="l04359"></a>04359       found = 0;
<a name="l04360"></a>04360       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l04361"></a>04361         {
<a name="l04362"></a>04362           usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l04363"></a>04363 
<a name="l04364"></a>04364           <span class="comment">/* Assume optimizations have been done so can just compair</span>
<a name="l04365"></a>04365 <span class="comment">           * ru_entry pointers instead of contents.</span>
<a name="l04366"></a>04366 <span class="comment">           */</span>
<a name="l04367"></a>04367           <span class="keywordflow">if</span> (usage_entry == ru_entry)
<a name="l04368"></a>04368             {
<a name="l04369"></a>04369               found = 1;
<a name="l04370"></a>04370             }
<a name="l04371"></a>04371         }
<a name="l04372"></a>04372 
<a name="l04373"></a>04373       <span class="comment">/* If ru_entry is not in this option, return 0 */</span>
<a name="l04374"></a>04374       <span class="keywordflow">if</span> (!found)
<a name="l04375"></a>04375         <span class="keywordflow">return</span> (0);
<a name="l04376"></a>04376     }
<a name="l04377"></a>04377 
<a name="l04378"></a>04378   <span class="comment">/* If got here, ru_entry must be every unit in this option */</span>
<a name="l04379"></a>04379   <span class="keywordflow">return</span> (1);
<a name="l04380"></a>04380 }
<a name="l04381"></a>04381 
<a name="l04382"></a>04382 <span class="keywordtype">int</span>
<a name="l04383"></a><a class="code" href="lmdes2__customizer_8c.html#b3184354774cd9adb6c800a4751ca015">04383</a> <a class="code" href="lmdes2__customizer_8c.html#b3184354774cd9adb6c800a4751ca015">option_usage_common_at_time</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * usage_entry)
<a name="l04384"></a>04384 {
<a name="l04385"></a>04385   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *ru_entry;
<a name="l04386"></a>04386   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field, *time_field;
<a name="l04387"></a>04387   <span class="keywordtype">int</span> index1, ru_time, usage_time;
<a name="l04388"></a>04388 
<a name="l04389"></a>04389   <span class="comment">/* Get the time for this usage */</span>
<a name="l04390"></a>04390   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"time"</span>);
<a name="l04391"></a>04391   usage_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l04392"></a>04392 
<a name="l04393"></a>04393   <span class="comment">/* Test only the ru_entries in the first unit of the option at</span>
<a name="l04394"></a>04394 <span class="comment">   * the specified time.</span>
<a name="l04395"></a>04395 <span class="comment">   */</span>
<a name="l04396"></a>04396   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l04397"></a>04397   unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, 0);
<a name="l04398"></a>04398   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04399"></a>04399 
<a name="l04400"></a>04400   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04401"></a>04401     {
<a name="l04402"></a>04402       ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l04403"></a>04403 
<a name="l04404"></a>04404       time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"time"</span>);
<a name="l04405"></a>04405       ru_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, 0);
<a name="l04406"></a>04406 
<a name="l04407"></a>04407       <span class="comment">/* Only test ru_entry's with usage_time */</span>
<a name="l04408"></a>04408       <span class="keywordflow">if</span> (ru_time != usage_time)
<a name="l04409"></a>04409         <span class="keywordflow">continue</span>;
<a name="l04410"></a>04410 
<a name="l04411"></a>04411       <span class="comment">/* If this ru_entry is not common to all options, return 0 now */</span>
<a name="l04412"></a>04412       <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#9676b54b21aedb75cd1024a8d8192b82">usage_common_to_all_options</a> (option_entry, ru_entry))
<a name="l04413"></a>04413         <span class="keywordflow">return</span> (0);
<a name="l04414"></a>04414     }
<a name="l04415"></a>04415 
<a name="l04416"></a>04416   <span class="comment">/* If got here, all usages at this time (for the first unit) must</span>
<a name="l04417"></a>04417 <span class="comment">   * be common.</span>
<a name="l04418"></a>04418 <span class="comment">   */</span>
<a name="l04419"></a>04419   <span class="keywordflow">return</span> (1);
<a name="l04420"></a>04420 }
<a name="l04421"></a>04421 
<a name="l04422"></a>04422 
<a name="l04423"></a>04423 <span class="keywordtype">void</span>
<a name="l04424"></a><a class="code" href="lmdes2__customizer_8c.html#bd8894f969d13c98f666bbf98a5383a3">04424</a> <a class="code" href="lmdes2__customizer_8c.html#bd8894f969d13c98f666bbf98a5383a3">remove_common_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * usage_entry)
<a name="l04425"></a>04425 {
<a name="l04426"></a>04426   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *ru_entry, *new_unit_entry;
<a name="l04427"></a>04427   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field, *new_use_field;
<a name="l04428"></a>04428   <span class="keywordtype">int</span> index1, index2, found;
<a name="l04429"></a>04429 
<a name="l04430"></a>04430   <span class="comment">/* Remove the usage from each option */</span>
<a name="l04431"></a>04431   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l04432"></a>04432   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04433"></a>04433     {
<a name="l04434"></a>04434       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l04435"></a>04435       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04436"></a>04436 
<a name="l04437"></a>04437       found = 0;
<a name="l04438"></a>04438       <span class="keywordflow">for</span> (index2 = use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2 &gt;= 0; index2--)
<a name="l04439"></a>04439         {
<a name="l04440"></a>04440           ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l04441"></a>04441 
<a name="l04442"></a>04442           <span class="keywordflow">if</span> (ru_entry == usage_entry)
<a name="l04443"></a>04443             {
<a name="l04444"></a>04444               found = 1;
<a name="l04445"></a>04445 
<a name="l04446"></a>04446               <span class="comment">/* Duplicate this unit so we can delete link */</span>
<a name="l04447"></a>04447               new_unit_entry = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (unit_entry);
<a name="l04448"></a>04448 
<a name="l04449"></a>04449 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04450"></a>04450 <span class="preprocessor"></span>              printf (<span class="stringliteral">"Creating %s to remove %s\n"</span>, new_unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l04451"></a>04451                       usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04452"></a>04452 <span class="preprocessor">#endif</span>
<a name="l04453"></a>04453 <span class="preprocessor"></span>
<a name="l04454"></a>04454               <span class="comment">/* Replace old unit with this new unit */</span>
<a name="l04455"></a>04455               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (one_of_field, index1, new_unit_entry);
<a name="l04456"></a>04456 
<a name="l04457"></a>04457               new_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04458"></a>04458               <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (new_use_field, index2);
<a name="l04459"></a>04459               <span class="keywordflow">break</span>;
<a name="l04460"></a>04460             }
<a name="l04461"></a>04461         }
<a name="l04462"></a>04462 
<a name="l04463"></a>04463       <span class="comment">/* Better have been found */</span>
<a name="l04464"></a>04464       <span class="keywordflow">if</span> (!found)
<a name="l04465"></a>04465         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"remove_common_usage: %s not found in %s[%i]!"</span>,
<a name="l04466"></a>04466                 usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, index1);
<a name="l04467"></a>04467     }
<a name="l04468"></a>04468 }
<a name="l04469"></a>04469 
<a name="l04470"></a>04470 
<a name="l04471"></a>04471 
<a name="l04472"></a>04472 <span class="keywordtype">void</span>
<a name="l04473"></a><a class="code" href="lmdes2__customizer_8c.html#f2197180102ce352a30d4087b462e14e">04473</a> <a class="code" href="lmdes2__customizer_8c.html#f2197180102ce352a30d4087b462e14e">CU_coalesce_unconditional_usages</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l04474"></a>04474 {
<a name="l04475"></a>04475   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section, *unit_section;
<a name="l04476"></a>04476   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *unit_entry, *option_entry, *first_unit, *ru_entry;
<a name="l04477"></a>04477   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_use_field, *unit_use_field, *one_of_field;
<a name="l04478"></a>04478   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *uncond_use_field;
<a name="l04479"></a>04479   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *unit_use_field_decl;
<a name="l04480"></a>04480   <span class="keywordtype">int</span> index1, index2, num_pulled_out, unit_index;
<a name="l04481"></a>04481   <span class="keywordtype">char</span> name_buf[5000];
<a name="l04482"></a>04482 
<a name="l04483"></a>04483   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l04484"></a>04484   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04485"></a>04485        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l04486"></a>04486     {
<a name="l04487"></a>04487 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l04488"></a>04488       printf (<span class="stringliteral">"Testing table %s\n"</span>, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04489"></a>04489 <span class="preprocessor">#endif</span>
<a name="l04490"></a>04490 <span class="preprocessor"></span>
<a name="l04491"></a>04491       table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l04492"></a>04492 
<a name="l04493"></a>04493       <span class="comment">/* Find the unit entry, if any for this table */</span>
<a name="l04494"></a>04494       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04495"></a>04495       unit_index = -1;
<a name="l04496"></a>04496       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04497"></a>04497         {
<a name="l04498"></a>04498           option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l04499"></a>04499           <span class="keywordflow">if</span> (strcmp (option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l04500"></a>04500             {
<a name="l04501"></a>04501               unit_entry = option_entry;
<a name="l04502"></a>04502               unit_index = index1;
<a name="l04503"></a>04503               <span class="keywordflow">break</span>;
<a name="l04504"></a>04504             }
<a name="l04505"></a>04505         }
<a name="l04506"></a>04506 
<a name="l04507"></a>04507       num_pulled_out = 0;
<a name="l04508"></a>04508 
<a name="l04509"></a>04509       <span class="comment">/* Test each option, if each unit in the option uses the same</span>
<a name="l04510"></a>04510 <span class="comment">       * resources at the same time (all the usages at that time</span>
<a name="l04511"></a>04511 <span class="comment">       * must be the same), pull out the usages into the unconditional</span>
<a name="l04512"></a>04512 <span class="comment">       * unit.</span>
<a name="l04513"></a>04513 <span class="comment">       */</span>
<a name="l04514"></a>04514       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l04515"></a>04515         {
<a name="l04516"></a>04516           option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l04517"></a>04517 
<a name="l04518"></a>04518           <span class="comment">/* Only process options */</span>
<a name="l04519"></a>04519           <span class="keywordflow">if</span> (strcmp (option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) != 0)
<a name="l04520"></a>04520             <span class="keywordflow">continue</span>;
<a name="l04521"></a>04521 
<a name="l04522"></a>04522 
<a name="l04523"></a>04523           <span class="comment">/* Get the unit for option one */</span>
<a name="l04524"></a>04524           one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l04525"></a>04525           first_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, 0);
<a name="l04526"></a>04526           unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (first_unit, <span class="stringliteral">"use"</span>);
<a name="l04527"></a>04527 
<a name="l04528"></a>04528 
<a name="l04529"></a>04529           <span class="keywordflow">for</span> (index2 = unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2 &gt;= 0;
<a name="l04530"></a>04530                index2--)
<a name="l04531"></a>04531             {
<a name="l04532"></a>04532               ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index2);
<a name="l04533"></a>04533 
<a name="l04534"></a>04534               <span class="comment">/* If this ru_entry cannot be extracted into the </span>
<a name="l04535"></a>04535 <span class="comment">               * unconditionally executed unit, goto the next ru_entry.</span>
<a name="l04536"></a>04536 <span class="comment">               */</span>
<a name="l04537"></a>04537               <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#b3184354774cd9adb6c800a4751ca015">option_usage_common_at_time</a> (option_entry, ru_entry))
<a name="l04538"></a>04538                 <span class="keywordflow">continue</span>;
<a name="l04539"></a>04539 
<a name="l04540"></a>04540 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04541"></a>04541 <span class="preprocessor"></span>              printf (<span class="stringliteral">"  %s common to all units in %s\n"</span>,
<a name="l04542"></a>04542                       ru_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, option_entry-&gt;name);
<a name="l04543"></a>04543 <span class="preprocessor">#endif</span>
<a name="l04544"></a>04544 <span class="preprocessor"></span>
<a name="l04545"></a>04545               <span class="comment">/* Duplicate existing unit or create new unit if this</span>
<a name="l04546"></a>04546 <span class="comment">               * is the first ru_entry pulled out.</span>
<a name="l04547"></a>04547 <span class="comment">               */</span>
<a name="l04548"></a>04548               <span class="keywordflow">if</span> (num_pulled_out == 0)
<a name="l04549"></a>04549                 {
<a name="l04550"></a>04550                   <span class="keywordflow">if</span> (unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04551"></a>04551                     {
<a name="l04552"></a>04552                       unit_entry = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (unit_entry);
<a name="l04553"></a>04553 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04554"></a>04554 <span class="preprocessor"></span>                      printf (<span class="stringliteral">"Duplicated '%s'\n"</span>, unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04555"></a>04555 <span class="preprocessor">#endif</span>
<a name="l04556"></a>04556 <span class="preprocessor"></span>                      <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, unit_index, unit_entry);
<a name="l04557"></a>04557                     }
<a name="l04558"></a>04558                   <span class="keywordflow">else</span>
<a name="l04559"></a>04559                     {
<a name="l04560"></a>04560                       unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l04561"></a>04561                       <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l04562"></a>04562                                           name_buf);
<a name="l04563"></a>04563                       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (unit_section, name_buf);
<a name="l04564"></a>04564 
<a name="l04565"></a>04565 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04566"></a>04566 <span class="preprocessor"></span>                      printf (<span class="stringliteral">"Created '%s'\n"</span>, unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04567"></a>04567 <span class="preprocessor">#endif</span>
<a name="l04568"></a>04568 <span class="preprocessor"></span>
<a name="l04569"></a>04569                       <span class="comment">/* Create the use field */</span>
<a name="l04570"></a>04570                       unit_use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (unit_section,
<a name="l04571"></a>04571                                                                 <span class="stringliteral">"use"</span>);
<a name="l04572"></a>04572                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (unit_entry, unit_use_field_decl, 1);
<a name="l04573"></a>04573                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field,
<a name="l04574"></a>04574                                    table_use_field-&gt;max_element_index + 1,
<a name="l04575"></a>04575                                    unit_entry);
<a name="l04576"></a>04576                     }
<a name="l04577"></a>04577                 }
<a name="l04578"></a>04578 
<a name="l04579"></a>04579               <span class="comment">/* Add this ru_entry to the unit */</span>
<a name="l04580"></a>04580               uncond_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04581"></a>04581               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (uncond_use_field,
<a name="l04582"></a>04582                            uncond_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, ru_entry);
<a name="l04583"></a>04583 
<a name="l04584"></a>04584               <span class="comment">/* Remove this ru_entry from all the option units */</span>
<a name="l04585"></a>04585               <a class="code" href="lmdes2__customizer_8c.html#bd8894f969d13c98f666bbf98a5383a3">remove_common_usage</a> (option_entry, ru_entry);
<a name="l04586"></a>04586 
<a name="l04587"></a>04587               num_pulled_out++;
<a name="l04588"></a>04588             }
<a name="l04589"></a>04589         }
<a name="l04590"></a>04590 
<a name="l04591"></a>04591     }
<a name="l04592"></a>04592 
<a name="l04593"></a>04593 }
<a name="l04594"></a>04594 
<a name="l04595"></a>04595 <span class="comment">/* Optimize the resource units for the bit map representation used by</span>
<a name="l04596"></a>04596 <span class="comment"> * the schedule manager to keep track of the resources used.</span>
<a name="l04597"></a>04597 <span class="comment"> * Want to combine resource usages for the same word in the map into one</span>
<a name="l04598"></a>04598 <span class="comment"> * entry, so that only one bit test is required.  This is done by</span>
<a name="l04599"></a>04599 <span class="comment"> * first sorting the resource usages by offset and bit location, then</span>
<a name="l04600"></a>04600 <span class="comment"> * combining the entries with the same offset.</span>
<a name="l04601"></a>04601 <span class="comment"> */</span>
<a name="l04602"></a>04602 <span class="keywordtype">void</span>
<a name="l04603"></a><a class="code" href="lmdes2__customizer_8c.html#2160faed9e117c61232adfb550843aaa">04603</a> <a class="code" href="lmdes2__customizer_8c.html#2160faed9e117c61232adfb550843aaa">optimize_resource_units</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">int</span> max_offset)
<a name="l04604"></a>04604 {
<a name="l04605"></a>04605   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section, *ru_section, *resource_section;
<a name="l04606"></a>04606   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry, *ru, *resource, *last_ru;
<a name="l04607"></a>04607   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *unit_use_field, *ru_use_field, *ru_time_field, *location_field;
<a name="l04608"></a>04608   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *last_ru_use_field;
<a name="l04609"></a>04609   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *ru_use_field_decl;
<a name="l04610"></a>04610   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structHeap.html">Heap</a> *heap;
<a name="l04611"></a>04611   <span class="keywordtype">int</span> index, use_time, map_offset, map_index, total_offset, last_offset;
<a name="l04612"></a>04612   <span class="keywordtype">int</span> num_words, time_shift, needs_dup;
<a name="l04613"></a>04613   <span class="keywordtype">int</span> cycle_offset;
<a name="l04614"></a>04614 <span class="preprocessor">#ifdef LP64_ARCHITECTURE</span>
<a name="l04615"></a>04615 <span class="preprocessor"></span>  <span class="keywordtype">long</span> time_count, sort_offset;
<a name="l04616"></a>04616 <span class="preprocessor">#else</span>
<a name="l04617"></a>04617 <span class="preprocessor"></span>  <span class="keywordtype">int</span> time_count, sort_offset;
<a name="l04618"></a>04618 <span class="preprocessor">#endif</span>
<a name="l04619"></a>04619 <span class="preprocessor"></span>  <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *time_table;
<a name="l04620"></a>04620   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time_symbol;
<a name="l04621"></a>04621 
<a name="l04622"></a>04622 
<a name="l04623"></a>04623   <span class="comment">/* Make sure the use field in the Resource_Usage section is </span>
<a name="l04624"></a>04624 <span class="comment">   * REQUIRED use(LINK(Resource) LINK(Resource)*) or make it</span>
<a name="l04625"></a>04625 <span class="comment">   * that way.  Expect the use field declaration to be the</span>
<a name="l04626"></a>04626 <span class="comment">   * above or REQUIRED use(LINK(Resource));</span>
<a name="l04627"></a>04627 <span class="comment">   */</span>
<a name="l04628"></a>04628   ru_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l04629"></a>04629   ru_use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (ru_section, <span class="stringliteral">"use"</span>);
<a name="l04630"></a>04630   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l04631"></a>04631 
<a name="l04632"></a>04632   <span class="comment">/* Do some testing to see if it is REQUIRED use(LINK(Resource)) */</span>
<a name="l04633"></a>04633   <span class="keywordflow">if</span> ((ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> == 0) &amp;&amp;
<a name="l04634"></a>04634       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#5f881765580aa53a9209df89120e46d7">kleene_starred</a> == 0) &amp;&amp;
<a name="l04635"></a>04635       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) &amp;&amp;
<a name="l04636"></a>04636       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] == resource_section))
<a name="l04637"></a>04637     {
<a name="l04638"></a>04638       <span class="comment">/* Add another resource link and kleene star it */</span>
<a name="l04639"></a>04639       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#cf268a6735d036c0166261196439a452">MD_require_link</a> (ru_use_field_decl, 1, resource_section);
<a name="l04640"></a>04640       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#b337c713035473e4b06c4125538f2a99">MD_kleene_star_requirement</a> (ru_use_field_decl, 1);
<a name="l04641"></a>04641     }
<a name="l04642"></a>04642 
<a name="l04643"></a>04643   <span class="comment">/* Punt if now not REQUIRED use(LINK(Resource) LINK(Resource)*)</span>
<a name="l04644"></a>04644 <span class="comment">   * Dont make this an 'else if' so this test gets exercised.</span>
<a name="l04645"></a>04645 <span class="comment">   */</span>
<a name="l04646"></a>04646   <span class="keywordflow">if</span> ((ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a> != 1) ||
<a name="l04647"></a>04647       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[1]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#5f881765580aa53a9209df89120e46d7">kleene_starred</a> != 1) ||
<a name="l04648"></a>04648       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l04649"></a>04649       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[1]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>) ||
<a name="l04650"></a>04650       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[0]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != resource_section) ||
<a name="l04651"></a>04651       (ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[1]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[0] != resource_section))
<a name="l04652"></a>04652     {
<a name="l04653"></a>04653       fprintf (stderr,
<a name="l04654"></a>04654                <span class="stringliteral">"\noptimize_resource_units: unexpected declaration "</span>
<a name="l04655"></a>04655                <span class="stringliteral">"for %s-&gt;%s:\n"</span>,
<a name="l04656"></a>04656                ru_section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, ru_use_field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l04657"></a>04657       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#da54c72928268acad4526ab846aa837d">MD_print_field_decl</a> (stderr, ru_use_field_decl, 80);
<a name="l04658"></a>04658       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"Fix customizer or this field's declaration."</span>);
<a name="l04659"></a>04659     }
<a name="l04660"></a>04660 
<a name="l04661"></a>04661 
<a name="l04662"></a>04662 
<a name="l04663"></a>04663 
<a name="l04664"></a>04664   <span class="comment">/* Calculate how much we need to shift the resource usage time in</span>
<a name="l04665"></a>04665 <span class="comment">   * order to get the true map offset.  In the resource manager,</span>
<a name="l04666"></a>04666 <span class="comment">   * we will always uses shifts instead of multiplies for speed reasons.</span>
<a name="l04667"></a>04667 <span class="comment">   */</span>
<a name="l04668"></a>04668   num_words = max_offset + 1;
<a name="l04669"></a>04669   time_shift = 0;
<a name="l04670"></a>04670   <span class="keywordflow">while</span> (num_words &gt; (1 &lt;&lt; time_shift))
<a name="l04671"></a>04671     time_shift++;
<a name="l04672"></a>04672 
<a name="l04673"></a>04673   <span class="comment">/* Create a heap for sorting the resource usages */</span>
<a name="l04674"></a>04674   heap = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/heap_8c.html#c4197167c9fa086c4654078a33edcfeb">Heap_Create</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/heap_8h.html#b0c1b906f7c74d490c2fa755fff02f35">HEAP_MIN</a>);
<a name="l04675"></a>04675 
<a name="l04676"></a>04676   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l04677"></a>04677   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section);
<a name="l04678"></a>04678        unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l04679"></a>04679     {
<a name="l04680"></a>04680       <span class="comment">/* Get each units use field */</span>
<a name="l04681"></a>04681       unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l04682"></a>04682 
<a name="l04683"></a>04683 <span class="preprocessor">#if 0</span>
<a name="l04684"></a>04684 <span class="preprocessor"></span>      <span class="comment">/* debug */</span>
<a name="l04685"></a>04685       printf (<span class="stringliteral">"\nBit-field optimizing '%s':\n"</span>, unit_entry-&gt;name);
<a name="l04686"></a>04686 <span class="preprocessor">#endif</span>
<a name="l04687"></a>04687 <span class="preprocessor"></span>      <span class="comment">/* Create offset table to help offset sort */</span>
<a name="l04688"></a>04688       time_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"Offset"</span>, 0);
<a name="l04689"></a>04689       time_count = 0;
<a name="l04690"></a>04690 
<a name="l04691"></a>04691       <span class="comment">/* Build offset table so can place cycle usages back in specified</span>
<a name="l04692"></a>04692 <span class="comment">       * order.</span>
<a name="l04693"></a>04693 <span class="comment">       */</span>
<a name="l04694"></a>04694       <span class="keywordflow">for</span> (index = 0; index &lt;= unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index++)
<a name="l04695"></a>04695         {
<a name="l04696"></a>04696           <span class="comment">/* Get the resource usage */</span>
<a name="l04697"></a>04697           ru = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index);
<a name="l04698"></a>04698 
<a name="l04699"></a>04699           <span class="comment">/* The the ru's time field */</span>
<a name="l04700"></a>04700           ru_time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru, <span class="stringliteral">"time"</span>);
<a name="l04701"></a>04701 
<a name="l04702"></a>04702           <span class="comment">/* Get the use time for the resource */</span>
<a name="l04703"></a>04703           use_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (ru_time_field, 0);
<a name="l04704"></a>04704 
<a name="l04705"></a>04705           <span class="comment">/* Have we seen this use_time before? */</span>
<a name="l04706"></a>04706           time_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (time_table, use_time);
<a name="l04707"></a>04707           <span class="keywordflow">if</span> (time_symbol == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04708"></a>04708             {
<a name="l04709"></a>04709               <span class="comment">/* No, increment the time count and assign a "unique" </span>
<a name="l04710"></a>04710 <span class="comment">               * sort offset to this time offset.  This is to prevent</span>
<a name="l04711"></a>04711 <span class="comment">               * the order of the resource usages are checked in</span>
<a name="l04712"></a>04712 <span class="comment">               * from being reordered by this sort (see Micro29 comment</span>
<a name="l04713"></a>04713 <span class="comment">               * at top of loop).</span>
<a name="l04714"></a>04714 <span class="comment">               */</span>
<a name="l04715"></a>04715               time_count++;
<a name="l04716"></a>04716               time_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (time_table, use_time,
<a name="l04717"></a>04717                                             (<span class="keywordtype">void</span> *) (time_count &lt;&lt; 16));
<a name="l04718"></a>04718             }
<a name="l04719"></a>04719         }
<a name="l04720"></a>04720 
<a name="l04721"></a>04721 
<a name="l04722"></a>04722       <span class="comment">/* Sort the resource usages by offset then index using</span>
<a name="l04723"></a>04723 <span class="comment">       * the heap sorter.</span>
<a name="l04724"></a>04724 <span class="comment">       * </span>
<a name="l04725"></a>04725 <span class="comment">       * To be fair (in Micro29 paper) to bit-field optimization </span>
<a name="l04726"></a>04726 <span class="comment">       * without the zero time opti applied, make sure the sort doesn't </span>
<a name="l04727"></a>04727 <span class="comment">       * reorder the order the cycles are checked checked in.  Otherwise,</span>
<a name="l04728"></a>04728 <span class="comment">       * without the zero-time opti scheduling performance can be </span>
<a name="l04729"></a>04729 <span class="comment">       * decreased!</span>
<a name="l04730"></a>04730 <span class="comment">       */</span>
<a name="l04731"></a>04731       <span class="keywordflow">for</span> (index = unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index &gt;= 0; index--)
<a name="l04732"></a>04732         {
<a name="l04733"></a>04733           <span class="comment">/* Get the resource usage */</span>
<a name="l04734"></a>04734           ru = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index);
<a name="l04735"></a>04735 
<a name="l04736"></a>04736           <span class="comment">/* Get the ru's use and time fields */</span>
<a name="l04737"></a>04737           ru_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru, <span class="stringliteral">"use"</span>);
<a name="l04738"></a>04738           ru_time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru, <span class="stringliteral">"time"</span>);
<a name="l04739"></a>04739 
<a name="l04740"></a>04740           <span class="comment">/* Make sure use and time fields have only one element in them */</span>
<a name="l04741"></a>04741           <span class="keywordflow">if</span> (ru_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l04742"></a>04742             <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"optimize_resource_units: one use expected!"</span>);
<a name="l04743"></a>04743 
<a name="l04744"></a>04744           <span class="keywordflow">if</span> (ru_time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l04745"></a>04745             <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"optimize_resource_units: one time expected!"</span>);
<a name="l04746"></a>04746 
<a name="l04747"></a>04747           <span class="comment">/* Get the use time for the resource */</span>
<a name="l04748"></a>04748           use_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (ru_time_field, 0);
<a name="l04749"></a>04749 
<a name="l04750"></a>04750           <span class="comment">/* Get the map offset and index for the resource */</span>
<a name="l04751"></a>04751           resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (ru_use_field, 0);
<a name="l04752"></a>04752           location_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (resource, <span class="stringliteral">"map_location"</span>);
<a name="l04753"></a>04753           map_offset = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (location_field, 0);
<a name="l04754"></a>04754           map_index = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (location_field, 1);
<a name="l04755"></a>04755 
<a name="l04756"></a>04756           <span class="comment">/* Calculate the cycle offset from time 0 */</span>
<a name="l04757"></a>04757           cycle_offset = (use_time &lt;&lt; time_shift) + map_offset;
<a name="l04758"></a>04758 
<a name="l04759"></a>04759           <span class="comment">/* Get the time offset for the use time */</span>
<a name="l04760"></a>04760           time_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (time_table, use_time);
<a name="l04761"></a>04761 
<a name="l04762"></a>04762           <span class="comment">/* Calculate it's bit offset from time 0, adjusting it</span>
<a name="l04763"></a>04763 <span class="comment">           * with the time offset.</span>
<a name="l04764"></a>04764 <span class="comment">           */</span>
<a name="l04765"></a>04765 <span class="preprocessor">#ifdef LP64_ARCHITECTURE</span>
<a name="l04766"></a>04766 <span class="preprocessor"></span>          sort_offset = (cycle_offset &lt;&lt; 5) + map_index + 
<a name="l04767"></a>04767             (<span class="keywordtype">long</span>) (time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>);
<a name="l04768"></a>04768 <span class="preprocessor">#else</span>
<a name="l04769"></a>04769 <span class="preprocessor"></span>          sort_offset = (cycle_offset &lt;&lt; 5) + map_index +
<a name="l04770"></a>04770             (<span class="keywordtype">int</span>) (time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>);
<a name="l04771"></a>04771 <span class="preprocessor">#endif</span>
<a name="l04772"></a>04772 <span class="preprocessor"></span>
<a name="l04773"></a>04773 <span class="preprocessor">#if 0</span>
<a name="l04774"></a>04774 <span class="preprocessor"></span>          <span class="comment">/* Debug */</span>
<a name="l04775"></a>04775           printf
<a name="l04776"></a>04776             (<span class="stringliteral">"%s time %i shift %i off %i index %i cycle_offset %i total %i\n"</span>,
<a name="l04777"></a>04777              ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, use_time, time_shift, map_offset, map_index,
<a name="l04778"></a>04778              (<span class="keywordtype">int</span>) (time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>), sort_offset);
<a name="l04779"></a>04779 <span class="preprocessor">#endif</span>
<a name="l04780"></a>04780 <span class="preprocessor"></span>
<a name="l04781"></a>04781           <span class="comment">/* Insert into heap based on total offset */</span>
<a name="l04782"></a>04782           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/heap_8c.html#c86e67aa3d315dce4c37dd848b3ad7b7">Heap_Insert</a> (heap, (<span class="keywordtype">void</span> *) ru, (<span class="keywordtype">double</span>) sort_offset);
<a name="l04783"></a>04783 
<a name="l04784"></a>04784           <span class="comment">/* Delete ru from use list */</span>
<a name="l04785"></a>04785           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (unit_use_field, index);
<a name="l04786"></a>04786 
<a name="l04787"></a>04787         }
<a name="l04788"></a>04788 
<a name="l04789"></a>04789       <span class="comment">/* Free time table, data is just a number (do not free) */</span>
<a name="l04790"></a>04790       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (time_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04791"></a>04791 
<a name="l04792"></a>04792       last_ru = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04793"></a>04793       last_offset = -100000;
<a name="l04794"></a>04794       needs_dup = 1;
<a name="l04795"></a>04795 
<a name="l04796"></a>04796       <span class="comment">/* Pull the ru's off the heap in total offset order */</span>
<a name="l04797"></a>04797       <span class="keywordflow">while</span> ((ru = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/heap_8c.html#6a7a4ed0f9b50b8e892c27589f6e92e5">Heap_ExtractTop</a> (heap)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04798"></a>04798         {
<a name="l04799"></a>04799           <span class="comment">/* Get the ru's use and time fields */</span>
<a name="l04800"></a>04800           ru_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru, <span class="stringliteral">"use"</span>);
<a name="l04801"></a>04801           ru_time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru, <span class="stringliteral">"time"</span>);
<a name="l04802"></a>04802 
<a name="l04803"></a>04803           <span class="comment">/* Get the use time for the resource */</span>
<a name="l04804"></a>04804           use_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (ru_time_field, 0);
<a name="l04805"></a>04805 
<a name="l04806"></a>04806           <span class="comment">/* Get the map offset and index for the resource */</span>
<a name="l04807"></a>04807           resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (ru_use_field, 0);
<a name="l04808"></a>04808           location_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (resource, <span class="stringliteral">"map_location"</span>);
<a name="l04809"></a>04809           map_offset = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (location_field, 0);
<a name="l04810"></a>04810 
<a name="l04811"></a>04811           <span class="comment">/* Calculate it's word offset from time 0 */</span>
<a name="l04812"></a>04812           total_offset = ((use_time &lt;&lt; time_shift) + map_offset);
<a name="l04813"></a>04813 
<a name="l04814"></a>04814 <span class="preprocessor">#if 0</span>
<a name="l04815"></a>04815 <span class="preprocessor"></span>          <span class="comment">/* Debug */</span>
<a name="l04816"></a>04816           printf (<span class="stringliteral">"%s time %i shift %i off %i total %i\n"</span>,
<a name="l04817"></a>04817                   ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, use_time, time_shift, map_offset, total_offset);
<a name="l04818"></a>04818 <span class="preprocessor">#endif</span>
<a name="l04819"></a>04819 <span class="preprocessor"></span>
<a name="l04820"></a>04820           <span class="comment">/* If first ru or has a different offset as last ru,</span>
<a name="l04821"></a>04821 <span class="comment">           * place it in the use_field at end of field.</span>
<a name="l04822"></a>04822 <span class="comment">           */</span>
<a name="l04823"></a>04823           <span class="keywordflow">if</span> ((last_ru == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (total_offset != last_offset))
<a name="l04824"></a>04824             {
<a name="l04825"></a>04825               <span class="comment">/* Place it in the use_field at the given index */</span>
<a name="l04826"></a>04826               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (unit_use_field,
<a name="l04827"></a>04827                            unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1, ru);
<a name="l04828"></a>04828               last_ru = ru;
<a name="l04829"></a>04829               last_offset = total_offset;
<a name="l04830"></a>04830               needs_dup = 1;
<a name="l04831"></a>04831             }
<a name="l04832"></a>04832           <span class="keywordflow">else</span>
<a name="l04833"></a>04833             {
<a name="l04834"></a>04834               <span class="comment">/* Duplicate the last ru if not already duplicated */</span>
<a name="l04835"></a>04835               <span class="keywordflow">if</span> (needs_dup)
<a name="l04836"></a>04836                 {
<a name="l04837"></a>04837                   last_ru = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (last_ru);
<a name="l04838"></a>04838                   <span class="comment">/* Replace current last_ru with duped ru */</span>
<a name="l04839"></a>04839                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (unit_use_field,
<a name="l04840"></a>04840                                unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>, last_ru);
<a name="l04841"></a>04841                   needs_dup = 0;
<a name="l04842"></a>04842                 }
<a name="l04843"></a>04843 
<a name="l04844"></a>04844               <span class="comment">/* Add current resource to the end of this ru's use field */</span>
<a name="l04845"></a>04845               last_ru_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (last_ru, <span class="stringliteral">"use"</span>);
<a name="l04846"></a>04846               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (last_ru_use_field,
<a name="l04847"></a>04847                            last_ru_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l04848"></a>04848                            resource);
<a name="l04849"></a>04849 
<a name="l04850"></a>04850 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l04851"></a>04851 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l04852"></a>04852               printf (<span class="stringliteral">"%s-&gt;use[%i]:\n  coalescing %s into %s\n"</span>,
<a name="l04853"></a>04853                       unit_entry-&gt;name, unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>,
<a name="l04854"></a>04854                       resource-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, last_ru-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l04855"></a>04855 <span class="preprocessor">#endif</span>
<a name="l04856"></a>04856 <span class="preprocessor"></span>            }
<a name="l04857"></a>04857         }
<a name="l04858"></a>04858     }
<a name="l04859"></a>04859 
<a name="l04860"></a>04860   <span class="comment">/* Dispose of the head (don't delete data) */</span>
<a name="l04861"></a>04861   heap = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/heap_8c.html#7b2694670d65b76abe0b706a2d94814f">Heap_Dispose</a> (heap, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04862"></a>04862 
<a name="l04863"></a>04863 }
<a name="l04864"></a>04864 
<a name="l04865"></a>04865 <span class="keywordtype">void</span>
<a name="l04866"></a><a class="code" href="lmdes2__customizer_8c.html#fa4c4f19e0105b0a4fb487dafb37bd84">04866</a> <a class="code" href="lmdes2__customizer_8c.html#fa4c4f19e0105b0a4fb487dafb37bd84">free_link_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * link_table)
<a name="l04867"></a>04867 {
<a name="l04868"></a>04868   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (link_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04869"></a>04869 }
<a name="l04870"></a>04870 
<a name="l04871"></a>04871 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *
<a name="l04872"></a><a class="code" href="lmdes2__customizer_8c.html#5c514dd5e4fda6d0660bfaf6ea103344">04872</a> <a class="code" href="lmdes2__customizer_8c.html#5c514dd5e4fda6d0660bfaf6ea103344">build_link_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> * target_section)
<a name="l04873"></a>04873 {
<a name="l04874"></a>04874   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *scan_section;
<a name="l04875"></a>04875   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l04876"></a>04876   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html">MD_Element_Req</a> *req;
<a name="l04877"></a>04877   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *link_table;
<a name="l04878"></a>04878   <span class="keywordtype">int</span> require_index, link_index;
<a name="l04879"></a>04879 
<a name="l04880"></a>04880   <span class="comment">/* Use a symbol table to hold all the field declarations that</span>
<a name="l04881"></a>04881 <span class="comment">   * link to this section.</span>
<a name="l04882"></a>04882 <span class="comment">   */</span>
<a name="l04883"></a>04883   link_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"link"</span>, 0);
<a name="l04884"></a>04884 
<a name="l04885"></a>04885   <span class="comment">/* Go through every section in the md looking for links to this section */</span>
<a name="l04886"></a>04886   <span class="keywordflow">for</span> (scan_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#80898363bd87b2073facc7280db90304">MD_first_section</a> (md); scan_section != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04887"></a>04887        scan_section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#e663f86a14d893405f3f150ba80ba952">MD_next_section</a> (scan_section))
<a name="l04888"></a>04888     {
<a name="l04889"></a>04889       <span class="comment">/* Go through every field declaration in section */</span>
<a name="l04890"></a>04890       <span class="keywordflow">for</span> (field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#ec8db6e1a71d3ca153e81e270872e8a4">MD_first_field_decl</a> (scan_section);
<a name="l04891"></a>04891            field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a1591f954c0b8b00c6a22356c02024ff">MD_next_field_decl</a> (field_decl))
<a name="l04892"></a>04892         {
<a name="l04893"></a>04893 
<a name="l04894"></a>04894           <span class="comment">/* Go through every requirement */</span>
<a name="l04895"></a>04895           <span class="keywordflow">for</span> (require_index = 0;
<a name="l04896"></a>04896                require_index &lt;= field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#9fd199750f1a1bbc166743145d20af20">max_require_index</a>;
<a name="l04897"></a>04897                require_index++)
<a name="l04898"></a>04898             {
<a name="l04899"></a>04899               <span class="comment">/* Get requirement */</span>
<a name="l04900"></a>04900               req = field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#af038c00fca9826f787384ffb4b2eb51">require</a>[require_index];
<a name="l04901"></a>04901 
<a name="l04902"></a>04902               <span class="comment">/* Only process links */</span>
<a name="l04903"></a>04903               if (req-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#b44280197e0bd60f7032f05373352116">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l04904"></a>04904                 <span class="keywordflow">continue</span>;
<a name="l04905"></a>04905 
<a name="l04906"></a>04906 
<a name="l04907"></a>04907               <span class="comment">/* Search every link */</span>
<a name="l04908"></a>04908               for (link_index = 0; link_index &lt; req-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#2abe43cebd3f2835f64c06a9986b5eb8">link_array_size</a>;
<a name="l04909"></a>04909                    link_index++)
<a name="l04910"></a>04910                 {
<a name="l04911"></a>04911                   <span class="comment">/* If link to target section, add field decl to table */</span>
<a name="l04912"></a>04912                   <span class="keywordflow">if</span> (req-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element__Req.html#1a814cd454fa772891c5fff8d77a14c3">link</a>[link_index] == target_section)
<a name="l04913"></a>04913                     {
<a name="l04914"></a>04914                       <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable)</span>
<a name="l04915"></a>04915 <span class="comment">                       *              off of the address of field_decl before</span>
<a name="l04916"></a>04916 <span class="comment">                       *              looking it up. */</span>
<a name="l04917"></a>04917                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (link_table, 
<a name="l04918"></a>04918                                       ((<span class="keywordtype">long</span>) field_decl &amp; (<span class="keywordtype">long</span>) 0xffffffff),
<a name="l04919"></a>04919                                       (<span class="keywordtype">void</span> *) field_decl);
<a name="l04920"></a>04920                       <span class="comment">/* Don't need to search other requirments */</span>
<a name="l04921"></a>04921                       require_index = field_decl-&gt;max_require_index + 1;
<a name="l04922"></a>04922                       <span class="keywordflow">break</span>;
<a name="l04923"></a>04923                     }
<a name="l04924"></a>04924                 }
<a name="l04925"></a>04925             }
<a name="l04926"></a>04926         }
<a name="l04927"></a>04927     }
<a name="l04928"></a>04928 
<a name="l04929"></a>04929   <span class="keywordflow">return</span> (link_table);
<a name="l04930"></a>04930 }
<a name="l04931"></a>04931 
<a name="l04932"></a>04932 <span class="keywordtype">void</span>
<a name="l04933"></a><a class="code" href="lmdes2__customizer_8c.html#7b841160a37c9819cb24c2709727eb58">04933</a> <a class="code" href="lmdes2__customizer_8c.html#7b841160a37c9819cb24c2709727eb58">free_remap_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * remap_table)
<a name="l04934"></a>04934 {
<a name="l04935"></a>04935   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *remap_symbol;
<a name="l04936"></a>04936 
<a name="l04937"></a>04937   <span class="comment">/* Free all the Pointer_Mapping structures. */</span>
<a name="l04938"></a>04938   <span class="keywordflow">for</span> (remap_symbol = remap_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; remap_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04939"></a>04939        remap_symbol = remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l04940"></a>04940     free ((<span class="keywordtype">void</span> *) (remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>));
<a name="l04941"></a>04941 
<a name="l04942"></a>04942   <span class="comment">/* No data to free */</span>
<a name="l04943"></a>04943   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (remap_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04944"></a>04944 }
<a name="l04945"></a>04945 
<a name="l04946"></a>04946 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *
<a name="l04947"></a><a class="code" href="lmdes2__customizer_8c.html#7a6ced70906068dcb26b7acce31d0ca9">04947</a> <a class="code" href="lmdes2__customizer_8c.html#7a6ced70906068dcb26b7acce31d0ca9">build_remap_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> * section)
<a name="l04948"></a>04948 {
<a name="l04949"></a>04949   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *remap_table;
<a name="l04950"></a>04950 
<a name="l04951"></a>04951   <span class="comment">/* Use a symbol table to hold all remappings.  Create</span>
<a name="l04952"></a>04952 <span class="comment">   * remap table half the size of the section for efficiency.</span>
<a name="l04953"></a>04953 <span class="comment">   */</span>
<a name="l04954"></a>04954   remap_table =
<a name="l04955"></a>04955     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"remap"</span>, section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#efaf1eb833608de0fd1909ecb40e2671">entry_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Symbol__Table.html#560dcf5e5fca3abec8c2379e98e29bd2">symbol_count</a> &gt;&gt; 1);
<a name="l04956"></a>04956 
<a name="l04957"></a>04957   <span class="comment">/* Return the new remap table */</span>
<a name="l04958"></a>04958   <span class="keywordflow">return</span> (remap_table);
<a name="l04959"></a>04959 }
<a name="l04960"></a>04960 
<a name="l04961"></a>04961 <span class="comment">/* Registers a remapping from from_entry to to_entry. */</span>
<a name="l04962"></a>04962 <span class="keywordtype">void</span>
<a name="l04963"></a><a class="code" href="lmdes2__customizer_8c.html#81b5e74760544ee45c3246205a9db199">04963</a> <a class="code" href="lmdes2__customizer_8c.html#81b5e74760544ee45c3246205a9db199">add_remap_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * remap_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * from_entry,
<a name="l04964"></a>04964                  <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * to_entry)
<a name="l04965"></a>04965 {
<a name="l04966"></a>04966   <a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *mapping;
<a name="l04967"></a>04967 
<a name="l04968"></a>04968   <span class="comment">/* Sanity check, neither from_entry or to_entry better be in the </span>
<a name="l04969"></a>04969 <span class="comment">   * searchable part of the table.</span>
<a name="l04970"></a>04970 <span class="comment">   */</span>
<a name="l04971"></a>04971   <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of the address</span>
<a name="l04972"></a>04972 <span class="comment">   *              of from_entry before looking it up. */</span>
<a name="l04973"></a>04973   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (remap_table, ((<span class="keywordtype">long</span>) from_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff)))
<a name="l04974"></a>04974     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__error_8c.html#04f215f17936ffe11d70fef75a9f2185">I_punt</a> (<span class="stringliteral">"add_remap_entry: from_entry already in table!"</span>);
<a name="l04975"></a>04975 
<a name="l04976"></a>04976   <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of the address</span>
<a name="l04977"></a>04977 <span class="comment">   *              of to_entry before looking it up. */</span>
<a name="l04978"></a>04978   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (remap_table, ((<span class="keywordtype">long</span>) to_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff)))
<a name="l04979"></a>04979     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__error_8c.html#04f215f17936ffe11d70fef75a9f2185">I_punt</a> (<span class="stringliteral">"add_remap_entry: to_entry already in table!"</span>);
<a name="l04980"></a>04980 
<a name="l04981"></a>04981 
<a name="l04982"></a>04982   <span class="comment">/* DUE TO THE ALGORITHM's CONSTRUCTION this is not necessary.  </span>
<a name="l04983"></a>04983 <span class="comment">   * Ifdef out for speed.</span>
<a name="l04984"></a>04984 <span class="comment">   */</span>
<a name="l04985"></a>04985 <span class="preprocessor">#if 0</span>
<a name="l04986"></a>04986 <span class="preprocessor"></span>  <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *symbol;
<a name="l04987"></a>04987   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *old_target;
<a name="l04988"></a>04988   <span class="comment">/* Apply remap to all existing remaps in table. */</span>
<a name="l04989"></a>04989   <span class="keywordflow">for</span> (symbol = remap_table-&gt;head_symbol; symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04990"></a>04990        symbol = symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l04991"></a>04991     {
<a name="l04992"></a>04992       old_target = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l04993"></a>04993       if (old_target == from_entry)
<a name="l04994"></a>04994         symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = (<span class="keywordtype">void</span> *) to_entry;
<a name="l04995"></a>04995     }
<a name="l04996"></a>04996 <span class="preprocessor">#endif</span>
<a name="l04997"></a>04997 <span class="preprocessor"></span>
<a name="l04998"></a>04998   <span class="comment">/* Add the remapping to the table */</span>
<a name="l04999"></a>04999   <span class="comment">/* 11/14/02 REK First, allocate a new Pointer_Mapping structure to store</span>
<a name="l05000"></a>05000 <span class="comment">   *              both pointer as pointers. */</span>
<a name="l05001"></a>05001   mapping = (<a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a>));
<a name="l05002"></a>05002   
<a name="l05003"></a>05003   <span class="keywordflow">if</span> (mapping == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05004"></a>05004     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__error_8c.html#04f215f17936ffe11d70fef75a9f2185">I_punt</a> (<span class="stringliteral">"add_remap_entry: Could not allocate Pointer_Mapping struct."</span>);
<a name="l05005"></a>05005 
<a name="l05006"></a>05006   mapping-&gt;<a class="code" href="structPointer__Mapping.html#661c5e8b6062b1e7d04fdcfd8f2df2c4">from</a> = (<span class="keywordtype">void</span> *) from_entry;
<a name="l05007"></a>05007   mapping-&gt;<a class="code" href="structPointer__Mapping.html#78ef5abc3b5cb05326bb41277ec887e3">to</a> = (<span class="keywordtype">void</span> *) to_entry;
<a name="l05008"></a>05008   
<a name="l05009"></a>05009   <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of the address</span>
<a name="l05010"></a>05010 <span class="comment">   *              of from_entry before looking it up. */</span>
<a name="l05011"></a>05011   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (remap_table, ((<span class="keywordtype">long</span>) from_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff), 
<a name="l05012"></a>05012                   (<span class="keywordtype">void</span> *) mapping);
<a name="l05013"></a>05013 }
<a name="l05014"></a>05014 
<a name="l05015"></a>05015 <span class="keywordtype">void</span>
<a name="l05016"></a><a class="code" href="lmdes2__customizer_8c.html#4b79fa02bfedc02fd8a999e382611b64">05016</a> <a class="code" href="lmdes2__customizer_8c.html#4b79fa02bfedc02fd8a999e382611b64">free_referenced_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * referenced_table)
<a name="l05017"></a>05017 {
<a name="l05018"></a>05018   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (referenced_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05019"></a>05019 }
<a name="l05020"></a>05020 
<a name="l05021"></a>05021 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *
<a name="l05022"></a><a class="code" href="lmdes2__customizer_8c.html#a6b6366bf2fed45e215362f0acf2c5ba">05022</a> <a class="code" href="lmdes2__customizer_8c.html#a6b6366bf2fed45e215362f0acf2c5ba">build_referenced_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * link_table, <span class="keywordtype">int</span> init_size)
<a name="l05023"></a>05023 {
<a name="l05024"></a>05024   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *link_decl;
<a name="l05025"></a>05025   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *referenced_table;
<a name="l05026"></a>05026   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *link_symbol;
<a name="l05027"></a>05027   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *scan_entry, *target_entry;
<a name="l05028"></a>05028   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *scan_field;
<a name="l05029"></a>05029   <span class="keywordtype">int</span> index;
<a name="l05030"></a>05030 
<a name="l05031"></a>05031 
<a name="l05032"></a>05032   <span class="comment">/* Use a symbol table to hold all the entries referenced by the</span>
<a name="l05033"></a>05033 <span class="comment">   * fields in the link_table.  Use number of entries in section</span>
<a name="l05034"></a>05034 <span class="comment">   * to determine the initial symbol table size.</span>
<a name="l05035"></a>05035 <span class="comment">   */</span>
<a name="l05036"></a>05036   referenced_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"referenced"</span>, init_size);
<a name="l05037"></a>05037   
<a name="l05038"></a>05038   
<a name="l05039"></a>05039   <span class="comment">/* Go through each field declaration that links to this section looking</span>
<a name="l05040"></a>05040 <span class="comment">   * for references to entries in this section.  (Will get some entries</span>
<a name="l05041"></a>05041 <span class="comment">   * from other sections also...)</span>
<a name="l05042"></a>05042 <span class="comment">   */</span>
<a name="l05043"></a>05043   <span class="keywordflow">for</span> (link_symbol = link_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; link_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05044"></a>05044        link_symbol = link_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l05045"></a>05045     {
<a name="l05046"></a>05046       <span class="comment">/* Get field decl */</span>
<a name="l05047"></a>05047       link_decl = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *) link_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l05048"></a>05048 
<a name="l05049"></a>05049       <span class="comment">/* Scan all the entries in that field's section */</span>
<a name="l05050"></a>05050       for (scan_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (link_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#873f013f5dda7d8c245dabc43ac88b4f">section</a>);
<a name="l05051"></a>05051            scan_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; scan_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (scan_entry))
<a name="l05052"></a>05052         {
<a name="l05053"></a>05053           <span class="comment">/* Get the ref field for this entry, go to next if NULL */</span>
<a name="l05054"></a>05054           <span class="keywordflow">if</span> ((scan_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (scan_entry, link_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05055"></a>05055             <span class="keywordflow">continue</span>;
<a name="l05056"></a>05056 
<a name="l05057"></a>05057           <span class="comment">/* Scan all elements of the field */</span>
<a name="l05058"></a>05058           <span class="keywordflow">for</span> (index = scan_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index &gt;= 0; index--)
<a name="l05059"></a>05059             {
<a name="l05060"></a>05060               <span class="comment">/* Test only links */</span>
<a name="l05061"></a>05061               <span class="keywordflow">if</span> (scan_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[index]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l05062"></a>05062                 <span class="keywordflow">continue</span>;
<a name="l05063"></a>05063 
<a name="l05064"></a>05064               <span class="comment">/* Get the target entry of the link */</span>
<a name="l05065"></a>05065               target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (scan_field, index);
<a name="l05066"></a>05066 
<a name="l05067"></a>05067               <span class="comment">/* Add entry address to table if not already there */</span>
<a name="l05068"></a>05068               <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l05069"></a>05069 <span class="comment">               *              the address of from_entry before looking it up.</span>
<a name="l05070"></a>05070 <span class="comment">               */</span>
<a name="l05071"></a>05071               <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (referenced_table, 
<a name="l05072"></a>05072                                    ((<span class="keywordtype">long</span>) target_entry &amp; \
<a name="l05073"></a>05073                                     (<span class="keywordtype">long</span>) 0xffffffff)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05074"></a>05074                 {
<a name="l05075"></a>05075                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (referenced_table, 
<a name="l05076"></a>05076                                   ((<span class="keywordtype">long</span>) target_entry &amp; \
<a name="l05077"></a>05077                                    (<span class="keywordtype">long</span>) 0xffffffff), <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05078"></a>05078                 }
<a name="l05079"></a>05079             }
<a name="l05080"></a>05080         }
<a name="l05081"></a>05081     }
<a name="l05082"></a>05082   
<a name="l05083"></a>05083   <span class="comment">/* Return the table of referenced entries */</span>
<a name="l05084"></a>05084   <span class="keywordflow">return</span> (referenced_table);
<a name="l05085"></a>05085 }
<a name="l05086"></a>05086 
<a name="l05087"></a>05087 <span class="keywordtype">int</span>
<a name="l05088"></a><a class="code" href="lmdes2__customizer_8c.html#576134def61f55e5825097f6c622e8be">05088</a> <a class="code" href="lmdes2__customizer_8c.html#576134def61f55e5825097f6c622e8be">entry_referenced</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * referenced_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * test_entry)
<a name="l05089"></a>05089 {
<a name="l05090"></a>05090   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (referenced_table, 
<a name="l05091"></a>05091                        ((<span class="keywordtype">long</span>) test_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05092"></a>05092     <span class="keywordflow">return</span> (1);
<a name="l05093"></a>05093   <span class="keywordflow">else</span>
<a name="l05094"></a>05094     <span class="keywordflow">return</span> (0);
<a name="l05095"></a>05095 }
<a name="l05096"></a>05096 
<a name="l05097"></a>05097 <span class="comment">/* Removes entries that are not referenced by any other entries in</span>
<a name="l05098"></a>05098 <span class="comment"> * the mdes (via a link).  Returns a count of the entries removed.</span>
<a name="l05099"></a>05099 <span class="comment"> */</span>
<a name="l05100"></a>05100 <span class="keywordtype">int</span>
<a name="l05101"></a><a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">05101</a> <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name)
<a name="l05102"></a>05102 {
<a name="l05103"></a>05103   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l05104"></a>05104   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *test_entry, *next_test_entry;
<a name="l05105"></a>05105   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *link_table, *referenced_table;
<a name="l05106"></a>05106   <span class="keywordtype">int</span> remove_count;
<a name="l05107"></a>05107 
<a name="l05108"></a>05108   remove_count = 0;
<a name="l05109"></a>05109 
<a name="l05110"></a>05110   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l05111"></a>05111 
<a name="l05112"></a>05112   <span class="comment">/* Use a symbol table to hold all the field declarations that</span>
<a name="l05113"></a>05113 <span class="comment">   * link to this section.</span>
<a name="l05114"></a>05114 <span class="comment">   */</span>
<a name="l05115"></a>05115   link_table = <a class="code" href="lmdes2__customizer_8c.html#5c514dd5e4fda6d0660bfaf6ea103344">build_link_table</a> (md, section);
<a name="l05116"></a>05116 
<a name="l05117"></a>05117   <span class="comment">/* Build a table of all the entries referenced by the fields</span>
<a name="l05118"></a>05118 <span class="comment">   * in the link_table.  Make its initial size be the number</span>
<a name="l05119"></a>05119 <span class="comment">   * of entries in this section.</span>
<a name="l05120"></a>05120 <span class="comment">   */</span>
<a name="l05121"></a>05121   referenced_table =
<a name="l05122"></a>05122     <a class="code" href="lmdes2__customizer_8c.html#a6b6366bf2fed45e215362f0acf2c5ba">build_referenced_table</a> (link_table, section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#efaf1eb833608de0fd1909ecb40e2671">entry_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Symbol__Table.html#560dcf5e5fca3abec8c2379e98e29bd2">symbol_count</a>);
<a name="l05123"></a>05123 
<a name="l05124"></a>05124   <span class="comment">/* Punt if no sections link to this section found since this routine </span>
<a name="l05125"></a>05125 <span class="comment">   * will want to remove all the entries (which cannot be right)</span>
<a name="l05126"></a>05126 <span class="comment">   */</span>
<a name="l05127"></a>05127   <span class="keywordflow">if</span> (link_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05128"></a>05128     {
<a name="l05129"></a>05129       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l05130"></a>05130               <span class="stringliteral">"remove_unreferenced_entries: No sections reference '%s'!"</span>,
<a name="l05131"></a>05131               section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l05132"></a>05132     }
<a name="l05133"></a>05133 
<a name="l05134"></a>05134   <span class="comment">/* Scan section's entries and delete unreferenced entries */</span>
<a name="l05135"></a>05135   <span class="keywordflow">for</span> (test_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); test_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05136"></a>05136        test_entry = next_test_entry)
<a name="l05137"></a>05137     {
<a name="l05138"></a>05138       <span class="comment">/* Get the next entry to scan before possibly deleting entry */</span>
<a name="l05139"></a>05139       next_test_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (test_entry);
<a name="l05140"></a>05140 
<a name="l05141"></a>05141       <span class="comment">/* If entry unreferenced, delete it */</span>
<a name="l05142"></a>05142       <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#576134def61f55e5825097f6c622e8be">entry_referenced</a> (referenced_table, test_entry))
<a name="l05143"></a>05143         {
<a name="l05144"></a>05144 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l05145"></a>05145           printf (<span class="stringliteral">"Deleting %s-&gt;%s\n"</span>, section-&gt;name, test_entry-&gt;name);
<a name="l05146"></a>05146 #endif
<a name="l05147"></a>05147 
<a name="l05148"></a>05148           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (test_entry);
<a name="l05149"></a>05149 
<a name="l05150"></a>05150           <span class="comment">/* Update count */</span>
<a name="l05151"></a>05151           remove_count++;
<a name="l05152"></a>05152         }
<a name="l05153"></a>05153     }
<a name="l05154"></a>05154 
<a name="l05155"></a>05155 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l05156"></a>05156 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (remove_count &gt; 0)
<a name="l05157"></a>05157     {
<a name="l05158"></a>05158       printf (<span class="stringliteral">"%i entries removed from %s.\n"</span>, remove_count, section-&gt;name);
<a name="l05159"></a>05159     }
<a name="l05160"></a>05160 <span class="preprocessor">#endif</span>
<a name="l05161"></a>05161 <span class="preprocessor"></span>
<a name="l05162"></a>05162   <span class="comment">/* Free the link and referenced tables */</span>
<a name="l05163"></a>05163   <a class="code" href="lmdes2__customizer_8c.html#fa4c4f19e0105b0a4fb487dafb37bd84">free_link_table</a> (link_table);
<a name="l05164"></a>05164   <a class="code" href="lmdes2__customizer_8c.html#4b79fa02bfedc02fd8a999e382611b64">free_referenced_table</a> (referenced_table);
<a name="l05165"></a>05165 
<a name="l05166"></a>05166   <span class="comment">/* Return the number of entries removed */</span>
<a name="l05167"></a>05167   <span class="keywordflow">return</span> (remove_count);
<a name="l05168"></a>05168 }
<a name="l05169"></a>05169 
<a name="l05170"></a>05170 
<a name="l05171"></a>05171 <span class="comment">/* Hashes a string, returning an unsigned 32 bit number. */</span>
<a name="l05172"></a>05172 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l05173"></a><a class="code" href="lmdes2__customizer_8c.html#2c1c0879b965f678466adfa8d6c8e412">05173</a> <a class="code" href="lmdes2__customizer_8c.html#2c1c0879b965f678466adfa8d6c8e412">CU_hash_string</a> (<span class="keywordtype">char</span> *string)
<a name="l05174"></a>05174 {
<a name="l05175"></a>05175   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_val;
<a name="l05176"></a>05176   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr;
<a name="l05177"></a>05177   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ch;
<a name="l05178"></a>05178 
<a name="l05179"></a>05179   hash_val = 0;
<a name="l05180"></a>05180 
<a name="l05181"></a>05181   <span class="comment">/* Scan through all the characters, adding the characters to the</span>
<a name="l05182"></a>05182 <span class="comment">   * hash value.  Multiply the hash value by 17 (using shifts) before</span>
<a name="l05183"></a>05183 <span class="comment">   * adding each character in.</span>
<a name="l05184"></a>05184 <span class="comment">   *</span>
<a name="l05185"></a>05185 <span class="comment">   * This very quick hash algorithm was tuned to work well with</span>
<a name="l05186"></a>05186 <span class="comment">   * strings ending with numbers.</span>
<a name="l05187"></a>05187 <span class="comment">   */</span>
<a name="l05188"></a>05188   ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) string;
<a name="l05189"></a>05189   <span class="keywordflow">while</span> ((ch = *ptr) != 0)
<a name="l05190"></a>05190     {
<a name="l05191"></a>05191       <span class="comment">/* Multiply hash_val by 17 by adding 16*hash_val to it.</span>
<a name="l05192"></a>05192 <span class="comment">       * (Use a shift, integer multiply is usually very expensive)</span>
<a name="l05193"></a>05193 <span class="comment">       */</span>
<a name="l05194"></a>05194       hash_val += (hash_val &lt;&lt; 4);
<a name="l05195"></a>05195 
<a name="l05196"></a>05196       <span class="comment">/* Add in character value */</span>
<a name="l05197"></a>05197       hash_val += ch;
<a name="l05198"></a>05198 
<a name="l05199"></a>05199       <span class="comment">/* Goto next character */</span>
<a name="l05200"></a>05200       ptr++;
<a name="l05201"></a>05201     }
<a name="l05202"></a>05202 
<a name="l05203"></a>05203   <span class="comment">/* Return the hash value */</span>
<a name="l05204"></a>05204   <span class="keywordflow">return</span> (hash_val);
<a name="l05205"></a>05205 }
<a name="l05206"></a>05206 
<a name="l05207"></a>05207 
<a name="l05208"></a>05208 <span class="comment">/* A content-addressable entry table used to delete redudant entries.</span>
<a name="l05209"></a>05209 <span class="comment"> * Will ignore "ignore_field" if not NULL when doing comparisons.</span>
<a name="l05210"></a>05210 <span class="comment"> * Automatically ignores the "original_name" field.</span>
<a name="l05211"></a>05211 <span class="comment"> *</span>
<a name="l05212"></a>05212 <span class="comment"> * Returns a content addressable entry table.</span>
<a name="l05213"></a>05213 <span class="comment"> */</span>
<a name="l05214"></a>05214 <a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> *
<a name="l05215"></a><a class="code" href="lmdes2__customizer_8c.html#f16fbbf8f638e1751157ef9598f2ef3a">05215</a> <a class="code" href="lmdes2__customizer_8c.html#f16fbbf8f638e1751157ef9598f2ef3a">ENTRY_new_contents_table</a> (<span class="keywordtype">char</span> *ignore_field, <span class="keywordtype">int</span> size)
<a name="l05216"></a>05216 {
<a name="l05217"></a>05217   <a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> *table;
<a name="l05218"></a>05218 
<a name="l05219"></a>05219   <span class="comment">/* Alloc table, create pool if necessary */</span>
<a name="l05220"></a>05220   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">ENTRY_Contents_Table_pool</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05221"></a>05221     {
<a name="l05222"></a>05222       <a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">ENTRY_Contents_Table_pool</a> =
<a name="l05223"></a>05223         <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#30a4dca94185560df25948489dee2d93">L_create_alloc_pool</a> (<span class="stringliteral">"ENTRY_Contents_Table"</span>,
<a name="l05224"></a>05224                              <span class="keyword">sizeof</span> (<a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a>), 1);
<a name="l05225"></a>05225     }
<a name="l05226"></a>05226   table = (<a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#0d726379da53889d3b6c91cb95afb7e2">L_alloc</a> (<a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">ENTRY_Contents_Table_pool</a>);
<a name="l05227"></a>05227 
<a name="l05228"></a>05228   <span class="comment">/* Create a int symbol table for the hash table */</span>
<a name="l05229"></a>05229   table-&gt;<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"entry_table"</span>, size);
<a name="l05230"></a>05230 
<a name="l05231"></a>05231   <span class="comment">/* Save the ignore field */</span>
<a name="l05232"></a>05232   <span class="keywordflow">if</span> (ignore_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05233"></a>05233     table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05234"></a>05234   <span class="keywordflow">else</span>
<a name="l05235"></a>05235     table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a> = strdup (ignore_field);
<a name="l05236"></a>05236 
<a name="l05237"></a>05237   <span class="comment">/* Return the table */</span>
<a name="l05238"></a>05238   <span class="keywordflow">return</span> (table);
<a name="l05239"></a>05239 }
<a name="l05240"></a>05240 <span class="comment">/* Returns the hash value for the contents an entry, </span>
<a name="l05241"></a>05241 <span class="comment"> * ignoring the original_name field and the ignore_field (if not</span>
<a name="l05242"></a>05242 <span class="comment"> * NULL).</span>
<a name="l05243"></a>05243 <span class="comment"> */</span>
<a name="l05244"></a>05244 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l05245"></a><a class="code" href="lmdes2__customizer_8c.html#5111443c1c6b69caeee383c07d23fdc1">05245</a> <a class="code" href="lmdes2__customizer_8c.html#5111443c1c6b69caeee383c07d23fdc1">ENTRY_hash_contents</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry1, <span class="keywordtype">char</span> *ignore_field)
<a name="l05246"></a>05246 {
<a name="l05247"></a>05247   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l05248"></a>05248   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field1;
<a name="l05249"></a>05249   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html">MD_Element</a> *element1;
<a name="l05250"></a>05250   <span class="keywordtype">int</span> i;
<a name="l05251"></a>05251   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_val;
<a name="l05252"></a>05252 <span class="preprocessor">#ifdef LP64_ARCHITECTURE</span>
<a name="l05253"></a>05253 <span class="preprocessor"></span>  <span class="keywordtype">long</span> element_val = 0;
<a name="l05254"></a>05254 <span class="preprocessor">#else</span>
<a name="l05255"></a>05255 <span class="preprocessor"></span>  <span class="keywordtype">int</span> element_val = 0;
<a name="l05256"></a>05256 <span class="preprocessor">#endif</span>
<a name="l05257"></a>05257 <span class="preprocessor"></span>
<a name="l05258"></a>05258   hash_val = 0;
<a name="l05259"></a>05259 
<a name="l05260"></a>05260   <span class="comment">/* Hash all the field values together */</span>
<a name="l05261"></a>05261   <span class="keywordflow">for</span> (field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#ec8db6e1a71d3ca153e81e270872e8a4">MD_first_field_decl</a> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>);
<a name="l05262"></a>05262        field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a1591f954c0b8b00c6a22356c02024ff">MD_next_field_decl</a> (field_decl))
<a name="l05263"></a>05263     {
<a name="l05264"></a>05264       <span class="comment">/* Skip testing this field decl if field is original_name */</span>
<a name="l05265"></a>05265       <span class="keywordflow">if</span> (strcmp (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>, <span class="stringliteral">"original_name"</span>) == 0)
<a name="l05266"></a>05266         <span class="keywordflow">continue</span>;
<a name="l05267"></a>05267 
<a name="l05268"></a>05268       <span class="comment">/* Skip testing this field decl if field is ignore_field</span>
<a name="l05269"></a>05269 <span class="comment">       * (don't do test if NULL)</span>
<a name="l05270"></a>05270 <span class="comment">       */</span>
<a name="l05271"></a>05271       <span class="keywordflow">if</span> ((ignore_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l05272"></a>05272           (strcmp (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>, ignore_field) == 0))
<a name="l05273"></a>05273         <span class="keywordflow">continue</span>;
<a name="l05274"></a>05274 
<a name="l05275"></a>05275       <span class="comment">/* Get the field */</span>
<a name="l05276"></a>05276       field1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (entry1, field_decl);
<a name="l05277"></a>05277 
<a name="l05278"></a>05278       <span class="comment">/* Skip field if NULL (hash in zero) */</span>
<a name="l05279"></a>05279       <span class="keywordflow">if</span> (field1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05280"></a>05280         {
<a name="l05281"></a>05281           hash_val += (hash_val &lt;&lt; 4) + 0;
<a name="l05282"></a>05282           <span class="keywordflow">continue</span>;
<a name="l05283"></a>05283         }
<a name="l05284"></a>05284 
<a name="l05285"></a>05285       <span class="comment">/* Hash in each element in field */</span>
<a name="l05286"></a>05286       <span class="keywordflow">for</span> (i = field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i &gt;= 0; i--)
<a name="l05287"></a>05287         {
<a name="l05288"></a>05288           element1 = field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[i];
<a name="l05289"></a>05289 
<a name="l05290"></a>05290           <span class="comment">/* Get element hash value, use 0 if element NULL */</span>
<a name="l05291"></a>05291           <span class="keywordflow">if</span> (element1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05292"></a>05292             {
<a name="l05293"></a>05293               element_val = 0;
<a name="l05294"></a>05294             }
<a name="l05295"></a>05295           <span class="keywordflow">else</span>
<a name="l05296"></a>05296             {
<a name="l05297"></a>05297               <span class="comment">/* Compare element contents */</span>
<a name="l05298"></a>05298               <span class="keywordflow">switch</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>)
<a name="l05299"></a>05299                 {
<a name="l05300"></a>05300                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>:
<a name="l05301"></a>05301                   element_val = element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#ddc89f1d5b71c37749d7d4b127c9cbcc">i</a>;
<a name="l05302"></a>05302                   <span class="keywordflow">break</span>;
<a name="l05303"></a>05303 
<a name="l05304"></a>05304                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d613c66d34f25d733291ba6118f1e2cd">MD_DOUBLE</a>:
<a name="l05305"></a>05305                   element_val = (int) element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#4b52f5c2e23bfb338782ec870c37e707">d</a>;
<a name="l05306"></a>05306                   <span class="keywordflow">break</span>;
<a name="l05307"></a>05307 
<a name="l05308"></a>05308                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#00aaba1fc61d6e7046112b9477287b70">MD_STRING</a>:
<a name="l05309"></a>05309                   element_val = <a class="code" href="lmdes2__customizer_8c.html#2c1c0879b965f678466adfa8d6c8e412">CU_hash_string</a> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#c8b36c70d4d891dedd5a77fe0e9ac6c3">s</a>);
<a name="l05310"></a>05310                   <span class="keywordflow">break</span>;
<a name="l05311"></a>05311 
<a name="l05312"></a>05312                 <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>:
<a name="l05313"></a>05313 <span class="preprocessor">#ifdef LP64_ARCHITECTURE</span>
<a name="l05314"></a>05314 <span class="preprocessor"></span>                  element_val = ((long) element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#fe38034d03fdff6c30058ca01aef6015">l</a>) &gt;&gt; 2;
<a name="l05315"></a>05315 <span class="preprocessor">#else</span>
<a name="l05316"></a>05316 <span class="preprocessor"></span>                  element_val = ((int) element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#fe38034d03fdff6c30058ca01aef6015">l</a>) &gt;&gt; 2;
<a name="l05317"></a>05317 <span class="preprocessor">#endif</span>
<a name="l05318"></a>05318 <span class="preprocessor"></span>                  <span class="keywordflow">break</span>;
<a name="l05319"></a>05319 
<a name="l05320"></a>05320                 <span class="keywordflow">default</span>:
<a name="l05321"></a>05321                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l05322"></a>05322                           <span class="stringliteral">"ENTRY_hash_contents: unknown element type %i"</span>,
<a name="l05323"></a>05323                           element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>);
<a name="l05324"></a>05324                 }
<a name="l05325"></a>05325             }
<a name="l05326"></a>05326 
<a name="l05327"></a>05327           hash_val += (hash_val &lt;&lt; 4) + element_val;
<a name="l05328"></a>05328         }
<a name="l05329"></a>05329     }
<a name="l05330"></a>05330 
<a name="l05331"></a>05331   <span class="comment">/* Return the hashed value */</span>
<a name="l05332"></a>05332   <span class="keywordflow">return</span> (hash_val);
<a name="l05333"></a>05333 }
<a name="l05334"></a>05334 
<a name="l05335"></a>05335 <span class="keywordtype">void</span>
<a name="l05336"></a><a class="code" href="lmdes2__customizer_8c.html#f8b740c45578bf755315091df166950f">05336</a> <a class="code" href="lmdes2__customizer_8c.html#f8b740c45578bf755315091df166950f">ENTRY_add_contents</a> (<a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> * table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l05337"></a>05337 {
<a name="l05338"></a>05338   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *symbol;
<a name="l05339"></a>05339   <a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>;
<a name="l05340"></a>05340   <span class="keywordtype">int</span> hash_val;
<a name="l05341"></a>05341 
<a name="l05342"></a>05342   <span class="comment">/* Get the hash_val for this entry */</span>
<a name="l05343"></a>05343   hash_val = (int) <a class="code" href="lmdes2__customizer_8c.html#5111443c1c6b69caeee383c07d23fdc1">ENTRY_hash_contents</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>);
<a name="l05344"></a>05344 
<a name="l05345"></a>05345   <span class="comment">/* Find symbol for hash value, if already exists */</span>
<a name="l05346"></a>05346   <span class="keywordflow">if</span> ((symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a>, hash_val)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05347"></a>05347     {
<a name="l05348"></a>05348       <span class="comment">/* Sanity check, make sure contents does not already exist </span>
<a name="l05349"></a>05349 <span class="comment"></span>
<a name="l05350"></a>05350 <span class="comment">       * Punt if it is, since can cause major debugging nighmares.</span>
<a name="l05351"></a>05351 <span class="comment">       */</span>
<a name="l05352"></a>05352       <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *) symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>; <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05353"></a>05353            <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;next_node)
<a name="l05354"></a>05354         {
<a name="l05355"></a>05355           <span class="comment">/* Better not already be in list */</span>
<a name="l05356"></a>05356           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;entry, table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>))
<a name="l05357"></a>05357             {
<a name="l05358"></a>05358               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry-&gt;section-&gt;md,
<a name="l05359"></a>05359                       <span class="stringliteral">"ENTRY_add_contents: cannot add '%s', "</span>
<a name="l05360"></a>05360                       <span class="stringliteral">"contents already in table!"</span>, entry-&gt;name);
<a name="l05361"></a>05361             }
<a name="l05362"></a>05362         }
<a name="l05363"></a>05363     }
<a name="l05364"></a>05364 
<a name="l05365"></a>05365   <span class="comment">/* Otherwise, create symbol for this hash value */</span>
<a name="l05366"></a>05366   <span class="keywordflow">else</span>
<a name="l05367"></a>05367     {
<a name="l05368"></a>05368       <span class="comment">/* Create symbol with NULL data.  Content node will be added later */</span>
<a name="l05369"></a>05369       symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a>, hash_val, (<span class="keywordtype">void</span> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05370"></a>05370     }
<a name="l05371"></a>05371 
<a name="l05372"></a>05372   <span class="comment">/* Create a node for this entry (initialize pool if necessary) */</span>
<a name="l05373"></a>05373   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">ENTRY_Contents_Node_pool</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05374"></a>05374     {
<a name="l05375"></a>05375       <a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">ENTRY_Contents_Node_pool</a> =
<a name="l05376"></a>05376         <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#30a4dca94185560df25948489dee2d93">L_create_alloc_pool</a> (<span class="stringliteral">"ENTRY_Contents_Node"</span>,
<a name="l05377"></a>05377                              <span class="keyword">sizeof</span> (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a>), 64);
<a name="l05378"></a>05378     }
<a name="l05379"></a>05379   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#0d726379da53889d3b6c91cb95afb7e2">L_alloc</a> (<a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">ENTRY_Contents_Node_pool</a>);
<a name="l05380"></a>05380 
<a name="l05381"></a>05381   <span class="comment">/* Initialize fields */</span>
<a name="l05382"></a>05382   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;entry = entry;
<a name="l05383"></a>05383   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;next_node = (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *) symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l05384"></a>05384 
<a name="l05385"></a>05385   <span class="comment">/* Add to front of symbol list */</span>
<a name="l05386"></a>05386   symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = (<span class="keywordtype">void</span> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>;
<a name="l05387"></a>05387 }
<a name="l05388"></a>05388 
<a name="l05389"></a>05389 <span class="comment">/* Returns the entry pointer if match found, NULL otherwise */</span>
<a name="l05390"></a>05390 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *
<a name="l05391"></a><a class="code" href="lmdes2__customizer_8c.html#7b037f4ab90fd72816810e1990293073">05391</a> <a class="code" href="lmdes2__customizer_8c.html#7b037f4ab90fd72816810e1990293073">ENTRY_find_match</a> (<a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> * table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l05392"></a>05392 {
<a name="l05393"></a>05393   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *symbol;
<a name="l05394"></a>05394   <a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>;
<a name="l05395"></a>05395   <span class="keywordtype">int</span> hash_val;
<a name="l05396"></a>05396 
<a name="l05397"></a>05397   <span class="comment">/* Get the hash_val for this entry */</span>
<a name="l05398"></a>05398   hash_val = (int) <a class="code" href="lmdes2__customizer_8c.html#5111443c1c6b69caeee383c07d23fdc1">ENTRY_hash_contents</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>);
<a name="l05399"></a>05399 
<a name="l05400"></a>05400   <span class="comment">/* Find symbol for hash value */</span>
<a name="l05401"></a>05401   <span class="keywordflow">if</span> ((symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a>, hash_val)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05402"></a>05402     {
<a name="l05403"></a>05403       <span class="comment">/* Search nodes with same hash value for match */</span>
<a name="l05404"></a>05404       <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *) symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>; <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05405"></a>05405            <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;next_node)
<a name="l05406"></a>05406         {
<a name="l05407"></a>05407           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (entry, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;entry, table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>))
<a name="l05408"></a>05408             {
<a name="l05409"></a>05409               <span class="comment">/* Return matching entry */</span>
<a name="l05410"></a>05410               <span class="keywordflow">return</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;entry);
<a name="l05411"></a>05411             }
<a name="l05412"></a>05412         }
<a name="l05413"></a>05413     }
<a name="l05414"></a>05414 
<a name="l05415"></a>05415   <span class="comment">/* If got here, match was not found */</span>
<a name="l05416"></a>05416   <span class="keywordflow">return</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05417"></a>05417 }
<a name="l05418"></a>05418 
<a name="l05419"></a>05419 <span class="comment">/* Frees all the nodes in a content node list.  </span>
<a name="l05420"></a>05420 <span class="comment"> * Used by ENTRY_delete_contents_table.</span>
<a name="l05421"></a>05421 <span class="comment"> */</span>
<a name="l05422"></a>05422 <span class="keywordtype">void</span>
<a name="l05423"></a><a class="code" href="lmdes2__customizer_8c.html#9ce7b111a4ff0767a08abb0fd60b3ad3">05423</a> <a class="code" href="lmdes2__customizer_8c.html#9ce7b111a4ff0767a08abb0fd60b3ad3">ENTRY_free_nodes</a> (<a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> * first_node)
<a name="l05424"></a>05424 {
<a name="l05425"></a>05425   <a class="code" href="structENTRY__Contents__Node.html">ENTRY_Contents_Node</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>, *<a class="code" href="structENTRY__Contents__Node.html#9a1cf42f115da41c98d28ff488611a8f">next_node</a>;
<a name="l05426"></a>05426 
<a name="l05427"></a>05427   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = first_node; <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a> = <a class="code" href="structENTRY__Contents__Node.html#9a1cf42f115da41c98d28ff488611a8f">next_node</a>)
<a name="l05428"></a>05428     {
<a name="l05429"></a>05429       <span class="comment">/* Get the next node before deleting this one */</span>
<a name="l05430"></a>05430       <a class="code" href="structENTRY__Contents__Node.html#9a1cf42f115da41c98d28ff488611a8f">next_node</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>-&gt;next_node;
<a name="l05431"></a>05431 
<a name="l05432"></a>05432       <span class="comment">/* Don't free contents, still in md */</span>
<a name="l05433"></a>05433       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#de8b565e7dd21f448acc6fd31bea94ac">L_free</a> (<a class="code" href="lmdes2__customizer_8c.html#8f9a19ca198e5d6477591152edc4b9e9">ENTRY_Contents_Node_pool</a>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#69971143e908d3fc31e596632d5a4073">node</a>);
<a name="l05434"></a>05434     }
<a name="l05435"></a>05435 }
<a name="l05436"></a>05436 
<a name="l05437"></a>05437 <span class="keywordtype">void</span>
<a name="l05438"></a><a class="code" href="lmdes2__customizer_8c.html#935d5d6ef4bbee76bfd07e7f15b71b71">05438</a> <a class="code" href="lmdes2__customizer_8c.html#935d5d6ef4bbee76bfd07e7f15b71b71">ENTRY_delete_contents_table</a> (<a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> * table)
<a name="l05439"></a>05439 {
<a name="l05440"></a>05440 
<a name="l05441"></a>05441   <span class="comment">/* Delete the hash table */</span>
<a name="l05442"></a>05442   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#849c8abfa8c7e646434e26dbfa80fada">hash_table</a>,
<a name="l05443"></a>05443                            (void (*)(<span class="keywordtype">void</span> *)) <a class="code" href="lmdes2__customizer_8c.html#9ce7b111a4ff0767a08abb0fd60b3ad3">ENTRY_free_nodes</a>);
<a name="l05444"></a>05444 
<a name="l05445"></a>05445   <span class="comment">/* Free the ignore field if it exists */</span>
<a name="l05446"></a>05446   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05447"></a>05447     free (table-&gt;<a class="code" href="structENTRY__Contents__Table.html#ce208a4e15a5fadc43a213d8a4a24dd1">ignore_field</a>);
<a name="l05448"></a>05448 
<a name="l05449"></a>05449   <span class="comment">/* Free the table */</span>
<a name="l05450"></a>05450   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/l__alloc__new_8c.html#de8b565e7dd21f448acc6fd31bea94ac">L_free</a> (<a class="code" href="lmdes2__customizer_8c.html#28bf32dd862451062fe00d50a0e83cac">ENTRY_Contents_Table_pool</a>, table);
<a name="l05451"></a>05451 }
<a name="l05452"></a>05452 
<a name="l05453"></a>05453 <span class="comment">/* Returns 1 if the field contents of the two entries are identical,</span>
<a name="l05454"></a>05454 <span class="comment"> * ignoring the original_name field and the ignore_field (if not</span>
<a name="l05455"></a>05455 <span class="comment"> * NULL).</span>
<a name="l05456"></a>05456 <span class="comment"> */</span>
<a name="l05457"></a>05457 <span class="keywordtype">int</span>
<a name="l05458"></a><a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">05458</a> <a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry1, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * entry2,
<a name="l05459"></a>05459                       <span class="keywordtype">char</span> *ignore_field)
<a name="l05460"></a>05460 {
<a name="l05461"></a>05461   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l05462"></a>05462   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field1, *field2;
<a name="l05463"></a>05463   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html">MD_Element</a> *element1, *element2;
<a name="l05464"></a>05464   <span class="keywordtype">int</span> i;
<a name="l05465"></a>05465 
<a name="l05466"></a>05466   <span class="comment">/* These entries better be in the same section */</span>
<a name="l05467"></a>05467   <span class="keywordflow">if</span> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a> != entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>)
<a name="l05468"></a>05468     {
<a name="l05469"></a>05469       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l05470"></a>05470               <span class="stringliteral">"CU_redundant_entries: entries have different sections %s&amp;%s"</span>,
<a name="l05471"></a>05471               entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, entry2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l05472"></a>05472     }
<a name="l05473"></a>05473 
<a name="l05474"></a>05474   <span class="comment">/* Scan the field declarations looking for differences */</span>
<a name="l05475"></a>05475   <span class="keywordflow">for</span> (field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#ec8db6e1a71d3ca153e81e270872e8a4">MD_first_field_decl</a> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>);
<a name="l05476"></a>05476        field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#a1591f954c0b8b00c6a22356c02024ff">MD_next_field_decl</a> (field_decl))
<a name="l05477"></a>05477     {
<a name="l05478"></a>05478       <span class="comment">/* Skip testing this field decl if field is original_name */</span>
<a name="l05479"></a>05479       <span class="keywordflow">if</span> (strcmp (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>, <span class="stringliteral">"original_name"</span>) == 0)
<a name="l05480"></a>05480         <span class="keywordflow">continue</span>;
<a name="l05481"></a>05481 
<a name="l05482"></a>05482       <span class="comment">/* Skip testing this field decl if field is ignore_field</span>
<a name="l05483"></a>05483 <span class="comment">       * (don't do test if NULL)</span>
<a name="l05484"></a>05484 <span class="comment">       */</span>
<a name="l05485"></a>05485       <span class="keywordflow">if</span> ((ignore_field != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l05486"></a>05486           (strcmp (field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>, ignore_field) == 0))
<a name="l05487"></a>05487         <span class="keywordflow">continue</span>;
<a name="l05488"></a>05488 
<a name="l05489"></a>05489       <span class="comment">/* Get the two fields */</span>
<a name="l05490"></a>05490       field1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (entry1, field_decl);
<a name="l05491"></a>05491       field2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (entry2, field_decl);
<a name="l05492"></a>05492 
<a name="l05493"></a>05493       <span class="comment">/* If they are both NULL, they match so far... */</span>
<a name="l05494"></a>05494       <span class="keywordflow">if</span> ((field1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (field2 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l05495"></a>05495         <span class="keywordflow">continue</span>;
<a name="l05496"></a>05496 
<a name="l05497"></a>05497       <span class="comment">/* If they are not both NULL, neither may be NULL to match */</span>
<a name="l05498"></a>05498       <span class="keywordflow">if</span> ((field1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (field2 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l05499"></a>05499         <span class="keywordflow">return</span> (0);
<a name="l05500"></a>05500 
<a name="l05501"></a>05501 
<a name="l05502"></a>05502       <span class="comment">/* They must have the same number of elements to match */</span>
<a name="l05503"></a>05503       <span class="keywordflow">if</span> (field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != field2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>)
<a name="l05504"></a>05504         <span class="keywordflow">return</span> (0);
<a name="l05505"></a>05505 
<a name="l05506"></a>05506       <span class="comment">/* Compare each element in the fields */</span>
<a name="l05507"></a>05507       <span class="keywordflow">for</span> (i = field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i &gt;= 0; i--)
<a name="l05508"></a>05508         {
<a name="l05509"></a>05509           element1 = field1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[i];
<a name="l05510"></a>05510           element2 = field2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[i];
<a name="l05511"></a>05511 
<a name="l05512"></a>05512           <span class="comment">/* If they are both NULL, they match so far... */</span>
<a name="l05513"></a>05513           <span class="keywordflow">if</span> ((element1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (element2 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l05514"></a>05514             <span class="keywordflow">continue</span>;
<a name="l05515"></a>05515 
<a name="l05516"></a>05516           <span class="comment">/* If they are not both NULL, neither may be NULL to match */</span>
<a name="l05517"></a>05517           <span class="keywordflow">if</span> ((element1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (element2 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l05518"></a>05518             <span class="keywordflow">return</span> (0);
<a name="l05519"></a>05519 
<a name="l05520"></a>05520           <span class="comment">/* Must be the same type of element to match */</span>
<a name="l05521"></a>05521           <span class="keywordflow">if</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != element2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>)
<a name="l05522"></a>05522             <span class="keywordflow">return</span> (0);
<a name="l05523"></a>05523 
<a name="l05524"></a>05524           <span class="comment">/* Compare element contents */</span>
<a name="l05525"></a>05525           <span class="keywordflow">switch</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>)
<a name="l05526"></a>05526             {
<a name="l05527"></a>05527             <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1bae96f31ca512cf27a95ab6f96f4d89">MD_INT</a>:
<a name="l05528"></a>05528               <span class="keywordflow">if</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#ddc89f1d5b71c37749d7d4b127c9cbcc">i</a> != element2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#ddc89f1d5b71c37749d7d4b127c9cbcc">i</a>)
<a name="l05529"></a>05529                 <span class="keywordflow">return</span> (0);
<a name="l05530"></a>05530               <span class="keywordflow">break</span>;
<a name="l05531"></a>05531 
<a name="l05532"></a>05532             <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d613c66d34f25d733291ba6118f1e2cd">MD_DOUBLE</a>:
<a name="l05533"></a>05533               <span class="keywordflow">if</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#4b52f5c2e23bfb338782ec870c37e707">d</a> != element2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#4b52f5c2e23bfb338782ec870c37e707">d</a>)
<a name="l05534"></a>05534                 <span class="keywordflow">return</span> (0);
<a name="l05535"></a>05535               <span class="keywordflow">break</span>;
<a name="l05536"></a>05536 
<a name="l05537"></a>05537             <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#00aaba1fc61d6e7046112b9477287b70">MD_STRING</a>:
<a name="l05538"></a>05538               <span class="keywordflow">if</span> (strcmp (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#c8b36c70d4d891dedd5a77fe0e9ac6c3">s</a>, element2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#c8b36c70d4d891dedd5a77fe0e9ac6c3">s</a>) != 0)
<a name="l05539"></a>05539                 <span class="keywordflow">return</span> (0);
<a name="l05540"></a>05540               <span class="keywordflow">break</span>;
<a name="l05541"></a>05541 
<a name="l05542"></a>05542             <span class="keywordflow">case</span> <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>:
<a name="l05543"></a>05543               <span class="keywordflow">if</span> (element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#fe38034d03fdff6c30058ca01aef6015">l</a> != element2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#d17591983c492ef322ed5237a3ecd79c">value</a>.<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/unionMD__Element_1_1@3.html#fe38034d03fdff6c30058ca01aef6015">l</a>)
<a name="l05544"></a>05544                 <span class="keywordflow">return</span> (0);
<a name="l05545"></a>05545               <span class="keywordflow">break</span>;
<a name="l05546"></a>05546 
<a name="l05547"></a>05547             <span class="keywordflow">default</span>:
<a name="l05548"></a>05548               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (entry1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l05549"></a>05549                       <span class="stringliteral">"CU_redundant_entries: unknown element type %i"</span>,
<a name="l05550"></a>05550                       element1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a>);
<a name="l05551"></a>05551             }
<a name="l05552"></a>05552         }
<a name="l05553"></a>05553     }
<a name="l05554"></a>05554 
<a name="l05555"></a>05555   <span class="comment">/* If got here, they must have the same contents (be redundant) */</span>
<a name="l05556"></a>05556   <span class="keywordflow">return</span> (1);
<a name="l05557"></a>05557 }
<a name="l05558"></a>05558 
<a name="l05559"></a>05559 <span class="comment">/* Replace references (links) to old_entry with new_entry */</span>
<a name="l05560"></a>05560 <span class="keywordtype">void</span>
<a name="l05561"></a><a class="code" href="lmdes2__customizer_8c.html#e91f10afbc8636670c067c17090d0cf3">05561</a> <a class="code" href="lmdes2__customizer_8c.html#e91f10afbc8636670c067c17090d0cf3">CU_replace_references</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * link_table,
<a name="l05562"></a>05562                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * remap_table)
<a name="l05563"></a>05563 {
<a name="l05564"></a>05564   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *link_decl;
<a name="l05565"></a>05565   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *link_symbol;
<a name="l05566"></a>05566   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *scan_entry, *target_entry;
<a name="l05567"></a>05567   <a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *remap_entry;
<a name="l05568"></a>05568   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *scan_field;
<a name="l05569"></a>05569   <span class="keywordtype">int</span> index;
<a name="l05570"></a>05570 
<a name="l05571"></a>05571   <span class="comment">/* Go through each field declaration that links to this section looking</span>
<a name="l05572"></a>05572 <span class="comment">   * for a reference in the remap table.</span>
<a name="l05573"></a>05573 <span class="comment">   */</span>
<a name="l05574"></a>05574   <span class="keywordflow">for</span> (link_symbol = link_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; link_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05575"></a>05575        link_symbol = link_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l05576"></a>05576     {
<a name="l05577"></a>05577       <span class="comment">/* Get field decl */</span>
<a name="l05578"></a>05578       link_decl = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *) link_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l05579"></a>05579 
<a name="l05580"></a>05580       <span class="comment">/* Scan all the entries in that field's section */</span>
<a name="l05581"></a>05581       for (scan_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (link_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#873f013f5dda7d8c245dabc43ac88b4f">section</a>);
<a name="l05582"></a>05582            scan_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; scan_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (scan_entry))
<a name="l05583"></a>05583         {
<a name="l05584"></a>05584           <span class="comment">/* Get the ref field for this entry, go to next if NULL */</span>
<a name="l05585"></a>05585           <span class="keywordflow">if</span> ((scan_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (scan_entry, link_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05586"></a>05586             <span class="keywordflow">continue</span>;
<a name="l05587"></a>05587 
<a name="l05588"></a>05588           <span class="comment">/* Scan all elements of the field */</span>
<a name="l05589"></a>05589           <span class="keywordflow">for</span> (index = scan_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index &gt;= 0; index--)
<a name="l05590"></a>05590             {
<a name="l05591"></a>05591               <span class="comment">/* Test only links */</span>
<a name="l05592"></a>05592               <span class="keywordflow">if</span> (scan_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#30c6e5daf8c090f3d509cf9ab75affd6">element</a>[index]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Element.html#c34e74cf17ccd87475b57333419766ed">type</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#832ab6cc636240c071152b8bd2824ff9">MD_LINK</a>)
<a name="l05593"></a>05593                 <span class="keywordflow">continue</span>;
<a name="l05594"></a>05594 
<a name="l05595"></a>05595               <span class="comment">/* If link to entry in remap table, replace with link to </span>
<a name="l05596"></a>05596 <span class="comment">               * remap_entry */</span>
<a name="l05597"></a>05597               target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (scan_field, index);
<a name="l05598"></a>05598               <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of</span>
<a name="l05599"></a>05599 <span class="comment">               *              target_entry before looking it up. */</span>
<a name="l05600"></a>05600               remap_entry = (<a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *) \
<a name="l05601"></a>05601                 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (remap_table,
<a name="l05602"></a>05602                                       ((<span class="keywordtype">long</span>) target_entry &amp; \
<a name="l05603"></a>05603                                        (<span class="keywordtype">long</span>) 0xffffffff));
<a name="l05604"></a>05604 
<a name="l05605"></a>05605               <span class="keywordflow">if</span> (remap_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05606"></a>05606                 {
<a name="l05607"></a>05607 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l05608"></a>05608 <span class="preprocessor"></span>                  printf (<span class="stringliteral">"  Replacing %s in %s-&gt;%s\n"</span>,
<a name="l05609"></a>05609                           target_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l05610"></a>05610                           scan_entry-&gt;section-&gt;name, scan_entry-&gt;name);
<a name="l05611"></a>05611 <span class="preprocessor">#endif</span>
<a name="l05612"></a>05612 <span class="preprocessor"></span>                  <span class="comment">/* 11/14/02 REK Changing this to use the to field of the</span>
<a name="l05613"></a>05613 <span class="comment">                   *              Pointer_Mapping structure.  This field used</span>
<a name="l05614"></a>05614 <span class="comment">                   *              to be stored in the data section of the</span>
<a name="l05615"></a>05615 <span class="comment">                   *              symbol. */</span>
<a name="l05616"></a>05616                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (scan_field, index, remap_entry-&gt;<a class="code" href="structPointer__Mapping.html#78ef5abc3b5cb05326bb41277ec887e3">to</a>);
<a name="l05617"></a>05617                 }
<a name="l05618"></a>05618             }
<a name="l05619"></a>05619         }
<a name="l05620"></a>05620     }
<a name="l05621"></a>05621 }
<a name="l05622"></a>05622 
<a name="l05623"></a>05623 <span class="keywordtype">int</span>
<a name="l05624"></a><a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">05624</a> <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name)
<a name="l05625"></a>05625 {
<a name="l05626"></a>05626   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l05627"></a>05627   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *entry1, *next_entry1, *matching_entry;
<a name="l05628"></a>05628   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *link_table, *remap_table;
<a name="l05629"></a>05629   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *remap_symbol;
<a name="l05630"></a>05630   <a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> *contents_table;
<a name="l05631"></a>05631   <a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *mapping;
<a name="l05632"></a>05632   <span class="keywordtype">int</span> eliminate_count;
<a name="l05633"></a>05633 
<a name="l05634"></a>05634   eliminate_count = 0;
<a name="l05635"></a>05635 
<a name="l05636"></a>05636   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l05637"></a>05637 
<a name="l05638"></a>05638   <span class="comment">/* Create a contents-addressable table for the entries in this section </span>
<a name="l05639"></a>05639 <span class="comment">   * (no extra fields will be ignored during contents comparisons) </span>
<a name="l05640"></a>05640 <span class="comment">   * Set initial size to number of entries in section.</span>
<a name="l05641"></a>05641 <span class="comment">   */</span>
<a name="l05642"></a>05642   contents_table =
<a name="l05643"></a>05643     <a class="code" href="lmdes2__customizer_8c.html#f16fbbf8f638e1751157ef9598f2ef3a">ENTRY_new_contents_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#efaf1eb833608de0fd1909ecb40e2671">entry_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Symbol__Table.html#560dcf5e5fca3abec8c2379e98e29bd2">symbol_count</a>);
<a name="l05644"></a>05644 
<a name="l05645"></a>05645   <span class="comment">/* Create a remap table for the remappings that will be required to</span>
<a name="l05646"></a>05646 <span class="comment">   * eliminate redundant entries.</span>
<a name="l05647"></a>05647 <span class="comment">   */</span>
<a name="l05648"></a>05648   remap_table = <a class="code" href="lmdes2__customizer_8c.html#7a6ced70906068dcb26b7acce31d0ca9">build_remap_table</a> (section);
<a name="l05649"></a>05649 
<a name="l05650"></a>05650   <span class="comment">/* Use a symbol table to hold all the field declarations that</span>
<a name="l05651"></a>05651 <span class="comment">   * link to this section.</span>
<a name="l05652"></a>05652 <span class="comment">   */</span>
<a name="l05653"></a>05653   link_table = <a class="code" href="lmdes2__customizer_8c.html#5c514dd5e4fda6d0660bfaf6ea103344">build_link_table</a> (md, section);
<a name="l05654"></a>05654 
<a name="l05655"></a>05655   <span class="comment">/* Punt if no links to this sections found since the name of this entry</span>
<a name="l05656"></a>05656 <span class="comment">   * must the the only way to the compiler to access this information,</span>
<a name="l05657"></a>05657 <span class="comment">   * and we cannot deletine names the compiler is expecting!</span>
<a name="l05658"></a>05658 <span class="comment">   */</span>
<a name="l05659"></a>05659   <span class="keywordflow">if</span> (link_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05660"></a>05660     {
<a name="l05661"></a>05661       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l05662"></a>05662               <span class="stringliteral">"eliminate_redundant_entries: No sections link to '%s'!"</span>,
<a name="l05663"></a>05663               section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l05664"></a>05664     }
<a name="l05665"></a>05665 
<a name="l05666"></a>05666   <span class="comment">/* Scan each entry looking for identical entries later in the section */</span>
<a name="l05667"></a>05667   <span class="keywordflow">for</span> (entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); entry1 != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05668"></a>05668        entry1 = next_entry1)
<a name="l05669"></a>05669     {
<a name="l05670"></a>05670       <span class="comment">/* Get the next entry before possibly deleting this one */</span>
<a name="l05671"></a>05671       next_entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (entry1);
<a name="l05672"></a>05672 
<a name="l05673"></a>05673       <span class="comment">/* If there is already an entry with the same contents as entry1,</span>
<a name="l05674"></a>05674 <span class="comment">       * delete entry1.</span>
<a name="l05675"></a>05675 <span class="comment">       */</span>
<a name="l05676"></a>05676       <span class="comment">/* Find previous entry, if any, with the same contents as entry1 */</span>
<a name="l05677"></a>05677       matching_entry = <a class="code" href="lmdes2__customizer_8c.html#7b037f4ab90fd72816810e1990293073">ENTRY_find_match</a> (contents_table, entry1);
<a name="l05678"></a>05678 
<a name="l05679"></a>05679       <span class="comment">/* If matching entry found, point all uses of entry1 at the matching</span>
<a name="l05680"></a>05680 <span class="comment">       * entry and delete entry1.</span>
<a name="l05681"></a>05681 <span class="comment">       */</span>
<a name="l05682"></a>05682       <span class="keywordflow">if</span> (matching_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05683"></a>05683         {
<a name="l05684"></a>05684           <span class="comment">/* Add entry to replace all references (links) to entry1 </span>
<a name="l05685"></a>05685 <span class="comment">           * with matching_entry.</span>
<a name="l05686"></a>05686 <span class="comment">           */</span>
<a name="l05687"></a>05687           <a class="code" href="lmdes2__customizer_8c.html#81b5e74760544ee45c3246205a9db199">add_remap_entry</a> (remap_table, entry1, matching_entry);
<a name="l05688"></a>05688 
<a name="l05689"></a>05689 
<a name="l05690"></a>05690         }
<a name="l05691"></a>05691 
<a name="l05692"></a>05692       <span class="comment">/* Otherwise, add this entry to the content-addressable table */</span>
<a name="l05693"></a>05693       <span class="keywordflow">else</span>
<a name="l05694"></a>05694         {
<a name="l05695"></a>05695           <a class="code" href="lmdes2__customizer_8c.html#f8b740c45578bf755315091df166950f">ENTRY_add_contents</a> (contents_table, entry1);
<a name="l05696"></a>05696         }
<a name="l05697"></a>05697     }
<a name="l05698"></a>05698 
<a name="l05699"></a>05699   <span class="comment">/* Replace references (links) to entry1 with matching_entry </span>
<a name="l05700"></a>05700 <span class="comment">   * for all the remaps in the remap_table</span>
<a name="l05701"></a>05701 <span class="comment">   */</span>
<a name="l05702"></a>05702   <a class="code" href="lmdes2__customizer_8c.html#e91f10afbc8636670c067c17090d0cf3">CU_replace_references</a> (link_table, remap_table);
<a name="l05703"></a>05703 
<a name="l05704"></a>05704   <span class="comment">/* Delete all the entries that were remapped  */</span>
<a name="l05705"></a>05705   <span class="keywordflow">for</span> (remap_symbol = remap_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; remap_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05706"></a>05706        remap_symbol = remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l05707"></a>05707     {
<a name="l05708"></a>05708       <span class="comment">/* Delete from_entry now all links point to to_entry */</span>
<a name="l05709"></a>05709       <span class="comment">/* 11/14/02 REK The 32 bit address used to be stored in the value section</span>
<a name="l05710"></a>05710 <span class="comment">       *              of remap_symbol.  The full 64 bit address is now stored</span>
<a name="l05711"></a>05711 <span class="comment">       *              in the from field of the data section of remap_symbol. */</span>
<a name="l05712"></a>05712       mapping = (<a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *) remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l05713"></a>05713       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> ((<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) mapping-&gt;<a class="code" href="structPointer__Mapping.html#661c5e8b6062b1e7d04fdcfd8f2df2c4">from</a>);
<a name="l05714"></a>05714 
<a name="l05715"></a>05715       <span class="comment">/* Update count */</span>
<a name="l05716"></a>05716       eliminate_count++;
<a name="l05717"></a>05717     }
<a name="l05718"></a>05718 
<a name="l05719"></a>05719   <span class="comment">/* Free the remap table */</span>
<a name="l05720"></a>05720   <a class="code" href="lmdes2__customizer_8c.html#7b841160a37c9819cb24c2709727eb58">free_remap_table</a> (remap_table);
<a name="l05721"></a>05721 
<a name="l05722"></a>05722 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l05723"></a>05723 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (eliminate_count &gt; 0)
<a name="l05724"></a>05724     {
<a name="l05725"></a>05725       printf (<span class="stringliteral">"%i redundant entries eliminated from %s.\n"</span>, eliminate_count,
<a name="l05726"></a>05726               section-&gt;name);
<a name="l05727"></a>05727     }
<a name="l05728"></a>05728 <span class="preprocessor">#endif</span>
<a name="l05729"></a>05729 <span class="preprocessor"></span>
<a name="l05730"></a>05730   <span class="comment">/* Free the link table */</span>
<a name="l05731"></a>05731   <a class="code" href="lmdes2__customizer_8c.html#fa4c4f19e0105b0a4fb487dafb37bd84">free_link_table</a> (link_table);
<a name="l05732"></a>05732 
<a name="l05733"></a>05733   <span class="comment">/* Free the content-addressable entry table */</span>
<a name="l05734"></a>05734   <a class="code" href="lmdes2__customizer_8c.html#935d5d6ef4bbee76bfd07e7f15b71b71">ENTRY_delete_contents_table</a> (contents_table);
<a name="l05735"></a>05735 
<a name="l05736"></a>05736   <span class="comment">/* Return the number of entries removed */</span>
<a name="l05737"></a>05737   <span class="keywordflow">return</span> (eliminate_count);
<a name="l05738"></a>05738 
<a name="l05739"></a>05739 }
<a name="l05740"></a>05740 
<a name="l05741"></a>05741 <span class="comment">/* To try to be fair after homogenizing the reservation tables when</span>
<a name="l05742"></a>05742 <span class="comment"> * opti-leve is 0, try to eliminate unnecessary entries added just</span>
<a name="l05743"></a>05743 <span class="comment"> * in order to homogenize the reservation tables.</span>
<a name="l05744"></a>05744 <span class="comment"> */</span>
<a name="l05745"></a>05745 <span class="keywordtype">int</span>
<a name="l05746"></a><a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">05746</a> <a class="code" href="lmdes2__customizer_8c.html#4286ee81d149a7bd3dda9056304a94bd">eliminate_redundant_new_entries_only</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name)
<a name="l05747"></a>05747 {
<a name="l05748"></a>05748   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l05749"></a>05749   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *entry1, *next_entry1, *matching_entry;
<a name="l05750"></a>05750   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *link_table, *remap_table;
<a name="l05751"></a>05751   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *remap_symbol;
<a name="l05752"></a>05752   <a class="code" href="structENTRY__Contents__Table.html">ENTRY_Contents_Table</a> *contents_table;
<a name="l05753"></a>05753   <a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *mapping;
<a name="l05754"></a>05754   <span class="keywordtype">int</span> eliminate_count;
<a name="l05755"></a>05755   <span class="keywordtype">char</span> *name_ptr;
<a name="l05756"></a>05756 
<a name="l05757"></a>05757   eliminate_count = 0;
<a name="l05758"></a>05758 
<a name="l05759"></a>05759   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l05760"></a>05760 
<a name="l05761"></a>05761   <span class="comment">/* Create a contents-addressable table for the entries in this section </span>
<a name="l05762"></a>05762 <span class="comment">   * (no extra fields will be ignored during contents comparisons) </span>
<a name="l05763"></a>05763 <span class="comment">   * Set initial size to number of entries in section.</span>
<a name="l05764"></a>05764 <span class="comment">   */</span>
<a name="l05765"></a>05765   contents_table =
<a name="l05766"></a>05766     <a class="code" href="lmdes2__customizer_8c.html#f16fbbf8f638e1751157ef9598f2ef3a">ENTRY_new_contents_table</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#efaf1eb833608de0fd1909ecb40e2671">entry_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Symbol__Table.html#560dcf5e5fca3abec8c2379e98e29bd2">symbol_count</a>);
<a name="l05767"></a>05767 
<a name="l05768"></a>05768   <span class="comment">/* Create a remap table for the remappings that will be required to</span>
<a name="l05769"></a>05769 <span class="comment">   * eliminate redundant entries.</span>
<a name="l05770"></a>05770 <span class="comment">   */</span>
<a name="l05771"></a>05771   remap_table = <a class="code" href="lmdes2__customizer_8c.html#7a6ced70906068dcb26b7acce31d0ca9">build_remap_table</a> (section);
<a name="l05772"></a>05772 
<a name="l05773"></a>05773   <span class="comment">/* Use a symbol table to hold all the field declarations that</span>
<a name="l05774"></a>05774 <span class="comment">   * link to this section.</span>
<a name="l05775"></a>05775 <span class="comment">   */</span>
<a name="l05776"></a>05776   link_table = <a class="code" href="lmdes2__customizer_8c.html#5c514dd5e4fda6d0660bfaf6ea103344">build_link_table</a> (md, section);
<a name="l05777"></a>05777 
<a name="l05778"></a>05778   <span class="comment">/* Punt if no links to this sections found since the name of this entry</span>
<a name="l05779"></a>05779 <span class="comment">   * must the the only way to the compiler to access this information,</span>
<a name="l05780"></a>05780 <span class="comment">   * and we cannot deletine names the compiler is expecting!</span>
<a name="l05781"></a>05781 <span class="comment">   */</span>
<a name="l05782"></a>05782   <span class="keywordflow">if</span> (link_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05783"></a>05783     {
<a name="l05784"></a>05784       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l05785"></a>05785               <span class="stringliteral">"eliminate_redundant_entries: No sections link to '%s'!"</span>,
<a name="l05786"></a>05786               section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>);
<a name="l05787"></a>05787     }
<a name="l05788"></a>05788 
<a name="l05789"></a>05789   <span class="comment">/* Scan each entry looking for identical entries later in the section */</span>
<a name="l05790"></a>05790   <span class="keywordflow">for</span> (entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); entry1 != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05791"></a>05791        entry1 = next_entry1)
<a name="l05792"></a>05792     {
<a name="l05793"></a>05793       <span class="comment">/* Get the next entry before possibly deleting this one */</span>
<a name="l05794"></a>05794       next_entry1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (entry1);
<a name="l05795"></a>05795 
<a name="l05796"></a>05796       <span class="comment">/* If there is already an entry with the same contents as entry1,</span>
<a name="l05797"></a>05797 <span class="comment">       * delete entry1.</span>
<a name="l05798"></a>05798 <span class="comment">       */</span>
<a name="l05799"></a>05799       <span class="comment">/* Find previous entry, if any, with the same contents as entry1 */</span>
<a name="l05800"></a>05800       matching_entry = <a class="code" href="lmdes2__customizer_8c.html#7b037f4ab90fd72816810e1990293073">ENTRY_find_match</a> (contents_table, entry1);
<a name="l05801"></a>05801 
<a name="l05802"></a>05802       <span class="comment">/* If matching entry found, point all uses of entry1 at the matching</span>
<a name="l05803"></a>05803 <span class="comment">       * entry and delete entry1.</span>
<a name="l05804"></a>05804 <span class="comment">       */</span>
<a name="l05805"></a>05805       <span class="keywordflow">if</span> (matching_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05806"></a>05806         {
<a name="l05807"></a>05807           <span class="comment">/* Determine if entry1 is a new entry by checking for a ~.</span>
<a name="l05808"></a>05808 <span class="comment">           */</span>
<a name="l05809"></a>05809           <span class="keywordflow">for</span> (name_ptr = entry1-&gt;name; *name_ptr != 0; name_ptr++)
<a name="l05810"></a>05810             {
<a name="l05811"></a>05811               <span class="keywordflow">if</span> (*name_ptr == <span class="charliteral">'~'</span>)
<a name="l05812"></a>05812                 <span class="keywordflow">break</span>;
<a name="l05813"></a>05813             }
<a name="l05814"></a>05814           <span class="comment">/* Only remap if have ~ in name. */</span>
<a name="l05815"></a>05815           <span class="keywordflow">if</span> (*name_ptr == <span class="charliteral">'~'</span>)
<a name="l05816"></a>05816             {
<a name="l05817"></a>05817               <span class="comment">/* Add entry to replace all references (links) to entry1 </span>
<a name="l05818"></a>05818 <span class="comment">               * with matching_entry.</span>
<a name="l05819"></a>05819 <span class="comment">               */</span>
<a name="l05820"></a>05820               <a class="code" href="lmdes2__customizer_8c.html#81b5e74760544ee45c3246205a9db199">add_remap_entry</a> (remap_table, entry1, matching_entry);
<a name="l05821"></a>05821             }
<a name="l05822"></a>05822 
<a name="l05823"></a>05823         }
<a name="l05824"></a>05824 
<a name="l05825"></a>05825       <span class="comment">/* Otherwise, add this entry to the content-addressable table */</span>
<a name="l05826"></a>05826       <span class="keywordflow">else</span>
<a name="l05827"></a>05827         {
<a name="l05828"></a>05828           <a class="code" href="lmdes2__customizer_8c.html#f8b740c45578bf755315091df166950f">ENTRY_add_contents</a> (contents_table, entry1);
<a name="l05829"></a>05829         }
<a name="l05830"></a>05830     }
<a name="l05831"></a>05831 
<a name="l05832"></a>05832   <span class="comment">/* Replace references (links) to entry1 with matching_entry </span>
<a name="l05833"></a>05833 <span class="comment">   * for all the remaps in the remap_table</span>
<a name="l05834"></a>05834 <span class="comment">   */</span>
<a name="l05835"></a>05835   <a class="code" href="lmdes2__customizer_8c.html#e91f10afbc8636670c067c17090d0cf3">CU_replace_references</a> (link_table, remap_table);
<a name="l05836"></a>05836 
<a name="l05837"></a>05837   <span class="comment">/* Delete all the entries that were remapped  */</span>
<a name="l05838"></a>05838   <span class="keywordflow">for</span> (remap_symbol = remap_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; remap_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05839"></a>05839        remap_symbol = remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l05840"></a>05840     {
<a name="l05841"></a>05841       <span class="comment">/* Delete from_entry now all links point to to_entry */</span>
<a name="l05842"></a>05842       <span class="comment">/* 11/14/02 REK The 32 bit address used to be stored in the value section</span>
<a name="l05843"></a>05843 <span class="comment">       *              of remap_symbol.  The full 64 bit address is now stored</span>
<a name="l05844"></a>05844 <span class="comment">       *              in the from field of the data section of remap_symbol. */</span>
<a name="l05845"></a>05845       mapping = (<a class="code" href="structPointer__Mapping.html">Pointer_Mapping</a> *) remap_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l05846"></a>05846       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> ((<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *) mapping-&gt;<a class="code" href="structPointer__Mapping.html#661c5e8b6062b1e7d04fdcfd8f2df2c4">from</a>);
<a name="l05847"></a>05847 
<a name="l05848"></a>05848       <span class="comment">/* Update count */</span>
<a name="l05849"></a>05849       eliminate_count++;
<a name="l05850"></a>05850     }
<a name="l05851"></a>05851 
<a name="l05852"></a>05852   <span class="comment">/* Free the remap table */</span>
<a name="l05853"></a>05853   <a class="code" href="lmdes2__customizer_8c.html#7b841160a37c9819cb24c2709727eb58">free_remap_table</a> (remap_table);
<a name="l05854"></a>05854 
<a name="l05855"></a>05855 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l05856"></a>05856 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (eliminate_count &gt; 0)
<a name="l05857"></a>05857     {
<a name="l05858"></a>05858       printf (<span class="stringliteral">"%i redundant entries eliminated from %s.\n"</span>, eliminate_count,
<a name="l05859"></a>05859               section-&gt;name);
<a name="l05860"></a>05860     }
<a name="l05861"></a>05861 <span class="preprocessor">#endif</span>
<a name="l05862"></a>05862 <span class="preprocessor"></span>
<a name="l05863"></a>05863   <span class="comment">/* Free the link table */</span>
<a name="l05864"></a>05864   <a class="code" href="lmdes2__customizer_8c.html#fa4c4f19e0105b0a4fb487dafb37bd84">free_link_table</a> (link_table);
<a name="l05865"></a>05865 
<a name="l05866"></a>05866   <span class="comment">/* Free the content-addressable entry table */</span>
<a name="l05867"></a>05867   <a class="code" href="lmdes2__customizer_8c.html#935d5d6ef4bbee76bfd07e7f15b71b71">ENTRY_delete_contents_table</a> (contents_table);
<a name="l05868"></a>05868 
<a name="l05869"></a>05869   <span class="comment">/* Return the number of entries removed */</span>
<a name="l05870"></a>05870   <span class="keywordflow">return</span> (eliminate_count);
<a name="l05871"></a>05871 
<a name="l05872"></a>05872 }
<a name="l05873"></a>05873 
<a name="l05874"></a>05874 <span class="comment">/* Remove all the original name fields created by this customizer.</span>
<a name="l05875"></a>05875 <span class="comment"> * Just deletes all fields with the name original_name!</span>
<a name="l05876"></a>05876 <span class="comment"> */</span>
<a name="l05877"></a>05877 <span class="keywordtype">void</span>
<a name="l05878"></a><a class="code" href="lmdes2__customizer_8c.html#6747e11fe0efbbeea18472c8a80f3a2c">05878</a> <a class="code" href="lmdes2__customizer_8c.html#6747e11fe0efbbeea18472c8a80f3a2c">remove_original_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l05879"></a>05879 {
<a name="l05880"></a>05880   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l05881"></a>05881   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l05882"></a>05882 
<a name="l05883"></a>05883   <span class="comment">/* Scan all sections for the original_name field */</span>
<a name="l05884"></a>05884   <span class="keywordflow">for</span> (section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#80898363bd87b2073facc7280db90304">MD_first_section</a> (md); section != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05885"></a>05885        section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#e663f86a14d893405f3f150ba80ba952">MD_next_section</a> (section))
<a name="l05886"></a>05886     {
<a name="l05887"></a>05887       <span class="comment">/* Delete the original_name field if in this section */</span>
<a name="l05888"></a>05888       field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (section, <span class="stringliteral">"original_name"</span>);
<a name="l05889"></a>05889       <span class="keywordflow">if</span> (field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05890"></a>05890         {
<a name="l05891"></a>05891 
<a name="l05892"></a>05892 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l05893"></a>05893 <span class="preprocessor"></span>          printf (<span class="stringliteral">"Deleting field %s-&gt;%s\n"</span>, section-&gt;name, field_decl-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html#fe0600b3a01ca8478f4f1055459d7e45">name</a>);
<a name="l05894"></a>05894 <span class="preprocessor">#endif</span>
<a name="l05895"></a>05895 <span class="preprocessor"></span>
<a name="l05896"></a>05896           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (field_decl);
<a name="l05897"></a>05897         }
<a name="l05898"></a>05898     }
<a name="l05899"></a>05899 
<a name="l05900"></a>05900 }
<a name="l05901"></a>05901 
<a name="l05902"></a>05902 <span class="comment">/* Renames the section entries to be short */</span>
<a name="l05903"></a>05903 <span class="keywordtype">void</span>
<a name="l05904"></a><a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">05904</a> <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *prefix)
<a name="l05905"></a>05905 {
<a name="l05906"></a>05906   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l05907"></a>05907   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l05908"></a>05908   <span class="keywordtype">char</span> name_buf[5000];
<a name="l05909"></a>05909   <span class="keywordtype">int</span> id;
<a name="l05910"></a>05910 
<a name="l05911"></a>05911   <span class="keywordtype">id</span> = 0;
<a name="l05912"></a>05912 
<a name="l05913"></a>05913   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l05914"></a>05914 
<a name="l05915"></a>05915   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05916"></a>05916        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l05917"></a>05917     {
<a name="l05918"></a>05918       sprintf (name_buf, <span class="stringliteral">"%s%i"</span>, prefix, <span class="keywordtype">id</span>);
<a name="l05919"></a>05919       <span class="keywordtype">id</span>++;
<a name="l05920"></a>05920 
<a name="l05921"></a>05921       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#21f5e11ef45622d57325c409ba6a486c">MD_rename_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, name_buf);
<a name="l05922"></a>05922     }
<a name="l05923"></a>05923 }
<a name="l05924"></a>05924 
<a name="l05925"></a>05925 <span class="keywordtype">int</span>
<a name="l05926"></a><a class="code" href="lmdes2__customizer_8c.html#68281f2aaba233f2380c5774122253be">05926</a> <a class="code" href="lmdes2__customizer_8c.html#68281f2aaba233f2380c5774122253be">optimize_alt_lists</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l05927"></a>05927 {
<a name="l05928"></a>05928   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *op_section;
<a name="l05929"></a>05929   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *op_entry, *link1, *link2, *new_link1;
<a name="l05930"></a>05930   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target1, *target2;
<a name="l05931"></a>05931   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *alt_decl;
<a name="l05932"></a>05932   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *alt_field, *format1, *format2;
<a name="l05933"></a>05933   <span class="keywordtype">int</span> index1, index2, i1, i2;
<a name="l05934"></a>05934   <span class="keywordtype">int</span> change_count;
<a name="l05935"></a>05935 
<a name="l05936"></a>05936   <span class="comment">/* Initialize change count */</span>
<a name="l05937"></a>05937   change_count = 0;
<a name="l05938"></a>05938 
<a name="l05939"></a>05939   op_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Operation"</span>);
<a name="l05940"></a>05940   alt_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (op_section, <span class="stringliteral">"alt"</span>);
<a name="l05941"></a>05941 
<a name="l05942"></a>05942   <span class="comment">/* Optimize each operation */</span>
<a name="l05943"></a>05943   <span class="keywordflow">for</span> (op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (op_section); op_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05944"></a>05944        op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (op_entry))
<a name="l05945"></a>05945     {
<a name="l05946"></a>05946       <span class="comment">/* Get the alt field for this op entry */</span>
<a name="l05947"></a>05947       <span class="keywordflow">if</span> ((alt_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (op_entry, alt_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05948"></a>05948         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"optimize_alt_lists: alt field expected"</span>);
<a name="l05949"></a>05949 
<a name="l05950"></a>05950       <span class="comment">/*</span>
<a name="l05951"></a>05951 <span class="comment">       * Remove duplicate links in alt field.  </span>
<a name="l05952"></a>05952 <span class="comment">       * alt_field-&gt;max_element_index will be changing as we do this.</span>
<a name="l05953"></a>05953 <span class="comment">       */</span>
<a name="l05954"></a>05954       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= alt_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l05955"></a>05955         {
<a name="l05956"></a>05956           link1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index1);
<a name="l05957"></a>05957           new_link1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05958"></a>05958 
<a name="l05959"></a>05959           <span class="comment">/* Scan forwards for elements we can delete or combine </span>
<a name="l05960"></a>05960 <span class="comment">           * index2 will only be incremented when we can do neither.</span>
<a name="l05961"></a>05961 <span class="comment">           */</span>
<a name="l05962"></a>05962           index2 = index1 + 1;
<a name="l05963"></a>05963           <span class="keywordflow">while</span> (index2 &lt;= alt_field-&gt;max_element_index)
<a name="l05964"></a>05964             {
<a name="l05965"></a>05965               link2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index2);
<a name="l05966"></a>05966 
<a name="l05967"></a>05967               <span class="comment">/* Delete link2 if the same as link one */</span>
<a name="l05968"></a>05968               <span class="keywordflow">if</span> (link1 == link2)
<a name="l05969"></a>05969                 {
<a name="l05970"></a>05970 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l05971"></a>05971                   printf (<span class="stringliteral">"Deleting redundant alt in '%s':\n"</span>
<a name="l05972"></a>05972                           <span class="stringliteral">"  alt[%i] and alt[%i] both point to %s\n"</span>,
<a name="l05973"></a>05973                           op_entry-&gt;name, index1, index2, link1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l05974"></a>05974 #endif
<a name="l05975"></a>05975 
<a name="l05976"></a>05976                   <span class="comment">/* Delete the redudant link, index2 will now point at </span>
<a name="l05977"></a>05977 <span class="comment">                   * the next link to process,so don't increment index2</span>
<a name="l05978"></a>05978 <span class="comment">                   */</span>
<a name="l05979"></a>05979                   <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (alt_field, index2);
<a name="l05980"></a>05980 
<a name="l05981"></a>05981                   <span class="comment">/* Update change count */</span>
<a name="l05982"></a>05982                   change_count++;
<a name="l05983"></a>05983                 }
<a name="l05984"></a>05984 
<a name="l05985"></a>05985               <span class="comment">/* Only combine link1 and link2 if index2 = index1 + 1</span>
<a name="l05986"></a>05986 <span class="comment">               * (Otherwise will change the priorities of the alts</span>
<a name="l05987"></a>05987 <span class="comment">               *  by pulling them together (bad)).</span>
<a name="l05988"></a>05988 <span class="comment">               */</span>
<a name="l05989"></a>05989               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((index2 == (index1 + 1)) &amp;&amp;
<a name="l05990"></a>05990                        <a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (link1, link2, <span class="stringliteral">"format"</span>))
<a name="l05991"></a>05991                 {
<a name="l05992"></a>05992 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l05993"></a>05993                   printf (<span class="stringliteral">"Formats can be combined in '%s':\n"</span>
<a name="l05994"></a>05994                           <span class="stringliteral">"  alt[%i]-&gt;%s and alt[%i]-&gt;%s\n"</span>,
<a name="l05995"></a>05995                           op_entry-&gt;name, index1, link1-&gt;name, index2,
<a name="l05996"></a>05996                           link2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l05997"></a>05997 #endif
<a name="l05998"></a>05998 
<a name="l05999"></a>05999                   <span class="comment">/* If have not combined before, create new link1 </span>
<a name="l06000"></a>06000 <span class="comment">                   * and place it in link1's place.</span>
<a name="l06001"></a>06001 <span class="comment">                   */</span>
<a name="l06002"></a>06002                   if (new_link1 == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06003"></a>06003                     {
<a name="l06004"></a>06004                       new_link1 = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (link1);
<a name="l06005"></a>06005                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (alt_field, index1, new_link1);
<a name="l06006"></a>06006                     }
<a name="l06007"></a>06007 
<a name="l06008"></a>06008                   <span class="comment">/* Add link2's formats to link1's */</span>
<a name="l06009"></a>06009                   format1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_link1, <span class="stringliteral">"format"</span>);
<a name="l06010"></a>06010                   format2 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (link2, <span class="stringliteral">"format"</span>);
<a name="l06011"></a>06011                   <span class="keywordflow">for</span> (i1 = 0; i1 &lt;= format2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i1++)
<a name="l06012"></a>06012                     {
<a name="l06013"></a>06013                       target2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (format2, i1);
<a name="l06014"></a>06014                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (format1, format1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l06015"></a>06015                                    target2);
<a name="l06016"></a>06016                     }
<a name="l06017"></a>06017 
<a name="l06018"></a>06018                   <span class="comment">/* Delete link2 from alt list, index2 will then point</span>
<a name="l06019"></a>06019 <span class="comment">                   * at next link to process, so don't increment index2</span>
<a name="l06020"></a>06020 <span class="comment">                   */</span>
<a name="l06021"></a>06021                   <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (alt_field, index2);
<a name="l06022"></a>06022 
<a name="l06023"></a>06023                   <span class="comment">/* Update change count */</span>
<a name="l06024"></a>06024                   change_count++;
<a name="l06025"></a>06025                 }
<a name="l06026"></a>06026 
<a name="l06027"></a>06027               <span class="comment">/* Warn about miss opportunties now.  Probably will want</span>
<a name="l06028"></a>06028 <span class="comment">               * to turn off in the future. (TURNED OFF)</span>
<a name="l06029"></a>06029 <span class="comment">               */</span>
<a name="l06030"></a>06030               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((index2 != (index1 + 1)) &amp;&amp;
<a name="l06031"></a>06031                        <a class="code" href="lmdes2__customizer_8c.html#33651693828cf0dceddf0652bb22eac0">CU_redundant_entries</a> (link1, link2, <span class="stringliteral">"format"</span>))
<a name="l06032"></a>06032                 {
<a name="l06033"></a>06033 
<a name="l06034"></a>06034 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06035"></a>06035 <span class="preprocessor"></span>                  printf
<a name="l06036"></a>06036                     (<span class="stringliteral">"Warning: formats could be combined in '%s' if they "</span>
<a name="l06037"></a>06037                      <span class="stringliteral">"were adjacent!!!:\n"</span>
<a name="l06038"></a>06038                      <span class="stringliteral">"  alt[%i]-&gt;%s and alt[%i]-&gt;%s\n"</span>, op_entry-&gt;name,
<a name="l06039"></a>06039                      index1, link1-&gt;name, index2, link2-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06040"></a>06040 <span class="preprocessor">#endif</span>
<a name="l06041"></a>06041 <span class="preprocessor"></span>
<a name="l06042"></a>06042                   <span class="comment">/* For now, increment index2 */</span>
<a name="l06043"></a>06043                   index2++;
<a name="l06044"></a>06044 
<a name="l06045"></a>06045                 }
<a name="l06046"></a>06046 
<a name="l06047"></a>06047               <span class="comment">/* Otherwise go to next link to test */</span>
<a name="l06048"></a>06048               <span class="keywordflow">else</span>
<a name="l06049"></a>06049                 {
<a name="l06050"></a>06050                   index2++;
<a name="l06051"></a>06051                 }
<a name="l06052"></a>06052             }
<a name="l06053"></a>06053 
<a name="l06054"></a>06054           <span class="comment">/* Scan link1 to make sure there are not redundant formats in</span>
<a name="l06055"></a>06055 <span class="comment">           * the format field.  Process the new_link1 (if any).</span>
<a name="l06056"></a>06056 <span class="comment">           */</span>
<a name="l06057"></a>06057           link1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index1);
<a name="l06058"></a>06058           format1 = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (link1, <span class="stringliteral">"format"</span>);
<a name="l06059"></a>06059           <span class="keywordflow">for</span> (i1 = 0; i1 &lt;= format1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; i1++)
<a name="l06060"></a>06060             {
<a name="l06061"></a>06061               target1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (format1, i1);
<a name="l06062"></a>06062 
<a name="l06063"></a>06063               <span class="comment">/* Scan backwards to facilitate deleting links */</span>
<a name="l06064"></a>06064               <span class="keywordflow">for</span> (i2 = format1-&gt;max_element_index; i2 &gt; i1; i2--)
<a name="l06065"></a>06065                 {
<a name="l06066"></a>06066                   target2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (format1, i2);
<a name="l06067"></a>06067 
<a name="l06068"></a>06068                   <span class="keywordflow">if</span> (target1 == target2)
<a name="l06069"></a>06069                     {
<a name="l06070"></a>06070 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l06071"></a>06071                       printf (<span class="stringliteral">"Deleting redundant format in '%s':\n"</span>
<a name="l06072"></a>06072                               <span class="stringliteral">"  format[%i] and format[%i] both point to %s\n"</span>,
<a name="l06073"></a>06073                               link1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, i1, i2, target1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06074"></a>06074 #endif
<a name="l06075"></a>06075 
<a name="l06076"></a>06076                       <span class="comment">/* Delete the redundant format */</span>
<a name="l06077"></a>06077                       <a class="code" href="lmdes2__customizer_8c.html#92c91ed1ca364644c08508886798782e">CU_delete_link_at</a> (format1, i2);
<a name="l06078"></a>06078 
<a name="l06079"></a>06079                       <span class="comment">/* Update change count */</span>
<a name="l06080"></a>06080                       change_count++;
<a name="l06081"></a>06081                     }
<a name="l06082"></a>06082                 }
<a name="l06083"></a>06083             }
<a name="l06084"></a>06084         }
<a name="l06085"></a>06085     }
<a name="l06086"></a>06086   <span class="keywordflow">return</span> (change_count);
<a name="l06087"></a>06087 }
<a name="l06088"></a>06088 
<a name="l06089"></a>06089 <span class="comment">/*</span>
<a name="l06090"></a>06090 <span class="comment"> * Does nothing for opti_level &lt; 1.</span>
<a name="l06091"></a>06091 <span class="comment"> * </span>
<a name="l06092"></a>06092 <span class="comment"> * Does the following "classical" optimizations on the mdes sections</span>
<a name="l06093"></a>06093 <span class="comment"> * that they are applicable to:</span>
<a name="l06094"></a>06094 <span class="comment"> *</span>
<a name="l06095"></a>06095 <span class="comment"> * 1) "dead code removal": Removes unreferenced entries.</span>
<a name="l06096"></a>06096 <span class="comment"> * 2) "common subexpression elimination": Removes identical entries by</span>
<a name="l06097"></a>06097 <span class="comment"> *       changing all links to point to just one of them.</span>
<a name="l06098"></a>06098 <span class="comment"> * </span>
<a name="l06099"></a>06099 <span class="comment"> * Also does the above optimizations to the alt lists in the operations.</span>
<a name="l06100"></a>06100 <span class="comment"> * May create new alternatives that then need to be optimized with the</span>
<a name="l06101"></a>06101 <span class="comment"> * above.  (That is why they are done here).</span>
<a name="l06102"></a>06102 <span class="comment"> *</span>
<a name="l06103"></a>06103 <span class="comment"> * Returns a count of the number of entries deleted and/or modified.</span>
<a name="l06104"></a>06104 <span class="comment"> */</span>
<a name="l06105"></a>06105 <span class="keywordtype">int</span>
<a name="l06106"></a><a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">06106</a> <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06107"></a>06107 {
<a name="l06108"></a>06108   <span class="keywordtype">int</span> change, total_change, pass;
<a name="l06109"></a>06109 
<a name="l06110"></a>06110 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l06111"></a>06111 <span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> count = 0;
<a name="l06112"></a>06112   count++;
<a name="l06113"></a>06113   printf (<span class="stringliteral">"Call %i to do_classical_optimizations\n"</span>, count);
<a name="l06114"></a>06114   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l06115"></a>06115   fflush (stdout);
<a name="l06116"></a>06116 <span class="preprocessor">#endif</span>
<a name="l06117"></a>06117 <span class="preprocessor"></span>
<a name="l06118"></a>06118   <span class="comment">/* Do nothing for opti_level &lt; 1 */</span>
<a name="l06119"></a>06119   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &lt; 1)
<a name="l06120"></a>06120     <span class="keywordflow">return</span> (0);
<a name="l06121"></a>06121 
<a name="l06122"></a>06122   total_change = 0;
<a name="l06123"></a>06123   change = 1;
<a name="l06124"></a>06124   pass = 0;
<a name="l06125"></a>06125   <span class="keywordflow">while</span> (change)
<a name="l06126"></a>06126     {
<a name="l06127"></a>06127       change = 0;
<a name="l06128"></a>06128       pass++;
<a name="l06129"></a>06129 
<a name="l06130"></a>06130 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06131"></a>06131 <span class="preprocessor"></span>      printf (<span class="stringliteral">"\nPass %i:\n"</span>, pass);
<a name="l06132"></a>06132 <span class="preprocessor">#endif</span>
<a name="l06133"></a>06133 <span class="preprocessor"></span>
<a name="l06134"></a>06134       <span class="comment">/* Cannot remove "redundant" Resource or Field_Type entries</span>
<a name="l06135"></a>06135 <span class="comment">       * since externally accessed so the name of the entry</span>
<a name="l06136"></a>06136 <span class="comment">       * means something.  I think it is confusing to</span>
<a name="l06137"></a>06137 <span class="comment">       * elmininate redundant Operand_Latency entries.</span>
<a name="l06138"></a>06138 <span class="comment">       */</span>
<a name="l06139"></a>06139       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l06140"></a>06140       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Field_Type"</span>);
<a name="l06141"></a>06141       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Operand_Latency"</span>);
<a name="l06142"></a>06142 
<a name="l06143"></a>06143 
<a name="l06144"></a>06144       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l06145"></a>06145       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l06146"></a>06146 
<a name="l06147"></a>06147       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l06148"></a>06148       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l06149"></a>06149 
<a name="l06150"></a>06150       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l06151"></a>06151       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l06152"></a>06152 
<a name="l06153"></a>06153       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l06154"></a>06154       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l06155"></a>06155 
<a name="l06156"></a>06156       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Operation_Format"</span>);
<a name="l06157"></a>06157       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Operation_Format"</span>);
<a name="l06158"></a>06158 
<a name="l06159"></a>06159       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Operation_Latency"</span>);
<a name="l06160"></a>06160       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Operation_Latency"</span>);
<a name="l06161"></a>06161 
<a name="l06162"></a>06162       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>);
<a name="l06163"></a>06163       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>);
<a name="l06164"></a>06164       change += <a class="code" href="lmdes2__customizer_8c.html#68281f2aaba233f2380c5774122253be">optimize_alt_lists</a> (md);
<a name="l06165"></a>06165 
<a name="l06166"></a>06166       change += <a class="code" href="lmdes2__customizer_8c.html#a4a74696d0e80cb977df64ded2259566">remove_unreferenced_entries</a> (md, <span class="stringliteral">"Operation"</span>);
<a name="l06167"></a>06167       change += <a class="code" href="lmdes2__customizer_8c.html#31d467358cd44db3f94464165d183232">eliminate_redundant_entries</a> (md, <span class="stringliteral">"Operation"</span>);
<a name="l06168"></a>06168 
<a name="l06169"></a>06169       total_change += change;
<a name="l06170"></a>06170     }
<a name="l06171"></a>06171 
<a name="l06172"></a>06172 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l06173"></a>06173 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Finished call %i to do_classical_optimizations\n"</span>, count);
<a name="l06174"></a>06174   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l06175"></a>06175   fflush (stdout);
<a name="l06176"></a>06176 <span class="preprocessor">#endif</span>
<a name="l06177"></a>06177 <span class="preprocessor"></span>
<a name="l06178"></a>06178   <span class="keywordflow">return</span> (total_change);
<a name="l06179"></a>06179 }
<a name="l06180"></a>06180 
<a name="l06181"></a>06181 <span class="comment">/* Counts the number of entries in a section */</span>
<a name="l06182"></a>06182 <span class="keywordtype">int</span>
<a name="l06183"></a><a class="code" href="lmdes2__customizer_8c.html#5bc12c0dabc53b4b665ed97e99dde230">06183</a> <a class="code" href="lmdes2__customizer_8c.html#5bc12c0dabc53b4b665ed97e99dde230">CU_count_section_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> * section)
<a name="l06184"></a>06184 {
<a name="l06185"></a>06185   <span class="comment">/* For speed, use internal md info (not the best way to do this) */</span>
<a name="l06186"></a>06186   <span class="keywordflow">return</span> (section-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#efaf1eb833608de0fd1909ecb40e2671">entry_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Symbol__Table.html#560dcf5e5fca3abec8c2379e98e29bd2">symbol_count</a>);
<a name="l06187"></a>06187 }
<a name="l06188"></a>06188 
<a name="l06189"></a>06189 <span class="comment">/* Counts the number of entries in the md */</span>
<a name="l06190"></a>06190 <span class="keywordtype">int</span>
<a name="l06191"></a><a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">06191</a> <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06192"></a>06192 {
<a name="l06193"></a>06193   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l06194"></a>06194   <span class="keywordtype">int</span> count;
<a name="l06195"></a>06195 
<a name="l06196"></a>06196   count = 0;
<a name="l06197"></a>06197 
<a name="l06198"></a>06198   <span class="keywordflow">for</span> (section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#80898363bd87b2073facc7280db90304">MD_first_section</a> (md); section != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06199"></a>06199        section = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#e663f86a14d893405f3f150ba80ba952">MD_next_section</a> (section))
<a name="l06200"></a>06200     {
<a name="l06201"></a>06201       count += <a class="code" href="lmdes2__customizer_8c.html#5bc12c0dabc53b4b665ed97e99dde230">CU_count_section_entries</a> (section);
<a name="l06202"></a>06202     }
<a name="l06203"></a>06203 
<a name="l06204"></a>06204   <span class="keywordflow">return</span> (count);
<a name="l06205"></a>06205 }
<a name="l06206"></a>06206 
<a name="l06207"></a>06207 <span class="comment">/* Check to make sure exactly one use in a Reservation Table specifies</span>
<a name="l06208"></a>06208 <span class="comment"> * the use of a slot (may use multiple slots in one use, the</span>
<a name="l06209"></a>06209 <span class="comment"> * smallest slot will be used).</span>
<a name="l06210"></a>06210 <span class="comment"> */</span>
<a name="l06211"></a>06211 <span class="keywordtype">void</span>
<a name="l06212"></a><a class="code" href="lmdes2__customizer_8c.html#e58a6292d04bae2e646a784873aff4da">06212</a> <a class="code" href="lmdes2__customizer_8c.html#e58a6292d04bae2e646a784873aff4da">check_slot_specification</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06213"></a>06213 {
<a name="l06214"></a>06214   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section, *resource_section;
<a name="l06215"></a>06215   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, *use_entry, *one_of_entry, *slot_entry;
<a name="l06216"></a>06216   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource1, *resource2;
<a name="l06217"></a>06217   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *slot_field_decl;
<a name="l06218"></a>06218   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field, *one_of_field, *slot1_field, *slot2_field;
<a name="l06219"></a>06219   <span class="keywordtype">int</span> index1, slot, index2, slot_index;
<a name="l06220"></a>06220   <span class="keywordtype">int</span> slot1, slot2;
<a name="l06221"></a>06221   <span class="keywordtype">int</span> option_count;
<a name="l06222"></a>06222 
<a name="l06223"></a>06223   <span class="comment">/* Scan resources to make sure a slot id is assigned to only</span>
<a name="l06224"></a>06224 <span class="comment">   * one resource.</span>
<a name="l06225"></a>06225 <span class="comment">   */</span>
<a name="l06226"></a>06226   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l06227"></a>06227   slot_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (resource_section, <span class="stringliteral">"slot"</span>);
<a name="l06228"></a>06228   <span class="keywordflow">for</span> (resource1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (resource_section); resource1 != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06229"></a>06229        resource1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource1))
<a name="l06230"></a>06230     {
<a name="l06231"></a>06231       <span class="comment">/* Only scan if assigned a slot */</span>
<a name="l06232"></a>06232       <span class="keywordflow">if</span> ((slot1_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (resource1, slot_field_decl)) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06233"></a>06233         <span class="keywordflow">continue</span>;
<a name="l06234"></a>06234       slot1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (slot1_field, 0);
<a name="l06235"></a>06235 
<a name="l06236"></a>06236       <span class="comment">/* Scan rest of table for resource with same slot number */</span>
<a name="l06237"></a>06237       <span class="keywordflow">for</span> (resource2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource1); resource2 != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06238"></a>06238            resource2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource2))
<a name="l06239"></a>06239         {
<a name="l06240"></a>06240           <span class="comment">/* Test only if assigned a slot */</span>
<a name="l06241"></a>06241           slot2_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (resource2, slot_field_decl);
<a name="l06242"></a>06242           <span class="keywordflow">if</span> (slot2_field == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06243"></a>06243             <span class="keywordflow">continue</span>;
<a name="l06244"></a>06244 
<a name="l06245"></a>06245           <span class="comment">/* See if they are the same */</span>
<a name="l06246"></a>06246           slot2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (slot2_field, 0);
<a name="l06247"></a>06247 
<a name="l06248"></a>06248           <span class="keywordflow">if</span> (slot1 == slot2)
<a name="l06249"></a>06249             {
<a name="l06250"></a>06250               fprintf (stderr,
<a name="l06251"></a>06251                        <span class="stringliteral">"Error: Resources %s and %s cannot both be slot %i!\n"</span>,
<a name="l06252"></a>06252                        resource1-&gt;name, resource2-&gt;name, slot1);
<a name="l06253"></a>06253               <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l06254"></a>06254             }
<a name="l06255"></a>06255         }
<a name="l06256"></a>06256     }
<a name="l06257"></a>06257 
<a name="l06258"></a>06258 
<a name="l06259"></a>06259   <span class="comment">/* Scan each reservation table for correctness */</span>
<a name="l06260"></a>06260   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l06261"></a>06261   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06262"></a>06262        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l06263"></a>06263     {
<a name="l06264"></a>06264       <span class="comment">/* Each table better have only one 'use' that specifies a slot */</span>
<a name="l06265"></a>06265       slot_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06266"></a>06266       slot_index = -1;
<a name="l06267"></a>06267 
<a name="l06268"></a>06268       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l06269"></a>06269       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06270"></a>06270         {
<a name="l06271"></a>06271           use_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l06272"></a>06272 
<a name="l06273"></a>06273           <span class="comment">/* For table options, if one option specifies a slot,</span>
<a name="l06274"></a>06274 <span class="comment">           * all the options must specify a slot.</span>
<a name="l06275"></a>06275 <span class="comment">           */</span>
<a name="l06276"></a>06276           <span class="keywordflow">if</span> (strcmp (use_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l06277"></a>06277             {
<a name="l06278"></a>06278               option_count = 0;
<a name="l06279"></a>06279               one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (use_entry, <span class="stringliteral">"one_of"</span>);
<a name="l06280"></a>06280               <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l06281"></a>06281                    index2++)
<a name="l06282"></a>06282                 {
<a name="l06283"></a>06283                   one_of_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index2);
<a name="l06284"></a>06284                   slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (one_of_entry);
<a name="l06285"></a>06285 
<a name="l06286"></a>06286                   <span class="keywordflow">if</span> (slot != -1)
<a name="l06287"></a>06287                     {
<a name="l06288"></a>06288                       option_count++;
<a name="l06289"></a>06289                     }
<a name="l06290"></a>06290                 }
<a name="l06291"></a>06291 
<a name="l06292"></a>06292               <span class="comment">/* Use slot if every option uses a slot */</span>
<a name="l06293"></a>06293               <span class="keywordflow">if</span> (option_count == (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1))
<a name="l06294"></a>06294                 {
<a name="l06295"></a>06295                   <span class="comment">/* Detect if more than one slot specified */</span>
<a name="l06296"></a>06296                   <span class="keywordflow">if</span> (slot_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06297"></a>06297                     {
<a name="l06298"></a>06298                       fprintf (stderr,
<a name="l06299"></a>06299                                <span class="stringliteral">"Error in %s-&gt;%s-&gt;use[%i] &amp; use[%i]:\n"</span>
<a name="l06300"></a>06300                                <span class="stringliteral">"  Only one link may use 'scheduling slot'"</span>
<a name="l06301"></a>06301                                <span class="stringliteral">" resources at time 0!\n"</span>,
<a name="l06302"></a>06302                                <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name,
<a name="l06303"></a>06303                                slot_index, index1);
<a name="l06304"></a>06304                       <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l06305"></a>06305                     }
<a name="l06306"></a>06306                   <span class="keywordflow">else</span>
<a name="l06307"></a>06307                     {
<a name="l06308"></a>06308                       slot_entry = use_entry;
<a name="l06309"></a>06309                       slot_index = index1;
<a name="l06310"></a>06310                     }
<a name="l06311"></a>06311                 }
<a name="l06312"></a>06312 
<a name="l06313"></a>06313               <span class="comment">/* Not good if only some options use a slot */</span>
<a name="l06314"></a>06314               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (option_count != 0)
<a name="l06315"></a>06315                 {
<a name="l06316"></a>06316                   fprintf (stderr,
<a name="l06317"></a>06317                            <span class="stringliteral">"Error in %s-&gt;%s-&gt;use[%i]-&gt;%s:\n"</span>
<a name="l06318"></a>06318                            <span class="stringliteral">"  All or none of the %i options must a use"</span>
<a name="l06319"></a>06319                            <span class="stringliteral">" 'scheduling slot' resource at time 0!\n"</span>,
<a name="l06320"></a>06320                            <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, index1,
<a name="l06321"></a>06321                            use_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l06322"></a>06322                            one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l06323"></a>06323                   <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l06324"></a>06324                 }
<a name="l06325"></a>06325             }
<a name="l06326"></a>06326           <span class="keywordflow">else</span>
<a name="l06327"></a>06327             {
<a name="l06328"></a>06328               slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (use_entry);
<a name="l06329"></a>06329 
<a name="l06330"></a>06330               <span class="keywordflow">if</span> (slot != -1)
<a name="l06331"></a>06331                 {
<a name="l06332"></a>06332                   <span class="comment">/* Detect if more than one slot specified */</span>
<a name="l06333"></a>06333                   <span class="keywordflow">if</span> (slot_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06334"></a>06334                     {
<a name="l06335"></a>06335                       fprintf (stderr,
<a name="l06336"></a>06336                                <span class="stringliteral">"Error in %s-&gt;%s-&gt;use[%i] &amp; use[%i]:\n"</span>
<a name="l06337"></a>06337                                <span class="stringliteral">"  Only one link may use 'scheduling slot'"</span>
<a name="l06338"></a>06338                                <span class="stringliteral">" resources at time 0!\n"</span>,
<a name="l06339"></a>06339                                <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name,
<a name="l06340"></a>06340                                slot_index, index1);
<a name="l06341"></a>06341                       <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l06342"></a>06342                     }
<a name="l06343"></a>06343                   <span class="keywordflow">else</span>
<a name="l06344"></a>06344                     {
<a name="l06345"></a>06345                       slot_entry = use_entry;
<a name="l06346"></a>06346                       slot_index = index1;
<a name="l06347"></a>06347                     }
<a name="l06348"></a>06348                 }
<a name="l06349"></a>06349             }
<a name="l06350"></a>06350         }
<a name="l06351"></a>06351 
<a name="l06352"></a>06352       <span class="comment">/* Exactly one 'use' should specify a slot */</span>
<a name="l06353"></a>06353       <span class="keywordflow">if</span> (slot_entry == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06354"></a>06354         {
<a name="l06355"></a>06355           fprintf (stderr,
<a name="l06356"></a>06356                    <span class="stringliteral">"Error in %s-&gt;%s-&gt;use[*]:\n"</span>
<a name="l06357"></a>06357                    <span class="stringliteral">"  One link must use a 'scheduling slot' resource"</span>
<a name="l06358"></a>06358                    <span class="stringliteral">" at time 0!\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name);
<a name="l06359"></a>06359           <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>++;
<a name="l06360"></a>06360         }
<a name="l06361"></a>06361     }
<a name="l06362"></a>06362 }
<a name="l06363"></a>06363 
<a name="l06364"></a>06364 <span class="comment">/* Mark the resource units that use one or more 'scheduling slot' resource </span>
<a name="l06365"></a>06365 <span class="comment"> * in time 0, with the smallest slot used.  Must be done after all</span>
<a name="l06366"></a>06366 <span class="comment"> * speed transformations are done (don't add units after this!).</span>
<a name="l06367"></a>06367 <span class="comment"> */</span>
<a name="l06368"></a>06368 <span class="keywordtype">void</span>
<a name="l06369"></a><a class="code" href="lmdes2__customizer_8c.html#5654a965175dc1d0b0e5b172cead0ac7">06369</a> <a class="code" href="lmdes2__customizer_8c.html#5654a965175dc1d0b0e5b172cead0ac7">mark_resource_unit_slots</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06370"></a>06370 {
<a name="l06371"></a>06371   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section;
<a name="l06372"></a>06372   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry;
<a name="l06373"></a>06373   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *slot_field_decl;
<a name="l06374"></a>06374   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *slot_field;
<a name="l06375"></a>06375   <span class="keywordtype">int</span> slot;
<a name="l06376"></a>06376 
<a name="l06377"></a>06377   <span class="comment">/* Get the resource unit section */</span>
<a name="l06378"></a>06378   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l06379"></a>06379 
<a name="l06380"></a>06380   <span class="comment">/* Delete the existing slot field declaration (if any).</span>
<a name="l06381"></a>06381 <span class="comment">   * This will delete the slot field for every entry.</span>
<a name="l06382"></a>06382 <span class="comment">   */</span>
<a name="l06383"></a>06383   <span class="keywordflow">if</span> ((slot_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (unit_section, <span class="stringliteral">"slot"</span>)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06384"></a>06384     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (slot_field_decl);
<a name="l06385"></a>06385 
<a name="l06386"></a>06386   <span class="comment">/* Create a optional slot field that takes one INT */</span>
<a name="l06387"></a>06387   slot_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (unit_section, <span class="stringliteral">"slot"</span>,
<a name="l06388"></a>06388                                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a1703a4bc4ce323d1338a2504d2e9874564d">MD_OPTIONAL_FIELD</a>);
<a name="l06389"></a>06389   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (slot_field_decl, 0);
<a name="l06390"></a>06390 
<a name="l06391"></a>06391   <span class="comment">/* Set the slot field for each unit that uses a slot in cycle 0 */</span>
<a name="l06392"></a>06392   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06393"></a>06393        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l06394"></a>06394     {
<a name="l06395"></a>06395       slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (unit_entry);
<a name="l06396"></a>06396 
<a name="l06397"></a>06397       <span class="comment">/* If has slot, create slot field and put the slot number in it */</span>
<a name="l06398"></a>06398       <span class="keywordflow">if</span> (slot != -1)
<a name="l06399"></a>06399         {
<a name="l06400"></a>06400           slot_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (unit_entry, slot_field_decl, 1);
<a name="l06401"></a>06401           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (slot_field, 0, slot);
<a name="l06402"></a>06402         }
<a name="l06403"></a>06403     }
<a name="l06404"></a>06404 }
<a name="l06405"></a>06405 
<a name="l06406"></a>06406 
<a name="l06407"></a>06407 <span class="comment">/* Returns the number of options for this entry, returns 1 if</span>
<a name="l06408"></a>06408 <span class="comment"> * not a table option.</span>
<a name="l06409"></a>06409 <span class="comment"> */</span>
<a name="l06410"></a>06410 <span class="keywordtype">int</span>
<a name="l06411"></a><a class="code" href="lmdes2__customizer_8c.html#b856325e80c0fe729a87901b233899df">06411</a> <a class="code" href="lmdes2__customizer_8c.html#b856325e80c0fe729a87901b233899df">CU_num_options</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l06412"></a>06412 {
<a name="l06413"></a>06413   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field;
<a name="l06414"></a>06414 
<a name="l06415"></a>06415   <span class="comment">/* If a resource_unit or resource_usage, return 1 option */</span>
<a name="l06416"></a>06416   <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Table_Option"</span>) != 0)
<a name="l06417"></a>06417     <span class="keywordflow">return</span> (1);
<a name="l06418"></a>06418 
<a name="l06419"></a>06419   <span class="comment">/* Get the one_of_field */</span>
<a name="l06420"></a>06420   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"one_of"</span>);
<a name="l06421"></a>06421 
<a name="l06422"></a>06422   <span class="comment">/* Return the number of options */</span>
<a name="l06423"></a>06423   <span class="keywordflow">return</span> (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l06424"></a>06424 }
<a name="l06425"></a>06425 
<a name="l06426"></a>06426 <span class="keywordtype">int</span>
<a name="l06427"></a><a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">06427</a> <a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">CU_max_usage_time</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>)
<a name="l06428"></a>06428 {
<a name="l06429"></a>06429   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *target_entry;
<a name="l06430"></a>06430   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field, *use_field, *time_field;
<a name="l06431"></a>06431   <span class="keywordtype">int</span> max_usage_time, usage_time;
<a name="l06432"></a>06432   <span class="keywordtype">int</span> index1;
<a name="l06433"></a>06433 
<a name="l06434"></a>06434   <span class="comment">/* Initialize max_usage_time for max search below */</span>
<a name="l06435"></a>06435   max_usage_time = -1;
<a name="l06436"></a>06436 
<a name="l06437"></a>06437   <span class="comment">/* Recurse on options for tables */</span>
<a name="l06438"></a>06438   <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Reservation_Table"</span>) == 0)
<a name="l06439"></a>06439     {
<a name="l06440"></a>06440       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l06441"></a>06441 
<a name="l06442"></a>06442       <span class="comment">/* Find the max usage time of all the options */</span>
<a name="l06443"></a>06443       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06444"></a>06444         {
<a name="l06445"></a>06445           target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l06446"></a>06446           usage_time = <a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">CU_max_usage_time</a> (target_entry);
<a name="l06447"></a>06447           <span class="keywordflow">if</span> (usage_time &gt; max_usage_time)
<a name="l06448"></a>06448             max_usage_time = usage_time;
<a name="l06449"></a>06449         }
<a name="l06450"></a>06450 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06451"></a>06451 <span class="preprocessor"></span>      printf (<span class="stringliteral">"Table %s: max time %i\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, max_usage_time);
<a name="l06452"></a>06452 <span class="preprocessor">#endif</span>
<a name="l06453"></a>06453 <span class="preprocessor"></span>    }
<a name="l06454"></a>06454 
<a name="l06455"></a>06455   <span class="comment">/* Recurse on units for table options */</span>
<a name="l06456"></a>06456   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l06457"></a>06457     {
<a name="l06458"></a>06458       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"one_of"</span>);
<a name="l06459"></a>06459 
<a name="l06460"></a>06460       <span class="comment">/* Find the max usage time of all the options */</span>
<a name="l06461"></a>06461       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06462"></a>06462         {
<a name="l06463"></a>06463           target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l06464"></a>06464           usage_time = <a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">CU_max_usage_time</a> (target_entry);
<a name="l06465"></a>06465           <span class="keywordflow">if</span> (usage_time &gt; max_usage_time)
<a name="l06466"></a>06466             max_usage_time = usage_time;
<a name="l06467"></a>06467         }
<a name="l06468"></a>06468 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06469"></a>06469 <span class="preprocessor"></span>      printf (<span class="stringliteral">"Option %s: max time %i\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, max_usage_time);
<a name="l06470"></a>06470 <span class="preprocessor">#endif</span>
<a name="l06471"></a>06471 <span class="preprocessor"></span>    }
<a name="l06472"></a>06472 
<a name="l06473"></a>06473   <span class="comment">/* Recurse one usages if resource unit */</span>
<a name="l06474"></a>06474   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l06475"></a>06475     {
<a name="l06476"></a>06476       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"use"</span>);
<a name="l06477"></a>06477 
<a name="l06478"></a>06478       <span class="comment">/* Find the max usage time of all the usages */</span>
<a name="l06479"></a>06479       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06480"></a>06480         {
<a name="l06481"></a>06481           target_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l06482"></a>06482           usage_time = <a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">CU_max_usage_time</a> (target_entry);
<a name="l06483"></a>06483           <span class="keywordflow">if</span> (usage_time &gt; max_usage_time)
<a name="l06484"></a>06484             max_usage_time = usage_time;
<a name="l06485"></a>06485         }
<a name="l06486"></a>06486 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06487"></a>06487 <span class="preprocessor"></span>      printf (<span class="stringliteral">"  Unit %s: max time %i\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, max_usage_time);
<a name="l06488"></a>06488 <span class="preprocessor">#endif</span>
<a name="l06489"></a>06489 <span class="preprocessor"></span>    }
<a name="l06490"></a>06490 
<a name="l06491"></a>06491   <span class="comment">/* Set the usage time if a usage */</span>
<a name="l06492"></a>06492   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name, <span class="stringliteral">"Resource_Usage"</span>) == 0)
<a name="l06493"></a>06493     {
<a name="l06494"></a>06494       time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, <span class="stringliteral">"time"</span>);
<a name="l06495"></a>06495 
<a name="l06496"></a>06496       <span class="comment">/* Find the max usage time */</span>
<a name="l06497"></a>06497       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06498"></a>06498         {
<a name="l06499"></a>06499           usage_time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, index1);
<a name="l06500"></a>06500           <span class="keywordflow">if</span> (usage_time &gt; max_usage_time)
<a name="l06501"></a>06501             max_usage_time = usage_time;
<a name="l06502"></a>06502         }
<a name="l06503"></a>06503 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06504"></a>06504 <span class="preprocessor"></span>      printf (<span class="stringliteral">"    Usage %s: max time %i\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;name, max_usage_time);
<a name="l06505"></a>06505 <span class="preprocessor">#endif</span>
<a name="l06506"></a>06506 <span class="preprocessor"></span>    }
<a name="l06507"></a>06507   <span class="keywordflow">else</span>
<a name="l06508"></a>06508     {
<a name="l06509"></a>06509       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"CU_max_usage_time: Unknown section '%s'"</span>,
<a name="l06510"></a>06510               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>-&gt;section-&gt;name);
<a name="l06511"></a>06511     }
<a name="l06512"></a>06512 
<a name="l06513"></a>06513   <span class="comment">/* Return the max usage time found */</span>
<a name="l06514"></a>06514   <span class="keywordflow">return</span> (max_usage_time);
<a name="l06515"></a>06515 }
<a name="l06516"></a>06516 
<a name="l06517"></a>06517 <span class="comment">/* Put the reservation tables in a format that:</span>
<a name="l06518"></a>06518 <span class="comment"> * 1) Places option or unit that defines the ops slot in slot_specifier()</span>
<a name="l06519"></a>06519 <span class="comment"> *    (it also remains in the use() field!)</span>
<a name="l06520"></a>06520 <span class="comment"> * 2) Find the max usage time of the table's usage and place in </span>
<a name="l06521"></a>06521 <span class="comment"> *    the field max_usage_time().</span>
<a name="l06522"></a>06522 <span class="comment"> * 3) For opti_level &gt;= 3,</span>
<a name="l06523"></a>06523 <span class="comment"> *    Sorts the options/units in use() by the number of options,</span>
<a name="l06524"></a>06524 <span class="comment"> *    so that the "most restrictive" options are checked first.</span>
<a name="l06525"></a>06525 <span class="comment"> *    In case of ties, place the option that sets the slot first.</span>
<a name="l06526"></a>06526 <span class="comment"> */</span>
<a name="l06527"></a>06527 <span class="keywordtype">void</span>
<a name="l06528"></a><a class="code" href="lmdes2__customizer_8c.html#7633a9393e597832a6f16c70d882d3b5">06528</a> <a class="code" href="lmdes2__customizer_8c.html#7633a9393e597832a6f16c70d882d3b5">format_reservation_tables</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06529"></a>06529 {
<a name="l06530"></a>06530   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section, *link_array[2], *option_section;
<a name="l06531"></a>06531   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *use1_entry, *temp_entry, *new_option;
<a name="l06532"></a>06532   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *table_slot_field_decl, *one_of_field_decl;
<a name="l06533"></a>06533   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *table_time_field_decl;
<a name="l06534"></a>06534   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_use_field, *table_slot_field, *one_of_field;
<a name="l06535"></a>06535   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_time_field;
<a name="l06536"></a>06536   <span class="keywordtype">int</span> index1, slot, found_slot;
<a name="l06537"></a>06537   <span class="keywordtype">int</span> max_usage_time;
<a name="l06538"></a>06538   <span class="keywordtype">char</span> name_buf[5000];
<a name="l06539"></a>06539 
<a name="l06540"></a>06540   <span class="comment">/* Get the reservation table section */</span>
<a name="l06541"></a>06541   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l06542"></a>06542 
<a name="l06543"></a>06543 
<a name="l06544"></a>06544   <span class="comment">/* Delete any existing slot_specifier field declaration */</span>
<a name="l06545"></a>06545   table_slot_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (table_section,
<a name="l06546"></a>06546                                               <span class="stringliteral">"slot_specifier"</span>);
<a name="l06547"></a>06547   <span class="keywordflow">if</span> (table_slot_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06548"></a>06548     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (table_slot_field_decl);
<a name="l06549"></a>06549 
<a name="l06550"></a>06550   <span class="comment">/* Create a new slot field declaration, required link to an</span>
<a name="l06551"></a>06551 <span class="comment">   * Table_Option or a Resource_Unit.  Points to the use link</span>
<a name="l06552"></a>06552 <span class="comment">   * that specifies the slot used by the table.</span>
<a name="l06553"></a>06553 <span class="comment">   */</span>
<a name="l06554"></a>06554   table_slot_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (table_section, <span class="stringliteral">"slot_specifier"</span>,
<a name="l06555"></a>06555                                              <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l06556"></a>06556 
<a name="l06557"></a>06557   <span class="comment">/* Make link array to make required link */</span>
<a name="l06558"></a>06558   link_array[0] = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l06559"></a>06559   link_array[1] = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l06560"></a>06560 
<a name="l06561"></a>06561   <span class="comment">/* Make required multitarget link */</span>
<a name="l06562"></a>06562   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#6db7feb559876c9ccc075a0756c4fb93">MD_require_multi_target_link</a> (table_slot_field_decl, 0, 2, link_array);
<a name="l06563"></a>06563 
<a name="l06564"></a>06564 
<a name="l06565"></a>06565   <span class="comment">/* Delete any existing max_usage_time field declaration */</span>
<a name="l06566"></a>06566   table_time_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#10402535f4e3b94b1e0d75ca22cd9eae">MD_find_field_decl</a> (table_section,
<a name="l06567"></a>06567                                               <span class="stringliteral">"max_usage_time"</span>);
<a name="l06568"></a>06568   <span class="keywordflow">if</span> (table_time_field_decl != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06569"></a>06569     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#76528f257b1781ee2ed2d2d7ebdae9b0">MD_delete_field_decl</a> (table_time_field_decl);
<a name="l06570"></a>06570 
<a name="l06571"></a>06571   <span class="comment">/* Create a new max_usage_time field declaration, requiring an int */</span>
<a name="l06572"></a>06572   table_time_field_decl = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#dbb60e2a637334eb1c028ae19d8fd7a6">MD_new_field_decl</a> (table_section, <span class="stringliteral">"max_usage_time"</span>,
<a name="l06573"></a>06573                                              <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#f759e9ac9fe5b3112dd641e85448a170072d545f4ce74ce4e3b35bde0a1deeb7">MD_REQUIRED_FIELD</a>);
<a name="l06574"></a>06574   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#c62eab6c660919a2250857aaffaddebb">MD_require_int</a> (table_time_field_decl, 0);
<a name="l06575"></a>06575 
<a name="l06576"></a>06576 
<a name="l06577"></a>06577 
<a name="l06578"></a>06578   <span class="comment">/* Convert any units linked to in the table into table_options</span>
<a name="l06579"></a>06579 <span class="comment">   * with only one option.   Makes building sm mdes easier.</span>
<a name="l06580"></a>06580 <span class="comment">   * Will to classical optimizations afterwards to minimize size.</span>
<a name="l06581"></a>06581 <span class="comment">   */</span>
<a name="l06582"></a>06582   option_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l06583"></a>06583   one_of_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (option_section, <span class="stringliteral">"one_of"</span>);
<a name="l06584"></a>06584   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06585"></a>06585        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l06586"></a>06586     {
<a name="l06587"></a>06587       <span class="comment">/* Get the use field */</span>
<a name="l06588"></a>06588       table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l06589"></a>06589 
<a name="l06590"></a>06590       <span class="comment">/* Convert all units found */</span>
<a name="l06591"></a>06591       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06592"></a>06592         {
<a name="l06593"></a>06593           <span class="comment">/* Get the use at this index */</span>
<a name="l06594"></a>06594           use1_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l06595"></a>06595 
<a name="l06596"></a>06596           <span class="comment">/* If a resource unit, convert to option  */</span>
<a name="l06597"></a>06597           <span class="keywordflow">if</span> (strcmp (use1_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l06598"></a>06598             {
<a name="l06599"></a>06599               <span class="comment">/* Create a new option that points to this unit */</span>
<a name="l06600"></a>06600               <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, table_entry-&gt;name, name_buf);
<a name="l06601"></a>06601               new_option = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (option_section, name_buf);
<a name="l06602"></a>06602               one_of_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_option, one_of_field_decl, 1);
<a name="l06603"></a>06603               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (one_of_field, 0, use1_entry);
<a name="l06604"></a>06604 
<a name="l06605"></a>06605 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06606"></a>06606 <span class="preprocessor"></span>              printf (<span class="stringliteral">"Converting %s[%i] from %s to %s\n"</span>,
<a name="l06607"></a>06607                       table_entry-&gt;name, index1, use1_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l06608"></a>06608                       new_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06609"></a>06609 <span class="preprocessor">#endif</span>
<a name="l06610"></a>06610 <span class="preprocessor"></span>
<a name="l06611"></a>06611               <span class="comment">/* Point table at option instead of unit */</span>
<a name="l06612"></a>06612               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, index1, new_option);
<a name="l06613"></a>06613             }
<a name="l06614"></a>06614 
<a name="l06615"></a>06615           <span class="comment">/* Better be a Table Option at this point */</span>
<a name="l06616"></a>06616           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (use1_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) != 0)
<a name="l06617"></a>06617             {
<a name="l06618"></a>06618               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l06619"></a>06619                       <span class="stringliteral">"format_reservation_tables:\n"</span>
<a name="l06620"></a>06620                       <span class="stringliteral">"Table option or resource unit expected not %s-&gt;%s!"</span>,
<a name="l06621"></a>06621                       use1_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, use1_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06622"></a>06622             }
<a name="l06623"></a>06623         }
<a name="l06624"></a>06624     }
<a name="l06625"></a>06625 
<a name="l06626"></a>06626   <span class="comment">/* Do classical optimizations to remove any duplicate options created */</span>
<a name="l06627"></a>06627   <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l06628"></a>06628 
<a name="l06629"></a>06629   <span class="comment">/* Find the slot specifying choice for each table and </span>
<a name="l06630"></a>06630 <span class="comment">   * put it in the slot_specifier field</span>
<a name="l06631"></a>06631 <span class="comment">   */</span>
<a name="l06632"></a>06632   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06633"></a>06633        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l06634"></a>06634     {
<a name="l06635"></a>06635       <span class="comment">/* Get the use field */</span>
<a name="l06636"></a>06636       table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l06637"></a>06637 
<a name="l06638"></a>06638       <span class="comment">/* Create a slot_specifier field for this table in which to put the</span>
<a name="l06639"></a>06639 <span class="comment">       * slot link.</span>
<a name="l06640"></a>06640 <span class="comment">       */</span>
<a name="l06641"></a>06641       table_slot_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (table_entry, table_slot_field_decl, 1);
<a name="l06642"></a>06642 
<a name="l06643"></a>06643       <span class="comment">/* Place the 'slot' entry first */</span>
<a name="l06644"></a>06644       found_slot = 0;
<a name="l06645"></a>06645       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;max_element_index; index1++)
<a name="l06646"></a>06646         {
<a name="l06647"></a>06647           <span class="comment">/* Get the use at this index */</span>
<a name="l06648"></a>06648           use1_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l06649"></a>06649 
<a name="l06650"></a>06650           <span class="comment">/* Put first if specifies a slot */</span>
<a name="l06651"></a>06651           <span class="keywordflow">if</span> ((slot = <a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (use1_entry)) != -1)
<a name="l06652"></a>06652             {
<a name="l06653"></a>06653 #<span class="keywordflow">if</span> 0
<a name="l06654"></a>06654               <span class="comment">/* Debug */</span>
<a name="l06655"></a>06655               printf (<span class="stringliteral">"%s-&gt;use[%i] (%s) specifies slot %i\n"</span>,
<a name="l06656"></a>06656                       table_entry-&gt;name, index1, use1_entry-&gt;name, slot);
<a name="l06657"></a>06657 #endif
<a name="l06658"></a>06658 
<a name="l06659"></a>06659               <span class="comment">/* Make sure we don't find two slots (should have</span>
<a name="l06660"></a>06660 <span class="comment">               * been detected earlier!).</span>
<a name="l06661"></a>06661 <span class="comment">               */</span>
<a name="l06662"></a>06662               if (found_slot != 0)
<a name="l06663"></a>06663                 {
<a name="l06664"></a>06664                   <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l06665"></a>06665                           <span class="stringliteral">"format_reservation_tables:"</span>
<a name="l06666"></a>06666                           <span class="stringliteral">" two slots, should have already punted!"</span>);
<a name="l06667"></a>06667                 }
<a name="l06668"></a>06668               found_slot = 1;
<a name="l06669"></a>06669 
<a name="l06670"></a>06670               <span class="comment">/* Place entry that specifies slot, in the table slot field */</span>
<a name="l06671"></a>06671               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_slot_field, 0, use1_entry);
<a name="l06672"></a>06672 
<a name="l06673"></a>06673               <span class="comment">/* If want slot option first, swap entry 0 and this one,</span>
<a name="l06674"></a>06674 <span class="comment">               * if not already first </span>
<a name="l06675"></a>06675 <span class="comment">               */</span>
<a name="l06676"></a>06676               <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#b5d3cfa3af0f0d0f3aae26ebc6253224">place_slots_first</a>) &amp;&amp; (index1 != 0))
<a name="l06677"></a>06677                 {
<a name="l06678"></a>06678                   <span class="comment">/* Debug */</span>
<a name="l06679"></a>06679 <span class="comment">/*</span>
<a name="l06680"></a>06680 <span class="comment">                    printf ("Placing slot first!\n");</span>
<a name="l06681"></a>06681 <span class="comment">*/</span>
<a name="l06682"></a>06682 
<a name="l06683"></a>06683                   temp_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, 0);
<a name="l06684"></a>06684                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, 0, use1_entry);
<a name="l06685"></a>06685                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, index1, temp_entry);
<a name="l06686"></a>06686                 }
<a name="l06687"></a>06687             }
<a name="l06688"></a>06688         }
<a name="l06689"></a>06689 
<a name="l06690"></a>06690       <span class="comment">/* Create max_usage_time field and put the max_usage_time it in */</span>
<a name="l06691"></a>06691       table_time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (table_entry, table_time_field_decl, 1);
<a name="l06692"></a>06692 
<a name="l06693"></a>06693       max_usage_time = <a class="code" href="lmdes2__customizer_8c.html#345b1023db31d3c2ed2cde83095ae799">CU_max_usage_time</a> (table_entry);
<a name="l06694"></a>06694 
<a name="l06695"></a>06695       <span class="comment">/* Sanity check, max_usage_time better be non-negative */</span>
<a name="l06696"></a>06696       <span class="keywordflow">if</span> (max_usage_time &lt; 0)
<a name="l06697"></a>06697         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"format_reservation_tables: Bad max_usage_time!"</span>);
<a name="l06698"></a>06698 
<a name="l06699"></a>06699       <span class="comment">/* Set the max usage time */</span>
<a name="l06700"></a>06700       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (table_time_field, 0, max_usage_time);
<a name="l06701"></a>06701 
<a name="l06702"></a>06702       <span class="comment">/* Don't do sort here. Use CU_order_use_fields() below. -JCG 6/8/96 */</span>
<a name="l06703"></a>06703 <span class="preprocessor">#if 0</span>
<a name="l06704"></a>06704 <span class="preprocessor"></span>      <span class="comment">/* Sort use() entries by number of options they have. </span>
<a name="l06705"></a>06705 <span class="comment">       * In case of ties, place the slot specifying option first.</span>
<a name="l06706"></a>06706 <span class="comment">       *</span>
<a name="l06707"></a>06707 <span class="comment">       * If place_slots_first is true, the slot option is first,</span>
<a name="l06708"></a>06708 <span class="comment">       * and sort should start with second use.</span>
<a name="l06709"></a>06709 <span class="comment">       */</span>
<a name="l06710"></a>06710       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *use2_entry;
<a name="l06711"></a>06711       <span class="keywordtype">int</span> num_options1, num_options2, min_options, min_index;
<a name="l06712"></a>06712       <span class="keywordtype">int</span> index2;
<a name="l06713"></a>06713 
<a name="l06714"></a>06714       <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#b5d3cfa3af0f0d0f3aae26ebc6253224">place_slots_first</a>)
<a name="l06715"></a>06715         index1 = 1;
<a name="l06716"></a>06716       <span class="keywordflow">else</span>
<a name="l06717"></a>06717         index1 = 0;
<a name="l06718"></a>06718       <span class="keywordflow">for</span> (; index1 &lt;= table_use_field-&gt;max_element_index; index1++)
<a name="l06719"></a>06719         {
<a name="l06720"></a>06720           <span class="comment">/* Get the use at this index */</span>
<a name="l06721"></a>06721           use1_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l06722"></a>06722 
<a name="l06723"></a>06723           <span class="comment">/* Get the number of options it has */</span>
<a name="l06724"></a>06724           num_options1 = <a class="code" href="lmdes2__customizer_8c.html#b856325e80c0fe729a87901b233899df">CU_num_options</a> (use1_entry);
<a name="l06725"></a>06725 
<a name="l06726"></a>06726           <span class="comment">/* If has only one option, don't move */</span>
<a name="l06727"></a>06727           <span class="keywordflow">if</span> (num_options1 == 1)
<a name="l06728"></a>06728             <span class="keywordflow">continue</span>;
<a name="l06729"></a>06729 
<a name="l06730"></a>06730           <span class="comment">/* Search from the remaining options for the minimum number</span>
<a name="l06731"></a>06731 <span class="comment">           * of options so we can place it at index1</span>
<a name="l06732"></a>06732 <span class="comment">           */</span>
<a name="l06733"></a>06733           min_options = num_options1;
<a name="l06734"></a>06734           min_index = index1;
<a name="l06735"></a>06735           <span class="keywordflow">for</span> (index2 = index1 + 1;
<a name="l06736"></a>06736                index2 &lt;= table_use_field-&gt;max_element_index; index2++)
<a name="l06737"></a>06737             {
<a name="l06738"></a>06738               use2_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index2);
<a name="l06739"></a>06739               num_options2 = <a class="code" href="lmdes2__customizer_8c.html#b856325e80c0fe729a87901b233899df">CU_num_options</a> (use2_entry);
<a name="l06740"></a>06740 
<a name="l06741"></a>06741 
<a name="l06742"></a>06742               <span class="comment">/*</span>
<a name="l06743"></a>06743 <span class="comment">               *   Get the option with the least number of options,</span>
<a name="l06744"></a>06744 <span class="comment">               *   in case of ties, pick the slot option first.</span>
<a name="l06745"></a>06745 <span class="comment">               */</span>
<a name="l06746"></a>06746               <span class="keywordflow">if</span> ((num_options2 &lt; min_options) ||
<a name="l06747"></a>06747                   ((num_options2 == min_options) &amp;&amp;
<a name="l06748"></a>06748                    (<a class="code" href="lmdes2__customizer_8c.html#68cc9dad453a2e899020a7ee00ae52bb">CU_get_slot</a> (use2_entry) &gt;= 0)))
<a name="l06749"></a>06749                 {
<a name="l06750"></a>06750                   min_options = num_options2;
<a name="l06751"></a>06751                   min_index = index2;
<a name="l06752"></a>06752                 }
<a name="l06753"></a>06753             }
<a name="l06754"></a>06754 
<a name="l06755"></a>06755           <span class="comment">/* Place the option selected at index1 if not already there */</span>
<a name="l06756"></a>06756           <span class="keywordflow">if</span> (min_index != index1)
<a name="l06757"></a>06757             {
<a name="l06758"></a>06758               temp_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, min_index);
<a name="l06759"></a>06759 
<a name="l06760"></a>06760 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06761"></a>06761 <span class="preprocessor"></span>              <span class="comment">/* Debug */</span>
<a name="l06762"></a>06762               printf (<span class="stringliteral">"Swapping %s use[%i] (%s %i options) and"</span>
<a name="l06763"></a>06763                       <span class="stringliteral">" use[%i] (%s %i options)\n"</span>,
<a name="l06764"></a>06764                       table_entry-&gt;name, index1, use1_entry-&gt;name,
<a name="l06765"></a>06765                       num_options1, min_index, temp_entry-&gt;name, min_options);
<a name="l06766"></a>06766 <span class="preprocessor">#endif</span>
<a name="l06767"></a>06767 <span class="preprocessor"></span>
<a name="l06768"></a>06768               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, min_index, use1_entry);
<a name="l06769"></a>06769               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (table_use_field, index1, temp_entry);
<a name="l06770"></a>06770             }
<a name="l06771"></a>06771         }
<a name="l06772"></a>06772 <span class="preprocessor">#endif</span>
<a name="l06773"></a>06773 <span class="preprocessor"></span>    }
<a name="l06774"></a>06774 
<a name="l06775"></a>06775   <span class="comment">/* </span>
<a name="l06776"></a>06776 <span class="comment">   * Applies transformations for opti_levels &gt;= 3 only.</span>
<a name="l06777"></a>06777 <span class="comment">   *</span>
<a name="l06778"></a>06778 <span class="comment">   * Sort the Reseveration_Table-&gt;use() links and Resource_Unit-&gt;use()</span>
<a name="l06779"></a>06779 <span class="comment">   * links so that resources will be distributed the same in the various</span>
<a name="l06780"></a>06780 <span class="comment">   * forms of the same table, and so that the classical optimizations</span>
<a name="l06781"></a>06781 <span class="comment">   * can detect these duplicate tables consistently.</span>
<a name="l06782"></a>06782 <span class="comment">   * </span>
<a name="l06783"></a>06783 <span class="comment">   * It also places checks near time 0 first, and reorders the</span>
<a name="l06784"></a>06784 <span class="comment">   * AND-OR trees (if opti_level &gt;= 4) to place most restrictive </span>
<a name="l06785"></a>06785 <span class="comment">   * checks first.</span>
<a name="l06786"></a>06786 <span class="comment">   *</span>
<a name="l06787"></a>06787 <span class="comment">   * Minimize the reordering.  Several bit-field optimizations have</span>
<a name="l06788"></a>06788 <span class="comment">   * been applied assuming this order as the final one, so don't </span>
<a name="l06789"></a>06789 <span class="comment">   * rearrange unless have a strong reason.</span>
<a name="l06790"></a>06790 <span class="comment">   */</span>
<a name="l06791"></a>06791   <a class="code" href="lmdes2__customizer_8c.html#09e11110f5b6a98ed4d840057dc1e125">CU_order_use_fields</a> (md, 1);
<a name="l06792"></a>06792 }
<a name="l06793"></a>06793 
<a name="l06794"></a>06794 <span class="comment">/* Determines if a MDES parameter exists,   */</span>
<a name="l06795"></a>06795 <span class="keywordtype">int</span>
<a name="l06796"></a><a class="code" href="lmdes2__customizer_8c.html#77b3447d0de2a17ecaa97e21cad307d5">06796</a> <a class="code" href="lmdes2__customizer_8c.html#77b3447d0de2a17ecaa97e21cad307d5">CU_parm_exists</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct@1.html#37bcc8711ce73b1674632b61832d13b2">name</a>)
<a name="l06797"></a>06797 {
<a name="l06798"></a>06798   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *parm_section;
<a name="l06799"></a>06799 
<a name="l06800"></a>06800   parm_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Parameter"</span>);
<a name="l06801"></a>06801 
<a name="l06802"></a>06802   <span class="comment">/* Return 0 if parameter doesn't exist */</span>
<a name="l06803"></a>06803   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ed997dd6e6244f22cfadf1befbd1a630">MD_find_entry</a> (parm_section, name) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06804"></a>06804     <span class="keywordflow">return</span> (0);
<a name="l06805"></a>06805 
<a name="l06806"></a>06806   <span class="comment">/* Otherwise, return 1 */</span>
<a name="l06807"></a>06807   <span class="keywordflow">return</span> (1);
<a name="l06808"></a>06808 }
<a name="l06809"></a>06809 
<a name="l06810"></a>06810 <span class="comment">/* Sets a string MDES parameter to the given value */</span>
<a name="l06811"></a>06811 <span class="keywordtype">void</span>
<a name="l06812"></a><a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">06812</a> <a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">CU_set_string_parm</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct@1.html#37bcc8711ce73b1674632b61832d13b2">name</a>, <span class="keywordtype">char</span> *string_value)
<a name="l06813"></a>06813 {
<a name="l06814"></a>06814   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *parm_section;
<a name="l06815"></a>06815   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *parm_entry;
<a name="l06816"></a>06816   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *value_field_decl;
<a name="l06817"></a>06817   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *value_field;
<a name="l06818"></a>06818 
<a name="l06819"></a>06819   parm_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Parameter"</span>);
<a name="l06820"></a>06820 
<a name="l06821"></a>06821   <span class="comment">/* Delete the parameter if already exists */</span>
<a name="l06822"></a>06822   <span class="keywordflow">if</span> ((parm_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ed997dd6e6244f22cfadf1befbd1a630">MD_find_entry</a> (parm_section, name)) != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06823"></a>06823     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (parm_entry);
<a name="l06824"></a>06824 
<a name="l06825"></a>06825   <span class="comment">/* Create a new parm entry */</span>
<a name="l06826"></a>06826   parm_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (parm_section, name);
<a name="l06827"></a>06827 
<a name="l06828"></a>06828   <span class="comment">/* Create a value field */</span>
<a name="l06829"></a>06829   value_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (parm_section, <span class="stringliteral">"value"</span>);
<a name="l06830"></a>06830   value_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (parm_entry, value_field_decl, 1);
<a name="l06831"></a>06831 
<a name="l06832"></a>06832   <span class="comment">/* Set the value field to the value specified */</span>
<a name="l06833"></a>06833   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ce4e2520515e16050f27d7b86196e82a">MD_set_string</a> (value_field, 0, string_value);
<a name="l06834"></a>06834 }
<a name="l06835"></a>06835 
<a name="l06836"></a>06836 <span class="comment">/* Sets a int MDES parameter to the given value */</span>
<a name="l06837"></a>06837 <span class="keywordtype">void</span>
<a name="l06838"></a><a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">06838</a> <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct@1.html#37bcc8711ce73b1674632b61832d13b2">name</a>, <span class="keywordtype">int</span> value)
<a name="l06839"></a>06839 {
<a name="l06840"></a>06840   <span class="keywordtype">char</span> value_string[100];
<a name="l06841"></a>06841   sprintf (value_string, <span class="stringliteral">"%i"</span>, value);
<a name="l06842"></a>06842   <a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">CU_set_string_parm</a> (md, name, value_string);
<a name="l06843"></a>06843 }
<a name="l06844"></a>06844 
<a name="l06845"></a>06845 <span class="keywordtype">void</span>
<a name="l06846"></a><a class="code" href="lmdes2__customizer_8c.html#77106874c18f2790c5bb0073dadf1313">06846</a> <a class="code" href="lmdes2__customizer_8c.html#77106874c18f2790c5bb0073dadf1313">expand_options</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * dest_option, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * src_option)
<a name="l06847"></a>06847 {
<a name="l06848"></a>06848   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *dest_unit, *src_usage, *src_unit, *new_unit;
<a name="l06849"></a>06849   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *dest_one_of, *dest_use, *src_one_of, *src_use;
<a name="l06850"></a>06850   <span class="keywordtype">int</span> dest_index, src_index, index1;
<a name="l06851"></a>06851 
<a name="l06852"></a>06852   <span class="comment">/* Get the destination's one_of field */</span>
<a name="l06853"></a>06853   dest_one_of = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (dest_option, <span class="stringliteral">"one_of"</span>);
<a name="l06854"></a>06854 
<a name="l06855"></a>06855   <span class="comment">/* Add the contents of each unit in src_option to the end of each</span>
<a name="l06856"></a>06856 <span class="comment">   * unit in dest_one_of.</span>
<a name="l06857"></a>06857 <span class="comment">   */</span>
<a name="l06858"></a>06858   <span class="keywordflow">for</span> (dest_index = dest_one_of-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; dest_index &gt;= 0;
<a name="l06859"></a>06859        dest_index--)
<a name="l06860"></a>06860     {
<a name="l06861"></a>06861       dest_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (dest_one_of, dest_index);
<a name="l06862"></a>06862 
<a name="l06863"></a>06863       <span class="comment">/* If the source option is just a unit, just tack on the</span>
<a name="l06864"></a>06864 <span class="comment">       * src's usages to each dest usage.</span>
<a name="l06865"></a>06865 <span class="comment">       */</span>
<a name="l06866"></a>06866       <span class="keywordflow">if</span> (strcmp (src_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l06867"></a>06867         {
<a name="l06868"></a>06868           dest_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (dest_unit, <span class="stringliteral">"use"</span>);
<a name="l06869"></a>06869           src_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (src_option, <span class="stringliteral">"use"</span>);
<a name="l06870"></a>06870           <span class="keywordflow">for</span> (src_index = 0; src_index &lt;= src_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l06871"></a>06871                src_index++)
<a name="l06872"></a>06872             {
<a name="l06873"></a>06873               src_usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_use, src_index);
<a name="l06874"></a>06874               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (dest_use, dest_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l06875"></a>06875                            src_usage);
<a name="l06876"></a>06876             }
<a name="l06877"></a>06877         }
<a name="l06878"></a>06878       <span class="comment">/* Duplicate the dest unit for each table option unit (except</span>
<a name="l06879"></a>06879 <span class="comment">       * the last one processed) and copy the table option's unit</span>
<a name="l06880"></a>06880 <span class="comment">       * to the end of this new unit.</span>
<a name="l06881"></a>06881 <span class="comment">       */</span>
<a name="l06882"></a>06882       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (src_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l06883"></a>06883         {
<a name="l06884"></a>06884           src_one_of = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (src_option, <span class="stringliteral">"one_of"</span>);
<a name="l06885"></a>06885           <span class="keywordflow">for</span> (src_index = src_one_of-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; src_index &gt;= 0;
<a name="l06886"></a>06886                src_index--)
<a name="l06887"></a>06887             {
<a name="l06888"></a>06888               <span class="keywordflow">if</span> (src_index != 0)
<a name="l06889"></a>06889                 {
<a name="l06890"></a>06890                   new_unit = <a class="code" href="lmdes2__customizer_8c.html#0f5365fc4e33bb5f9ed676c4fbba9ea1">CU_dup_entry</a> (dest_unit);
<a name="l06891"></a>06891                   <a class="code" href="lmdes2__customizer_8c.html#6654d07ff1321b2e08dfd348ff1e3e2b">CU_add_link_at</a> (dest_one_of, dest_index + 1, new_unit);
<a name="l06892"></a>06892                 }
<a name="l06893"></a>06893               <span class="keywordflow">else</span>
<a name="l06894"></a>06894                 new_unit = dest_unit;
<a name="l06895"></a>06895               dest_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (new_unit, <span class="stringliteral">"use"</span>);
<a name="l06896"></a>06896               src_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_one_of, src_index);
<a name="l06897"></a>06897               src_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (src_unit, <span class="stringliteral">"use"</span>);
<a name="l06898"></a>06898               <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= src_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06899"></a>06899                 {
<a name="l06900"></a>06900                   src_usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (src_use, index1);
<a name="l06901"></a>06901                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (dest_use, dest_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1,
<a name="l06902"></a>06902                                src_usage);
<a name="l06903"></a>06903                 }
<a name="l06904"></a>06904 
<a name="l06905"></a>06905             }
<a name="l06906"></a>06906         }
<a name="l06907"></a>06907       <span class="keywordflow">else</span>
<a name="l06908"></a>06908         {
<a name="l06909"></a>06909           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"expand_options: unexpected src_entry %s-&gt;%s"</span>,
<a name="l06910"></a>06910                   src_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, src_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06911"></a>06911         }
<a name="l06912"></a>06912     }
<a name="l06913"></a>06913 
<a name="l06914"></a>06914 }
<a name="l06915"></a>06915 
<a name="l06916"></a>06916 <span class="comment">/* Expands the reservation table tree so that there is one resource</span>
<a name="l06917"></a>06917 <span class="comment"> * unit for each variation of the reservation table.  The transformed</span>
<a name="l06918"></a>06918 <span class="comment"> * table will have a use field linking to either one resource unit or </span>
<a name="l06919"></a>06919 <span class="comment"> * one table option entry only.  The table option entry will contain</span>
<a name="l06920"></a>06920 <span class="comment"> * all of these expanded units. </span>
<a name="l06921"></a>06921 <span class="comment"> * </span>
<a name="l06922"></a>06922 <span class="comment"> * This algorithm puts the reservation tables into an equivalent form</span>
<a name="l06923"></a>06923 <span class="comment"> * as Elcor's compiler.  (They use alternatives for each option,</span>
<a name="l06924"></a>06924 <span class="comment"> * we use both alternatives and table options to enumerate out all</span>
<a name="l06925"></a>06925 <span class="comment"> * the options for scheduling effeciency with our implementation)</span>
<a name="l06926"></a>06926 <span class="comment"> */</span>
<a name="l06927"></a>06927 <span class="keywordtype">void</span>
<a name="l06928"></a><a class="code" href="lmdes2__customizer_8c.html#fc9ac81a9950e113cd26337a38f6079c">06928</a> <a class="code" href="lmdes2__customizer_8c.html#fc9ac81a9950e113cd26337a38f6079c">expand_out_reservation_tables</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l06929"></a>06929 {
<a name="l06930"></a>06930   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section, *option_section, *unit_section;
<a name="l06931"></a>06931   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *new_option, *src_option, *new_unit;
<a name="l06932"></a>06932   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *one_of_field_decl, *use_field_decl;
<a name="l06933"></a>06933   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field, *new_one_of, *new_use;
<a name="l06934"></a>06934   <span class="keywordtype">int</span> index1;
<a name="l06935"></a>06935   <span class="keywordtype">char</span> name_buf[5000];
<a name="l06936"></a>06936 
<a name="l06937"></a>06937   <span class="comment">/* Get the reservation table section */</span>
<a name="l06938"></a>06938   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l06939"></a>06939   option_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l06940"></a>06940   one_of_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (option_section, <span class="stringliteral">"one_of"</span>);
<a name="l06941"></a>06941   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l06942"></a>06942   use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (unit_section, <span class="stringliteral">"use"</span>);
<a name="l06943"></a>06943 
<a name="l06944"></a>06944   <span class="comment">/* Expand out each reservation table entry */</span>
<a name="l06945"></a>06945   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06946"></a>06946        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l06947"></a>06947     {
<a name="l06948"></a>06948       <span class="comment">/* Get the use field for this entry */</span>
<a name="l06949"></a>06949       use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l06950"></a>06950 
<a name="l06951"></a>06951       <span class="comment">/* Skip use fields with only one choice */</span>
<a name="l06952"></a>06952       <span class="keywordflow">if</span> (use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> == 0)
<a name="l06953"></a>06953         <span class="keywordflow">continue</span>;
<a name="l06954"></a>06954 
<a name="l06955"></a>06955 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06956"></a>06956 <span class="preprocessor"></span>      printf (<span class="stringliteral">"Expanding %s\n"</span>, table_entry-&gt;name);
<a name="l06957"></a>06957 <span class="preprocessor">#endif</span>
<a name="l06958"></a>06958 <span class="preprocessor"></span>
<a name="l06959"></a>06959       <span class="comment">/* Create a new table option and a new one_of field </span>
<a name="l06960"></a>06960 <span class="comment">       * to contain links to all the resource units  we are going to create.</span>
<a name="l06961"></a>06961 <span class="comment">       */</span>
<a name="l06962"></a>06962       <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, table_entry-&gt;name, name_buf);
<a name="l06963"></a>06963       new_option = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (option_section, name_buf);
<a name="l06964"></a>06964       new_one_of = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_option, one_of_field_decl, 0);
<a name="l06965"></a>06965 
<a name="l06966"></a>06966       <span class="comment">/* Create a option that points to one empty use */</span>
<a name="l06967"></a>06967       <a class="code" href="lmdes2__customizer_8c.html#0d6d799591481b18affc74f76c135c41">CU_get_unique_name</a> (md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, table_entry-&gt;name, name_buf);
<a name="l06968"></a>06968       new_unit = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (unit_section, name_buf);
<a name="l06969"></a>06969       new_use = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (new_unit, use_field_decl, 0);
<a name="l06970"></a>06970       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (new_one_of, 0, new_unit);
<a name="l06971"></a>06971 
<a name="l06972"></a>06972       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l06973"></a>06973         {
<a name="l06974"></a>06974           src_option = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l06975"></a>06975 
<a name="l06976"></a>06976 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l06977"></a>06977 <span class="preprocessor"></span>          printf (<span class="stringliteral">"Adding '%s' options to '%s'\n"</span>, src_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l06978"></a>06978                   new_option-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l06979"></a>06979 <span class="preprocessor">#endif</span>
<a name="l06980"></a>06980 <span class="preprocessor"></span>          <a class="code" href="lmdes2__customizer_8c.html#77106874c18f2790c5bb0073dadf1313">expand_options</a> (new_option, src_option);
<a name="l06981"></a>06981           <span class="comment">/* Delete this option */</span>
<a name="l06982"></a>06982           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (use_field, index1);
<a name="l06983"></a>06983         }
<a name="l06984"></a>06984       <span class="comment">/* Set the use_field to the new option that contains all</span>
<a name="l06985"></a>06985 <span class="comment">       * the variations of this operation.</span>
<a name="l06986"></a>06986 <span class="comment">       */</span>
<a name="l06987"></a>06987       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, 0, new_option);
<a name="l06988"></a>06988     }
<a name="l06989"></a>06989 }
<a name="l06990"></a>06990 
<a name="l06991"></a>06991 <span class="keywordtype">void</span>
<a name="l06992"></a><a class="code" href="lmdes2__customizer_8c.html#4b2133824eaddc147250f9325ba07988">06992</a> <a class="code" href="lmdes2__customizer_8c.html#4b2133824eaddc147250f9325ba07988">calc_forbidden_latencies</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * forbidden_set,
<a name="l06993"></a>06993                           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> * use1_field, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> * use2_field)
<a name="l06994"></a>06994 {
<a name="l06995"></a>06995   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *usage_section;
<a name="l06996"></a>06996   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *usage1_entry, *usage2_entry, *resource1, *resource2;
<a name="l06997"></a>06997   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *usage_use_decl, *usage_time_decl;
<a name="l06998"></a>06998   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *usage1_use_field, *usage2_use_field;
<a name="l06999"></a>06999   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *usage1_time_field, *usage2_time_field;
<a name="l07000"></a>07000   <span class="keywordtype">int</span> time1, time2;
<a name="l07001"></a>07001   <span class="keywordtype">int</span> index1, index2;
<a name="l07002"></a>07002   <span class="keywordtype">int</span> latency;
<a name="l07003"></a>07003 
<a name="l07004"></a>07004   <span class="comment">/* Get the usage_use and usage_time declarations to speed up the </span>
<a name="l07005"></a>07005 <span class="comment">   * search.</span>
<a name="l07006"></a>07006 <span class="comment">   */</span>
<a name="l07007"></a>07007   usage_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (use1_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#488f279bdde7f11a63d112a52390d726">entry</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#591a84eb045f1fb8b356fe0844e5730c">md</a>,
<a name="l07008"></a>07008                                    <span class="stringliteral">"Resource_Usage"</span>);
<a name="l07009"></a>07009   usage_use_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"use"</span>);
<a name="l07010"></a>07010   usage_time_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"time"</span>);
<a name="l07011"></a>07011 
<a name="l07012"></a>07012 
<a name="l07013"></a>07013   <span class="comment">/* Generate a forbidden latency for each pair of usages that</span>
<a name="l07014"></a>07014 <span class="comment">   * share the same resource.  Generate only latencies &gt;= 0.</span>
<a name="l07015"></a>07015 <span class="comment">   */</span>
<a name="l07016"></a>07016   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use1_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l07017"></a>07017     {
<a name="l07018"></a>07018       <span class="comment">/* Get the first usage's resource and time usage */</span>
<a name="l07019"></a>07019       usage1_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use1_field, index1);
<a name="l07020"></a>07020 
<a name="l07021"></a>07021       usage1_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage1_entry, usage_use_decl);
<a name="l07022"></a>07022       resource1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (usage1_use_field, 0);
<a name="l07023"></a>07023 
<a name="l07024"></a>07024       usage1_time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage1_entry, usage_time_decl);
<a name="l07025"></a>07025       time1 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (usage1_time_field, 0);
<a name="l07026"></a>07026 
<a name="l07027"></a>07027       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= use2_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l07028"></a>07028         {
<a name="l07029"></a>07029           <span class="comment">/* Get the second usage's resource and time usage */</span>
<a name="l07030"></a>07030           usage2_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use2_field, index2);
<a name="l07031"></a>07031 
<a name="l07032"></a>07032           usage2_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage2_entry, usage_use_decl);
<a name="l07033"></a>07033           resource2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (usage2_use_field, 0);
<a name="l07034"></a>07034 
<a name="l07035"></a>07035           <span class="comment">/* If are not using the same resource, no forbidden latency */</span>
<a name="l07036"></a>07036           <span class="keywordflow">if</span> (resource1 != resource2)
<a name="l07037"></a>07037             <span class="keywordflow">continue</span>;
<a name="l07038"></a>07038 
<a name="l07039"></a>07039           <span class="comment">/* Calculate the forbidden latency for the two times */</span>
<a name="l07040"></a>07040           usage2_time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage2_entry, usage_time_decl);
<a name="l07041"></a>07041           time2 = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (usage2_time_field, 0);
<a name="l07042"></a>07042 
<a name="l07043"></a>07043           latency = time2 - time1;
<a name="l07044"></a>07044 
<a name="l07045"></a>07045           <span class="comment">/* Don't use negative forbidden latencies, so don't add</span>
<a name="l07046"></a>07046 <span class="comment">           * into forbidden set. -JCG 4/11/96</span>
<a name="l07047"></a>07047 <span class="comment">           */</span>
<a name="l07048"></a>07048           <span class="keywordflow">if</span> (latency &lt; 0)
<a name="l07049"></a>07049             <span class="keywordflow">continue</span>;
<a name="l07050"></a>07050 
<a name="l07051"></a>07051           <span class="comment">/* Add latency to forbidden set if not already there */</span>
<a name="l07052"></a>07052           <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07053"></a>07053             {
<a name="l07054"></a>07054               <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (forbidden_set, latency, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07055"></a>07055 
<a name="l07056"></a>07056 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07057"></a>07057 <span class="preprocessor"></span>              printf (<span class="stringliteral">"   Adding %i to F[%s][%s] due to %s at %i and %i\n"</span>,
<a name="l07058"></a>07058                       latency, use1_field-&gt;entry-&gt;name,
<a name="l07059"></a>07059                       use2_field-&gt;entry-&gt;name, resource1-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, time1, time2);
<a name="l07060"></a>07060 <span class="preprocessor">#endif</span>
<a name="l07061"></a>07061 <span class="preprocessor"></span>            }
<a name="l07062"></a>07062         }
<a name="l07063"></a>07063     }
<a name="l07064"></a>07064 }
<a name="l07065"></a>07065 
<a name="l07066"></a>07066 <span class="keywordtype">void</span>
<a name="l07067"></a><a class="code" href="lmdes2__customizer_8c.html#8c6ba9919f402479699c8861c5e39512">07067</a> <a class="code" href="lmdes2__customizer_8c.html#8c6ba9919f402479699c8861c5e39512">add_usage</a> (<a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07068"></a>07068 {
<a name="l07069"></a>07069   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage;
<a name="l07070"></a>07070   <span class="keywordtype">char</span> name_buf[100];
<a name="l07071"></a>07071 
<a name="l07072"></a>07072   <span class="comment">/* See if there is any usages yet at the given time */</span>
<a name="l07073"></a>07073   usage = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>,
<a name="l07074"></a>07074                                                      time);
<a name="l07075"></a>07075 
<a name="l07076"></a>07076   <span class="comment">/* If not, add one */</span>
<a name="l07077"></a>07077   <span class="keywordflow">if</span> (usage == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07078"></a>07078     {
<a name="l07079"></a>07079       sprintf (name_buf, <span class="stringliteral">"%s_t%i"</span>, resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, time);
<a name="l07080"></a>07080       usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (name_buf, 0);
<a name="l07081"></a>07081       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>, time, (<span class="keywordtype">void</span> *) usage);
<a name="l07082"></a>07082     }
<a name="l07083"></a>07083 
<a name="l07084"></a>07084   <span class="comment">/* Add this user's usage if not already there */</span>
<a name="l07085"></a>07085   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (usage, user) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07086"></a>07086     {
<a name="l07087"></a>07087       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (usage, user, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07088"></a>07088     }
<a name="l07089"></a>07089 }
<a name="l07090"></a>07090 
<a name="l07091"></a>07091 <span class="comment">/* Returns 1 if usage for this resource already exists */</span>
<a name="l07092"></a>07092 <span class="keywordtype">int</span>
<a name="l07093"></a><a class="code" href="lmdes2__customizer_8c.html#50502d936ec33def8a9137058724306b">07093</a> <a class="code" href="lmdes2__customizer_8c.html#50502d936ec33def8a9137058724306b">usage_exists</a> (<a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07094"></a>07094 {
<a name="l07095"></a>07095   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage;
<a name="l07096"></a>07096 
<a name="l07097"></a>07097   <span class="comment">/* See if there is any usages yet at the given time */</span>
<a name="l07098"></a>07098   usage = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>,
<a name="l07099"></a>07099                                                      time);
<a name="l07100"></a>07100 
<a name="l07101"></a>07101   <span class="comment">/* If not, usage doesn't exist */</span>
<a name="l07102"></a>07102   <span class="keywordflow">if</span> (usage == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07103"></a>07103     <span class="keywordflow">return</span> (0);
<a name="l07104"></a>07104 
<a name="l07105"></a>07105   <span class="comment">/* Is this usage there? */</span>
<a name="l07106"></a>07106   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (usage, user) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07107"></a>07107     <span class="keywordflow">return</span> (0);
<a name="l07108"></a>07108   <span class="keywordflow">else</span>
<a name="l07109"></a>07109     <span class="keywordflow">return</span> (1);
<a name="l07110"></a>07110 }
<a name="l07111"></a>07111 
<a name="l07112"></a>07112 <span class="comment">/* Returns 1 if F[user1][user2] has latency in its forbidden set.</span>
<a name="l07113"></a>07113 <span class="comment"> * Otherwise returns 0</span>
<a name="l07114"></a>07114 <span class="comment"> */</span>
<a name="l07115"></a>07115 <span class="keywordtype">int</span>
<a name="l07116"></a><a class="code" href="lmdes2__customizer_8c.html#ac6b4ad0603ffe89733d6f648fe92f55">07116</a> <a class="code" href="lmdes2__customizer_8c.html#ac6b4ad0603ffe89733d6f648fe92f55">is_forbidden</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07117"></a>07117               <span class="keywordtype">int</span> user1, <span class="keywordtype">int</span> user2, <span class="keywordtype">int</span> latency)
<a name="l07118"></a>07118 {
<a name="l07119"></a>07119   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *forbidden_set;
<a name="l07120"></a>07120   <span class="keywordtype">int</span> temp_user;
<a name="l07121"></a>07121 
<a name="l07122"></a>07122   <span class="comment">/* Handle negative latencies by swapping users, and</span>
<a name="l07123"></a>07123 <span class="comment">   * negating latency. -JCG 4/11/96</span>
<a name="l07124"></a>07124 <span class="comment">   */</span>
<a name="l07125"></a>07125   <span class="keywordflow">if</span> (latency &lt; 0)
<a name="l07126"></a>07126     {
<a name="l07127"></a>07127       temp_user = user1;
<a name="l07128"></a>07128       user1 = user2;
<a name="l07129"></a>07129       user2 = temp_user;
<a name="l07130"></a>07130 
<a name="l07131"></a>07131       latency = -latency;
<a name="l07132"></a>07132     }
<a name="l07133"></a>07133 
<a name="l07134"></a>07134   forbidden_set = forbidden_matrix[user1][user2];
<a name="l07135"></a>07135 
<a name="l07136"></a>07136   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07137"></a>07137     <span class="keywordflow">return</span> (0);
<a name="l07138"></a>07138   <span class="keywordflow">else</span>
<a name="l07139"></a>07139     <span class="keywordflow">return</span> (1);
<a name="l07140"></a>07140 }
<a name="l07141"></a>07141 
<a name="l07142"></a>07142 <span class="comment">/* Returns 1 if the new_user can be added to the resource at new_time</span>
<a name="l07143"></a>07143 <span class="comment"> * without adding any forbidden latencies not in the forbidden matrix.</span>
<a name="l07144"></a>07144 <span class="comment"> * Returns 0 otherwise.</span>
<a name="l07145"></a>07145 <span class="comment"> */</span>
<a name="l07146"></a>07146 <span class="keywordtype">int</span>
<a name="l07147"></a><a class="code" href="lmdes2__customizer_8c.html#e57b1f371837875dcd922b96c5d4099d">07147</a> <a class="code" href="lmdes2__customizer_8c.html#e57b1f371837875dcd922b96c5d4099d">is_compatable</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07148"></a>07148                <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> new_user, <span class="keywordtype">int</span> new_time)
<a name="l07149"></a>07149 {
<a name="l07150"></a>07150   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time_symbol, *usage_symbol;
<a name="l07151"></a>07151   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage_table;
<a name="l07152"></a>07152   <span class="keywordtype">int</span> test_user, test_time, latency;
<a name="l07153"></a>07153 
<a name="l07154"></a>07154   <span class="comment">/* Check compatability of user at time with every usage of this resource */</span>
<a name="l07155"></a>07155   <span class="keywordflow">for</span> (time_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; time_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07156"></a>07156        time_symbol = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07157"></a>07157     {
<a name="l07158"></a>07158       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07159"></a>07159       test_time = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07160"></a>07160 
<a name="l07161"></a>07161       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07162"></a>07162       usage_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07163"></a>07163 
<a name="l07164"></a>07164       <span class="comment">/* Test all usages of this resource at this time */</span>
<a name="l07165"></a>07165       for (usage_symbol = usage_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; usage_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07166"></a>07166            usage_symbol = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07167"></a>07167         {
<a name="l07168"></a>07168           <span class="comment">/* Get the existing user to test */</span>
<a name="l07169"></a>07169           test_user = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07170"></a>07170 
<a name="l07171"></a>07171           <span class="comment">/* Calculate the forbidden latency this will add */</span>
<a name="l07172"></a>07172           latency = test_time - new_time;
<a name="l07173"></a>07173 
<a name="l07174"></a>07174           <span class="comment">/* If adding new_user will create a forbidden latency</span>
<a name="l07175"></a>07175 <span class="comment">           * that is not in the original matrix, return 0</span>
<a name="l07176"></a>07176 <span class="comment">           * (The order of new_user and test_user args must be </span>
<a name="l07177"></a>07177 <span class="comment">           *  consistent with latency calculation!)</span>
<a name="l07178"></a>07178 <span class="comment">           */</span>
<a name="l07179"></a>07179           <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#ac6b4ad0603ffe89733d6f648fe92f55">is_forbidden</a> (forbidden_matrix, new_user, test_user, latency))
<a name="l07180"></a>07180             <span class="keywordflow">return</span> (0);
<a name="l07181"></a>07181         }
<a name="l07182"></a>07182     }
<a name="l07183"></a>07183 
<a name="l07184"></a>07184   <span class="comment">/* If have reached here, must be compatable */</span>
<a name="l07185"></a>07185   <span class="keywordflow">return</span> (1);
<a name="l07186"></a>07186 }
<a name="l07187"></a>07187 
<a name="l07188"></a>07188 <span class="keywordtype">void</span>
<a name="l07189"></a><a class="code" href="lmdes2__customizer_8c.html#c56e6d5cf030a514b50156a8d5705302">07189</a> <a class="code" href="lmdes2__customizer_8c.html#c56e6d5cf030a514b50156a8d5705302">add_to_generating_set</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07190"></a>07190                        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * set, <span class="keywordtype">int</span> user1, <span class="keywordtype">int</span> user2,
<a name="l07191"></a>07191                        <span class="keywordtype">int</span> latency)
<a name="l07192"></a>07192 {
<a name="l07193"></a>07193   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *resource_symbol;
<a name="l07194"></a>07194   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l07195"></a>07195   <span class="keywordtype">int</span> resources_modified;
<a name="l07196"></a>07196 
<a name="l07197"></a>07197   <span class="comment">/* Initially no resources are modified */</span>
<a name="l07198"></a>07198   resources_modified = 0;
<a name="l07199"></a>07199 
<a name="l07200"></a>07200   <span class="comment">/* Try to add this elementary pair to each resource already in the</span>
<a name="l07201"></a>07201 <span class="comment">   * generating set.</span>
<a name="l07202"></a>07202 <span class="comment">   */</span>
<a name="l07203"></a>07203   <span class="keywordflow">for</span> (resource_symbol = set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; resource_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07204"></a>07204        resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07205"></a>07205     {
<a name="l07206"></a>07206       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l07207"></a>07207       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07208"></a>07208 
<a name="l07209"></a>07209       <span class="comment">/* If a slot resource, prevent adding new usages at time 0 */</span>
<a name="l07210"></a>07210       if (resource-&gt;<a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a> &amp; <a class="code" href="lmdes2__customizer_8c.html#d2fffad840fe164eb77141c323a1bc9b">SLOT_RESOURCE</a>)
<a name="l07211"></a>07211         {
<a name="l07212"></a>07212 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07213"></a>07213 <span class="preprocessor"></span>          printf (<span class="stringliteral">"Considering adding of %s user1 %i user2 %i latency %i\n"</span>,
<a name="l07214"></a>07214                   resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user1, user2, latency);
<a name="l07215"></a>07215 <span class="preprocessor">#endif</span>
<a name="l07216"></a>07216 <span class="preprocessor"></span>
<a name="l07217"></a>07217           <span class="comment">/* Don't allow adding of user1 at time 0 */</span>
<a name="l07218"></a>07218           <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#50502d936ec33def8a9137058724306b">usage_exists</a> (resource, user1, 0))
<a name="l07219"></a>07219             <span class="keywordflow">continue</span>;
<a name="l07220"></a>07220 
<a name="l07221"></a>07221           <span class="comment">/* Don't allow adding of user2 at time 0 */</span>
<a name="l07222"></a>07222           <span class="keywordflow">if</span> ((latency == 0) &amp;&amp; !<a class="code" href="lmdes2__customizer_8c.html#50502d936ec33def8a9137058724306b">usage_exists</a> (resource, user2, 0))
<a name="l07223"></a>07223             <span class="keywordflow">continue</span>;
<a name="l07224"></a>07224 
<a name="l07225"></a>07225 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07226"></a>07226 <span class="preprocessor"></span>          printf (<span class="stringliteral">"Allowing adding of %s user1 %i user2 %i latency %i\n"</span>,
<a name="l07227"></a>07227                   resource-&gt;name, user1, user2, latency);
<a name="l07228"></a>07228 <span class="preprocessor">#endif</span>
<a name="l07229"></a>07229 <span class="preprocessor"></span>        }
<a name="l07230"></a>07230 
<a name="l07231"></a>07231       <span class="comment">/* Is the use of user1 at time 0 and user2 at latency </span>
<a name="l07232"></a>07232 <span class="comment">       * compatible with this resource? */</span>
<a name="l07233"></a>07233       <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#e57b1f371837875dcd922b96c5d4099d">is_compatable</a> (forbidden_matrix, resource, user1, 0) &amp;&amp;
<a name="l07234"></a>07234           <a class="code" href="lmdes2__customizer_8c.html#e57b1f371837875dcd922b96c5d4099d">is_compatable</a> (forbidden_matrix, resource, user2, latency))
<a name="l07235"></a>07235         {
<a name="l07236"></a>07236 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07237"></a>07237 <span class="preprocessor"></span>          printf
<a name="l07238"></a>07238             (<span class="stringliteral">"Unit %i time %i and unit %i at time %i is compatable with "</span>
<a name="l07239"></a>07239              <span class="stringliteral">"resource %s\n"</span>,
<a name="l07240"></a>07240              user1, 0, user2, latency, resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l07241"></a>07241 <span class="preprocessor">#endif</span>
<a name="l07242"></a>07242 <span class="preprocessor"></span>
<a name="l07243"></a>07243           <span class="comment">/* Add these usages to this compatable resource */</span>
<a name="l07244"></a>07244           <a class="code" href="lmdes2__customizer_8c.html#8c6ba9919f402479699c8861c5e39512">add_usage</a> (resource, user1, 0);
<a name="l07245"></a>07245           <a class="code" href="lmdes2__customizer_8c.html#8c6ba9919f402479699c8861c5e39512">add_usage</a> (resource, user2, latency);
<a name="l07246"></a>07246 
<a name="l07247"></a>07247           <span class="comment">/* Update the resources modified count */</span>
<a name="l07248"></a>07248           resources_modified++;
<a name="l07249"></a>07249         }
<a name="l07250"></a>07250     }
<a name="l07251"></a>07251 
<a name="l07252"></a>07252 <span class="preprocessor">#if 0</span>
<a name="l07253"></a>07253 <span class="preprocessor"></span>  <span class="comment">/* We add all the resources up front, so this usage must be compatable</span>
<a name="l07254"></a>07254 <span class="comment">   * with at least one of them!!!  NOT TRUE... can have the following</span>
<a name="l07255"></a>07255 <span class="comment">   * situation (only table):</span>
<a name="l07256"></a>07256 <span class="comment">   * Resource1:</span>
<a name="l07257"></a>07257 <span class="comment">   *    time0: 3</span>
<a name="l07258"></a>07258 <span class="comment">   *    time1: 5</span>
<a name="l07259"></a>07259 <span class="comment">   *    time2: 7</span>
<a name="l07260"></a>07260 <span class="comment">   * </span>
<a name="l07261"></a>07261 <span class="comment">   * Would want to add 5, 7, lat 1, (5 at time 0, 7 at time 1), which</span>
<a name="l07262"></a>07262 <span class="comment">   * is not compatable.  I didn't see any cases where it would</span>
<a name="l07263"></a>07263 <span class="comment">   * be usefull to create a new resource with this usage, so I am not.</span>
<a name="l07264"></a>07264 <span class="comment">   * -JCG 4/6/96</span>
<a name="l07265"></a>07265 <span class="comment">   */</span>
<a name="l07266"></a>07266   <span class="keywordflow">if</span> (resources_modified == 0)
<a name="l07267"></a>07267     {
<a name="l07268"></a>07268       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l07269"></a>07269               <span class="stringliteral">"add_to_generating_set:\n"</span>
<a name="l07270"></a>07270               <span class="stringliteral">"Should not need to add resource for user1 %i user2 %i lat %i!"</span>,
<a name="l07271"></a>07271               user1, user2, latency);
<a name="l07272"></a>07272     }
<a name="l07273"></a>07273 <span class="preprocessor">#endif</span>
<a name="l07274"></a>07274 <span class="preprocessor"></span>
<a name="l07275"></a>07275 }
<a name="l07276"></a>07276 
<a name="l07277"></a>07277 <span class="comment">/* Returns 1 if every usage in resource2 is in resource1 */</span>
<a name="l07278"></a>07278 <span class="keywordtype">int</span>
<a name="l07279"></a><a class="code" href="lmdes2__customizer_8c.html#ddf6fc9b02168b82e781ab4cfb4f96a2">07279</a> <a class="code" href="lmdes2__customizer_8c.html#ddf6fc9b02168b82e781ab4cfb4f96a2">resource_redundant</a> (<a class="code" href="structResource__Info.html">Resource_Info</a> * resource1, <a class="code" href="structResource__Info.html">Resource_Info</a> * resource2)
<a name="l07280"></a>07280 {
<a name="l07281"></a>07281   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time2_symbol, *usage2_symbol;
<a name="l07282"></a>07282   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage1_table, *usage2_table;
<a name="l07283"></a>07283   <span class="keywordtype">int</span> time, user;
<a name="l07284"></a>07284 
<a name="l07285"></a>07285   <span class="comment">/* For every usage time of resource2, make sure resource1 also</span>
<a name="l07286"></a>07286 <span class="comment">   * has the same usage.</span>
<a name="l07287"></a>07287 <span class="comment">   */</span>
<a name="l07288"></a>07288   <span class="keywordflow">for</span> (time2_symbol = resource2-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07289"></a>07289        time2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time2_symbol = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07290"></a>07290     {
<a name="l07291"></a>07291       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07292"></a>07292       time = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07293"></a>07293 
<a name="l07294"></a>07294       <span class="comment">/* Get the usage of this time for resource1, if not found</span>
<a name="l07295"></a>07295 <span class="comment">       * then not redundant</span>
<a name="l07296"></a>07296 <span class="comment">       */</span>
<a name="l07297"></a>07297       usage1_table =
<a name="l07298"></a>07298         (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource1-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>,
<a name="l07299"></a>07299                                                    time);
<a name="l07300"></a>07300       <span class="keywordflow">if</span> (usage1_table == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07301"></a>07301         <span class="keywordflow">return</span> (0);
<a name="l07302"></a>07302 
<a name="l07303"></a>07303       <span class="comment">/* Get the usage table for this time for resource2 */</span>
<a name="l07304"></a>07304       usage2_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07305"></a>07305 
<a name="l07306"></a>07306       <span class="comment">/* Test all usages of this resource at this time */</span>
<a name="l07307"></a>07307       for (usage2_symbol = usage2_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; usage2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07308"></a>07308            usage2_symbol = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07309"></a>07309         {
<a name="l07310"></a>07310           <span class="comment">/* Get a user of this resource at this time */</span>
<a name="l07311"></a>07311           user = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07312"></a>07312 
<a name="l07313"></a>07313           <span class="comment">/* Return 0 if not in usage1_table */</span>
<a name="l07314"></a>07314           <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (usage1_table, user) == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07315"></a>07315             <span class="keywordflow">return</span> (0);
<a name="l07316"></a>07316         }
<a name="l07317"></a>07317     }
<a name="l07318"></a>07318 
<a name="l07319"></a>07319   <span class="comment">/* If got here, must be redundant */</span>
<a name="l07320"></a>07320   <span class="keywordflow">return</span> (1);
<a name="l07321"></a>07321 }
<a name="l07322"></a>07322 
<a name="l07323"></a>07323 <span class="keywordtype">void</span>
<a name="l07324"></a><a class="code" href="lmdes2__customizer_8c.html#bfdef3d3f07e9a7c115420edfd247755">07324</a> <a class="code" href="lmdes2__customizer_8c.html#bfdef3d3f07e9a7c115420edfd247755">delete_resource</a> (<a class="code" href="structResource__Info.html">Resource_Info</a> * resource)
<a name="l07325"></a>07325 {
<a name="l07326"></a>07326   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time_symbol, *next_time_symbol;
<a name="l07327"></a>07327   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage_table;
<a name="l07328"></a>07328 
<a name="l07329"></a>07329   <span class="comment">/* For every usage time of resource2, make sure resource1 also</span>
<a name="l07330"></a>07330 <span class="comment">   * has the same usage.</span>
<a name="l07331"></a>07331 <span class="comment">   */</span>
<a name="l07332"></a>07332   <span class="keywordflow">for</span> (time_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; time_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07333"></a>07333        time_symbol = next_time_symbol)
<a name="l07334"></a>07334     {
<a name="l07335"></a>07335       <span class="comment">/* Get the next time symbol before deleting this one */</span>
<a name="l07336"></a>07336       next_time_symbol = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>;
<a name="l07337"></a>07337 
<a name="l07338"></a>07338       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07339"></a>07339       usage_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07340"></a>07340 
<a name="l07341"></a>07341       <span class="comment">/* Delete the symbol table */</span>
<a name="l07342"></a>07342       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (usage_table, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07343"></a>07343 
<a name="l07344"></a>07344       <span class="comment">/* Delete the time symbol */</span>
<a name="l07345"></a>07345       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#84cc47e8a94e9d12339fe6824c406c6e">INT_delete_symbol</a> (time_symbol, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07346"></a>07346     }
<a name="l07347"></a>07347 
<a name="l07348"></a>07348   <span class="comment">/* Delete the resource table */</span>
<a name="l07349"></a>07349   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07350"></a>07350 
<a name="l07351"></a>07351   <span class="comment">/* Free the resource info */</span>
<a name="l07352"></a>07352   free (resource);
<a name="l07353"></a>07353 }
<a name="l07354"></a>07354 
<a name="l07355"></a>07355 <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *
<a name="l07356"></a><a class="code" href="lmdes2__customizer_8c.html#e427d30cb6d003905bbbf42b3fa712b5">07356</a> <a class="code" href="lmdes2__customizer_8c.html#e427d30cb6d003905bbbf42b3fa712b5">build_generating_set</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md,
<a name="l07357"></a>07357                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07358"></a>07358                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> ** unit_array, <span class="keywordtype">int</span> num_units)
<a name="l07359"></a>07359 {
<a name="l07360"></a>07360   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l07361"></a>07361   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_section, *unit_section, *usage_section;
<a name="l07362"></a>07362   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource_entry, *unit_entry, *usage_entry, *resource_id;
<a name="l07363"></a>07363   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *unit_use_field_decl, *usage_use_field_decl;
<a name="l07364"></a>07364   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *usage_time_field_decl, *slot_field_decl;
<a name="l07365"></a>07365   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *unit_use_field, *usage_use_field, *usage_time_field;
<a name="l07366"></a>07366   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *time_table;
<a name="l07367"></a>07367   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource1, *resource2;
<a name="l07368"></a>07368   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *generating_set;
<a name="l07369"></a>07369   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *resource1_symbol, *resource2_symbol;
<a name="l07370"></a>07370   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *next_resource2_symbol;
<a name="l07371"></a>07371   <span class="keywordtype">int</span> index2;
<a name="l07372"></a>07372   <span class="keywordtype">int</span> user1, time;
<a name="l07373"></a>07373   <span class="keywordtype">int</span> need_redundant_header;
<a name="l07374"></a>07374 
<a name="l07375"></a>07375   <span class="comment">/* Create the table to hold the generating set,</span>
<a name="l07376"></a>07376 <span class="comment">   * make it initially big to hold all these pointer references ok</span>
<a name="l07377"></a>07377 <span class="comment">   */</span>
<a name="l07378"></a>07378   generating_set = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (<span class="stringliteral">"generating_set"</span>, 256);
<a name="l07379"></a>07379 
<a name="l07380"></a>07380   <span class="comment">/* Create all the resources currently in mdes */</span>
<a name="l07381"></a>07381   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l07382"></a>07382   slot_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (resource_section, <span class="stringliteral">"slot"</span>);
<a name="l07383"></a>07383   <span class="keywordflow">for</span> (resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (resource_section);
<a name="l07384"></a>07384        resource_entry != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07385"></a>07385        resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource_entry))
<a name="l07386"></a>07386     {
<a name="l07387"></a>07387       time_table = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (resource_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, 0);
<a name="l07388"></a>07388       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structResource__Info.html">Resource_Info</a>));
<a name="l07389"></a>07389       <span class="keywordflow">if</span> (resource == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07390"></a>07390         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Out of memory"</span>);
<a name="l07391"></a>07391 
<a name="l07392"></a>07392       resource-&gt;<a class="code" href="structResource__Info.html#a13a7304c90dda9445585f943726e69a">resource_entry</a> = resource_entry;
<a name="l07393"></a>07393       resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a> = resource_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>;
<a name="l07394"></a>07394       resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a> = time_table;
<a name="l07395"></a>07395       resource-&gt;<a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a> = 0;
<a name="l07396"></a>07396 
<a name="l07397"></a>07397       <span class="comment">/* Mark slot resources */</span>
<a name="l07398"></a>07398       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (resource_entry, slot_field_decl) != NULL)
<a name="l07399"></a>07399         {
<a name="l07400"></a>07400           resource-&gt;<a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a> |= <a class="code" href="lmdes2__customizer_8c.html#d2fffad840fe164eb77141c323a1bc9b">SLOT_RESOURCE</a>;
<a name="l07401"></a>07401         }
<a name="l07402"></a>07402 
<a name="l07403"></a>07403       <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l07404"></a>07404 <span class="comment">       *              resource_entry before looking it up. */</span>
<a name="l07405"></a>07405       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#ddfe548700f0b7b030b45cb5fe1cdf67">INT_add_symbol</a> (generating_set, 
<a name="l07406"></a>07406                       ((<span class="keywordtype">long</span>) resource_entry &amp; (<span class="keywordtype">long</span>) 0xffffffff),
<a name="l07407"></a>07407                       (<span class="keywordtype">void</span> *) resource);
<a name="l07408"></a>07408     }
<a name="l07409"></a>07409 
<a name="l07410"></a>07410   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l07411"></a>07411   unit_use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (unit_section, <span class="stringliteral">"use"</span>);
<a name="l07412"></a>07412   usage_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l07413"></a>07413   usage_use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"use"</span>);
<a name="l07414"></a>07414   usage_time_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"time"</span>);
<a name="l07415"></a>07415   <span class="keywordflow">for</span> (user1 = 0; user1 &lt; num_units; user1++)
<a name="l07416"></a>07416     {
<a name="l07417"></a>07417       unit_entry = unit_array[user1];
<a name="l07418"></a>07418       unit_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (unit_entry, unit_use_field_decl);
<a name="l07419"></a>07419 
<a name="l07420"></a>07420       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l07421"></a>07421         {
<a name="l07422"></a>07422           usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (unit_use_field, index2);
<a name="l07423"></a>07423 
<a name="l07424"></a>07424           usage_use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage_entry, usage_use_field_decl);
<a name="l07425"></a>07425 
<a name="l07426"></a>07426           resource_id = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (usage_use_field, 0);
<a name="l07427"></a>07427 
<a name="l07428"></a>07428           usage_time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (usage_entry,
<a name="l07429"></a>07429                                             usage_time_field_decl);
<a name="l07430"></a>07430           time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (usage_time_field, 0);
<a name="l07431"></a>07431 
<a name="l07432"></a>07432           <span class="comment">/* Find the resource being used */</span>
<a name="l07433"></a>07433           <span class="comment">/* 11/14/02 REK Strip the high 32 bits (if applicable) off of </span>
<a name="l07434"></a>07434 <span class="comment">           *              resource_id before looking it up. */</span>
<a name="l07435"></a>07435           resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) \
<a name="l07436"></a>07436             <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (generating_set,
<a name="l07437"></a>07437                                   ((<span class="keywordtype">long</span>) resource_id &amp; (<span class="keywordtype">long</span>) 0xffffffff));
<a name="l07438"></a>07438 
<a name="l07439"></a>07439           <span class="comment">/* Better not be NULL */</span>
<a name="l07440"></a>07440           <span class="keywordflow">if</span> (resource == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07441"></a>07441             <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"build_generating_set: resource not found!"</span>);
<a name="l07442"></a>07442 
<a name="l07443"></a>07443           <span class="comment">/* Add this unit as a user of this resource */</span>
<a name="l07444"></a>07444           <a class="code" href="lmdes2__customizer_8c.html#8c6ba9919f402479699c8861c5e39512">add_usage</a> (resource, user1, time);
<a name="l07445"></a>07445         }
<a name="l07446"></a>07446     }
<a name="l07447"></a>07447 
<a name="l07448"></a>07448 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07449"></a>07449 <span class="preprocessor"></span>  printf (<span class="stringliteral">"\n\nInitial generating set:\n"</span>);
<a name="l07450"></a>07450   <a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">print_generating_set</a> (stdout, generating_set, unit_array, 0);
<a name="l07451"></a>07451 <span class="preprocessor">#endif</span>
<a name="l07452"></a>07452 <span class="preprocessor"></span>
<a name="l07453"></a>07453   need_redundant_header = 1;
<a name="l07454"></a>07454 
<a name="l07455"></a>07455   <span class="comment">/* Remove redundant resources */</span>
<a name="l07456"></a>07456   <span class="keywordflow">for</span> (resource1_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07457"></a>07457        resource1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07458"></a>07458        resource1_symbol = resource1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07459"></a>07459     {
<a name="l07460"></a>07460       resource1 = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07461"></a>07461       for (resource2_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07462"></a>07462            resource2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; resource2_symbol = next_resource2_symbol)
<a name="l07463"></a>07463         {
<a name="l07464"></a>07464           <span class="comment">/* Get the next resource2_symbol before perhaps deleting this</span>
<a name="l07465"></a>07465 <span class="comment">           * one.</span>
<a name="l07466"></a>07466 <span class="comment">           */</span>
<a name="l07467"></a>07467           next_resource2_symbol = resource2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>;
<a name="l07468"></a>07468 
<a name="l07469"></a>07469           resource2 = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07470"></a>07470 
<a name="l07471"></a>07471           <span class="comment">/* Don't test against itself */</span>
<a name="l07472"></a>07472           if (resource1 == resource2)
<a name="l07473"></a>07473             <span class="keywordflow">continue</span>;
<a name="l07474"></a>07474 
<a name="l07475"></a>07475           <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#ddf6fc9b02168b82e781ab4cfb4f96a2">resource_redundant</a> (resource1, resource2))
<a name="l07476"></a>07476             {
<a name="l07477"></a>07477               <span class="keywordflow">if</span> (!(resource2-&gt;<a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a> &amp; <a class="code" href="lmdes2__customizer_8c.html#d2fffad840fe164eb77141c323a1bc9b">SLOT_RESOURCE</a>))
<a name="l07478"></a>07478                 {
<a name="l07479"></a>07479 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07480"></a>07480 <span class="preprocessor"></span>                  printf (<span class="stringliteral">"Given %s, %s is redundant... Removing.\n"</span>,
<a name="l07481"></a>07481                           resource1-&gt;name, resource2-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l07482"></a>07482 <span class="preprocessor">#endif</span>
<a name="l07483"></a>07483 <span class="preprocessor"></span>
<a name="l07484"></a>07484                   <span class="keywordflow">if</span> (need_redundant_header)
<a name="l07485"></a>07485                     {
<a name="l07486"></a>07486                       printf (<span class="stringliteral">"&gt; Deleting redundant resources:"</span>);
<a name="l07487"></a>07487                       need_redundant_header = 0;
<a name="l07488"></a>07488                     }
<a name="l07489"></a>07489                   printf (<span class="stringliteral">" %s"</span>, resource2-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l07490"></a>07490                   <a class="code" href="lmdes2__customizer_8c.html#bfdef3d3f07e9a7c115420edfd247755">delete_resource</a> (resource2);
<a name="l07491"></a>07491                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#84cc47e8a94e9d12339fe6824c406c6e">INT_delete_symbol</a> (resource2_symbol, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07492"></a>07492                 }
<a name="l07493"></a>07493               <span class="keywordflow">else</span>
<a name="l07494"></a>07494                 {
<a name="l07495"></a>07495 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07496"></a>07496 <span class="preprocessor"></span>                  printf
<a name="l07497"></a>07497                     (<span class="stringliteral">"Given %s, %s is redundant... but cannot delete slot "</span>
<a name="l07498"></a>07498                      <span class="stringliteral">"resource.\n"</span>,
<a name="l07499"></a>07499                      resource1-&gt;name, resource2-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l07500"></a>07500 <span class="preprocessor">#endif</span>
<a name="l07501"></a>07501 <span class="preprocessor"></span>                }
<a name="l07502"></a>07502             }
<a name="l07503"></a>07503         }
<a name="l07504"></a>07504     }
<a name="l07505"></a>07505   <span class="comment">/* Terminate list of redundant resources if necesary */</span>
<a name="l07506"></a>07506   <span class="keywordflow">if</span> (!need_redundant_header)
<a name="l07507"></a>07507     printf (<span class="stringliteral">"\n"</span>);
<a name="l07508"></a>07508 
<a name="l07509"></a>07509   <span class="comment">/* Can "fill out" the generating set to allow shifting around</span>
<a name="l07510"></a>07510 <span class="comment">   * of the resource usages.  May help a little, but didn't make</span>
<a name="l07511"></a>07511 <span class="comment">   * a big difference in our machine descriptions.</span>
<a name="l07512"></a>07512 <span class="comment">   * If do uncomment code, make sure not to add extra slot usages</span>
<a name="l07513"></a>07513 <span class="comment">   * (and prevent the deletion of slots currently used... Taken care</span>
<a name="l07514"></a>07514 <span class="comment">   *  of 4/6/96 -JCG)</span>
<a name="l07515"></a>07515 <span class="comment">   *</span>
<a name="l07516"></a>07516 <span class="comment">   */</span>
<a name="l07517"></a>07517 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07518"></a>07518 <span class="preprocessor"></span>  printf (<span class="stringliteral">"\n Filling out generating set:\n"</span>);
<a name="l07519"></a>07519 
<a name="l07520"></a>07520   <span class="comment">/* Create all the resources necessary to generate all of</span>
<a name="l07521"></a>07521 <span class="comment">   * the forbidden latencies.</span>
<a name="l07522"></a>07522 <span class="comment">   */</span>
<a name="l07523"></a>07523   <span class="keywordtype">int</span> index1, latency;
<a name="l07524"></a>07524   <span class="keywordflow">for</span> (index1 = 0; index1 &lt; num_units; index1++)
<a name="l07525"></a>07525     {
<a name="l07526"></a>07526       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> **forbidden_row, *forbidden_set;
<a name="l07527"></a>07527       forbidden_row = forbidden_matrix[index1];
<a name="l07528"></a>07528       <span class="keywordflow">for</span> (index2 = 0; index2 &lt; num_units; index2++)
<a name="l07529"></a>07529         {
<a name="l07530"></a>07530           forbidden_set = forbidden_row[index2];
<a name="l07531"></a>07531 
<a name="l07532"></a>07532           <span class="comment">/* Add each forbidden latency to tghe generating set */</span>
<a name="l07533"></a>07533           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *symbol;
<a name="l07534"></a>07534           <span class="keywordflow">for</span> (symbol = forbidden_set-&gt;head_symbol; symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07535"></a>07535                symbol = symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07536"></a>07536             {
<a name="l07537"></a>07537               <span class="comment">/* Get the forbidden latency */</span>
<a name="l07538"></a>07538               latency = symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07539"></a>07539 
<a name="l07540"></a>07540               <span class="comment">/* Only process latencies &gt;= 0 */</span>
<a name="l07541"></a>07541               if (latency &lt; 0)
<a name="l07542"></a>07542                 <span class="keywordflow">continue</span>;
<a name="l07543"></a>07543 
<a name="l07544"></a>07544               <a class="code" href="lmdes2__customizer_8c.html#c56e6d5cf030a514b50156a8d5705302">add_to_generating_set</a> (forbidden_matrix, generating_set,
<a name="l07545"></a>07545                                      index1, index2, latency);
<a name="l07546"></a>07546             }
<a name="l07547"></a>07547         }
<a name="l07548"></a>07548     }
<a name="l07549"></a>07549 <span class="preprocessor">#endif</span>
<a name="l07550"></a>07550 <span class="preprocessor"></span>
<a name="l07551"></a>07551   <span class="keywordflow">return</span> (generating_set);
<a name="l07552"></a>07552 }
<a name="l07553"></a>07553 
<a name="l07554"></a>07554 
<a name="l07555"></a>07555 
<a name="l07556"></a>07556 
<a name="l07557"></a>07557 <span class="keywordtype">void</span>
<a name="l07558"></a><a class="code" href="lmdes2__customizer_8c.html#f5f197f8e2818c8aeebcad98a7af54ba">07558</a> <a class="code" href="lmdes2__customizer_8c.html#f5f197f8e2818c8aeebcad98a7af54ba">enumerate_pairs</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07559"></a>07559                  <a class="code" href="structResource__Info.html">Resource_Info</a> * resource)
<a name="l07560"></a>07560 {
<a name="l07561"></a>07561   <a class="code" href="structPair__Node.html">Pair_Node</a> *pnode;
<a name="l07562"></a>07562   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time1_symbol, *usage1_symbol, *forbidden_symbol;
<a name="l07563"></a>07563   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time2_symbol, *usage2_symbol;
<a name="l07564"></a>07564   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage1_table, *usage2_table;
<a name="l07565"></a>07565   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *forbidden_set;
<a name="l07566"></a>07566   <span class="keywordtype">int</span> user1, user2, time1, time2, latency;
<a name="l07567"></a>07567 
<a name="l07568"></a>07568 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07569"></a>07569 <span class="preprocessor"></span>  printf (<span class="stringliteral">"\nFor resource %s:\n"</span>, resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l07570"></a>07570 <span class="preprocessor">#endif</span>
<a name="l07571"></a>07571 <span class="preprocessor"></span>
<a name="l07572"></a>07572   <span class="keywordflow">for</span> (time1_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07573"></a>07573        time1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time1_symbol = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07574"></a>07574     {
<a name="l07575"></a>07575       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07576"></a>07576       time1 = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07577"></a>07577 
<a name="l07578"></a>07578       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07579"></a>07579       usage1_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07580"></a>07580 
<a name="l07581"></a>07581       for (time2_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07582"></a>07582            time2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time2_symbol = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07583"></a>07583         {
<a name="l07584"></a>07584           <span class="comment">/* Get the time for this usage table */</span>
<a name="l07585"></a>07585           time2 = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07586"></a>07586 
<a name="l07587"></a>07587           <span class="comment">/* Get the usage table for this time */</span>
<a name="l07588"></a>07588           usage2_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07589"></a>07589 
<a name="l07590"></a>07590           latency = time2 - time1;
<a name="l07591"></a>07591 
<a name="l07592"></a>07592           <span class="comment">/* Only add positive latencies */</span>
<a name="l07593"></a>07593           if (latency &lt; 0)
<a name="l07594"></a>07594             <span class="keywordflow">continue</span>;
<a name="l07595"></a>07595 
<a name="l07596"></a>07596           <span class="comment">/* Test all usages of this resource at this time */</span>
<a name="l07597"></a>07597           <span class="keywordflow">for</span> (usage1_symbol = usage1_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07598"></a>07598                usage1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07599"></a>07599                usage1_symbol = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07600"></a>07600             {
<a name="l07601"></a>07601               <span class="comment">/* Get the existing user to test */</span>
<a name="l07602"></a>07602               user1 = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07603"></a>07603 
<a name="l07604"></a>07604               <span class="keywordflow">for</span> (usage2_symbol = usage2_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07605"></a>07605                    usage2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07606"></a>07606                    usage2_symbol = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07607"></a>07607                 {
<a name="l07608"></a>07608                   <span class="comment">/* Get the existing user to test */</span>
<a name="l07609"></a>07609                   user2 = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07610"></a>07610 
<a name="l07611"></a>07611 
<a name="l07612"></a>07612                   forbidden_set = forbidden_matrix[user1][user2];
<a name="l07613"></a>07613 
<a name="l07614"></a>07614                   forbidden_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency);
<a name="l07615"></a>07615 
<a name="l07616"></a>07616                   pnode = (<a class="code" href="structPair__Node.html">Pair_Node</a> *) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structPair__Node.html">Pair_Node</a>));
<a name="l07617"></a>07617                   <span class="keywordflow">if</span> (pnode == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07618"></a>07618                     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Out of memory"</span>);
<a name="l07619"></a>07619                   pnode-&gt;<a class="code" href="structPair__Node.html#9791ae4ee8b004db541141a808b74b95">resource</a> = resource;
<a name="l07620"></a>07620                   pnode-&gt;<a class="code" href="structPair__Node.html#0794150083c96d6831c84db393e034c8">time1</a> = time1;
<a name="l07621"></a>07621                   pnode-&gt;<a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">next</a> = (Pair_Node *) forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07622"></a>07622                   forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = (<span class="keywordtype">void</span> *) pnode;
<a name="l07623"></a>07623 
<a name="l07624"></a>07624 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07625"></a>07625 <span class="preprocessor"></span>                  printf (<span class="stringliteral">"Adding user1 %i, user2 %i time1 %i, time2 = %i\n"</span>,
<a name="l07626"></a>07626                           user1, user2, time1, time2);
<a name="l07627"></a>07627 <span class="preprocessor">#endif</span>
<a name="l07628"></a>07628 <span class="preprocessor"></span>                }
<a name="l07629"></a>07629             }
<a name="l07630"></a>07630 
<a name="l07631"></a>07631         }
<a name="l07632"></a>07632     }
<a name="l07633"></a>07633 }
<a name="l07634"></a>07634 <span class="keywordtype">int</span>
<a name="l07635"></a><a class="code" href="lmdes2__customizer_8c.html#9f86fef88cfa05bb7b44606ba6d92f8b">07635</a> <a class="code" href="lmdes2__customizer_8c.html#9f86fef88cfa05bb7b44606ba6d92f8b">mark_covered</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07636"></a>07636               <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07637"></a>07637 {
<a name="l07638"></a>07638   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *forbidden_set;
<a name="l07639"></a>07639   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage2_table, *usage1_table;
<a name="l07640"></a>07640   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time1_symbol, *usage1_symbol;
<a name="l07641"></a>07641   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time2_symbol, *usage2_symbol, *forbidden_symbol;
<a name="l07642"></a>07642   <a class="code" href="structPair__Node.html">Pair_Node</a> *pnode, *next_pnode;
<a name="l07643"></a>07643   <span class="keywordtype">int</span> time1, time2, user1, user2, latency, num_covered;
<a name="l07644"></a>07644 
<a name="l07645"></a>07645   num_covered = 0;
<a name="l07646"></a>07646 
<a name="l07647"></a>07647   <span class="comment">/* Mark those covered latencies covered where user is user1 */</span>
<a name="l07648"></a>07648   user1 = user;
<a name="l07649"></a>07649   time1 = time;
<a name="l07650"></a>07650 
<a name="l07651"></a>07651   <span class="keywordflow">for</span> (time2_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07652"></a>07652        time2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time2_symbol = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07653"></a>07653     {
<a name="l07654"></a>07654       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07655"></a>07655       time2 = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07656"></a>07656 
<a name="l07657"></a>07657       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07658"></a>07658       usage2_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07659"></a>07659 
<a name="l07660"></a>07660       <span class="comment">/* Only process non-negative latencies */</span>
<a name="l07661"></a>07661       latency = time2 - time1;
<a name="l07662"></a>07662       if (latency &lt; 0)
<a name="l07663"></a>07663         <span class="keywordflow">continue</span>;
<a name="l07664"></a>07664 
<a name="l07665"></a>07665       <span class="keywordflow">for</span> (usage2_symbol = usage2_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07666"></a>07666            usage2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; usage2_symbol = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07667"></a>07667         {
<a name="l07668"></a>07668           <span class="comment">/* Mark only those latencies associated with committed usages */</span>
<a name="l07669"></a>07669           <span class="keywordflow">if</span> (usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == 0)
<a name="l07670"></a>07670             <span class="keywordflow">continue</span>;
<a name="l07671"></a>07671 
<a name="l07672"></a>07672           <span class="comment">/* Get the existing user to test */</span>
<a name="l07673"></a>07673           user2 = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07674"></a>07674 
<a name="l07675"></a>07675           forbidden_set = forbidden_matrix[user1][user2];
<a name="l07676"></a>07676 
<a name="l07677"></a>07677           forbidden_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency);
<a name="l07678"></a>07678 
<a name="l07679"></a>07679           <span class="comment">/* Better not be null */</span>
<a name="l07680"></a>07680           <span class="keywordflow">if</span> (forbidden_symbol == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07681"></a>07681             {
<a name="l07682"></a>07682               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l07683"></a>07683                       <span class="stringliteral">"mark_covered: NULL forbidden_symbol!\n"</span>
<a name="l07684"></a>07684                       <span class="stringliteral">"For resource %s: user1 %i user2 %i, time1 %i, "</span>
<a name="l07685"></a>07685                       <span class="stringliteral">"time2 %i\n"</span>,
<a name="l07686"></a>07686                       resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user1, user2, time1, time2);
<a name="l07687"></a>07687             }
<a name="l07688"></a>07688 
<a name="l07689"></a>07689           <span class="comment">/* Continue if has already been covered */</span>
<a name="l07690"></a>07690           <span class="keywordflow">if</span> (forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07691"></a>07691             <span class="keywordflow">continue</span>;
<a name="l07692"></a>07692 
<a name="l07693"></a>07693           <span class="comment">/* Free pair nodes */</span>
<a name="l07694"></a>07694           <span class="keywordflow">for</span> (pnode = (<a class="code" href="structPair__Node.html">Pair_Node</a> *) forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>; pnode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07695"></a>07695                pnode = next_pnode)
<a name="l07696"></a>07696             {
<a name="l07697"></a>07697               <span class="comment">/* Get the next pnode before deleting this one */</span>
<a name="l07698"></a>07698               next_pnode = pnode-&gt;<a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">next</a>;
<a name="l07699"></a>07699 
<a name="l07700"></a>07700               free (pnode);
<a name="l07701"></a>07701             }
<a name="l07702"></a>07702 
<a name="l07703"></a>07703           <span class="comment">/* Mark as covered */</span>
<a name="l07704"></a>07704           forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07705"></a>07705 
<a name="l07706"></a>07706           <span class="comment">/* Update covered count */</span>
<a name="l07707"></a>07707           num_covered++;
<a name="l07708"></a>07708         }
<a name="l07709"></a>07709     }
<a name="l07710"></a>07710 
<a name="l07711"></a>07711 
<a name="l07712"></a>07712   <span class="comment">/* Mark those covered latencies covered where user is user2 */</span>
<a name="l07713"></a>07713   user2 = user;
<a name="l07714"></a>07714   time2 = time;
<a name="l07715"></a>07715 
<a name="l07716"></a>07716   <span class="keywordflow">for</span> (time1_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07717"></a>07717        time1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time1_symbol = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07718"></a>07718     {
<a name="l07719"></a>07719       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07720"></a>07720       time1 = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07721"></a>07721 
<a name="l07722"></a>07722       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07723"></a>07723       usage1_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07724"></a>07724 
<a name="l07725"></a>07725       <span class="comment">/* Only process non-negative latencies */</span>
<a name="l07726"></a>07726       latency = time2 - time1;
<a name="l07727"></a>07727       if (latency &lt; 0)
<a name="l07728"></a>07728         <span class="keywordflow">continue</span>;
<a name="l07729"></a>07729 
<a name="l07730"></a>07730       <span class="keywordflow">for</span> (usage1_symbol = usage1_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07731"></a>07731            usage1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; usage1_symbol = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07732"></a>07732         {
<a name="l07733"></a>07733           <span class="comment">/* Mark only those latencies associated with committed usages */</span>
<a name="l07734"></a>07734           <span class="keywordflow">if</span> (usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == 0)
<a name="l07735"></a>07735             <span class="keywordflow">continue</span>;
<a name="l07736"></a>07736 
<a name="l07737"></a>07737           <span class="comment">/* Get the existing user to test */</span>
<a name="l07738"></a>07738           user1 = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07739"></a>07739 
<a name="l07740"></a>07740           forbidden_set = forbidden_matrix[user1][user2];
<a name="l07741"></a>07741 
<a name="l07742"></a>07742           forbidden_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency);
<a name="l07743"></a>07743 
<a name="l07744"></a>07744           <span class="comment">/* Better not be null */</span>
<a name="l07745"></a>07745           <span class="keywordflow">if</span> (forbidden_symbol == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07746"></a>07746             {
<a name="l07747"></a>07747               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l07748"></a>07748                       <span class="stringliteral">"mark_covered: NULL forbidden_symbol!\n"</span>
<a name="l07749"></a>07749                       <span class="stringliteral">"For resource %s: user1 %i user2 %i, time1 %i, "</span>
<a name="l07750"></a>07750                       <span class="stringliteral">"time2 %i\n"</span>,
<a name="l07751"></a>07751                       resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user1, user2, time1, time2);
<a name="l07752"></a>07752             }
<a name="l07753"></a>07753 
<a name="l07754"></a>07754           <span class="comment">/* Continue if has already been covered */</span>
<a name="l07755"></a>07755           <span class="keywordflow">if</span> (forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07756"></a>07756             <span class="keywordflow">continue</span>;
<a name="l07757"></a>07757 
<a name="l07758"></a>07758           <span class="comment">/* Free pair nodes */</span>
<a name="l07759"></a>07759           <span class="keywordflow">for</span> (pnode = (<a class="code" href="structPair__Node.html">Pair_Node</a> *) forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>; pnode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07760"></a>07760                pnode = next_pnode)
<a name="l07761"></a>07761             {
<a name="l07762"></a>07762               <span class="comment">/* Get the next pnode before deleting this one */</span>
<a name="l07763"></a>07763               next_pnode = pnode-&gt;<a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">next</a>;
<a name="l07764"></a>07764 
<a name="l07765"></a>07765               free (pnode);
<a name="l07766"></a>07766             }
<a name="l07767"></a>07767 
<a name="l07768"></a>07768           <span class="comment">/* Mark as covered */</span>
<a name="l07769"></a>07769           forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07770"></a>07770 
<a name="l07771"></a>07771           <span class="comment">/* Update covered count */</span>
<a name="l07772"></a>07772           num_covered++;
<a name="l07773"></a>07773         }
<a name="l07774"></a>07774     }
<a name="l07775"></a>07775 
<a name="l07776"></a>07776   <span class="keywordflow">return</span> (num_covered);
<a name="l07777"></a>07777 }
<a name="l07778"></a>07778 
<a name="l07779"></a>07779 <span class="keywordtype">void</span>
<a name="l07780"></a><a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">07780</a> <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07781"></a>07781               <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07782"></a>07782 {
<a name="l07783"></a>07783   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage;
<a name="l07784"></a>07784   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *user_usage;
<a name="l07785"></a>07785 
<a name="l07786"></a>07786   <span class="comment">/* Make sure there is a usage for the given time! */</span>
<a name="l07787"></a>07787   usage = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>,
<a name="l07788"></a>07788                                                      time);
<a name="l07789"></a>07789   <span class="keywordflow">if</span> (usage == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07790"></a>07790     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"commit_usage: usage for time %i expected!\n"</span>, time);
<a name="l07791"></a>07791 
<a name="l07792"></a>07792 
<a name="l07793"></a>07793   <span class="comment">/* Get this user's usage */</span>
<a name="l07794"></a>07794   <span class="keywordflow">if</span> ((user_usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (usage, user)) == NULL)
<a name="l07795"></a>07795     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (NULL, <span class="stringliteral">"commit_usage: user_usage for user %i expected!\n"</span>, user);
<a name="l07796"></a>07796 
<a name="l07797"></a>07797   <span class="comment">/* If user_usage already commited, return now */</span>
<a name="l07798"></a>07798   <span class="keywordflow">if</span> (user_usage-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> != NULL)
<a name="l07799"></a>07799     <span class="keywordflow">return</span>;
<a name="l07800"></a>07800 
<a name="l07801"></a>07801   <span class="comment">/* Mark the user_usage as committed */</span>
<a name="l07802"></a>07802   user_usage-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> = (<span class="keywordtype">void</span> *) 1;
<a name="l07803"></a>07803 
<a name="l07804"></a>07804   <span class="comment">/* Mark the forbidden matrix latencies covered by this usage as</span>
<a name="l07805"></a>07805 <span class="comment">   * covered.</span>
<a name="l07806"></a>07806 <span class="comment">   */</span>
<a name="l07807"></a>07807   <a class="code" href="lmdes2__customizer_8c.html#9f86fef88cfa05bb7b44606ba6d92f8b">mark_covered</a> (forbidden_matrix, resource, user, time);
<a name="l07808"></a>07808 }
<a name="l07809"></a>07809 
<a name="l07810"></a>07810 <span class="keywordtype">int</span>
<a name="l07811"></a><a class="code" href="lmdes2__customizer_8c.html#9de3070c3c12a6fffae5eab9c66d1925">07811</a> <a class="code" href="lmdes2__customizer_8c.html#9de3070c3c12a6fffae5eab9c66d1925">is_usage_committed</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07812"></a>07812                     <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07813"></a>07813 {
<a name="l07814"></a>07814   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage;
<a name="l07815"></a>07815   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *user_usage;
<a name="l07816"></a>07816 
<a name="l07817"></a>07817   <span class="comment">/* Make sure there is a usage for the given time! */</span>
<a name="l07818"></a>07818   usage = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>,
<a name="l07819"></a>07819                                                      time);
<a name="l07820"></a>07820   <span class="keywordflow">if</span> (usage == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07821"></a>07821     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"is_usage_committed: usage for time %i expected!\n"</span>, time);
<a name="l07822"></a>07822 
<a name="l07823"></a>07823 
<a name="l07824"></a>07824   <span class="comment">/* Get this user's usage */</span>
<a name="l07825"></a>07825   <span class="keywordflow">if</span> ((user_usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (usage, user)) == NULL)
<a name="l07826"></a>07826     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (NULL,
<a name="l07827"></a>07827             <span class="stringliteral">"is_usage_committed: user_usage for user %i expected!\n"</span>, user);
<a name="l07828"></a>07828 
<a name="l07829"></a>07829   <span class="comment">/* If user_usage already commited, return 1, otherwise 0 */</span>
<a name="l07830"></a>07830   <span class="keywordflow">if</span> (user_usage-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> != NULL)
<a name="l07831"></a>07831     <span class="keywordflow">return</span> (1);
<a name="l07832"></a>07832   <span class="keywordflow">else</span>
<a name="l07833"></a>07833     <span class="keywordflow">return</span> (0);
<a name="l07834"></a>07834 }
<a name="l07835"></a>07835 
<a name="l07836"></a>07836 <span class="keywordtype">int</span>
<a name="l07837"></a><a class="code" href="lmdes2__customizer_8c.html#ab8af320e914a5226e613527f8e57a63">07837</a> <a class="code" href="lmdes2__customizer_8c.html#ab8af320e914a5226e613527f8e57a63">count_num_covered</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07838"></a>07838                    <a class="code" href="structResource__Info.html">Resource_Info</a> * resource, <span class="keywordtype">int</span> user, <span class="keywordtype">int</span> time)
<a name="l07839"></a>07839 {
<a name="l07840"></a>07840   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *forbidden_set;
<a name="l07841"></a>07841   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage2_table, *usage1_table;
<a name="l07842"></a>07842   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time1_symbol, *usage1_symbol;
<a name="l07843"></a>07843   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time2_symbol, *usage2_symbol, *forbidden_symbol;
<a name="l07844"></a>07844   <span class="keywordtype">int</span> time1, time2, user1, user2, latency, num_covered;
<a name="l07845"></a>07845 
<a name="l07846"></a>07846   num_covered = 0;
<a name="l07847"></a>07847 
<a name="l07848"></a>07848   <span class="comment">/* Count those covered latencies covered where user is user1 */</span>
<a name="l07849"></a>07849   user1 = user;
<a name="l07850"></a>07850   time1 = time;
<a name="l07851"></a>07851 
<a name="l07852"></a>07852   <span class="keywordflow">for</span> (time2_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07853"></a>07853        time2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time2_symbol = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07854"></a>07854     {
<a name="l07855"></a>07855       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07856"></a>07856       time2 = time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07857"></a>07857 
<a name="l07858"></a>07858       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07859"></a>07859       usage2_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07860"></a>07860 
<a name="l07861"></a>07861       <span class="comment">/* Only process non-negative latencies */</span>
<a name="l07862"></a>07862       latency = time2 - time1;
<a name="l07863"></a>07863       if (latency &lt; 0)
<a name="l07864"></a>07864         <span class="keywordflow">continue</span>;
<a name="l07865"></a>07865 
<a name="l07866"></a>07866       <span class="keywordflow">for</span> (usage2_symbol = usage2_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07867"></a>07867            usage2_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; usage2_symbol = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07868"></a>07868         {
<a name="l07869"></a>07869           <span class="comment">/* Mark only those latencies associated with committed usages */</span>
<a name="l07870"></a>07870           <span class="keywordflow">if</span> (usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == 0)
<a name="l07871"></a>07871             <span class="keywordflow">continue</span>;
<a name="l07872"></a>07872 
<a name="l07873"></a>07873           <span class="comment">/* Get the existing user to test */</span>
<a name="l07874"></a>07874           user2 = usage2_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07875"></a>07875 
<a name="l07876"></a>07876           forbidden_set = forbidden_matrix[user1][user2];
<a name="l07877"></a>07877 
<a name="l07878"></a>07878           forbidden_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency);
<a name="l07879"></a>07879 
<a name="l07880"></a>07880           <span class="comment">/* Better not be null */</span>
<a name="l07881"></a>07881           <span class="keywordflow">if</span> (forbidden_symbol == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07882"></a>07882             {
<a name="l07883"></a>07883               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l07884"></a>07884                       <span class="stringliteral">"count_num_covered: NULL forbidden_symbol!\n"</span>
<a name="l07885"></a>07885                       <span class="stringliteral">"For resource %s: user1 %i user2 %i, time1 %i, "</span>
<a name="l07886"></a>07886                       <span class="stringliteral">"time2 %i\n"</span>,
<a name="l07887"></a>07887                       resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user1, user2, time1, time2);
<a name="l07888"></a>07888             }
<a name="l07889"></a>07889 
<a name="l07890"></a>07890           <span class="comment">/* Continue if has already been covered */</span>
<a name="l07891"></a>07891           <span class="keywordflow">if</span> (forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07892"></a>07892             <span class="keywordflow">continue</span>;
<a name="l07893"></a>07893 
<a name="l07894"></a>07894           <span class="comment">/* Update covered count */</span>
<a name="l07895"></a>07895           num_covered++;
<a name="l07896"></a>07896         }
<a name="l07897"></a>07897     }
<a name="l07898"></a>07898 
<a name="l07899"></a>07899 
<a name="l07900"></a>07900   <span class="comment">/* Mark those covered latencies covered where user is user2 */</span>
<a name="l07901"></a>07901   user2 = user;
<a name="l07902"></a>07902   time2 = time;
<a name="l07903"></a>07903 
<a name="l07904"></a>07904   <span class="keywordflow">for</span> (time1_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07905"></a>07905        time1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; time1_symbol = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07906"></a>07906     {
<a name="l07907"></a>07907       <span class="comment">/* Get the time for this usage table */</span>
<a name="l07908"></a>07908       time1 = time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07909"></a>07909 
<a name="l07910"></a>07910       <span class="comment">/* Get the usage table for this time */</span>
<a name="l07911"></a>07911       usage1_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07912"></a>07912 
<a name="l07913"></a>07913       <span class="comment">/* Only process positive latencies (don't count 0 latencies twice) */</span>
<a name="l07914"></a>07914       latency = time2 - time1;
<a name="l07915"></a>07915       if (latency &lt; 0)
<a name="l07916"></a>07916         <span class="keywordflow">continue</span>;
<a name="l07917"></a>07917 
<a name="l07918"></a>07918       <span class="keywordflow">for</span> (usage1_symbol = usage1_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07919"></a>07919            usage1_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; usage1_symbol = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07920"></a>07920         {
<a name="l07921"></a>07921           <span class="comment">/* Mark only those latencies associated with committed usages */</span>
<a name="l07922"></a>07922           <span class="keywordflow">if</span> (usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == 0)
<a name="l07923"></a>07923             <span class="keywordflow">continue</span>;
<a name="l07924"></a>07924 
<a name="l07925"></a>07925           <span class="comment">/* Get the existing user to test */</span>
<a name="l07926"></a>07926           user1 = usage1_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l07927"></a>07927 
<a name="l07928"></a>07928           forbidden_set = forbidden_matrix[user1][user2];
<a name="l07929"></a>07929 
<a name="l07930"></a>07930           forbidden_symbol = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#4b4e1a84b31fad39d8a62e2920c3f1a2">INT_find_symbol</a> (forbidden_set, latency);
<a name="l07931"></a>07931 
<a name="l07932"></a>07932           <span class="comment">/* Better not be null */</span>
<a name="l07933"></a>07933           <span class="keywordflow">if</span> (forbidden_symbol == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07934"></a>07934             {
<a name="l07935"></a>07935               <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l07936"></a>07936                       <span class="stringliteral">"mark_covered: NULL forbidden_symbol!\n"</span>
<a name="l07937"></a>07937                       <span class="stringliteral">"For resource %s: user1 %i user2 %i, time1 %i, "</span>
<a name="l07938"></a>07938                       <span class="stringliteral">"time2 %i\n"</span>,
<a name="l07939"></a>07939                       resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user1, user2, time1, time2);
<a name="l07940"></a>07940             }
<a name="l07941"></a>07941 
<a name="l07942"></a>07942           <span class="comment">/* Continue if has already been covered */</span>
<a name="l07943"></a>07943           <span class="keywordflow">if</span> (forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07944"></a>07944             <span class="keywordflow">continue</span>;
<a name="l07945"></a>07945 
<a name="l07946"></a>07946           <span class="comment">/* Update covered count */</span>
<a name="l07947"></a>07947           num_covered++;
<a name="l07948"></a>07948         }
<a name="l07949"></a>07949     }
<a name="l07950"></a>07950 
<a name="l07951"></a>07951   <span class="keywordflow">return</span> (num_covered);
<a name="l07952"></a>07952 }
<a name="l07953"></a>07953 
<a name="l07954"></a>07954 <span class="keywordtype">void</span>
<a name="l07955"></a><a class="code" href="lmdes2__customizer_8c.html#4a7cfc80caf1cc2ac73c2347fa710f63">07955</a> <a class="code" href="lmdes2__customizer_8c.html#4a7cfc80caf1cc2ac73c2347fa710f63">minimize_generating_set</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * generating_set,
<a name="l07956"></a>07956                          <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *** forbidden_matrix,
<a name="l07957"></a>07957                          <span class="keywordtype">int</span> num_units, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> ** unit_array)
<a name="l07958"></a>07958 {
<a name="l07959"></a>07959   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *resource_symbol, *forbidden_symbol, *user_symbol;
<a name="l07960"></a>07960   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage_table;
<a name="l07961"></a>07961   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l07962"></a>07962   <a class="code" href="structResource__Info.html">Resource_Info</a> *min_resource;
<a name="l07963"></a>07963   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> **forbidden_row, *forbidden_set;
<a name="l07964"></a>07964   <a class="code" href="structPair__Node.html">Pair_Node</a> *phead, *pnode, *best_pnode;
<a name="l07965"></a>07965   <span class="keywordtype">int</span> num_covered;
<a name="l07966"></a>07966   <span class="keywordtype">int</span> user1, user2, latency, count, max_count, num_left;
<a name="l07967"></a>07967   <span class="keywordtype">int</span> min_user1 = 0, min_user2 = 0, min_time1 = 0, min_time2 = 0;
<a name="l07968"></a>07968   <span class="keywordtype">int</span> min_count = 0, min_covered = 0;
<a name="l07969"></a>07969   <span class="keywordtype">int</span> best_covered;
<a name="l07970"></a>07970   <span class="keywordtype">int</span> time1, time2;
<a name="l07971"></a>07971 
<a name="l07972"></a>07972   <span class="keywordflow">for</span> (resource_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07973"></a>07973        resource_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07974"></a>07974        resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07975"></a>07975     {
<a name="l07976"></a>07976       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l07977"></a>07977       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07978"></a>07978 
<a name="l07979"></a>07979       <a class="code" href="lmdes2__customizer_8c.html#f5f197f8e2818c8aeebcad98a7af54ba">enumerate_pairs</a> (forbidden_matrix, resource);
<a name="l07980"></a>07980     }
<a name="l07981"></a>07981 
<a name="l07982"></a>07982   <span class="comment">/* After all the usage pairs are enumerated, commit the usages of</span>
<a name="l07983"></a>07983 <span class="comment">   * slot resources at time (and remove the associated pairs), so</span>
<a name="l07984"></a>07984 <span class="comment">   * that the scheduler and user will not get confused by deleted or</span>
<a name="l07985"></a>07985 <span class="comment">   * different slot usage.</span>
<a name="l07986"></a>07986 <span class="comment">   */</span>
<a name="l07987"></a>07987 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l07988"></a>07988 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Committing slot usages at time 0\n"</span>);
<a name="l07989"></a>07989 <span class="preprocessor">#endif</span>
<a name="l07990"></a>07990 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (resource_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l07991"></a>07991        resource_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07992"></a>07992        resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l07993"></a>07993     {
<a name="l07994"></a>07994       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l07995"></a>07995       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l07996"></a>07996 
<a name="l07997"></a>07997       <span class="comment">/* If not a slot resource, process next resource */</span>
<a name="l07998"></a>07998       if (!(resource-&gt;<a class="code" href="structResource__Info.html#44136b3784d799962f70d46b95e00245">flags</a> &amp; <a class="code" href="lmdes2__customizer_8c.html#d2fffad840fe164eb77141c323a1bc9b">SLOT_RESOURCE</a>))
<a name="l07999"></a>07999         <span class="keywordflow">continue</span>;
<a name="l08000"></a>08000 
<a name="l08001"></a>08001       <span class="comment">/* Get the usage table for time 0, continue if don't exist */</span>
<a name="l08002"></a>08002       usage_table =
<a name="l08003"></a>08003         (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#3022f18360abe8bea56f9cdd41807741">INT_find_symbol_data</a> (resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>, 0);
<a name="l08004"></a>08004       <span class="keywordflow">if</span> (usage_table == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l08005"></a>08005         <span class="keywordflow">continue</span>;
<a name="l08006"></a>08006 
<a name="l08007"></a>08007       <span class="comment">/* Commit all usages of this resource at time 0 */</span>
<a name="l08008"></a>08008       <span class="keywordflow">for</span> (user_symbol = usage_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; user_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08009"></a>08009            user_symbol = user_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08010"></a>08010         {
<a name="l08011"></a>08011 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08012"></a>08012 <span class="preprocessor"></span>          printf (<span class="stringliteral">"Committing slot usage %s user %i time 0\n"</span>,
<a name="l08013"></a>08013                   resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, user_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>);
<a name="l08014"></a>08014 <span class="preprocessor">#endif</span>
<a name="l08015"></a>08015 <span class="preprocessor"></span>          <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (forbidden_matrix, resource, user_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>, 0);
<a name="l08016"></a>08016         }
<a name="l08017"></a>08017 
<a name="l08018"></a>08018 
<a name="l08019"></a>08019     }
<a name="l08020"></a>08020 
<a name="l08021"></a>08021 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08022"></a>08022 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Commiting unique pairs\n"</span>);
<a name="l08023"></a>08023 <span class="preprocessor">#endif</span>
<a name="l08024"></a>08024 <span class="preprocessor"></span>
<a name="l08025"></a>08025   max_count = 0;
<a name="l08026"></a>08026   num_left = 0;
<a name="l08027"></a>08027   <span class="keywordflow">for</span> (user1 = 0; user1 &lt; num_units; user1++)
<a name="l08028"></a>08028     {
<a name="l08029"></a>08029       forbidden_row = forbidden_matrix[user1];
<a name="l08030"></a>08030       <span class="keywordflow">for</span> (user2 = 0; user2 &lt; num_units; user2++)
<a name="l08031"></a>08031         {
<a name="l08032"></a>08032           forbidden_set = forbidden_row[user2];
<a name="l08033"></a>08033 
<a name="l08034"></a>08034           <span class="keywordflow">for</span> (forbidden_symbol = forbidden_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08035"></a>08035                forbidden_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08036"></a>08036                forbidden_symbol = forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08037"></a>08037             {
<a name="l08038"></a>08038               <span class="comment">/* Get the resource for this symbol */</span>
<a name="l08039"></a>08039               latency = forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l08040"></a>08040 
<a name="l08041"></a>08041               <span class="comment">/* Only process non-negative latencies */</span>
<a name="l08042"></a>08042               if (latency &lt; 0)
<a name="l08043"></a>08043                 <span class="keywordflow">continue</span>;
<a name="l08044"></a>08044 
<a name="l08045"></a>08045               <span class="comment">/* Only process pairs for latencies that have</span>
<a name="l08046"></a>08046 <span class="comment">               * not already been covered.</span>
<a name="l08047"></a>08047 <span class="comment">               */</span>
<a name="l08048"></a>08048               <span class="keywordflow">if</span> (forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l08049"></a>08049                 <span class="keywordflow">continue</span>;
<a name="l08050"></a>08050 
<a name="l08051"></a>08051               phead = (<a class="code" href="structPair__Node.html">Pair_Node</a> *) forbidden_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08052"></a>08052 
<a name="l08053"></a>08053               count = 0;
<a name="l08054"></a>08054               for (pnode = phead; pnode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; pnode = pnode-&gt;<a class="code" href="structPair__Node.html#52a91852dc793620658dc5ff52f569f7">next</a>)
<a name="l08055"></a>08055                 {
<a name="l08056"></a>08056                   count++;
<a name="l08057"></a>08057                 }
<a name="l08058"></a>08058 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08059"></a>08059 <span class="preprocessor"></span>              printf (<span class="stringliteral">"User1 %i user2 %i latency %i  pairs %i\n"</span>,
<a name="l08060"></a>08060                       user1, user2, latency, count);
<a name="l08061"></a>08061 <span class="preprocessor">#endif</span>
<a name="l08062"></a>08062 <span class="preprocessor"></span>
<a name="l08063"></a>08063               <span class="keywordflow">if</span> (count &gt; max_count)
<a name="l08064"></a>08064                 max_count = count;
<a name="l08065"></a>08065 
<a name="l08066"></a>08066               <span class="keywordflow">if</span> (count == 1)
<a name="l08067"></a>08067                 {
<a name="l08068"></a>08068                   <span class="comment">/* Committing a usage pair will cause that pair</span>
<a name="l08069"></a>08069 <span class="comment">                   * to be freed... Get information from pair</span>
<a name="l08070"></a>08070 <span class="comment">                   * before committing!  (Detected with Mem Advisor)</span>
<a name="l08071"></a>08071 <span class="comment">                   */</span>
<a name="l08072"></a>08072                   resource = phead-&gt;<a class="code" href="structPair__Node.html#9791ae4ee8b004db541141a808b74b95">resource</a>;
<a name="l08073"></a>08073                   time1 = phead-&gt;<a class="code" href="structPair__Node.html#0794150083c96d6831c84db393e034c8">time1</a>;
<a name="l08074"></a>08074                   time2 = latency + phead-&gt;<a class="code" href="structPair__Node.html#0794150083c96d6831c84db393e034c8">time1</a>;
<a name="l08075"></a>08075                   <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (forbidden_matrix, resource, user1, time1);
<a name="l08076"></a>08076                   <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (forbidden_matrix, resource, user2, time2);
<a name="l08077"></a>08077                 }
<a name="l08078"></a>08078               <span class="keywordflow">else</span>
<a name="l08079"></a>08079                 {
<a name="l08080"></a>08080                   num_left++;
<a name="l08081"></a>08081                 }
<a name="l08082"></a>08082             }
<a name="l08083"></a>08083         }
<a name="l08084"></a>08084     }
<a name="l08085"></a>08085 
<a name="l08086"></a>08086   <span class="comment">/* While there are latencies uncovered, pick an usage pair that</span>
<a name="l08087"></a>08087 <span class="comment">   * covers the most remaining latencies.  See below for</span>
<a name="l08088"></a>08088 <span class="comment">   * the rules for selecting pairs in case of ties.</span>
<a name="l08089"></a>08089 <span class="comment">   */</span>
<a name="l08090"></a>08090   <span class="keywordflow">while</span> (num_left &gt; 0)
<a name="l08091"></a>08091     {
<a name="l08092"></a>08092       num_left = 0;
<a name="l08093"></a>08093       min_resource = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08094"></a>08094 
<a name="l08095"></a>08095 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08096"></a>08096 <span class="preprocessor"></span>      printf (<span class="stringliteral">"What is left:\n"</span>);
<a name="l08097"></a>08097       <a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">print_generating_set</a> (stdout, generating_set, unit_array, 1);
<a name="l08098"></a>08098 <span class="preprocessor">#endif</span>
<a name="l08099"></a>08099 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (user1 = 0; user1 &lt; num_units; user1++)
<a name="l08100"></a>08100         {
<a name="l08101"></a>08101           forbidden_row = forbidden_matrix[user1];
<a name="l08102"></a>08102           <span class="keywordflow">for</span> (user2 = 0; user2 &lt; num_units; user2++)
<a name="l08103"></a>08103             {
<a name="l08104"></a>08104               forbidden_set = forbidden_row[user2];
<a name="l08105"></a>08105 
<a name="l08106"></a>08106               <span class="keywordflow">for</span> (forbidden_symbol = forbidden_set-&gt;head_symbol;
<a name="l08107"></a>08107                    forbidden_symbol != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08108"></a>08108                    forbidden_symbol = forbidden_symbol-&gt;next_symbol)
<a name="l08109"></a>08109                 {
<a name="l08110"></a>08110                   <span class="comment">/* Get the resource for this symbol */</span>
<a name="l08111"></a>08111                   latency = forbidden_symbol-&gt;value;
<a name="l08112"></a>08112 
<a name="l08113"></a>08113                   <span class="comment">/* Only process non-negative latencies */</span>
<a name="l08114"></a>08114                   if (latency &lt; 0)
<a name="l08115"></a>08115                     <span class="keywordflow">continue</span>;
<a name="l08116"></a>08116 
<a name="l08117"></a>08117                   <span class="comment">/* Only process pairs for latencies that have</span>
<a name="l08118"></a>08118 <span class="comment">                   * not already been covered.</span>
<a name="l08119"></a>08119 <span class="comment">                   */</span>
<a name="l08120"></a>08120                   <span class="keywordflow">if</span> (forbidden_symbol-&gt;data == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l08121"></a>08121                     <span class="keywordflow">continue</span>;
<a name="l08122"></a>08122 
<a name="l08123"></a>08123                   phead = (<a class="code" href="structPair__Node.html">Pair_Node</a> *) forbidden_symbol-&gt;data;
<a name="l08124"></a>08124 
<a name="l08125"></a>08125                   <span class="comment">/* Count the number of usage pairs that generate</span>
<a name="l08126"></a>08126 <span class="comment">                   * this forbidden latency</span>
<a name="l08127"></a>08127 <span class="comment">                   */</span>
<a name="l08128"></a>08128                   count = 0;
<a name="l08129"></a>08129                   for (pnode = phead; pnode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; pnode = pnode-&gt;next)
<a name="l08130"></a>08130                     {
<a name="l08131"></a>08131                       count++;
<a name="l08132"></a>08132                     }
<a name="l08133"></a>08133 
<a name="l08134"></a>08134 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08135"></a>08135 <span class="preprocessor"></span>                  printf (<span class="stringliteral">"User1 %i user2 %i latency %i  pairs %i\n"</span>,
<a name="l08136"></a>08136                           user1, user2, latency, count);
<a name="l08137"></a>08137 <span class="preprocessor">#endif</span>
<a name="l08138"></a>08138 <span class="preprocessor"></span>
<a name="l08139"></a>08139                   best_pnode = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08140"></a>08140                   best_covered = -1;
<a name="l08141"></a>08141 
<a name="l08142"></a>08142                   <span class="comment">/* Find the usage pair for this forbidden latency</span>
<a name="l08143"></a>08143 <span class="comment">                   * that covers the most forbidden latencies (other</span>
<a name="l08144"></a>08144 <span class="comment">                   * than this one).  </span>
<a name="l08145"></a>08145 <span class="comment">                   * This algorithm used to give slight preference to</span>
<a name="l08146"></a>08146 <span class="comment">                   * pairs where one usage is already committed </span>
<a name="l08147"></a>08147 <span class="comment">                   * I now correct this, so they are all equal -JCG 4/16/96</span>
<a name="l08148"></a>08148 <span class="comment">                   * (Made no difference for PA or SPARC! but seems the</span>
<a name="l08149"></a>08149 <span class="comment">                   *  right thing to do)</span>
<a name="l08150"></a>08150 <span class="comment">                   */</span>
<a name="l08151"></a>08151                   <span class="keywordflow">for</span> (pnode = phead; pnode != <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; pnode = pnode-&gt;next)
<a name="l08152"></a>08152                     {
<a name="l08153"></a>08153                       num_covered =
<a name="l08154"></a>08154                         <a class="code" href="lmdes2__customizer_8c.html#ab8af320e914a5226e613527f8e57a63">count_num_covered</a> (forbidden_matrix,
<a name="l08155"></a>08155                                            pnode-&gt;resource,
<a name="l08156"></a>08156                                            user1, pnode-&gt;time1);
<a name="l08157"></a>08157 
<a name="l08158"></a>08158                       <span class="comment">/* Subtract from the count the "coverage" caused by</span>
<a name="l08159"></a>08159 <span class="comment">                       * user2 @ time2 being already commited.</span>
<a name="l08160"></a>08160 <span class="comment">                       */</span>
<a name="l08161"></a>08161                       if (<a class="code" href="lmdes2__customizer_8c.html#9de3070c3c12a6fffae5eab9c66d1925">is_usage_committed</a> (forbidden_matrix,
<a name="l08162"></a>08162                                               pnode-&gt;resource,
<a name="l08163"></a>08163                                               user2, pnode-&gt;time1 + latency))
<a name="l08164"></a>08164                         {
<a name="l08165"></a>08165 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l08166"></a>08166                           printf
<a name="l08167"></a>08167                             (<span class="stringliteral">"Correcting cover for %s user1 %i user2 %i "</span>
<a name="l08168"></a>08168                              <span class="stringliteral">"time1 %i time2 %i\n"</span>,
<a name="l08169"></a>08169                              pnode-&gt;resource-&gt;name, user1, user2,
<a name="l08170"></a>08170                              pnode-&gt;time1, pnode-&gt;time1 + latency);
<a name="l08171"></a>08171 #endif
<a name="l08172"></a>08172                           num_covered--;
<a name="l08173"></a>08173                         }
<a name="l08174"></a>08174                       <span class="comment">/* Don't count the same resource usage twice */</span>
<a name="l08175"></a>08175                       <span class="keywordflow">if</span> ((user1 != user2) || (latency != 0))
<a name="l08176"></a>08176                         {
<a name="l08177"></a>08177                           num_covered +=
<a name="l08178"></a>08178                             <a class="code" href="lmdes2__customizer_8c.html#ab8af320e914a5226e613527f8e57a63">count_num_covered</a> (forbidden_matrix,
<a name="l08179"></a>08179                                                pnode-&gt;resource,
<a name="l08180"></a>08180                                                user2, pnode-&gt;time1 + latency);
<a name="l08181"></a>08181 
<a name="l08182"></a>08182                           <span class="comment">/* Subtract from the count the "coverage" caused</span>
<a name="l08183"></a>08183 <span class="comment">                           * by user1 @ time1 being already commited.</span>
<a name="l08184"></a>08184 <span class="comment">                           */</span>
<a name="l08185"></a>08185                           if (<a class="code" href="lmdes2__customizer_8c.html#9de3070c3c12a6fffae5eab9c66d1925">is_usage_committed</a> (forbidden_matrix,
<a name="l08186"></a>08186                                                   pnode-&gt;resource,
<a name="l08187"></a>08187                                                   user1, pnode-&gt;time1))
<a name="l08188"></a>08188                             {
<a name="l08189"></a>08189 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l08190"></a>08190                               printf
<a name="l08191"></a>08191                                 (<span class="stringliteral">"Correcting cover for %s user1 %i user2 %i "</span>
<a name="l08192"></a>08192                                  <span class="stringliteral">"time1 %i time2 %i\n"</span>,
<a name="l08193"></a>08193                                  pnode-&gt;resource-&gt;name, user1, user2,
<a name="l08194"></a>08194                                  pnode-&gt;time1, pnode-&gt;time1 + latency);
<a name="l08195"></a>08195 #endif
<a name="l08196"></a>08196                               num_covered--;
<a name="l08197"></a>08197                             }
<a name="l08198"></a>08198 
<a name="l08199"></a>08199                         }
<a name="l08200"></a>08200 
<a name="l08201"></a>08201 
<a name="l08202"></a>08202                       <span class="keywordflow">if</span> ((best_pnode == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l08203"></a>08203                           (best_covered &lt; num_covered) ||
<a name="l08204"></a>08204                           (best_pnode-&gt;time1 &gt; pnode-&gt;time1))
<a name="l08205"></a>08205                         {
<a name="l08206"></a>08206                           best_pnode = pnode;
<a name="l08207"></a>08207                           best_covered = num_covered;
<a name="l08208"></a>08208                         }
<a name="l08209"></a>08209                     }
<a name="l08210"></a>08210 
<a name="l08211"></a>08211 
<a name="l08212"></a>08212                   <span class="comment">/* Using greedy covering algorithm.  Pick </span>
<a name="l08213"></a>08213 <span class="comment">                   * the next pair to commit based on the following</span>
<a name="l08214"></a>08214 <span class="comment">                   * sort order:</span>
<a name="l08215"></a>08215 <span class="comment">                   * 1) The number of forbidden latencies covered</span>
<a name="l08216"></a>08216 <span class="comment">                   *    (pick the largest).</span>
<a name="l08217"></a>08217 <span class="comment">                   * 2) The number of pair that cover this latency</span>
<a name="l08218"></a>08218 <span class="comment">                   *    (pick the smallest).</span>
<a name="l08219"></a>08219 <span class="comment">                   * 3) The early time of the usage (pick the smallest,</span>
<a name="l08220"></a>08220 <span class="comment">                   *    bias towards small usage times, 0 is likely to</span>
<a name="l08221"></a>08221 <span class="comment">                   *    be a good usage time)</span>
<a name="l08222"></a>08222 <span class="comment">                   * 4) The late time of the usage (pick the largest!,</span>
<a name="l08223"></a>08223 <span class="comment">                   *    bias towards picking the long latency times first,</span>
<a name="l08224"></a>08224 <span class="comment">                   *    they most likely are going to be picked anyway,</span>
<a name="l08225"></a>08225 <span class="comment">                   *    so pick them now) (It could go either way, but</span>
<a name="l08226"></a>08226 <span class="comment">                   *    using the largest worked much better on PA's</span>
<a name="l08227"></a>08227 <span class="comment">                   *    divides.)</span>
<a name="l08228"></a>08228 <span class="comment">                   * </span>
<a name="l08229"></a>08229 <span class="comment">                   * Otherwise pick the first pair encountered.</span>
<a name="l08230"></a>08230 <span class="comment">                   */</span>
<a name="l08231"></a>08231                   <span class="keywordflow">if</span> ((min_resource == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l08232"></a>08232                       ((min_covered &lt; best_covered)) ||
<a name="l08233"></a>08233                       ((min_covered == best_covered) &amp;&amp;
<a name="l08234"></a>08234                        (min_count &gt; count)) ||
<a name="l08235"></a>08235                       ((min_covered == best_covered) &amp;&amp;
<a name="l08236"></a>08236                        (min_count == count) &amp;&amp;
<a name="l08237"></a>08237                        (min_time1 &gt; best_pnode-&gt;time1)) ||
<a name="l08238"></a>08238                       ((min_covered == best_covered) &amp;&amp;
<a name="l08239"></a>08239                        (min_count == count) &amp;&amp;
<a name="l08240"></a>08240                        (min_time1 == best_pnode-&gt;time1) &amp;&amp;
<a name="l08241"></a>08241                        (min_time2 &lt; (best_pnode-&gt;time1 + latency))))
<a name="l08242"></a>08242                     {
<a name="l08243"></a>08243                       min_resource = best_pnode-&gt;resource;
<a name="l08244"></a>08244                       min_user1 = user1;
<a name="l08245"></a>08245                       min_user2 = user2;
<a name="l08246"></a>08246                       min_time1 = best_pnode-&gt;time1;
<a name="l08247"></a>08247                       min_time2 = best_pnode-&gt;time1 + latency;
<a name="l08248"></a>08248                       min_count = count;
<a name="l08249"></a>08249                       min_covered = best_covered;
<a name="l08250"></a>08250 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l08251"></a>08251                       printf
<a name="l08252"></a>08252                         (<span class="stringliteral">"New min: resource %s user1 %i user2 %i time1 %i "</span>
<a name="l08253"></a>08253                          <span class="stringliteral">"time2 %i count %i covered %i\n"</span>,
<a name="l08254"></a>08254                          min_resource-&gt;name, min_user1, min_user2, min_time1,
<a name="l08255"></a>08255                          min_time2, min_count, min_covered);
<a name="l08256"></a>08256 #endif
<a name="l08257"></a>08257                     }
<a name="l08258"></a>08258 
<a name="l08259"></a>08259                   num_left++;
<a name="l08260"></a>08260                 }
<a name="l08261"></a>08261             }
<a name="l08262"></a>08262         }
<a name="l08263"></a>08263 
<a name="l08264"></a>08264       <span class="comment">/* If min_resource is NULL, num_left better be 0 */</span>
<a name="l08265"></a>08265       <span class="keywordflow">if</span> ((min_resource == <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (num_left != 0))
<a name="l08266"></a>08266         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__global_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">"Minimize gen set: algorithm error!"</span>);
<a name="l08267"></a>08267 
<a name="l08268"></a>08268       <span class="keywordflow">if</span> (min_resource != NULL)
<a name="l08269"></a>08269         {
<a name="l08270"></a>08270           <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (forbidden_matrix, min_resource, min_user1, min_time1);
<a name="l08271"></a>08271           <a class="code" href="lmdes2__customizer_8c.html#7bbd7a4ef676ca025d871cea39549a0d">commit_usage</a> (forbidden_matrix, min_resource, min_user2, min_time2);
<a name="l08272"></a>08272 
<a name="l08273"></a>08273 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08274"></a>08274 <span class="preprocessor"></span>          printf
<a name="l08275"></a>08275             (<span class="stringliteral">"Num left %i: resource %s user1 %i user2 %i time1 %i time2 %i "</span>
<a name="l08276"></a>08276              <span class="stringliteral">"count %i covered %i\n"</span>,
<a name="l08277"></a>08277              num_left, min_resource-&gt;name, min_user1, min_user2, min_time1,
<a name="l08278"></a>08278              min_time2, min_count, min_covered);
<a name="l08279"></a>08279 <span class="preprocessor">#endif</span>
<a name="l08280"></a>08280 <span class="preprocessor"></span>        }
<a name="l08281"></a>08281 
<a name="l08282"></a>08282     }
<a name="l08283"></a>08283 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08284"></a>08284 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Final generating set after minimization:\n"</span>);
<a name="l08285"></a>08285   <a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">print_generating_set</a> (stdout, generating_set, unit_array, 1);
<a name="l08286"></a>08286 <span class="preprocessor">#endif</span>
<a name="l08287"></a>08287 <span class="preprocessor"></span>}
<a name="l08288"></a>08288 
<a name="l08289"></a>08289 
<a name="l08290"></a>08290 <span class="keywordtype">void</span>
<a name="l08291"></a><a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">08291</a> <a class="code" href="lmdes2__customizer_8c.html#ebeba51fe729c503fd5b0918d2631671">print_generating_set</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * generating_set,
<a name="l08292"></a>08292                       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> ** unit_array, <span class="keywordtype">int</span> committed)
<a name="l08293"></a>08293 {
<a name="l08294"></a>08294   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time_symbol, *usage_symbol, *resource_symbol;
<a name="l08295"></a>08295   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage_table;
<a name="l08296"></a>08296   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l08297"></a>08297   <span class="keywordtype">int</span> time;
<a name="l08298"></a>08298   <span class="keywordtype">int</span> user;
<a name="l08299"></a>08299 
<a name="l08300"></a>08300   <span class="keywordflow">for</span> (resource_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08301"></a>08301        resource_symbol != NULL;
<a name="l08302"></a>08302        resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08303"></a>08303     {
<a name="l08304"></a>08304       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l08305"></a>08305       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08306"></a>08306       fprintf (out, <span class="stringliteral">"%s:\n"</span>, resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>);
<a name="l08307"></a>08307 
<a name="l08308"></a>08308       <span class="keywordflow">for</span> (time_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08309"></a>08309            time_symbol != NULL; time_symbol = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08310"></a>08310         {
<a name="l08311"></a>08311           <span class="comment">/* Get the time for this usage table */</span>
<a name="l08312"></a>08312           time = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l08313"></a>08313 
<a name="l08314"></a>08314           fprintf (out, <span class="stringliteral">"  time %i:"</span>, time);
<a name="l08315"></a>08315 
<a name="l08316"></a>08316           <span class="comment">/* Get the usage table for this time */</span>
<a name="l08317"></a>08317           usage_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08318"></a>08318 
<a name="l08319"></a>08319           <span class="comment">/* Test all usages of this resource at this time */</span>
<a name="l08320"></a>08320           for (usage_symbol = usage_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; usage_symbol != NULL;
<a name="l08321"></a>08321                usage_symbol = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08322"></a>08322             {
<a name="l08323"></a>08323               <span class="comment">/* Get a user of this resource at this time */</span>
<a name="l08324"></a>08324               user = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l08325"></a>08325 
<a name="l08326"></a>08326               <span class="keywordflow">if</span> (committed == ((<span class="keywordtype">long</span>) usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> &amp; (<span class="keywordtype">long</span>) 0xffffffff))
<a name="l08327"></a>08327                 printf (<span class="stringliteral">" %i"</span>, user);
<a name="l08328"></a>08328               <span class="keywordflow">else</span>
<a name="l08329"></a>08329                 printf (<span class="stringliteral">" (%i)"</span>, user);
<a name="l08330"></a>08330             }
<a name="l08331"></a>08331           printf (<span class="stringliteral">"\n"</span>);
<a name="l08332"></a>08332         }
<a name="l08333"></a>08333       printf (<span class="stringliteral">"\n"</span>);
<a name="l08334"></a>08334     }
<a name="l08335"></a>08335 }
<a name="l08336"></a>08336 
<a name="l08337"></a>08337 <span class="keywordtype">void</span>
<a name="l08338"></a><a class="code" href="lmdes2__customizer_8c.html#4327d8c541da78d5f3f9cf53831da30d">08338</a> <a class="code" href="lmdes2__customizer_8c.html#4327d8c541da78d5f3f9cf53831da30d">free_generating_set</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * generating_set)
<a name="l08339"></a>08339 {
<a name="l08340"></a>08340   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *resource_symbol, *next_resource_symbol;
<a name="l08341"></a>08341   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l08342"></a>08342 
<a name="l08343"></a>08343   <span class="comment">/* Delete all the resources in the generating set */</span>
<a name="l08344"></a>08344   <span class="keywordflow">for</span> (resource_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08345"></a>08345        resource_symbol != NULL; resource_symbol = next_resource_symbol)
<a name="l08346"></a>08346     {
<a name="l08347"></a>08347       <span class="comment">/* Get the next resource symbol before deleting this one */</span>
<a name="l08348"></a>08348       next_resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>;
<a name="l08349"></a>08349 
<a name="l08350"></a>08350       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l08351"></a>08351       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08352"></a>08352 
<a name="l08353"></a>08353       <span class="comment">/* Delete this resource */</span>
<a name="l08354"></a>08354       <a class="code" href="lmdes2__customizer_8c.html#bfdef3d3f07e9a7c115420edfd247755">delete_resource</a> (resource);
<a name="l08355"></a>08355 
<a name="l08356"></a>08356       <span class="comment">/* Delete the symbol pointing to it */</span>
<a name="l08357"></a>08357       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#84cc47e8a94e9d12339fe6824c406c6e">INT_delete_symbol</a> (resource_symbol, NULL);
<a name="l08358"></a>08358     }
<a name="l08359"></a>08359 
<a name="l08360"></a>08360   <span class="comment">/* Delete the generating set itself */</span>
<a name="l08361"></a>08361   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (generating_set, NULL);
<a name="l08362"></a>08362 }
<a name="l08363"></a>08363 
<a name="l08364"></a>08364 <span class="keywordtype">void</span>
<a name="l08365"></a><a class="code" href="lmdes2__customizer_8c.html#9e2ad332512f8a39005bb239d100eef6">08365</a> <a class="code" href="lmdes2__customizer_8c.html#9e2ad332512f8a39005bb239d100eef6">instantiate_generating_set</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> * generating_set,
<a name="l08366"></a>08366                             <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> ** use_array, <span class="keywordtype">int</span> num_units,
<a name="l08367"></a>08367                             <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> * usage_section)
<a name="l08368"></a>08368 {
<a name="l08369"></a>08369   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html">INT_Symbol</a> *time_symbol, *usage_symbol, *resource_symbol;
<a name="l08370"></a>08370   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *usage_table;
<a name="l08371"></a>08371   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *usage, *next_usage;
<a name="l08372"></a>08372   <a class="code" href="structResource__Info.html">Resource_Info</a> *resource;
<a name="l08373"></a>08373   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *time_field, *use_field;
<a name="l08374"></a>08374   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *time_field_decl, *use_field_decl;
<a name="l08375"></a>08375   <span class="keywordtype">int</span> user, time, index1, index2;
<a name="l08376"></a>08376   <span class="keywordtype">char</span> name_buf[5000];
<a name="l08377"></a>08377 
<a name="l08378"></a>08378   <span class="comment">/* Delete all the existing links in the unit-&gt;use fields */</span>
<a name="l08379"></a>08379   <span class="keywordflow">for</span> (index1 = 0; index1 &lt; num_units; index1++)
<a name="l08380"></a>08380     {
<a name="l08381"></a>08381       <span class="keywordflow">for</span> (index2 = use_array[index1]-&gt;max_element_index; index2 &gt;= 0;
<a name="l08382"></a>08382            index2--)
<a name="l08383"></a>08383         {
<a name="l08384"></a>08384           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#323c95e323e8e32f489e998a83f87c53">MD_delete_element</a> (use_array[index1], index2);
<a name="l08385"></a>08385         }
<a name="l08386"></a>08386     }
<a name="l08387"></a>08387 
<a name="l08388"></a>08388   <span class="comment">/* Delete all the existing resource usage entries */</span>
<a name="l08389"></a>08389   <span class="keywordflow">for</span> (usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (usage_section); usage != NULL;
<a name="l08390"></a>08390        usage = next_usage)
<a name="l08391"></a>08391     {
<a name="l08392"></a>08392       <span class="comment">/* Get the next resource usage before deleting this one */</span>
<a name="l08393"></a>08393       next_usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (usage);
<a name="l08394"></a>08394 
<a name="l08395"></a>08395       <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d90f29f9c1e93c7269b8cd426ef3a563">MD_delete_entry</a> (usage);
<a name="l08396"></a>08396     }
<a name="l08397"></a>08397 
<a name="l08398"></a>08398   <span class="comment">/* Get the time and use field declarations */</span>
<a name="l08399"></a>08399   use_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"use"</span>);
<a name="l08400"></a>08400   time_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (usage_section, <span class="stringliteral">"time"</span>);
<a name="l08401"></a>08401 
<a name="l08402"></a>08402   <span class="keywordflow">for</span> (resource_symbol = generating_set-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08403"></a>08403        resource_symbol != NULL;
<a name="l08404"></a>08404        resource_symbol = resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08405"></a>08405     {
<a name="l08406"></a>08406       <span class="comment">/* Get the resource for this symbol */</span>
<a name="l08407"></a>08407       resource = (<a class="code" href="structResource__Info.html">Resource_Info</a> *) resource_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08408"></a>08408 
<a name="l08409"></a>08409       for (time_symbol = resource-&gt;<a class="code" href="structResource__Info.html#c445ffe205bc68c63cb5197080e0df73">time_table</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>;
<a name="l08410"></a>08410            time_symbol != NULL; time_symbol = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08411"></a>08411         {
<a name="l08412"></a>08412           <span class="comment">/* Get the time for this usage table */</span>
<a name="l08413"></a>08413           time = time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l08414"></a>08414 
<a name="l08415"></a>08415           <span class="comment">/* Create a new usage of this resource at this time */</span>
<a name="l08416"></a>08416           sprintf (name_buf, <span class="stringliteral">"%s_t%i"</span>, resource-&gt;<a class="code" href="structResource__Info.html#9897dc471a7e5f4a91fb0bc2c614b12b">name</a>, time);
<a name="l08417"></a>08417           usage = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#9f8fe13898aae1fcebba90fa026a3318">MD_new_entry</a> (usage_section, name_buf);
<a name="l08418"></a>08418 
<a name="l08419"></a>08419           <span class="comment">/* Set the entries time and use field appropriately */</span>
<a name="l08420"></a>08420           use_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (usage, use_field_decl, 1);
<a name="l08421"></a>08421           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_field, 0, resource-&gt;<a class="code" href="structResource__Info.html#a13a7304c90dda9445585f943726e69a">resource_entry</a>);
<a name="l08422"></a>08422 
<a name="l08423"></a>08423           time_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#fbc882977f12979165e7d5903d2272be">MD_new_field</a> (usage, time_field_decl, 1);
<a name="l08424"></a>08424           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#d3609a2cbc1a05b0cffb684d3dbbd573">MD_set_int</a> (time_field, 0, time);
<a name="l08425"></a>08425 
<a name="l08426"></a>08426           <span class="comment">/* Get the usage table for this time */</span>
<a name="l08427"></a>08427           usage_table = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *) time_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a>;
<a name="l08428"></a>08428 
<a name="l08429"></a>08429           <span class="comment">/* Add the commited usages of this resource at this time */</span>
<a name="l08430"></a>08430           for (usage_symbol = usage_table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html#987a4445814d684b15e723269707ace0">head_symbol</a>; usage_symbol != NULL;
<a name="l08431"></a>08431                usage_symbol = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2e66816ffa140184184a1645c9e60226">next_symbol</a>)
<a name="l08432"></a>08432             {
<a name="l08433"></a>08433 
<a name="l08434"></a>08434               <span class="comment">/* Add only committed usages */</span>
<a name="l08435"></a>08435               <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#2158658fd3bec8e70b62a2c2c151ff03">data</a> &amp; (<span class="keywordtype">long</span>) 0xffffffff) == 1)
<a name="l08436"></a>08436                 {
<a name="l08437"></a>08437                   <span class="comment">/* Get a user of this resource at this time */</span>
<a name="l08438"></a>08438                   user = usage_symbol-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol.html#36e57f163da72b9608d16bcdd99781dc">value</a>;
<a name="l08439"></a>08439 
<a name="l08440"></a>08440                   <span class="comment">/* Add the usage to this user's use field */</span>
<a name="l08441"></a>08441                   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#c1642c81252810b1792fac58dfb79777">MD_set_link</a> (use_array[user],
<a name="l08442"></a>08442                                use_array[user]-&gt;max_element_index + 1, usage);
<a name="l08443"></a>08443                 }
<a name="l08444"></a>08444             }
<a name="l08445"></a>08445         }
<a name="l08446"></a>08446     }
<a name="l08447"></a>08447 }
<a name="l08448"></a>08448 
<a name="l08449"></a>08449 <span class="keywordtype">void</span>
<a name="l08450"></a><a class="code" href="lmdes2__customizer_8c.html#80bbeee5328a5227004302dbc729efa9">08450</a> <a class="code" href="lmdes2__customizer_8c.html#80bbeee5328a5227004302dbc729efa9">reduce_resource_units</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l08451"></a>08451 {
<a name="l08452"></a>08452   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section, *usage_section;
<a name="l08453"></a>08453   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> **unit_array, *unit_entry, *usage_entry;
<a name="l08454"></a>08454   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> **use_array, *use1_field, *use2_field, *test_field;
<a name="l08455"></a>08455   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> ***forbidden_matrix, **forbidden_row, *forbidden_set;
<a name="l08456"></a>08456   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *generating_set;
<a name="l08457"></a>08457   <span class="keywordtype">int</span> num_units, array_size, index1, index2;
<a name="l08458"></a>08458   <span class="keywordtype">char</span> name_buf[100];
<a name="l08459"></a>08459 
<a name="l08460"></a>08460 
<a name="l08461"></a>08461   <span class="comment">/* Sanity check, this routine should be called only if each</span>
<a name="l08462"></a>08462 <span class="comment">   * resource usage has been homogenized so that only one resource</span>
<a name="l08463"></a>08463 <span class="comment">   * is used at only one time.</span>
<a name="l08464"></a>08464 <span class="comment">   */</span>
<a name="l08465"></a>08465   usage_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Usage"</span>);
<a name="l08466"></a>08466   <span class="keywordflow">for</span> (usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (usage_section); usage_entry != NULL;
<a name="l08467"></a>08467        usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (usage_entry))
<a name="l08468"></a>08468     {
<a name="l08469"></a>08469       <span class="comment">/* Get the use and time field for each entry and make</span>
<a name="l08470"></a>08470 <span class="comment">       * sure they only have one element.</span>
<a name="l08471"></a>08471 <span class="comment">       */</span>
<a name="l08472"></a>08472       test_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"use"</span>);
<a name="l08473"></a>08473       <span class="keywordflow">if</span> (test_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l08474"></a>08474         {
<a name="l08475"></a>08475           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l08476"></a>08476                   <span class="stringliteral">"reduce_resource_units: '%s' has %i resources specified!"</span>,
<a name="l08477"></a>08477                   usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html#3897d56c1462bdc067453fe3a7d61131">name</a>, test_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08478"></a>08478         }
<a name="l08479"></a>08479 
<a name="l08480"></a>08480       test_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"time"</span>);
<a name="l08481"></a>08481       <span class="keywordflow">if</span> (test_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> != 0)
<a name="l08482"></a>08482         {
<a name="l08483"></a>08483           <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l08484"></a>08484                   <span class="stringliteral">"reduce_resource_units: '%s' has %i times specified!"</span>,
<a name="l08485"></a>08485                   usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html#3897d56c1462bdc067453fe3a7d61131">name</a>, test_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08486"></a>08486         }
<a name="l08487"></a>08487 
<a name="l08488"></a>08488     }
<a name="l08489"></a>08489 
<a name="l08490"></a>08490   <span class="comment">/* Get the Resource_Unit section */</span>
<a name="l08491"></a>08491   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l08492"></a>08492 
<a name="l08493"></a>08493   <span class="comment">/* Get the number of resource units */</span>
<a name="l08494"></a>08494   num_units = <a class="code" href="lmdes2__customizer_8c.html#5bc12c0dabc53b4b665ed97e99dde230">CU_count_section_entries</a> (unit_section);
<a name="l08495"></a>08495 
<a name="l08496"></a>08496 
<a name="l08497"></a>08497   <span class="comment">/* Create an array of units and their use fields to operate on */</span>
<a name="l08498"></a>08498   array_size = num_units * <span class="keyword">sizeof</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *);
<a name="l08499"></a>08499   <span class="keywordflow">if</span> ((unit_array = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> **) malloc (array_size)) == NULL)
<a name="l08500"></a>08500     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"reduce_resource_units: Out of memory"</span>);
<a name="l08501"></a>08501 
<a name="l08502"></a>08502   array_size = num_units * <span class="keyword">sizeof</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *);
<a name="l08503"></a>08503   <span class="keywordflow">if</span> ((use_array = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> **) malloc (array_size)) == NULL)
<a name="l08504"></a>08504     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"reduce_resource_units: Out of memory"</span>);
<a name="l08505"></a>08505 
<a name="l08506"></a>08506   <span class="comment">/* Load units and their uses into array */</span>
<a name="l08507"></a>08507   index1 = 0;
<a name="l08508"></a>08508   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != NULL;
<a name="l08509"></a>08509        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l08510"></a>08510     {
<a name="l08511"></a>08511       unit_array[index1] = unit_entry;
<a name="l08512"></a>08512       use_array[index1] = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08513"></a>08513       index1++;
<a name="l08514"></a>08514     }
<a name="l08515"></a>08515 
<a name="l08516"></a>08516 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08517"></a>08517 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Trees before minimization:\n"</span>);
<a name="l08518"></a>08518   <a class="code" href="lmdes2__customizer_8c.html#a2b1793d18fb89fc6b66c789c85cc39a">print_table_trees</a> (stdout, md);
<a name="l08519"></a>08519   printf (<span class="stringliteral">"\n"</span>);
<a name="l08520"></a>08520 
<a name="l08521"></a>08521   printf (<span class="stringliteral">"Units:\n"</span>);
<a name="l08522"></a>08522   <span class="keywordflow">for</span> (index1 = 0; index1 &lt; num_units; index1++)
<a name="l08523"></a>08523     {
<a name="l08524"></a>08524       printf (<span class="stringliteral">" %4i: %s\n"</span>, index1, unit_array[index1]-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/struct@1.html#37bcc8711ce73b1674632b61832d13b2">name</a>);
<a name="l08525"></a>08525     }
<a name="l08526"></a>08526   printf (<span class="stringliteral">"\n"</span>);
<a name="l08527"></a>08527 <span class="preprocessor">#endif</span>
<a name="l08528"></a>08528 <span class="preprocessor"></span>
<a name="l08529"></a>08529   <span class="comment">/* Create an matrix of INT_Symbol_Tables to hold the forbidden latencies */</span>
<a name="l08530"></a>08530   <span class="comment">/* Create the row array that is the first level of the matrix */</span>
<a name="l08531"></a>08531   array_size = num_units * <span class="keyword">sizeof</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> **);
<a name="l08532"></a>08532   <span class="keywordflow">if</span> ((forbidden_matrix = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> ***) malloc (array_size)) == NULL)
<a name="l08533"></a>08533     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"reduce_resource_units: Out of memory"</span>);
<a name="l08534"></a>08534 
<a name="l08535"></a>08535   <span class="comment">/* Create a matrix of forbidden sets using INT_Symbol_Tables */</span>
<a name="l08536"></a>08536   array_size = num_units * <span class="keyword">sizeof</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> *);
<a name="l08537"></a>08537   <span class="keywordflow">for</span> (index1 = 0; index1 &lt; num_units; index1++)
<a name="l08538"></a>08538     {
<a name="l08539"></a>08539       <span class="keywordflow">if</span> ((forbidden_row = (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structINT__Symbol__Table.html">INT_Symbol_Table</a> **) malloc (array_size)) == NULL)
<a name="l08540"></a>08540         <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"reduce_resource_units: Out of memory"</span>);
<a name="l08541"></a>08541       forbidden_matrix[index1] = forbidden_row;
<a name="l08542"></a>08542 
<a name="l08543"></a>08543       <span class="comment">/* Get the use field of the first unit */</span>
<a name="l08544"></a>08544       use1_field = use_array[index1];
<a name="l08545"></a>08545 
<a name="l08546"></a>08546       <span class="comment">/* Fill this row with empty symbol tables */</span>
<a name="l08547"></a>08547       <span class="keywordflow">for</span> (index2 = 0; index2 &lt; num_units; index2++)
<a name="l08548"></a>08548         {
<a name="l08549"></a>08549           <span class="comment">/* Create name for each symbol table */</span>
<a name="l08550"></a>08550           sprintf (name_buf, <span class="stringliteral">"F[%i][%i]"</span>, index1, index2);
<a name="l08551"></a>08551           forbidden_set = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#934c16acb34dcf5ecc68557a95b3ab91">INT_new_symbol_table</a> (name_buf, 0);
<a name="l08552"></a>08552 
<a name="l08553"></a>08553           <span class="comment">/* Get the use field of the second unit */</span>
<a name="l08554"></a>08554           use2_field = use_array[index2];
<a name="l08555"></a>08555 
<a name="l08556"></a>08556           <a class="code" href="lmdes2__customizer_8c.html#4b2133824eaddc147250f9325ba07988">calc_forbidden_latencies</a> (forbidden_set, use1_field, use2_field);
<a name="l08557"></a>08557 
<a name="l08558"></a>08558           forbidden_row[index2] = forbidden_set;
<a name="l08559"></a>08559         }
<a name="l08560"></a>08560     }
<a name="l08561"></a>08561 
<a name="l08562"></a>08562   <span class="comment">/* Build the generating set using the current usages.  </span>
<a name="l08563"></a>08563 <span class="comment">   * It was found that add additional usages that are allowed by</span>
<a name="l08564"></a>08564 <span class="comment">   * the forbidden matrix was not very beneficial.  So that code</span>
<a name="l08565"></a>08565 <span class="comment">   * is currently ifdefed out. -JCG</span>
<a name="l08566"></a>08566 <span class="comment">   */</span>
<a name="l08567"></a>08567   generating_set = <a class="code" href="lmdes2__customizer_8c.html#e427d30cb6d003905bbbf42b3fa712b5">build_generating_set</a> (md, forbidden_matrix, unit_array,
<a name="l08568"></a>08568                                          num_units);
<a name="l08569"></a>08569 
<a name="l08570"></a>08570 
<a name="l08571"></a>08571   <span class="comment">/* Use a covering algorithm to find a close to minimal set of usages</span>
<a name="l08572"></a>08572 <span class="comment">   * that generates all the forbidden latencies of the original.</span>
<a name="l08573"></a>08573 <span class="comment">   * Routines makes sure that the usage of slot resources at time 0 does</span>
<a name="l08574"></a>08574 <span class="comment">   * not change (may confuse both the scheduler (if in the end no slot</span>
<a name="l08575"></a>08575 <span class="comment">   * is used) and the user (if instructions end up in different slots)).</span>
<a name="l08576"></a>08576 <span class="comment">   */</span>
<a name="l08577"></a>08577   <a class="code" href="lmdes2__customizer_8c.html#4a7cfc80caf1cc2ac73c2347fa710f63">minimize_generating_set</a> (generating_set, forbidden_matrix, num_units,
<a name="l08578"></a>08578                            unit_array);
<a name="l08579"></a>08579 
<a name="l08580"></a>08580 
<a name="l08581"></a>08581   <span class="comment">/* Build up all the new unit usages, by create each resource usage</span>
<a name="l08582"></a>08582 <span class="comment">   * and placing in the correct units.</span>
<a name="l08583"></a>08583 <span class="comment">   */</span>
<a name="l08584"></a>08584   <a class="code" href="lmdes2__customizer_8c.html#9e2ad332512f8a39005bb239d100eef6">instantiate_generating_set</a> (generating_set, use_array, num_units,
<a name="l08585"></a>08585                               usage_section);
<a name="l08586"></a>08586 
<a name="l08587"></a>08587   <span class="comment">/* Free up all the memory used */</span>
<a name="l08588"></a>08588   <a class="code" href="lmdes2__customizer_8c.html#4327d8c541da78d5f3f9cf53831da30d">free_generating_set</a> (generating_set);
<a name="l08589"></a>08589 
<a name="l08590"></a>08590   <span class="comment">/* Free unit and use array */</span>
<a name="l08591"></a>08591   free (unit_array);
<a name="l08592"></a>08592   free (use_array);
<a name="l08593"></a>08593 
<a name="l08594"></a>08594   <span class="comment">/* Free forbidden matrix */</span>
<a name="l08595"></a>08595   <span class="keywordflow">for</span> (index1 = 0; index1 &lt; num_units; index1++)
<a name="l08596"></a>08596     {
<a name="l08597"></a>08597       forbidden_row = forbidden_matrix[index1];
<a name="l08598"></a>08598       <span class="keywordflow">for</span> (index2 = 0; index2 &lt; num_units; index2++)
<a name="l08599"></a>08599         {
<a name="l08600"></a>08600           forbidden_set = forbidden_row[index2];
<a name="l08601"></a>08601           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/int__symbol_8c.html#c7eeab5d805b089e062bb7e6204ddbf0">INT_delete_symbol_table</a> (forbidden_set, NULL);
<a name="l08602"></a>08602         }
<a name="l08603"></a>08603       free (forbidden_row);
<a name="l08604"></a>08604     }
<a name="l08605"></a>08605   free (forbidden_matrix);
<a name="l08606"></a>08606 
<a name="l08607"></a>08607 }
<a name="l08608"></a>08608 
<a name="l08609"></a>08609 <span class="keywordtype">int</span>
<a name="l08610"></a><a class="code" href="lmdes2__customizer_8c.html#4ce135688fc954521f1946964d6d3025">08610</a> <a class="code" href="lmdes2__customizer_8c.html#4ce135688fc954521f1946964d6d3025">count_table_uses</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * table_entry)
<a name="l08611"></a>08611 {
<a name="l08612"></a>08612   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *alt_section, *op_section, *impact_op_section;
<a name="l08613"></a>08613   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *alt_entry, *op_entry, *impact_op_entry, *target_alt, *target_op;
<a name="l08614"></a>08614   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *alt_field_decl, *resv_field_decl, *op_field_decl;
<a name="l08615"></a>08615   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *alt_field, *resv_field, *op_field;
<a name="l08616"></a>08616   <span class="keywordtype">int</span> index1, index2, count;
<a name="l08617"></a>08617 
<a name="l08618"></a>08618   count = 0;
<a name="l08619"></a>08619 
<a name="l08620"></a>08620   <span class="comment">/* Get sections from md */</span>
<a name="l08621"></a>08621   alt_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>);
<a name="l08622"></a>08622   op_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Operation"</span>);
<a name="l08623"></a>08623   impact_op_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>);
<a name="l08624"></a>08624 
<a name="l08625"></a>08625   <span class="comment">/* Get field declarations for speed */</span>
<a name="l08626"></a>08626   resv_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (alt_section, <span class="stringliteral">"resv"</span>);
<a name="l08627"></a>08627   alt_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (op_section, <span class="stringliteral">"alt"</span>);
<a name="l08628"></a>08628   op_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (impact_op_section, <span class="stringliteral">"op"</span>);
<a name="l08629"></a>08629 
<a name="l08630"></a>08630   <span class="comment">/* For each alternative that points to this table */</span>
<a name="l08631"></a>08631   <span class="keywordflow">for</span> (alt_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (alt_section); alt_entry != NULL;
<a name="l08632"></a>08632        alt_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (alt_entry))
<a name="l08633"></a>08633     {
<a name="l08634"></a>08634       resv_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (alt_entry, resv_field_decl);
<a name="l08635"></a>08635 
<a name="l08636"></a>08636       <span class="comment">/* Only look at alts that link to table_entry */</span>
<a name="l08637"></a>08637       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (resv_field, 0) != table_entry)
<a name="l08638"></a>08638         <span class="keywordflow">continue</span>;
<a name="l08639"></a>08639 
<a name="l08640"></a>08640 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08641"></a>08641 <span class="preprocessor"></span>      printf (<span class="stringliteral">"%s links to %s\n"</span>, alt_entry-&gt;name, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l08642"></a>08642 <span class="preprocessor">#endif</span>
<a name="l08643"></a>08643 <span class="preprocessor"></span>
<a name="l08644"></a>08644       <span class="comment">/* For each link to this alt in an operation "alt" field */</span>
<a name="l08645"></a>08645       <span class="keywordflow">for</span> (op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (op_section); op_entry != NULL;
<a name="l08646"></a>08646            op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (op_entry))
<a name="l08647"></a>08647         {
<a name="l08648"></a>08648           alt_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (op_entry, alt_field_decl);
<a name="l08649"></a>08649 
<a name="l08650"></a>08650           <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= alt_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l08651"></a>08651             {
<a name="l08652"></a>08652               target_alt = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index1);
<a name="l08653"></a>08653 
<a name="l08654"></a>08654               <span class="comment">/* Only look at op links to this alt */</span>
<a name="l08655"></a>08655               <span class="keywordflow">if</span> (target_alt != alt_entry)
<a name="l08656"></a>08656                 <span class="keywordflow">continue</span>;
<a name="l08657"></a>08657 
<a name="l08658"></a>08658 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08659"></a>08659 <span class="preprocessor"></span>              printf (<span class="stringliteral">"  %s links to %s\n"</span>, op_entry-&gt;name, alt_entry-&gt;name);
<a name="l08660"></a>08660 <span class="preprocessor">#endif</span>
<a name="l08661"></a>08661 <span class="preprocessor"></span>
<a name="l08662"></a>08662               <span class="comment">/* For each IMPACT_operation that links to this op, </span>
<a name="l08663"></a>08663 <span class="comment">               * increment count.</span>
<a name="l08664"></a>08664 <span class="comment">               */</span>
<a name="l08665"></a>08665               <span class="keywordflow">for</span> (impact_op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (impact_op_section);
<a name="l08666"></a>08666                    impact_op_entry != NULL;
<a name="l08667"></a>08667                    impact_op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (impact_op_entry))
<a name="l08668"></a>08668                 {
<a name="l08669"></a>08669                   op_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (impact_op_entry, op_field_decl);
<a name="l08670"></a>08670 
<a name="l08671"></a>08671                   <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= op_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l08672"></a>08672                        index2++)
<a name="l08673"></a>08673                     {
<a name="l08674"></a>08674                       target_op = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (op_field, index2);
<a name="l08675"></a>08675 
<a name="l08676"></a>08676                       <span class="keywordflow">if</span> (target_op != op_entry)
<a name="l08677"></a>08677                         <span class="keywordflow">continue</span>;
<a name="l08678"></a>08678 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08679"></a>08679 <span class="preprocessor"></span>                      printf (<span class="stringliteral">"    %s links to %s\n"</span>, impact_op_entry-&gt;name,
<a name="l08680"></a>08680                               op_entry-&gt;name);
<a name="l08681"></a>08681 <span class="preprocessor">#endif</span>
<a name="l08682"></a>08682 <span class="preprocessor"></span>
<a name="l08683"></a>08683                       count++;
<a name="l08684"></a>08684                     }
<a name="l08685"></a>08685                 }
<a name="l08686"></a>08686 
<a name="l08687"></a>08687             }
<a name="l08688"></a>08688         }
<a name="l08689"></a>08689 
<a name="l08690"></a>08690     }
<a name="l08691"></a>08691 
<a name="l08692"></a>08692   <span class="comment">/* Since all dead code should be removed before this call, count better</span>
<a name="l08693"></a>08693 <span class="comment">   * be greater than 0! (unless opti_level &lt; 1)</span>
<a name="l08694"></a>08694 <span class="comment">   */</span>
<a name="l08695"></a>08695   <span class="keywordflow">if</span> ((count &lt; 1) &amp;&amp; (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 1))
<a name="l08696"></a>08696     {
<a name="l08697"></a>08697       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (NULL, <span class="stringliteral">"Count table uses: No uses of '%s-&gt;%s'!"</span>,
<a name="l08698"></a>08698               table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l08699"></a>08699     }
<a name="l08700"></a>08700 
<a name="l08701"></a>08701   <span class="keywordflow">return</span> (count);
<a name="l08702"></a>08702 }
<a name="l08703"></a>08703 
<a name="l08704"></a>08704 <span class="keywordtype">double</span>
<a name="l08705"></a><a class="code" href="lmdes2__customizer_8c.html#6eb3b2ecf46c562b81d39d54afd41f36">08705</a> <a class="code" href="lmdes2__customizer_8c.html#6eb3b2ecf46c562b81d39d54afd41f36">average_usage_checks</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l08706"></a>08706 {
<a name="l08707"></a>08707   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section;
<a name="l08708"></a>08708   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *option_entry, *usage_entry;
<a name="l08709"></a>08709   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_use, *option_one_of, *usage_use;
<a name="l08710"></a>08710   <span class="keywordtype">double</span> total_checks, total_weight, total_average;
<a name="l08711"></a>08711   <span class="keywordtype">double</span> option_checks, table_checks, table_weight;
<a name="l08712"></a>08712   <span class="keywordtype">int</span> index1, index2;
<a name="l08713"></a>08713 
<a name="l08714"></a>08714   total_checks = 0.0;
<a name="l08715"></a>08715   total_weight = 0.0;
<a name="l08716"></a>08716 
<a name="l08717"></a>08717   <span class="comment">/* Sum up the number of checks for each table.  Weighted by</span>
<a name="l08718"></a>08718 <span class="comment">   * the number of variations each table can have.</span>
<a name="l08719"></a>08719 <span class="comment">   */</span>
<a name="l08720"></a>08720   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l08721"></a>08721   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != NULL;
<a name="l08722"></a>08722        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l08723"></a>08723     {
<a name="l08724"></a>08724       <span class="comment">/*Get the table use field */</span>
<a name="l08725"></a>08725       table_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l08726"></a>08726 
<a name="l08727"></a>08727       <span class="comment">/* Calculate the weight of this table (based on the number</span>
<a name="l08728"></a>08728 <span class="comment">       * of variations the options allow)</span>
<a name="l08729"></a>08729 <span class="comment">       */</span>
<a name="l08730"></a>08730       table_weight = (double) <a class="code" href="lmdes2__customizer_8c.html#4ce135688fc954521f1946964d6d3025">count_table_uses</a> (md, table_entry);
<a name="l08731"></a>08731       table_checks = 0.0;
<a name="l08732"></a>08732       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l08733"></a>08733         {
<a name="l08734"></a>08734           option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use, index1);
<a name="l08735"></a>08735 
<a name="l08736"></a>08736           <span class="comment">/* Update count if this is a table option */</span>
<a name="l08737"></a>08737           <span class="keywordflow">if</span> (strcmp (option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l08738"></a>08738             {
<a name="l08739"></a>08739               option_one_of = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l08740"></a>08740               table_weight *= (double) (option_one_of-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08741"></a>08741 
<a name="l08742"></a>08742               option_checks = 0.0;
<a name="l08743"></a>08743               for (index2 = 0; index2 &lt;= option_one_of-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l08744"></a>08744                    index2++)
<a name="l08745"></a>08745                 {
<a name="l08746"></a>08746                   usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (option_one_of, index2);
<a name="l08747"></a>08747                   usage_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"use"</span>);
<a name="l08748"></a>08748                   option_checks +=
<a name="l08749"></a>08749                     (double) (usage_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08750"></a>08750                 }
<a name="l08751"></a>08751               table_checks += (option_checks /
<a name="l08752"></a>08752                                (double) (option_one_of-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> +
<a name="l08753"></a>08753                                          1));
<a name="l08754"></a>08754             }
<a name="l08755"></a>08755           <span class="keywordflow">else</span>
<a name="l08756"></a>08756             {
<a name="l08757"></a>08757               usage_entry = option_entry;
<a name="l08758"></a>08758               usage_use = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"use"</span>);
<a name="l08759"></a>08759               table_checks += (double) (usage_use-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08760"></a>08760             }
<a name="l08761"></a>08761         }
<a name="l08762"></a>08762 
<a name="l08763"></a>08763 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08764"></a>08764 <span class="preprocessor"></span>      printf (<span class="stringliteral">"%s has weight %.2f checks %.2f\n"</span>, table_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>,
<a name="l08765"></a>08765               table_weight, table_checks);
<a name="l08766"></a>08766 <span class="preprocessor">#endif</span>
<a name="l08767"></a>08767 <span class="preprocessor"></span>
<a name="l08768"></a>08768 
<a name="l08769"></a>08769       <span class="comment">/* Update the total weight and checks */</span>
<a name="l08770"></a>08770       total_weight += table_weight;
<a name="l08771"></a>08771       total_checks += (table_checks * table_weight);
<a name="l08772"></a>08772     }
<a name="l08773"></a>08773 
<a name="l08774"></a>08774   <span class="keywordflow">if</span> (total_weight &gt; 0.1)
<a name="l08775"></a>08775     total_average = total_checks / total_weight;
<a name="l08776"></a>08776   <span class="keywordflow">else</span>
<a name="l08777"></a>08777     total_average = 0.0;
<a name="l08778"></a>08778 
<a name="l08779"></a>08779 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08780"></a>08780 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Total weight %.2f checks %.2f  average %.2f\n"</span>,
<a name="l08781"></a>08781           total_weight, total_checks, total_average);
<a name="l08782"></a>08782 <span class="preprocessor">#endif</span>
<a name="l08783"></a>08783 <span class="preprocessor"></span>
<a name="l08784"></a>08784   <span class="keywordflow">return</span> (total_average);
<a name="l08785"></a>08785 }
<a name="l08786"></a>08786 
<a name="l08787"></a>08787 <span class="comment">/* Calculates the worst case number of resource checks to determine</span>
<a name="l08788"></a>08788 <span class="comment"> * if this alternative cannot be scheduled.</span>
<a name="l08789"></a>08789 <span class="comment"> * Basically, only the last option for each choice is available, and</span>
<a name="l08790"></a>08790 <span class="comment"> * the last option of the last choice fails.</span>
<a name="l08791"></a>08791 <span class="comment"> * </span>
<a name="l08792"></a>08792 <span class="comment"> * Equivalent to the number of resource checks in the AND/OR tree.</span>
<a name="l08793"></a>08793 <span class="comment"> */</span>
<a name="l08794"></a>08794 <span class="keywordtype">int</span>
<a name="l08795"></a><a class="code" href="lmdes2__customizer_8c.html#6953d208b5ecd712ff502c07d454e67b">08795</a> <a class="code" href="lmdes2__customizer_8c.html#6953d208b5ecd712ff502c07d454e67b">calc_best_case_succeed</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * alt_entry)
<a name="l08796"></a>08796 {
<a name="l08797"></a>08797   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *usage_entry, *unit_entry;
<a name="l08798"></a>08798   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *resv_field, *table_use_field, *one_of_field, *unit_use_field;
<a name="l08799"></a>08799   <span class="keywordtype">int</span> index1;
<a name="l08800"></a>08800   <span class="keywordtype">int</span> best_case_succeed;
<a name="l08801"></a>08801 
<a name="l08802"></a>08802   <span class="comment">/* Get the reservation table for this alternative */</span>
<a name="l08803"></a>08803   resv_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (alt_entry, <span class="stringliteral">"resv"</span>);
<a name="l08804"></a>08804   table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (resv_field, 0);
<a name="l08805"></a>08805 
<a name="l08806"></a>08806   <span class="comment">/* Sum up the resource checks, in all the options of this table */</span>
<a name="l08807"></a>08807   table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l08808"></a>08808   best_case_succeed = 0;
<a name="l08809"></a>08809 
<a name="l08810"></a>08810   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l08811"></a>08811     {
<a name="l08812"></a>08812       usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l08813"></a>08813 
<a name="l08814"></a>08814       <span class="comment">/* Best case, first option available for each choice */</span>
<a name="l08815"></a>08815       <span class="keywordflow">if</span> (strcmp (usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l08816"></a>08816         {
<a name="l08817"></a>08817           unit_entry = usage_entry;
<a name="l08818"></a>08818           unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08819"></a>08819           best_case_succeed += unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l08820"></a>08820         }
<a name="l08821"></a>08821       <span class="keywordflow">else</span>
<a name="l08822"></a>08822         {
<a name="l08823"></a>08823           one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"one_of"</span>);
<a name="l08824"></a>08824           <span class="comment">/* Add up all the resource usages for the first option */</span>
<a name="l08825"></a>08825           unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, 0);
<a name="l08826"></a>08826           unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08827"></a>08827           best_case_succeed += unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l08828"></a>08828         }
<a name="l08829"></a>08829     }
<a name="l08830"></a>08830 
<a name="l08831"></a>08831 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08832"></a>08832 <span class="preprocessor"></span>  printf (<span class="stringliteral">"      %s best case succeed %i\n"</span>, table_entry-&gt;name,
<a name="l08833"></a>08833           best_case_succeed);
<a name="l08834"></a>08834 <span class="preprocessor">#endif</span>
<a name="l08835"></a>08835 <span class="preprocessor"></span>
<a name="l08836"></a>08836   <span class="keywordflow">return</span> (best_case_succeed);
<a name="l08837"></a>08837 }
<a name="l08838"></a>08838 <span class="comment">/* Calculates the best case number of resource checks to determine</span>
<a name="l08839"></a>08839 <span class="comment"> * if this alternative cannot be scheduled.</span>
<a name="l08840"></a>08840 <span class="comment"> */</span>
<a name="l08841"></a>08841 <span class="keywordtype">int</span>
<a name="l08842"></a><a class="code" href="lmdes2__customizer_8c.html#ceb3d2d68fbf7f1698accb82d5742719">08842</a> <a class="code" href="lmdes2__customizer_8c.html#ceb3d2d68fbf7f1698accb82d5742719">calc_best_case_fail</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * alt_entry)
<a name="l08843"></a>08843 {
<a name="l08844"></a>08844   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *usage_entry;
<a name="l08845"></a>08845   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *resv_field, *use_field, *one_of_field;
<a name="l08846"></a>08846   <span class="keywordtype">int</span> best_case_fail;
<a name="l08847"></a>08847 
<a name="l08848"></a>08848   <span class="comment">/* Get the reservation table for this alternative */</span>
<a name="l08849"></a>08849   resv_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (alt_entry, <span class="stringliteral">"resv"</span>);
<a name="l08850"></a>08850   table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (resv_field, 0);
<a name="l08851"></a>08851 
<a name="l08852"></a>08852   <span class="comment">/* Get the first use for this table */</span>
<a name="l08853"></a>08853   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l08854"></a>08854   usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, 0);
<a name="l08855"></a>08855 
<a name="l08856"></a>08856   <span class="comment">/* Best case usage, have to test each option, failing with</span>
<a name="l08857"></a>08857 <span class="comment">   * the first check.  So return the number of options for the</span>
<a name="l08858"></a>08858 <span class="comment">   * first use.  Return 1 for resource_units.</span>
<a name="l08859"></a>08859 <span class="comment">   */</span>
<a name="l08860"></a>08860   <span class="keywordflow">if</span> (strcmp (usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l08861"></a>08861     {
<a name="l08862"></a>08862       best_case_fail = 1;
<a name="l08863"></a>08863     }
<a name="l08864"></a>08864   <span class="keywordflow">else</span>
<a name="l08865"></a>08865     {
<a name="l08866"></a>08866       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"one_of"</span>);
<a name="l08867"></a>08867       best_case_fail = one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l08868"></a>08868     }
<a name="l08869"></a>08869 
<a name="l08870"></a>08870 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08871"></a>08871 <span class="preprocessor"></span>  printf (<span class="stringliteral">"      %s best case fail %i\n"</span>, usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>, best_case_fail);
<a name="l08872"></a>08872 <span class="preprocessor">#endif</span>
<a name="l08873"></a>08873 <span class="preprocessor"></span>
<a name="l08874"></a>08874   <span class="keywordflow">return</span> (best_case_fail);
<a name="l08875"></a>08875 }
<a name="l08876"></a>08876 
<a name="l08877"></a>08877 <span class="comment">/* Calculates the worst case number of resource checks to determine</span>
<a name="l08878"></a>08878 <span class="comment"> * if this alternative cannot be scheduled.</span>
<a name="l08879"></a>08879 <span class="comment"> * Basically, only the last option for each choice is available, and</span>
<a name="l08880"></a>08880 <span class="comment"> * the last option of the last choice fails.</span>
<a name="l08881"></a>08881 <span class="comment"> * </span>
<a name="l08882"></a>08882 <span class="comment"> * Equivalent to the number of resource checks in the AND/OR tree.</span>
<a name="l08883"></a>08883 <span class="comment"> */</span>
<a name="l08884"></a>08884 <span class="keywordtype">int</span>
<a name="l08885"></a><a class="code" href="lmdes2__customizer_8c.html#d0902b41af4b8f27f9e37f303a00cada">08885</a> <a class="code" href="lmdes2__customizer_8c.html#d0902b41af4b8f27f9e37f303a00cada">calc_worst_case_fail</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * alt_entry)
<a name="l08886"></a>08886 {
<a name="l08887"></a>08887   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *usage_entry, *unit_entry;
<a name="l08888"></a>08888   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *resv_field, *table_use_field, *one_of_field, *unit_use_field;
<a name="l08889"></a>08889   <span class="keywordtype">int</span> index1, index2;
<a name="l08890"></a>08890   <span class="keywordtype">int</span> worst_case_fail;
<a name="l08891"></a>08891 
<a name="l08892"></a>08892   <span class="comment">/* Get the reservation table for this alternative */</span>
<a name="l08893"></a>08893   resv_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (alt_entry, <span class="stringliteral">"resv"</span>);
<a name="l08894"></a>08894   table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (resv_field, 0);
<a name="l08895"></a>08895 
<a name="l08896"></a>08896   <span class="comment">/* Sum up the resource checks, in all the options of this table */</span>
<a name="l08897"></a>08897   table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l08898"></a>08898   worst_case_fail = 0;
<a name="l08899"></a>08899 
<a name="l08900"></a>08900   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l08901"></a>08901     {
<a name="l08902"></a>08902       usage_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l08903"></a>08903 
<a name="l08904"></a>08904       <span class="comment">/* Worst case, have to test every resource usage.  */</span>
<a name="l08905"></a>08905       <span class="keywordflow">if</span> (strcmp (usage_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Resource_Unit"</span>) == 0)
<a name="l08906"></a>08906         {
<a name="l08907"></a>08907           unit_entry = usage_entry;
<a name="l08908"></a>08908           unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08909"></a>08909           worst_case_fail += unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l08910"></a>08910         }
<a name="l08911"></a>08911       <span class="keywordflow">else</span>
<a name="l08912"></a>08912         {
<a name="l08913"></a>08913           one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (usage_entry, <span class="stringliteral">"one_of"</span>);
<a name="l08914"></a>08914           <span class="comment">/* Add up all the resource usages in every option */</span>
<a name="l08915"></a>08915           <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>;
<a name="l08916"></a>08916                index2++)
<a name="l08917"></a>08917             {
<a name="l08918"></a>08918               unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index2);
<a name="l08919"></a>08919               unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08920"></a>08920               worst_case_fail += unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l08921"></a>08921             }
<a name="l08922"></a>08922         }
<a name="l08923"></a>08923     }
<a name="l08924"></a>08924 
<a name="l08925"></a>08925 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l08926"></a>08926 <span class="preprocessor"></span>  printf (<span class="stringliteral">"      %s worst case fail %i\n"</span>, table_entry-&gt;name,
<a name="l08927"></a>08927           worst_case_fail);
<a name="l08928"></a>08928 <span class="preprocessor">#endif</span>
<a name="l08929"></a>08929 <span class="preprocessor"></span>
<a name="l08930"></a>08930   <span class="keywordflow">return</span> (worst_case_fail);
<a name="l08931"></a>08931 }
<a name="l08932"></a>08932 
<a name="l08933"></a>08933 <span class="keywordtype">int</span>
<a name="l08934"></a><a class="code" href="lmdes2__customizer_8c.html#d54eaab305504150964b0f25c12b30d2">08934</a> <a class="code" href="lmdes2__customizer_8c.html#d54eaab305504150964b0f25c12b30d2">calc_memory_size</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l08935"></a>08935 {
<a name="l08936"></a>08936   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section, *option_section, *unit_section;
<a name="l08937"></a>08937   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry, *option_entry, *unit_entry;
<a name="l08938"></a>08938   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *unit_use_field, *one_of_field, *table_use_field;
<a name="l08939"></a>08939   <span class="keywordtype">int</span> mem_size, usage_size, option_size, table_size, or_table_size;
<a name="l08940"></a>08940   <span class="keywordtype">int</span> usage_count, or_mem_size;
<a name="l08941"></a>08941 
<a name="l08942"></a>08942   <span class="comment">/* Initialize memory_size */</span>
<a name="l08943"></a>08943   usage_size = 0;
<a name="l08944"></a>08944   option_size = 0;
<a name="l08945"></a>08945   table_size = 0;
<a name="l08946"></a>08946   or_table_size = 0;
<a name="l08947"></a>08947 
<a name="l08948"></a>08948   <span class="comment">/* Initialize usage count */</span>
<a name="l08949"></a>08949   usage_count = 0;
<a name="l08950"></a>08950 
<a name="l08951"></a>08951   <span class="comment">/* Calculate the size due to resource units */</span>
<a name="l08952"></a>08952   unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l08953"></a>08953   <span class="keywordflow">for</span> (unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (unit_section); unit_entry != NULL;
<a name="l08954"></a>08954        unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (unit_entry))
<a name="l08955"></a>08955     {
<a name="l08956"></a>08956       <span class="comment">/* Get the use field */</span>
<a name="l08957"></a>08957       unit_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l08958"></a>08958 
<a name="l08959"></a>08959       <span class="comment">/* Currently each unit takes 8 bytes for each usage,</span>
<a name="l08960"></a>08960 <span class="comment">       * and 8 bytes for the header.  (Need to look at when the header</span>
<a name="l08961"></a>08961 <span class="comment">       * is taken care of by table options).</span>
<a name="l08962"></a>08962 <span class="comment">       */</span>
<a name="l08963"></a>08963       usage_size += 8 + (8 * (unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1));
<a name="l08964"></a>08964 
<a name="l08965"></a>08965       usage_count += (unit_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1);
<a name="l08966"></a>08966     }
<a name="l08967"></a>08967 
<a name="l08968"></a>08968   <span class="comment">/* Calculate the size due to table options */</span>
<a name="l08969"></a>08969   option_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Table_Option"</span>);
<a name="l08970"></a>08970   <span class="keywordflow">for</span> (option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (option_section); option_entry != NULL;
<a name="l08971"></a>08971        option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (option_entry))
<a name="l08972"></a>08972     {
<a name="l08973"></a>08973       <span class="comment">/* Get the one_of field */</span>
<a name="l08974"></a>08974       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l08975"></a>08975 
<a name="l08976"></a>08976       <span class="comment">/* Currently, each option takes 8 bytes for the header,</span>
<a name="l08977"></a>08977 <span class="comment">       * and 8 bytes per option (unit headers).</span>
<a name="l08978"></a>08978 <span class="comment">       */</span>
<a name="l08979"></a>08979       option_size += 8 + (8 * (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1));
<a name="l08980"></a>08980     }
<a name="l08981"></a>08981 
<a name="l08982"></a>08982   <span class="comment">/* Calculate the size due to reseveration tables */</span>
<a name="l08983"></a>08983   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l08984"></a>08984   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != NULL;
<a name="l08985"></a>08985        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l08986"></a>08986     {
<a name="l08987"></a>08987       <span class="comment">/* Get the use field */</span>
<a name="l08988"></a>08988       table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table_entry, <span class="stringliteral">"use"</span>);
<a name="l08989"></a>08989 
<a name="l08990"></a>08990       <span class="comment">/* Currently, each table takes 16 bytes for the header,</span>
<a name="l08991"></a>08991 <span class="comment">       * and 8 bytes per choice (option headers).</span>
<a name="l08992"></a>08992 <span class="comment">       */</span>
<a name="l08993"></a>08993       table_size += 16 + (8 * (table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1));
<a name="l08994"></a>08994 
<a name="l08995"></a>08995       <span class="comment">/* For OR trees, only 1 choice, so options (unit headers) are </span>
<a name="l08996"></a>08996 <span class="comment">       * instead put in the array.</span>
<a name="l08997"></a>08997 <span class="comment">       */</span>
<a name="l08998"></a>08998       option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, 0);
<a name="l08999"></a>08999       one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l09000"></a>09000       or_table_size += 16 + (8 * (one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1));
<a name="l09001"></a>09001     }
<a name="l09002"></a>09002 
<a name="l09003"></a>09003 
<a name="l09004"></a>09004   mem_size = usage_size + option_size + table_size;
<a name="l09005"></a>09005   or_mem_size = usage_size + or_table_size;
<a name="l09006"></a>09006 
<a name="l09007"></a>09007 
<a name="l09008"></a>09008   printf (<span class="stringliteral">"\n"</span>);
<a name="l09009"></a>09009   printf (<span class="stringliteral">"%10i Operation types (table_section)\n"</span>,
<a name="l09010"></a>09010           <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#8147bf28dfbbf6ce27e9ecb06e6806fd">MD_num_entries</a> (table_section));
<a name="l09011"></a>09011   printf (<span class="stringliteral">"%10i Tables (resource units)\n"</span>, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#8147bf28dfbbf6ce27e9ecb06e6806fd">MD_num_entries</a> (unit_section));
<a name="l09012"></a>09012   printf (<span class="stringliteral">"%10i checks (total static number)\n"</span>, usage_count);
<a name="l09013"></a>09013 
<a name="l09014"></a>09014 
<a name="l09015"></a>09015 
<a name="l09016"></a>09016   printf (<span class="stringliteral">"%10i bytes for resource usages\n"</span>, usage_size);
<a name="l09017"></a>09017   printf (<span class="stringliteral">"%10i bytes for table options\n"</span>, option_size);
<a name="l09018"></a>09018   printf (<span class="stringliteral">"%10i bytes for reservation tables\n"</span>, table_size);
<a name="l09019"></a>09019   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a>)
<a name="l09020"></a>09020     printf (<span class="stringliteral">"%10i bytes for OR-tree reservation tables\n"</span>, or_table_size);
<a name="l09021"></a>09021   printf (<span class="stringliteral">"%10i total bytes for AND/OR-tree resource info\n"</span>, mem_size);
<a name="l09022"></a>09022   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a>)
<a name="l09023"></a>09023     printf (<span class="stringliteral">"%10i total bytes for OR-tree resource info\n"</span>, or_mem_size);
<a name="l09024"></a>09024 
<a name="l09025"></a>09025   <span class="comment">/* Return the memory size */</span>
<a name="l09026"></a>09026   <span class="keywordflow">return</span> (mem_size);
<a name="l09027"></a>09027 }
<a name="l09028"></a>09028 
<a name="l09029"></a>09029 <span class="keywordtype">void</span>
<a name="l09030"></a><a class="code" href="lmdes2__customizer_8c.html#b970674a582a8ea1ad5140f669f34581">09030</a> <a class="code" href="lmdes2__customizer_8c.html#b970674a582a8ea1ad5140f669f34581">print_static_stats</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l09031"></a>09031 {
<a name="l09032"></a>09032   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *IMPACT_op_section;
<a name="l09033"></a>09033   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *IMPACT_op_entry, *op_entry, *alt_entry;
<a name="l09034"></a>09034   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *op_field, *alt_field;
<a name="l09035"></a>09035   <span class="keywordtype">int</span> index1, index2;
<a name="l09036"></a>09036   <span class="keywordtype">int</span> total_op_count, total_best_case_fail, total_worst_case_fail;
<a name="l09037"></a>09037   <span class="keywordtype">int</span> total_best_case_succeed;
<a name="l09038"></a>09038   <span class="keywordtype">int</span> total_mem_size;
<a name="l09039"></a>09039   <span class="keywordtype">int</span> best_case_fail, worst_case_fail, best_case_succeed;
<a name="l09040"></a>09040 
<a name="l09041"></a>09041   <span class="comment">/* Initialize stats */</span>
<a name="l09042"></a>09042   total_op_count = 0;
<a name="l09043"></a>09043   total_best_case_succeed = 0;
<a name="l09044"></a>09044   total_best_case_fail = 0;
<a name="l09045"></a>09045   total_worst_case_fail = 0;
<a name="l09046"></a>09046 
<a name="l09047"></a>09047   <span class="comment">/* Print header */</span>
<a name="l09048"></a>09048   fprintf (out, <span class="stringliteral">"&gt; Static MDES stats:\n"</span>);
<a name="l09049"></a>09049 
<a name="l09050"></a>09050   <span class="comment">/* Get the memory size for the reservation tables */</span>
<a name="l09051"></a>09051   total_mem_size = <a class="code" href="lmdes2__customizer_8c.html#d54eaab305504150964b0f25c12b30d2">calc_memory_size</a> (md);
<a name="l09052"></a>09052 
<a name="l09053"></a>09053   <span class="comment">/* Calculate stats for each IMPACT_op */</span>
<a name="l09054"></a>09054   IMPACT_op_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>);
<a name="l09055"></a>09055   <span class="keywordflow">for</span> (IMPACT_op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (IMPACT_op_section);
<a name="l09056"></a>09056        IMPACT_op_entry != NULL;
<a name="l09057"></a>09057        IMPACT_op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (IMPACT_op_entry))
<a name="l09058"></a>09058     {
<a name="l09059"></a>09059 
<a name="l09060"></a>09060 #<span class="keywordflow">if</span> <a class="code" href="lmdes2__customizer_8c.html#6ae2868cfb34bf62378235a206c9800c">DEBUG_OPTI</a>
<a name="l09061"></a>09061       printf (<span class="stringliteral">"%s\n"</span>, IMPACT_op_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09062"></a>09062 <span class="preprocessor">#endif</span>
<a name="l09063"></a>09063 <span class="preprocessor"></span>
<a name="l09064"></a>09064       <span class="comment">/* Get the op field for this IMPACT_op */</span>
<a name="l09065"></a>09065       op_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (IMPACT_op_entry, <span class="stringliteral">"op"</span>);
<a name="l09066"></a>09066 
<a name="l09067"></a>09067       <span class="comment">/* Initialize stats for op */</span>
<a name="l09068"></a>09068       best_case_succeed = 0;
<a name="l09069"></a>09069       best_case_fail = 0;
<a name="l09070"></a>09070       worst_case_fail = 0;
<a name="l09071"></a>09071 
<a name="l09072"></a>09072       <span class="comment">/* Sum up the stats for each op for this IMPACT_op */</span>
<a name="l09073"></a>09073       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= op_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09074"></a>09074         {
<a name="l09075"></a>09075           <span class="comment">/* Get this op entry */</span>
<a name="l09076"></a>09076           op_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (op_field, index1);
<a name="l09077"></a>09077 
<a name="l09078"></a>09078 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l09079"></a>09079 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  %s\n"</span>, op_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09080"></a>09080 <span class="preprocessor">#endif</span>
<a name="l09081"></a>09081 <span class="preprocessor"></span>
<a name="l09082"></a>09082           <span class="comment">/* Get the alt field for this op */</span>
<a name="l09083"></a>09083           alt_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (op_entry, <span class="stringliteral">"alt"</span>);
<a name="l09084"></a>09084 
<a name="l09085"></a>09085           <span class="comment">/* Sum up the stats for each alt in this op */</span>
<a name="l09086"></a>09086           <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= alt_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l09087"></a>09087             {
<a name="l09088"></a>09088               <span class="comment">/* Get this alt entry */</span>
<a name="l09089"></a>09089               alt_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (alt_field, index2);
<a name="l09090"></a>09090 
<a name="l09091"></a>09091 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l09092"></a>09092 <span class="preprocessor"></span>              printf (<span class="stringliteral">"    %s\n"</span>, alt_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09093"></a>09093 <span class="preprocessor">#endif</span>
<a name="l09094"></a>09094 <span class="preprocessor"></span>
<a name="l09095"></a>09095               <span class="comment">/* Get the best case succeed for only the first op */</span>
<a name="l09096"></a>09096               <span class="keywordflow">if</span> (index2 == 0)
<a name="l09097"></a>09097                 {
<a name="l09098"></a>09098                   best_case_succeed += <a class="code" href="lmdes2__customizer_8c.html#6953d208b5ecd712ff502c07d454e67b">calc_best_case_succeed</a> (alt_entry);
<a name="l09099"></a>09099                 }
<a name="l09100"></a>09100 
<a name="l09101"></a>09101               best_case_fail += <a class="code" href="lmdes2__customizer_8c.html#ceb3d2d68fbf7f1698accb82d5742719">calc_best_case_fail</a> (alt_entry);
<a name="l09102"></a>09102               worst_case_fail += <a class="code" href="lmdes2__customizer_8c.html#d0902b41af4b8f27f9e37f303a00cada">calc_worst_case_fail</a> (alt_entry);
<a name="l09103"></a>09103             }
<a name="l09104"></a>09104         }
<a name="l09105"></a>09105 
<a name="l09106"></a>09106       <span class="comment">/* Update stats */</span>
<a name="l09107"></a>09107       total_op_count++;
<a name="l09108"></a>09108       total_best_case_succeed += best_case_succeed;
<a name="l09109"></a>09109       total_best_case_fail += best_case_fail;
<a name="l09110"></a>09110       total_worst_case_fail += worst_case_fail;
<a name="l09111"></a>09111     }
<a name="l09112"></a>09112 
<a name="l09113"></a>09113   <span class="comment">/* Print stats */</span>
<a name="l09114"></a>09114 <span class="preprocessor">#if DEBUG_OPTI</span>
<a name="l09115"></a>09115 <span class="preprocessor"></span>  printf (<span class="stringliteral">"%10i operations in MDES.\n"</span>, total_op_count);
<a name="l09116"></a>09116   printf (<span class="stringliteral">"%10i total best case succeed.\n"</span>, total_best_case_succeed);
<a name="l09117"></a>09117   printf (<span class="stringliteral">"%10i total best case fail.\n"</span>, total_best_case_fail);
<a name="l09118"></a>09118   printf (<span class="stringliteral">"%10i total worst case fail.\n"</span>, total_worst_case_fail);
<a name="l09119"></a>09119 <span class="preprocessor">#endif</span>
<a name="l09120"></a>09120 <span class="preprocessor"></span>  printf (<span class="stringliteral">"%10.2f average best case succeed/operation.\n"</span>,
<a name="l09121"></a>09121           (<span class="keywordtype">double</span>) (((<span class="keywordtype">double</span>) total_best_case_succeed) /
<a name="l09122"></a>09122                     ((<span class="keywordtype">double</span>) total_op_count)));
<a name="l09123"></a>09123   printf (<span class="stringliteral">"%10.2f average best case fail/operation.\n"</span>,
<a name="l09124"></a>09124           (<span class="keywordtype">double</span>) (((<span class="keywordtype">double</span>) total_best_case_fail) /
<a name="l09125"></a>09125                     ((<span class="keywordtype">double</span>) total_op_count)));
<a name="l09126"></a>09126   printf (<span class="stringliteral">"%10.2f average worst case fail/operation.\n"</span>,
<a name="l09127"></a>09127           (<span class="keywordtype">double</span>) (((<span class="keywordtype">double</span>) total_worst_case_fail) /
<a name="l09128"></a>09128                     ((<span class="keywordtype">double</span>) total_op_count)));
<a name="l09129"></a>09129 }
<a name="l09130"></a>09130 <span class="keywordtype">void</span>
<a name="l09131"></a><a class="code" href="lmdes2__customizer_8c.html#fb00d3f1fdaa1c335512b34734911cd3">09131</a> <a class="code" href="lmdes2__customizer_8c.html#fb00d3f1fdaa1c335512b34734911cd3">print_ru_tree</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * ru_entry)
<a name="l09132"></a>09132 {
<a name="l09133"></a>09133   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field, *time_field;
<a name="l09134"></a>09134   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource_entry;
<a name="l09135"></a>09135   <span class="keywordtype">int</span> index1, index2, time;
<a name="l09136"></a>09136 
<a name="l09137"></a>09137   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"use"</span>);
<a name="l09138"></a>09138   time_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (ru_entry, <span class="stringliteral">"time"</span>);
<a name="l09139"></a>09139   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= time_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09140"></a>09140     {
<a name="l09141"></a>09141       time = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (time_field, index1);
<a name="l09142"></a>09142       fprintf (out, <span class="stringliteral">"        @%i:"</span>, time);
<a name="l09143"></a>09143       <span class="keywordflow">for</span> (index2 = 0; index2 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index2++)
<a name="l09144"></a>09144         {
<a name="l09145"></a>09145           resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index2);
<a name="l09146"></a>09146 
<a name="l09147"></a>09147           fprintf (out, <span class="stringliteral">" %s"</span>, resource_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09148"></a>09148         }
<a name="l09149"></a>09149       fprintf (out, <span class="stringliteral">"\n"</span>);
<a name="l09150"></a>09150     }
<a name="l09151"></a>09151 }
<a name="l09152"></a>09152 
<a name="l09153"></a>09153 <span class="keywordtype">void</span>
<a name="l09154"></a><a class="code" href="lmdes2__customizer_8c.html#a8a42d2c311cc844d1ba895443b70aa4">09154</a> <a class="code" href="lmdes2__customizer_8c.html#a8a42d2c311cc844d1ba895443b70aa4">print_unit_tree</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * unit_entry, <span class="keywordtype">int</span> option_id)
<a name="l09155"></a>09155 {
<a name="l09156"></a>09156   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *use_field;
<a name="l09157"></a>09157   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *ru_entry;
<a name="l09158"></a>09158   <span class="keywordtype">int</span> index1;
<a name="l09159"></a>09159 
<a name="l09160"></a>09160   fprintf (out, <span class="stringliteral">"      Option %i (%s):\n"</span>, option_id, unit_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09161"></a>09161   use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (unit_entry, <span class="stringliteral">"use"</span>);
<a name="l09162"></a>09162   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09163"></a>09163     {
<a name="l09164"></a>09164       ru_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (use_field, index1);
<a name="l09165"></a>09165       <a class="code" href="lmdes2__customizer_8c.html#fb00d3f1fdaa1c335512b34734911cd3">print_ru_tree</a> (out, ru_entry);
<a name="l09166"></a>09166     }
<a name="l09167"></a>09167 }
<a name="l09168"></a>09168 
<a name="l09169"></a>09169 <span class="keywordtype">void</span>
<a name="l09170"></a><a class="code" href="lmdes2__customizer_8c.html#403032539b9119ba7e8100ea00975277">09170</a> <a class="code" href="lmdes2__customizer_8c.html#403032539b9119ba7e8100ea00975277">print_option_tree</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * option_entry)
<a name="l09171"></a>09171 {
<a name="l09172"></a>09172   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *one_of_field;
<a name="l09173"></a>09173   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *unit_entry;
<a name="l09174"></a>09174   <span class="keywordtype">int</span> index1;
<a name="l09175"></a>09175 
<a name="l09176"></a>09176   one_of_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (option_entry, <span class="stringliteral">"one_of"</span>);
<a name="l09177"></a>09177   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= one_of_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09178"></a>09178     {
<a name="l09179"></a>09179       unit_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (one_of_field, index1);
<a name="l09180"></a>09180       <a class="code" href="lmdes2__customizer_8c.html#a8a42d2c311cc844d1ba895443b70aa4">print_unit_tree</a> (out, unit_entry, index1);
<a name="l09181"></a>09181     }
<a name="l09182"></a>09182 }
<a name="l09183"></a>09183 
<a name="l09184"></a>09184 <span class="keywordtype">void</span>
<a name="l09185"></a><a class="code" href="lmdes2__customizer_8c.html#b3fc3f2427e4193ddc11562a6ed56f7b">09185</a> <a class="code" href="lmdes2__customizer_8c.html#b3fc3f2427e4193ddc11562a6ed56f7b">print_and_or_tree</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> * table)
<a name="l09186"></a>09186 {
<a name="l09187"></a>09187   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *table_use_field;
<a name="l09188"></a>09188   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *option_entry;
<a name="l09189"></a>09189   <span class="keywordtype">int</span> index1;
<a name="l09190"></a>09190 
<a name="l09191"></a>09191   fprintf (out, <span class="stringliteral">"  %s:"</span>, table-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09192"></a>09192   table_use_field = <a class="code" href="lmdes2__customizer_8c.html#92da4a5722a22962930cd80ebcbfe551">CU_find_field_by_name</a> (table, <span class="stringliteral">"use"</span>);
<a name="l09193"></a>09193   <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= table_use_field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09194"></a>09194     {
<a name="l09195"></a>09195       option_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#fd7bc44d273ab835db24cfb8ad5f31a6">MD_get_link</a> (table_use_field, index1);
<a name="l09196"></a>09196       fprintf (out, <span class="stringliteral">"\n    Choice %i (%s):\n"</span>, index1, option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#0bffa96670ce4a276af5a502e8f18f06">name</a>);
<a name="l09197"></a>09197       <span class="keywordflow">if</span> (strcmp (option_entry-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html#6c2e1649225bc303ca11ab958b634e69">section</a>-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html#46dce333d5cc9f32edb7e71f9b382ca3">name</a>, <span class="stringliteral">"Table_Option"</span>) == 0)
<a name="l09198"></a>09198         <a class="code" href="lmdes2__customizer_8c.html#403032539b9119ba7e8100ea00975277">print_option_tree</a> (out, option_entry);
<a name="l09199"></a>09199       <span class="keywordflow">else</span>
<a name="l09200"></a>09200         <a class="code" href="lmdes2__customizer_8c.html#a8a42d2c311cc844d1ba895443b70aa4">print_unit_tree</a> (out, option_entry, 0);
<a name="l09201"></a>09201     }
<a name="l09202"></a>09202 }
<a name="l09203"></a>09203 
<a name="l09204"></a>09204 <span class="keywordtype">void</span>
<a name="l09205"></a><a class="code" href="lmdes2__customizer_8c.html#a2b1793d18fb89fc6b66c789c85cc39a">09205</a> <a class="code" href="lmdes2__customizer_8c.html#a2b1793d18fb89fc6b66c789c85cc39a">print_table_trees</a> (FILE * out, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l09206"></a>09206 {
<a name="l09207"></a>09207   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *table_section;
<a name="l09208"></a>09208   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *table_entry;
<a name="l09209"></a>09209 
<a name="l09210"></a>09210   table_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Reservation_Table"</span>);
<a name="l09211"></a>09211   <span class="keywordflow">for</span> (table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (table_section); table_entry != NULL;
<a name="l09212"></a>09212        table_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (table_entry))
<a name="l09213"></a>09213     {
<a name="l09214"></a>09214       <a class="code" href="lmdes2__customizer_8c.html#b3fc3f2427e4193ddc11562a6ed56f7b">print_and_or_tree</a> (out, table_entry);
<a name="l09215"></a>09215       fprintf (out, <span class="stringliteral">"\n"</span>);
<a name="l09216"></a>09216     }
<a name="l09217"></a>09217 }
<a name="l09218"></a>09218 
<a name="l09219"></a>09219 <span class="comment">/* Returns the maximum number of elements in the section for this field.</span>
<a name="l09220"></a>09220 <span class="comment"> * Returns 0 if field is not specified for any entries or if they</span>
<a name="l09221"></a>09221 <span class="comment"> * are all empty.</span>
<a name="l09222"></a>09222 <span class="comment"> */</span>
<a name="l09223"></a>09223 <span class="keywordtype">int</span>
<a name="l09224"></a><a class="code" href="lmdes2__customizer_8c.html#ebb6e3da59774d2be9fea3034f0e749a">09224</a> <a class="code" href="lmdes2__customizer_8c.html#ebb6e3da59774d2be9fea3034f0e749a">CU_calc_max_field_size</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name)
<a name="l09225"></a>09225 {
<a name="l09226"></a>09226   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l09227"></a>09227   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l09228"></a>09228   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l09229"></a>09229   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l09230"></a>09230   <span class="keywordtype">int</span> field_size, max_size;
<a name="l09231"></a>09231 
<a name="l09232"></a>09232   max_size = 0;
<a name="l09233"></a>09233 
<a name="l09234"></a>09234   <span class="comment">/* Get the section and field declaration */</span>
<a name="l09235"></a>09235   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l09236"></a>09236   field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (section, field_name);
<a name="l09237"></a>09237 
<a name="l09238"></a>09238   <span class="comment">/* Find the max size of this field in this section */</span>
<a name="l09239"></a>09239   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != NULL;
<a name="l09240"></a>09240        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l09241"></a>09241     {
<a name="l09242"></a>09242       field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl);
<a name="l09243"></a>09243 
<a name="l09244"></a>09244       <span class="comment">/* Skip entries that don't specify the field */</span>
<a name="l09245"></a>09245       <span class="keywordflow">if</span> (field == NULL)
<a name="l09246"></a>09246         <span class="keywordflow">continue</span>;
<a name="l09247"></a>09247 
<a name="l09248"></a>09248       <span class="comment">/* Get the field size */</span>
<a name="l09249"></a>09249       field_size = field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a> + 1;
<a name="l09250"></a>09250 
<a name="l09251"></a>09251       <span class="keywordflow">if</span> (field_size &gt; max_size)
<a name="l09252"></a>09252         max_size = field_size;
<a name="l09253"></a>09253     }
<a name="l09254"></a>09254 
<a name="l09255"></a>09255   <span class="keywordflow">return</span> (max_size);
<a name="l09256"></a>09256 }
<a name="l09257"></a>09257 
<a name="l09258"></a>09258 <span class="comment">/* Returns the maximum integer value found in the specified field. */</span>
<a name="l09259"></a>09259 <span class="keywordtype">int</span>
<a name="l09260"></a><a class="code" href="lmdes2__customizer_8c.html#5dd5fab3cd53184cc8789f2e2c3ba33a">09260</a> <a class="code" href="lmdes2__customizer_8c.html#5dd5fab3cd53184cc8789f2e2c3ba33a">CU_calc_int_field_max_value</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md, <span class="keywordtype">char</span> *section_name, <span class="keywordtype">char</span> *field_name)
<a name="l09261"></a>09261 {
<a name="l09262"></a>09262   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *section;
<a name="l09263"></a>09263   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>;
<a name="l09264"></a>09264   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *field_decl;
<a name="l09265"></a>09265   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *field;
<a name="l09266"></a>09266   <span class="keywordtype">int</span> index1, value, max_value, num_values;
<a name="l09267"></a>09267 
<a name="l09268"></a>09268   max_value = -100000;
<a name="l09269"></a>09269   num_values = 0;
<a name="l09270"></a>09270 
<a name="l09271"></a>09271   <span class="comment">/* Get the section and field declaration */</span>
<a name="l09272"></a>09272   section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, section_name);
<a name="l09273"></a>09273   field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (section, field_name);
<a name="l09274"></a>09274 
<a name="l09275"></a>09275   <span class="comment">/* Find the max size of this field in this section */</span>
<a name="l09276"></a>09276   <span class="keywordflow">for</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (section); <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> != NULL;
<a name="l09277"></a>09277        <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>))
<a name="l09278"></a>09278     {
<a name="l09279"></a>09279       field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/dataflow_8c.html#79617e393ed50f7bffa2de436e1f9c74">entry</a>, field_decl);
<a name="l09280"></a>09280 
<a name="l09281"></a>09281       <span class="comment">/* Skip entries that don't specify the field */</span>
<a name="l09282"></a>09282       <span class="keywordflow">if</span> (field == NULL)
<a name="l09283"></a>09283         <span class="keywordflow">continue</span>;
<a name="l09284"></a>09284 
<a name="l09285"></a>09285       <span class="comment">/* Get each elements value and take it's max */</span>
<a name="l09286"></a>09286       <span class="keywordflow">for</span> (index1 = 0; index1 &lt;= field-&gt;<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html#2b91ce290e95ee2fc51af43930c4501f">max_element_index</a>; index1++)
<a name="l09287"></a>09287         {
<a name="l09288"></a>09288           value = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (field, index1);
<a name="l09289"></a>09289 
<a name="l09290"></a>09290           <span class="comment">/* Update max stats */</span>
<a name="l09291"></a>09291           <span class="keywordflow">if</span> ((num_values == 0) || (max_value &lt; value))
<a name="l09292"></a>09292             max_value = value;
<a name="l09293"></a>09293 
<a name="l09294"></a>09294           <span class="comment">/* Update value count */</span>
<a name="l09295"></a>09295           num_values++;
<a name="l09296"></a>09296         }
<a name="l09297"></a>09297     }
<a name="l09298"></a>09298 
<a name="l09299"></a>09299   <span class="comment">/* Punt if no values were specified */</span>
<a name="l09300"></a>09300   <span class="keywordflow">if</span> (num_values == 0)
<a name="l09301"></a>09301     <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md, <span class="stringliteral">"No int values specified for field %s in section %s!"</span>,
<a name="l09302"></a>09302             field_name, section_name);
<a name="l09303"></a>09303 
<a name="l09304"></a>09304   <span class="comment">/* Return the max value */</span>
<a name="l09305"></a>09305   <span class="keywordflow">return</span> (max_value);
<a name="l09306"></a>09306 }
<a name="l09307"></a>09307 
<a name="l09308"></a>09308 <span class="comment">/* Set slot parameters "max_slot", "num_slots" for this machine description */</span>
<a name="l09309"></a>09309 <span class="keywordtype">void</span>
<a name="l09310"></a><a class="code" href="lmdes2__customizer_8c.html#c9352cf521d85bfd11ab88a863ae1459">09310</a> <a class="code" href="lmdes2__customizer_8c.html#c9352cf521d85bfd11ab88a863ae1459">CU_set_slot_parameters</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l09311"></a>09311 {
<a name="l09312"></a>09312   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *resource_section;
<a name="l09313"></a>09313   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Entry.html">MD_Entry</a> *resource_entry;
<a name="l09314"></a>09314   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field__Decl.html">MD_Field_Decl</a> *slot_field_decl;
<a name="l09315"></a>09315   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Field.html">MD_Field</a> *slot_field;
<a name="l09316"></a>09316   <span class="keywordtype">int</span> slot, max_slot, num_slots;
<a name="l09317"></a>09317 
<a name="l09318"></a>09318   <span class="comment">/* Get the resource section and its slot field declaration */</span>
<a name="l09319"></a>09319   resource_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource"</span>);
<a name="l09320"></a>09320   slot_field_decl = <a class="code" href="lmdes2__customizer_8c.html#b75391e91939a490c363358e9c12f40c">CU_find_field_decl</a> (resource_section, <span class="stringliteral">"slot"</span>);
<a name="l09321"></a>09321 
<a name="l09322"></a>09322   <span class="comment">/* Initialize stats */</span>
<a name="l09323"></a>09323   max_slot = -1;
<a name="l09324"></a>09324   num_slots = 0;
<a name="l09325"></a>09325 
<a name="l09326"></a>09326   <span class="comment">/* Scan all resources to calc parameters */</span>
<a name="l09327"></a>09327   <span class="keywordflow">for</span> (resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#665a6d3a42e627dd69abb473cdc4aade">MD_first_entry</a> (resource_section);
<a name="l09328"></a>09328        resource_entry != NULL;
<a name="l09329"></a>09329        resource_entry = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#f91910c190e1e376321633ee24e235c0">MD_next_entry</a> (resource_entry))
<a name="l09330"></a>09330     {
<a name="l09331"></a>09331       <span class="comment">/* Only look at resources with a slot field specified */</span>
<a name="l09332"></a>09332       slot_field = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#1124821854f50740cfaecb6394234b80">MD_find_field</a> (resource_entry, slot_field_decl);
<a name="l09333"></a>09333       <span class="keywordflow">if</span> (slot_field == NULL)
<a name="l09334"></a>09334         <span class="keywordflow">continue</span>;
<a name="l09335"></a>09335 
<a name="l09336"></a>09336       <span class="comment">/* Get the slot for this resource */</span>
<a name="l09337"></a>09337       slot = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#4d8e575b183c6a55bec1296f8a890db6">MD_get_int</a> (slot_field, 0);
<a name="l09338"></a>09338 
<a name="l09339"></a>09339       <span class="comment">/* Update stats */</span>
<a name="l09340"></a>09340       <span class="keywordflow">if</span> (slot &gt; max_slot)
<a name="l09341"></a>09341         max_slot = slot;
<a name="l09342"></a>09342 
<a name="l09343"></a>09343       num_slots++;
<a name="l09344"></a>09344     }
<a name="l09345"></a>09345 
<a name="l09346"></a>09346   <span class="comment">/* Set the slot parameters */</span>
<a name="l09347"></a>09347   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"num_slots"</span>, num_slots);
<a name="l09348"></a>09348   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"max_slot"</span>, max_slot);
<a name="l09349"></a>09349 
<a name="l09350"></a>09350 }
<a name="l09351"></a>09351 
<a name="l09352"></a>09352 <span class="keywordtype">void</span>
<a name="l09353"></a><a class="code" href="lmdes2__customizer_8c.html#e15b6758241bc43ed7472236b84c63bd">09353</a> <a class="code" href="lmdes2__customizer_8c.html#e15b6758241bc43ed7472236b84c63bd">dump_md</a> (<span class="keywordtype">char</span> *file_name, <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l09354"></a>09354 {
<a name="l09355"></a>09355   FILE *out;
<a name="l09356"></a>09356 
<a name="l09357"></a>09357   printf (<span class="stringliteral">"\n Dumping md file to '%s'\n"</span>, file_name);
<a name="l09358"></a>09358   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l09359"></a>09359   fflush (stdout);
<a name="l09360"></a>09360 
<a name="l09361"></a>09361   <span class="keywordflow">if</span> ((out = fopen (file_name, <span class="stringliteral">"w"</span>)) == NULL)
<a name="l09362"></a>09362     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/i__error_8c.html#04f215f17936ffe11d70fef75a9f2185">I_punt</a> (<span class="stringliteral">"dump_md: unable to open '%s'"</span>, file_name);
<a name="l09363"></a>09363 
<a name="l09364"></a>09364   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8c.html#08198a382f6e7b587c2a239dcb3af660">MD_write_md</a> (out, md);
<a name="l09365"></a>09365 
<a name="l09366"></a>09366   fclose (out);
<a name="l09367"></a>09367 
<a name="l09368"></a>09368   printf (<span class="stringliteral">"Finished dump\n"</span>);
<a name="l09369"></a>09369   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l09370"></a>09370   fflush (stdout);
<a name="l09371"></a>09371 }
<a name="l09372"></a>09372 
<a name="l09373"></a>09373 <span class="keywordtype">void</span>
<a name="l09374"></a><a class="code" href="lmdes2__customizer_8c.html#325650c03d399b4e850fe3a9bda3df17">09374</a> <a class="code" href="lmdes2__customizer_8c.html#325650c03d399b4e850fe3a9bda3df17">customize_md</a> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD.html">MD</a> * md)
<a name="l09375"></a>09375 {
<a name="l09376"></a>09376   <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/structMD__Section.html">MD_Section</a> *unit_section;
<a name="l09377"></a>09377   <span class="keywordtype">int</span> max_offset;
<a name="l09378"></a>09378   <span class="keywordtype">int</span> total_change, initial_size, opti_size, speed_size;
<a name="l09379"></a>09379   <span class="keywordtype">int</span> pre_expansion, post_expansion, expansion_added;
<a name="l09380"></a>09380   <span class="keywordtype">double</span> pre_reduction_avg, post_reduction_avg;
<a name="l09381"></a>09381   <span class="keywordtype">int</span> num_dest_operands, num_src_operands, num_pred_operands;
<a name="l09382"></a>09382   <span class="keywordtype">int</span> max_field_type_id, max_proc_opc;
<a name="l09383"></a>09383 
<a name="l09384"></a>09384 
<a name="l09385"></a>09385 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09386"></a>09386 <span class="preprocessor"></span>  printf (<span class="stringliteral">"&gt; Starting customization\n"</span>);
<a name="l09387"></a>09387   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l09388"></a>09388 <span class="preprocessor">#endif</span>
<a name="l09389"></a>09389 <span class="preprocessor"></span>
<a name="l09390"></a>09390   <span class="comment">/* Create rename table */</span>
<a name="l09391"></a>09391   <a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">rename_table</a> = <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#28305366471c84770b5d9e0a2de17974">STRING_new_symbol_table</a> (<span class="stringliteral">"rename"</span>, 128);
<a name="l09392"></a>09392 
<a name="l09393"></a>09393   <span class="comment">/* Get the initial size of the mdes */</span>
<a name="l09394"></a>09394   initial_size = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09395"></a>09395 
<a name="l09396"></a>09396   <span class="comment">/* Read all the header tables used for customization */</span>
<a name="l09397"></a>09397   <a class="code" href="lmdes2__customizer_8c.html#335c1116a90b866de4a2951d0bb9eca0">read_header_tables</a> (md);
<a name="l09398"></a>09398 
<a name="l09399"></a>09399   <a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">annotate_header_values</a> (md, <span class="stringliteral">"Field_Type"</span>, <span class="stringliteral">"id"</span>, <span class="stringliteral">"MDES_OPERAND_"</span>, 0);
<a name="l09400"></a>09400 
<a name="l09401"></a>09401   <a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">annotate_header_values</a> (md, <span class="stringliteral">"IMPACT_Operation_Flag"</span>, <span class="stringliteral">"id"</span>, <span class="stringliteral">"OP_FLAG_"</span>, 1);
<a name="l09402"></a>09402 
<a name="l09403"></a>09403 
<a name="l09404"></a>09404   <a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">annotate_header_values</a> (md, <span class="stringliteral">"IMPACT_Alt_Flag"</span>, <span class="stringliteral">"id"</span>, <span class="stringliteral">"ALT_FLAG_"</span>, 1);
<a name="l09405"></a>09405 
<a name="l09406"></a>09406   <a class="code" href="lmdes2__customizer_8c.html#66d922d9b46761dde0bd9e8d03168a2a">annotate_header_values</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>, <span class="stringliteral">"proc_opc"</span>, <span class="stringliteral">""</span>, 1);
<a name="l09407"></a>09407 
<a name="l09408"></a>09408   <span class="comment">/* 20020822 SZU</span>
<a name="l09409"></a>09409 <span class="comment">   * Want to encode the latency classes as contiguous hash instead of string.</span>
<a name="l09410"></a>09410 <span class="comment">   * Assign numbers to Operation for hash number.</span>
<a name="l09411"></a>09411 <span class="comment">   */</span>
<a name="l09412"></a>09412   <a class="code" href="lmdes2__customizer_8c.html#9269b069890aaa0c3eadf5b9e64e2a72">annotate_hash</a> (md, <span class="stringliteral">"Operation"</span>);
<a name="l09413"></a>09413 
<a name="l09414"></a>09414   <span class="comment">/* 20020731 SZU</span>
<a name="l09415"></a>09415 <span class="comment">   * annotate_latency_class function added to retain latency class</span>
<a name="l09416"></a>09416 <span class="comment">   * information in IMPACT_Operation and Prod_Cons_Latency.</span>
<a name="l09417"></a>09417 <span class="comment">   * Required because of loss of information during compression of Operation</span>
<a name="l09418"></a>09418 <span class="comment">   * and Scheduling_Alternatives sections.</span>
<a name="l09419"></a>09419 <span class="comment">   */</span>
<a name="l09420"></a>09420 
<a name="l09421"></a>09421   <a class="code" href="lmdes2__customizer_8c.html#4f7bcf59270a7e4092afdc10b639fc36">annotate_latency_class</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>, <span class="stringliteral">"op"</span>, <span class="stringliteral">"lat_class"</span>);
<a name="l09422"></a>09422 
<a name="l09423"></a>09423   <span class="comment">/* 20020810 SZU</span>
<a name="l09424"></a>09424 <span class="comment">   * Prod_Cons_Latency section not in all mdes. Check first.</span>
<a name="l09425"></a>09425 <span class="comment">   */</span>
<a name="l09426"></a>09426   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/md_8h.html#ea84fd9204301dda7014a2374251db76">MD_find_section</a> (md, <span class="stringliteral">"Prod_Cons_Latency"</span>) != NULL)
<a name="l09427"></a>09427     {
<a name="l09428"></a>09428       <a class="code" href="lmdes2__customizer_8c.html#4f7bcf59270a7e4092afdc10b639fc36">annotate_latency_class</a> (md, <span class="stringliteral">"Prod_Cons_Latency"</span>, <span class="stringliteral">"prod"</span>,
<a name="l09429"></a>09429                               <span class="stringliteral">"p_lat_class"</span>);
<a name="l09430"></a>09430 
<a name="l09431"></a>09431       <a class="code" href="lmdes2__customizer_8c.html#4f7bcf59270a7e4092afdc10b639fc36">annotate_latency_class</a> (md, <span class="stringliteral">"Prod_Cons_Latency"</span>, <span class="stringliteral">"cons"</span>,
<a name="l09432"></a>09432                               <span class="stringliteral">"c_lat_class"</span>);
<a name="l09433"></a>09433     }
<a name="l09434"></a>09434 
<a name="l09435"></a>09435 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09436"></a>09436 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
<a name="l09437"></a>09437     printf (<span class="stringliteral">"&gt; No Prod_Cons_Latency section in mdes\n"</span>);
<a name="l09438"></a>09438 <span class="preprocessor">#endif</span>
<a name="l09439"></a>09439 <span class="preprocessor"></span>
<a name="l09440"></a>09440   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">header_errors</a> &gt; 0)
<a name="l09441"></a>09441     {
<a name="l09442"></a>09442       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l09443"></a>09443               <span class="stringliteral">"%i errors occurred using headers to customize lmdes2.\nCannot "</span>
<a name="l09444"></a>09444               <span class="stringliteral">"continue!"</span>,
<a name="l09445"></a>09445               <a class="code" href="lmdes2__customizer_8c.html#b0b0139b9ffe1f2089e4e43fb71fb4d3">header_errors</a>);
<a name="l09446"></a>09446     }
<a name="l09447"></a>09447 
<a name="l09448"></a>09448   <a class="code" href="lmdes2__customizer_8c.html#8d183a09983eb17f4c21eba43c6ac1cc">convert_to_bit_representation</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>, <span class="stringliteral">"flags"</span>,
<a name="l09449"></a>09449                                  <span class="stringliteral">"IMPACT_Operation_Flag"</span>, <span class="stringliteral">"id"</span>, <span class="stringliteral">"bit_flags"</span>);
<a name="l09450"></a>09450 
<a name="l09451"></a>09451   <a class="code" href="lmdes2__customizer_8c.html#8d183a09983eb17f4c21eba43c6ac1cc">convert_to_bit_representation</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>, <span class="stringliteral">"flags"</span>,
<a name="l09452"></a>09452                                  <span class="stringliteral">"IMPACT_Alt_Flag"</span>, <span class="stringliteral">"id"</span>, <span class="stringliteral">"bit_flags"</span>);
<a name="l09453"></a>09453 
<a name="l09454"></a>09454   <a class="code" href="lmdes2__customizer_8c.html#63b739f1e28f24f379411fb7743e6b44">add_all_children_to_list</a> (md, <span class="stringliteral">"Field_Type"</span>, <span class="stringliteral">"compatible_with"</span>);
<a name="l09455"></a>09455 
<a name="l09456"></a>09456 
<a name="l09457"></a>09457   <a class="code" href="lmdes2__customizer_8c.html#634270b643e7deeab2184f71ca619024">convert_to_int_list_all_targets</a> (md, <span class="stringliteral">"Field_Type"</span>, <span class="stringliteral">"compatible_with"</span>,
<a name="l09458"></a>09458                                    <span class="stringliteral">"id"</span>, <span class="stringliteral">"compatible_ids"</span>);
<a name="l09459"></a>09459 
<a name="l09460"></a>09460   <a class="code" href="lmdes2__customizer_8c.html#6740c00001d924e1656171ce296a54d0">check_bidirectional_links</a> (md, <span class="stringliteral">"Register"</span>, <span class="stringliteral">"overlaps"</span>);
<a name="l09461"></a>09461 
<a name="l09462"></a>09462 
<a name="l09463"></a>09463   <span class="comment">/* Scheduler uses unsigned short int to store slot numbers.</span>
<a name="l09464"></a>09464 <span class="comment">   * Make sure there are no negative slots or that it not too big.</span>
<a name="l09465"></a>09465 <span class="comment">   */</span>
<a name="l09466"></a>09466   <a class="code" href="lmdes2__customizer_8c.html#41d1d44089b9ab6bbc29aa96db125b25">check_int_bounds</a> (md, <span class="stringliteral">"Resource"</span>, <span class="stringliteral">"slot"</span>, 0, ((2 &lt;&lt; 15) - 1));
<a name="l09467"></a>09467 
<a name="l09468"></a>09468   <span class="comment">/* Check to make sure exactly one use in a Reservation Table specifies</span>
<a name="l09469"></a>09469 <span class="comment">   * the use of a slot (may use multiple slots in one use, the</span>
<a name="l09470"></a>09470 <span class="comment">   * smallest slot will be used).</span>
<a name="l09471"></a>09471 <span class="comment">   */</span>
<a name="l09472"></a>09472   <a class="code" href="lmdes2__customizer_8c.html#e58a6292d04bae2e646a784873aff4da">check_slot_specification</a> (md);
<a name="l09473"></a>09473 
<a name="l09474"></a>09474   <span class="comment">/* Check to make sure that the same resource is not unconditionally</span>
<a name="l09475"></a>09475 <span class="comment">   * used at the same time in a Resource_Usage or a Resource_Unit.</span>
<a name="l09476"></a>09476 <span class="comment">   */</span>
<a name="l09477"></a>09477   <a class="code" href="lmdes2__customizer_8c.html#2fcefe048bbfcd44785ed45ad58bde9d">check_for_unconditional_overlap</a> (md);
<a name="l09478"></a>09478 
<a name="l09479"></a>09479   <span class="comment">/* Make sure option count will fall in scheduler's unsigned short.</span>
<a name="l09480"></a>09480 <span class="comment">   * See routine header for recommendations if you exceed this size.</span>
<a name="l09481"></a>09481 <span class="comment">   */</span>
<a name="l09482"></a>09482   <a class="code" href="lmdes2__customizer_8c.html#d7581428a805b5351485f9d09da4aad0">check_table_option_count</a> (md);
<a name="l09483"></a>09483 
<a name="l09484"></a>09484 
<a name="l09485"></a>09485   <span class="comment">/* Going to allocate array based on IMPACT_operations proc_opc.</span>
<a name="l09486"></a>09486 <span class="comment">   * Limit range to prevent some huge array from being created due to</span>
<a name="l09487"></a>09487 <span class="comment">   * some creative choices for proc_opc by code generator writers.  </span>
<a name="l09488"></a>09488 <span class="comment">   * (Same limit as in version1).</span>
<a name="l09489"></a>09489 <span class="comment">   */</span>
<a name="l09490"></a>09490   <a class="code" href="lmdes2__customizer_8c.html#9bfc7ce417705fe84aae84f4d1403015">check_proc_opcs</a> (md);
<a name="l09491"></a>09491 
<a name="l09492"></a>09492 
<a name="l09493"></a>09493   <span class="comment">/* Specify the maximum number of operands specified in the operation</span>
<a name="l09494"></a>09494 <span class="comment">   * formats.</span>
<a name="l09495"></a>09495 <span class="comment">   */</span>
<a name="l09496"></a>09496   num_dest_operands = <a class="code" href="lmdes2__customizer_8c.html#ebb6e3da59774d2be9fea3034f0e749a">CU_calc_max_field_size</a> (md, <span class="stringliteral">"Operation_Format"</span>, <span class="stringliteral">"dest"</span>);
<a name="l09497"></a>09497   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"num_dest_operands"</span>, num_dest_operands);
<a name="l09498"></a>09498 
<a name="l09499"></a>09499   num_src_operands = <a class="code" href="lmdes2__customizer_8c.html#ebb6e3da59774d2be9fea3034f0e749a">CU_calc_max_field_size</a> (md, <span class="stringliteral">"Operation_Format"</span>, <span class="stringliteral">"src"</span>);
<a name="l09500"></a>09500   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"num_src_operands"</span>, num_src_operands);
<a name="l09501"></a>09501 
<a name="l09502"></a>09502   num_pred_operands = <a class="code" href="lmdes2__customizer_8c.html#ebb6e3da59774d2be9fea3034f0e749a">CU_calc_max_field_size</a> (md, <span class="stringliteral">"Operation_Format"</span>, <span class="stringliteral">"pred"</span>);
<a name="l09503"></a>09503   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"num_pred_operands"</span>, num_pred_operands);
<a name="l09504"></a>09504 
<a name="l09505"></a>09505 
<a name="l09506"></a>09506   <span class="comment">/* Set the slot parameters max_slot and num_slots */</span>
<a name="l09507"></a>09507   <a class="code" href="lmdes2__customizer_8c.html#c9352cf521d85bfd11ab88a863ae1459">CU_set_slot_parameters</a> (md);
<a name="l09508"></a>09508 
<a name="l09509"></a>09509   <span class="comment">/* Set the max field type id parameter */</span>
<a name="l09510"></a>09510   max_field_type_id = <a class="code" href="lmdes2__customizer_8c.html#5dd5fab3cd53184cc8789f2e2c3ba33a">CU_calc_int_field_max_value</a> (md, <span class="stringliteral">"Field_Type"</span>, <span class="stringliteral">"id"</span>);
<a name="l09511"></a>09511   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"max_field_type_id"</span>, max_field_type_id);
<a name="l09512"></a>09512 
<a name="l09513"></a>09513 
<a name="l09514"></a>09514   <span class="comment">/* Set the max_proc_opc parameter */</span>
<a name="l09515"></a>09515   max_proc_opc = <a class="code" href="lmdes2__customizer_8c.html#5dd5fab3cd53184cc8789f2e2c3ba33a">CU_calc_int_field_max_value</a> (md, <span class="stringliteral">"IMPACT_Operation"</span>,
<a name="l09516"></a>09516                                               <span class="stringliteral">"proc_opc"</span>);
<a name="l09517"></a>09517   <a class="code" href="lmdes2__customizer_8c.html#41d97bbca3aeb3d1e569f1e822129a16">CU_set_int_parm</a> (md, <span class="stringliteral">"max_proc_opc"</span>, max_proc_opc);
<a name="l09518"></a>09518 
<a name="l09519"></a>09519 
<a name="l09520"></a>09520   <span class="comment">/* Don't do the fancy optimizations if the mdes is already bad */</span>
<a name="l09521"></a>09521   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a> &gt; 0)
<a name="l09522"></a>09522     {
<a name="l09523"></a>09523       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l09524"></a>09524               <span class="stringliteral">"%i errors occurred during customization.\nCannot continue!"</span>,
<a name="l09525"></a>09525               <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>);
<a name="l09526"></a>09526     }
<a name="l09527"></a>09527 
<a name="l09528"></a>09528 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09529"></a>09529 <span class="preprocessor"></span>  printf
<a name="l09530"></a>09530     (<span class="stringliteral">"\nRemoving unreferenced entries before homogenizing res tables:\n"</span>);
<a name="l09531"></a>09531   fflush (stdout);
<a name="l09532"></a>09532 <span class="preprocessor">#endif</span>
<a name="l09533"></a>09533 <span class="preprocessor"></span>
<a name="l09534"></a>09534   total_change = <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09535"></a>09535 
<a name="l09536"></a>09536   <span class="comment">/* Get the size of the mdes after classical optimizations */</span>
<a name="l09537"></a>09537   opti_size = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09538"></a>09538 
<a name="l09539"></a>09539 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l09540"></a>09540 <span class="preprocessor"></span>  <span class="keywordflow">if</span> ((initial_size != opti_size) &amp;&amp; (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt; 0))
<a name="l09541"></a>09541     {
<a name="l09542"></a>09542       printf
<a name="l09543"></a>09543         (<span class="stringliteral">"&gt; MDES size-reducing transformations eliminated %i (of %i) "</span>
<a name="l09544"></a>09544          <span class="stringliteral">"entries.\n"</span>,
<a name="l09545"></a>09545          initial_size - opti_size, initial_size);
<a name="l09546"></a>09546       fflush (stdout);
<a name="l09547"></a>09547     }
<a name="l09548"></a>09548 <span class="preprocessor">#endif</span>
<a name="l09549"></a>09549 <span class="preprocessor"></span>
<a name="l09550"></a>09550 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09551"></a>09551 <span class="preprocessor"></span>  printf (<span class="stringliteral">"%i entries deleted/modified before homogenizing res tables.\n"</span>,
<a name="l09552"></a>09552           total_change);
<a name="l09553"></a>09553   fflush (stdout);
<a name="l09554"></a>09554 <span class="preprocessor">#endif</span>
<a name="l09555"></a>09555 <span class="preprocessor"></span>
<a name="l09556"></a>09556   <span class="comment">/* Homogenize the reservation tables into a form the scheduler and</span>
<a name="l09557"></a>09557 <span class="comment">   * resource_usage optimizer can handle.</span>
<a name="l09558"></a>09558 <span class="comment">   */</span>
<a name="l09559"></a>09559   <a class="code" href="lmdes2__customizer_8c.html#3f2c2ef62b99bf93eba2656e2f742c67">homogenize_reservation_tables</a> (md);
<a name="l09560"></a>09560 
<a name="l09561"></a>09561 <span class="preprocessor">#if 0</span>
<a name="l09562"></a>09562 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Returning now for debugging!\n"</span>);
<a name="l09563"></a>09563   <span class="keywordflow">return</span>;
<a name="l09564"></a>09564 <span class="preprocessor">#endif</span>
<a name="l09565"></a>09565 <span class="preprocessor"></span>
<a name="l09566"></a>09566 
<a name="l09567"></a>09567   <span class="comment">/* Optimize away any duplicate info created to homogenize res table */</span>
<a name="l09568"></a>09568   <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09569"></a>09569 
<a name="l09570"></a>09570 <span class="preprocessor">#if 1</span>
<a name="l09571"></a>09571 <span class="preprocessor"></span>  <span class="comment">/* Debug, do renaming earlier to make smaller */</span>
<a name="l09572"></a>09572   <span class="comment">/* Make MDES smaller by removing the transformation debug info field</span>
<a name="l09573"></a>09573 <span class="comment">   * 'original_name' and by renaming all the entries we have been</span>
<a name="l09574"></a>09574 <span class="comment">   * manipulating to short names.  (It is confusing to have an alternative</span>
<a name="l09575"></a>09575 <span class="comment">   * for a SUB on an ADD, etc.  So better to just blow away the names</span>
<a name="l09576"></a>09576 <span class="comment">   * that don't really aid in debugging.</span>
<a name="l09577"></a>09577 <span class="comment">   */</span>
<a name="l09578"></a>09578   <a class="code" href="lmdes2__customizer_8c.html#6747e11fe0efbbeea18472c8a80f3a2c">remove_original_name</a> (md);
<a name="l09579"></a>09579   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt; 0)
<a name="l09580"></a>09580     {
<a name="l09581"></a>09581       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Usage"</span>, <span class="stringliteral">"R"</span>);
<a name="l09582"></a>09582       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Unit"</span>, <span class="stringliteral">"U"</span>);
<a name="l09583"></a>09583       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Table_Option"</span>, <span class="stringliteral">"O"</span>);
<a name="l09584"></a>09584       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Reservation_Table"</span>, <span class="stringliteral">"T"</span>);
<a name="l09585"></a>09585       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>, <span class="stringliteral">"A"</span>);
<a name="l09586"></a>09586       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Operation"</span>, <span class="stringliteral">"op"</span>);
<a name="l09587"></a>09587     }
<a name="l09588"></a>09588 <span class="preprocessor">#endif</span>
<a name="l09589"></a>09589 <span class="preprocessor"></span>
<a name="l09590"></a>09590   <span class="comment">/* If -expand specified on command line, expand out the reservation</span>
<a name="l09591"></a>09591 <span class="comment">   * tables so that each variation is explicitly listed.  This converts</span>
<a name="l09592"></a>09592 <span class="comment">   * all tables with more than one choice (more than one table use)</span>
<a name="l09593"></a>09593 <span class="comment">   * into a table with only one choice (with all the options explicitly</span>
<a name="l09594"></a>09594 <span class="comment">   * in that choice).</span>
<a name="l09595"></a>09595 <span class="comment">   */</span>
<a name="l09596"></a>09596   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a>)
<a name="l09597"></a>09597     {
<a name="l09598"></a>09598       <span class="comment">/* Get number of entries before expansion */</span>
<a name="l09599"></a>09599       pre_expansion = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09600"></a>09600 
<a name="l09601"></a>09601       <a class="code" href="lmdes2__customizer_8c.html#fc9ac81a9950e113cd26337a38f6079c">expand_out_reservation_tables</a> (md);
<a name="l09602"></a>09602 
<a name="l09603"></a>09603       <span class="comment">/* Get number of entries after expansion */</span>
<a name="l09604"></a>09604       post_expansion = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09605"></a>09605 
<a name="l09606"></a>09606 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09607"></a>09607 <span class="preprocessor"></span>      printf (<span class="stringliteral">"Expansion added %i entries before opti\n"</span>,
<a name="l09608"></a>09608               post_expansion - pre_expansion);
<a name="l09609"></a>09609       fflush (stdout);
<a name="l09610"></a>09610 <span class="preprocessor">#endif</span>
<a name="l09611"></a>09611 <span class="preprocessor"></span>
<a name="l09612"></a>09612       <span class="comment">/* </span>
<a name="l09613"></a>09613 <span class="comment">       * Applies transformations for opti_levels &gt;= 3.</span>
<a name="l09614"></a>09614 <span class="comment">       *</span>
<a name="l09615"></a>09615 <span class="comment">       * Sort the Reseveration_Table-&gt;use() links and Resource_Unit-&gt;use()</span>
<a name="l09616"></a>09616 <span class="comment">       * links so that resources will be distributed the same in the various</span>
<a name="l09617"></a>09617 <span class="comment">       * forms of the same table, and so that the classical optimizations</span>
<a name="l09618"></a>09618 <span class="comment">       * can detect these duplicate tables consistently.</span>
<a name="l09619"></a>09619 <span class="comment">       * </span>
<a name="l09620"></a>09620 <span class="comment">       * It also places checks near time 0 first.</span>
<a name="l09621"></a>09621 <span class="comment">       *</span>
<a name="l09622"></a>09622 <span class="comment">       * Don't limit reordering.  Gives classical opti a consistent ordering.</span>
<a name="l09623"></a>09623 <span class="comment">       */</span>
<a name="l09624"></a>09624       <a class="code" href="lmdes2__customizer_8c.html#09e11110f5b6a98ed4d840057dc1e125">CU_order_use_fields</a> (md, 1);
<a name="l09625"></a>09625 
<a name="l09626"></a>09626       <span class="comment">/* optimize after doing expansion */</span>
<a name="l09627"></a>09627       <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09628"></a>09628 
<a name="l09629"></a>09629       <span class="comment">/* Get number of entries after expansion */</span>
<a name="l09630"></a>09630       post_expansion = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09631"></a>09631 
<a name="l09632"></a>09632       <span class="comment">/* See how many entries expansion added */</span>
<a name="l09633"></a>09633       expansion_added = post_expansion - pre_expansion;
<a name="l09634"></a>09634 
<a name="l09635"></a>09635 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l09636"></a>09636 <span class="preprocessor"></span>      printf (<span class="stringliteral">"&gt; Reservation Table expansion added %i entries.\n"</span>,
<a name="l09637"></a>09637               expansion_added);
<a name="l09638"></a>09638       fflush (stdout);
<a name="l09639"></a>09639 <span class="preprocessor">#endif</span>
<a name="l09640"></a>09640 <span class="preprocessor"></span><span class="preprocessor">#if 1</span>
<a name="l09641"></a>09641 <span class="preprocessor"></span>      <span class="comment">/* Debug, do renaming earlier to make smaller */</span>
<a name="l09642"></a>09642       <span class="comment">/* Make MDES smaller by removing the transformation debug info field</span>
<a name="l09643"></a>09643 <span class="comment">       * 'original_name' and by renaming all the entries we have been</span>
<a name="l09644"></a>09644 <span class="comment">       * manipulating to short names.  (It is confusing to have an alternative</span>
<a name="l09645"></a>09645 <span class="comment">       * for a SUB on an ADD, etc.  So better to just blow away the names</span>
<a name="l09646"></a>09646 <span class="comment">       * that don't really aid in debugging.</span>
<a name="l09647"></a>09647 <span class="comment">       */</span>
<a name="l09648"></a>09648       <a class="code" href="lmdes2__customizer_8c.html#6747e11fe0efbbeea18472c8a80f3a2c">remove_original_name</a> (md);
<a name="l09649"></a>09649       <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt; 0)
<a name="l09650"></a>09650         {
<a name="l09651"></a>09651           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Usage"</span>, <span class="stringliteral">"R"</span>);
<a name="l09652"></a>09652           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Unit"</span>, <span class="stringliteral">"U"</span>);
<a name="l09653"></a>09653           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Table_Option"</span>, <span class="stringliteral">"O"</span>);
<a name="l09654"></a>09654           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Reservation_Table"</span>, <span class="stringliteral">"T"</span>);
<a name="l09655"></a>09655           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>, <span class="stringliteral">"A"</span>);
<a name="l09656"></a>09656           <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Operation"</span>, <span class="stringliteral">"op"</span>);
<a name="l09657"></a>09657         }
<a name="l09658"></a>09658 <span class="preprocessor">#endif</span>
<a name="l09659"></a>09659 <span class="preprocessor"></span>
<a name="l09660"></a>09660     }
<a name="l09661"></a>09661   <span class="comment">/* Otherwise flag that expansion added no entries since it was not done! */</span>
<a name="l09662"></a>09662   <span class="keywordflow">else</span>
<a name="l09663"></a>09663     {
<a name="l09664"></a>09664 
<a name="l09665"></a>09665       expansion_added = 0;
<a name="l09666"></a>09666     }
<a name="l09667"></a>09667 
<a name="l09668"></a>09668 
<a name="l09669"></a>09669   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 3) &amp;&amp; <a class="code" href="lmdes2__customizer_8c.html#138a3fb2763ae65b4e1a58716ed69355">resource_minimization</a>)
<a name="l09670"></a>09670     {
<a name="l09671"></a>09671       pre_reduction_avg = <a class="code" href="lmdes2__customizer_8c.html#6eb3b2ecf46c562b81d39d54afd41f36">average_usage_checks</a> (md);
<a name="l09672"></a>09672 
<a name="l09673"></a>09673       unit_section = <a class="code" href="lmdes2__customizer_8c.html#5b29c261eac5c2802f9c5ef741c7ef12">CU_find_section</a> (md, <span class="stringliteral">"Resource_Unit"</span>);
<a name="l09674"></a>09674 
<a name="l09675"></a>09675 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09676"></a>09676 <span class="preprocessor"></span>      printf (<span class="stringliteral">"%i resource units being optimized\n"</span>,
<a name="l09677"></a>09677               <a class="code" href="lmdes2__customizer_8c.html#5bc12c0dabc53b4b665ed97e99dde230">CU_count_section_entries</a> (unit_section));
<a name="l09678"></a>09678       fflush (stdout);
<a name="l09679"></a>09679 <span class="preprocessor">#endif</span>
<a name="l09680"></a>09680 <span class="preprocessor"></span>
<a name="l09681"></a>09681       <a class="code" href="lmdes2__customizer_8c.html#80bbeee5328a5227004302dbc729efa9">reduce_resource_units</a> (md);
<a name="l09682"></a>09682 
<a name="l09683"></a>09683       post_reduction_avg = <a class="code" href="lmdes2__customizer_8c.html#6eb3b2ecf46c562b81d39d54afd41f36">average_usage_checks</a> (md);
<a name="l09684"></a>09684 
<a name="l09685"></a>09685 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l09686"></a>09686 <span class="preprocessor"></span>      printf
<a name="l09687"></a>09687         (<span class="stringliteral">"&gt; Minimization reduced the average resource usages/table from %.2f "</span>
<a name="l09688"></a>09688          <span class="stringliteral">"to %.2f.\n"</span>,
<a name="l09689"></a>09689          pre_reduction_avg, post_reduction_avg);
<a name="l09690"></a>09690       fflush (stdout);
<a name="l09691"></a>09691 <span class="preprocessor">#endif</span>
<a name="l09692"></a>09692 <span class="preprocessor"></span>    }
<a name="l09693"></a>09693   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 3)
<a name="l09694"></a>09694     {
<a name="l09695"></a>09695 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l09696"></a>09696 <span class="preprocessor"></span>      printf (<span class="stringliteral">"&gt; No resource minimization techniques performed.\n"</span>);
<a name="l09697"></a>09697       fflush (stdout);
<a name="l09698"></a>09698 <span class="preprocessor">#endif</span>
<a name="l09699"></a>09699 <span class="preprocessor"></span>    }
<a name="l09700"></a>09700 
<a name="l09701"></a>09701   <span class="comment">/* Assign an index and offset of each the resources in the resource map</span>
<a name="l09702"></a>09702 <span class="comment">   * used  by the scheduler manager.  Remove unreference resources </span>
<a name="l09703"></a>09703 <span class="comment">   * before allocation.</span>
<a name="l09704"></a>09704 <span class="comment">   *</span>
<a name="l09705"></a>09705 <span class="comment">   * May want to do 'bit' allocation in the future to allow better</span>
<a name="l09706"></a>09706 <span class="comment">   * optimization of resource units when there are more than 32 resources.</span>
<a name="l09707"></a>09707 <span class="comment">   * Returns number of words required - 1.</span>
<a name="l09708"></a>09708 <span class="comment">   */</span>
<a name="l09709"></a>09709 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09710"></a>09710 <span class="preprocessor"></span>  printf (<span class="stringliteral">"\nRemoving unreferenced entries before map assignment:\n"</span>);
<a name="l09711"></a>09711   fflush (stdout);
<a name="l09712"></a>09712 <span class="preprocessor">#endif</span>
<a name="l09713"></a>09713 <span class="preprocessor"></span>
<a name="l09714"></a>09714   total_change = <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09715"></a>09715 
<a name="l09716"></a>09716 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09717"></a>09717 <span class="preprocessor"></span>  printf (<span class="stringliteral">"%i entries deleted/modified before map assigment.\n"</span>,
<a name="l09718"></a>09718           total_change);
<a name="l09719"></a>09719   fflush (stdout);
<a name="l09720"></a>09720 <span class="preprocessor">#endif</span>
<a name="l09721"></a>09721 <span class="preprocessor"></span>
<a name="l09722"></a>09722 
<a name="l09723"></a>09723   max_offset = <a class="code" href="lmdes2__customizer_8c.html#80f65397ab1027641ff4bae7d6b48595">assign_resource_map_locations</a> (md);
<a name="l09724"></a>09724 
<a name="l09725"></a>09725   <span class="comment">/* Coalesce unconditional usages only for level 4 opti.</span>
<a name="l09726"></a>09726 <span class="comment">   * Allow -no_tree_opti to turn off.</span>
<a name="l09727"></a>09727 <span class="comment">   * Don't do if expanding tables since undoes expand tables.</span>
<a name="l09728"></a>09728 <span class="comment">   */</span>
<a name="l09729"></a>09729   <span class="keywordflow">if</span> ((<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 5) &amp;&amp; <a class="code" href="lmdes2__customizer_8c.html#b8dfd5ac67573c68c04e14078ea2aeee">tree_opti</a> &amp;&amp; !<a class="code" href="lmdes2__customizer_8c.html#563cdd5e89becf23ee5a738704c6f08f">expand_tables</a>)
<a name="l09730"></a>09730     {
<a name="l09731"></a>09731       <a class="code" href="lmdes2__customizer_8c.html#f2197180102ce352a30d4087b462e14e">CU_coalesce_unconditional_usages</a> (md);
<a name="l09732"></a>09732     }
<a name="l09733"></a>09733 
<a name="l09734"></a>09734 <span class="preprocessor">#if 0</span>
<a name="l09735"></a>09735 <span class="preprocessor"></span>  <span class="comment">/* Debug, return now */</span>
<a name="l09736"></a>09736   printf (<span class="stringliteral">"Returning early for debugging purposes!\n"</span>);
<a name="l09737"></a>09737   <span class="keywordflow">return</span>;
<a name="l09738"></a>09738 <span class="preprocessor">#endif</span>
<a name="l09739"></a>09739 <span class="preprocessor"></span>
<a name="l09740"></a>09740   <span class="comment">/* Do classical optimizations to remove the extra units created by</span>
<a name="l09741"></a>09741 <span class="comment">   * coalescing the unconditional usages</span>
<a name="l09742"></a>09742 <span class="comment">   */</span>
<a name="l09743"></a>09743   <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09744"></a>09744 
<a name="l09745"></a>09745 <span class="preprocessor">#if 0</span>
<a name="l09746"></a>09746 <span class="preprocessor"></span>  <span class="comment">/* Debug, dump file here */</span>
<a name="l09747"></a>09747   <a class="code" href="lmdes2__customizer_8c.html#e15b6758241bc43ed7472236b84c63bd">dump_md</a> (<span class="stringliteral">"debug1.md"</span>, md);
<a name="l09748"></a>09748 <span class="preprocessor">#endif</span>
<a name="l09749"></a>09749 <span class="preprocessor"></span>
<a name="l09750"></a>09750 
<a name="l09751"></a>09751   <span class="comment">/* Optimize the resource_units so that multiple resources can be tested</span>
<a name="l09752"></a>09752 <span class="comment">   * by the same bit mask (in the same cycle).</span>
<a name="l09753"></a>09753 <span class="comment">   * Pass in the max offset to simplify calculations.</span>
<a name="l09754"></a>09754 <span class="comment">   */</span>
<a name="l09755"></a>09755   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 2)
<a name="l09756"></a>09756     {
<a name="l09757"></a>09757       <a class="code" href="lmdes2__customizer_8c.html#2160faed9e117c61232adfb550843aaa">optimize_resource_units</a> (md, max_offset);
<a name="l09758"></a>09758     }
<a name="l09759"></a>09759 
<a name="l09760"></a>09760 <span class="preprocessor">#if 0</span>
<a name="l09761"></a>09761 <span class="preprocessor"></span>  <span class="comment">/* Debug, dump file here */</span>
<a name="l09762"></a>09762   <a class="code" href="lmdes2__customizer_8c.html#e15b6758241bc43ed7472236b84c63bd">dump_md</a> (<span class="stringliteral">"debug2.md"</span>, md);
<a name="l09763"></a>09763 <span class="preprocessor">#endif</span>
<a name="l09764"></a>09764 <span class="preprocessor"></span>
<a name="l09765"></a>09765 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09766"></a>09766 <span class="preprocessor"></span>  printf (<span class="stringliteral">"\nEliminating redundant entries after resource unit opti:\n"</span>);
<a name="l09767"></a>09767   fflush (stdout);
<a name="l09768"></a>09768 <span class="preprocessor">#endif</span>
<a name="l09769"></a>09769 <span class="preprocessor"></span>
<a name="l09770"></a>09770   total_change = <a class="code" href="lmdes2__customizer_8c.html#609ff85ad7bd0ce810ba3f0732aef469">do_classical_optimizations</a> (md);
<a name="l09771"></a>09771 
<a name="l09772"></a>09772 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09773"></a>09773 <span class="preprocessor"></span>  printf (<span class="stringliteral">"%i entries deleted/modified after resource unit opti.\n"</span>,
<a name="l09774"></a>09774           total_change);
<a name="l09775"></a>09775   fflush (stdout);
<a name="l09776"></a>09776 <span class="preprocessor">#endif</span>
<a name="l09777"></a>09777 <span class="preprocessor"></span>
<a name="l09778"></a>09778   <span class="comment">/* Get the size of the mdes after speed/scheduling optimizations */</span>
<a name="l09779"></a>09779   speed_size = <a class="code" href="lmdes2__customizer_8c.html#d85163db809465f91b4a016d3862ad69">CU_count_entries</a> (md);
<a name="l09780"></a>09780 
<a name="l09781"></a>09781 <span class="preprocessor">#if VERBOSE_STATS</span>
<a name="l09782"></a>09782 <span class="preprocessor"></span>  <span class="comment">/* Take into account the extries the table expansion added */</span>
<a name="l09783"></a>09783   <span class="keywordflow">if</span> ((opti_size != (speed_size - expansion_added)) &amp;&amp; (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt;= 2))
<a name="l09784"></a>09784     {
<a name="l09785"></a>09785       printf
<a name="l09786"></a>09786         (<span class="stringliteral">"&gt; Scheduler speed-enhancing transformations added %i entries.\n"</span>,
<a name="l09787"></a>09787          (speed_size - expansion_added) - opti_size);
<a name="l09788"></a>09788 
<a name="l09789"></a>09789       <span class="keywordtype">double</span> post_speed_avg;
<a name="l09790"></a>09790       post_speed_avg = <a class="code" href="lmdes2__customizer_8c.html#6eb3b2ecf46c562b81d39d54afd41f36">average_usage_checks</a> (md);
<a name="l09791"></a>09791       printf
<a name="l09792"></a>09792         (<span class="stringliteral">"&gt; Bit-field opti reduced the average resource usage checks/table "</span>
<a name="l09793"></a>09793          <span class="stringliteral">"to %.2f.\n"</span>,
<a name="l09794"></a>09794          post_speed_avg);
<a name="l09795"></a>09795       fflush (stdout);
<a name="l09796"></a>09796     }
<a name="l09797"></a>09797 <span class="preprocessor">#endif</span>
<a name="l09798"></a>09798 <span class="preprocessor"></span>
<a name="l09799"></a>09799 
<a name="l09800"></a>09800   <span class="comment">/* Mark the resource units that use one or more 'scheduling slot' resource </span>
<a name="l09801"></a>09801 <span class="comment">   * in time 0, with the smallest slot used.  Must be done after all</span>
<a name="l09802"></a>09802 <span class="comment">   * speed transformations are done (don't add units after this!).</span>
<a name="l09803"></a>09803 <span class="comment">   */</span>
<a name="l09804"></a>09804   <a class="code" href="lmdes2__customizer_8c.html#5654a965175dc1d0b0e5b172cead0ac7">mark_resource_unit_slots</a> (md);
<a name="l09805"></a>09805 
<a name="l09806"></a>09806   <span class="comment">/* Put the reservation tables in a format that:</span>
<a name="l09807"></a>09807 <span class="comment">   * 1) Places all units into options that with just that unit as</span>
<a name="l09808"></a>09808 <span class="comment">   *    a choice.  Makes loading sm mdes easier.</span>
<a name="l09809"></a>09809 <span class="comment">   * 2) Places option or unit that defines the ops slot into the</span>
<a name="l09810"></a>09810 <span class="comment">   *    new table field slot_specifier()</span>
<a name="l09811"></a>09811 <span class="comment">   * 3) For opti_level &gt;= 3</span>
<a name="l09812"></a>09812 <span class="comment">   *    Sorts the options/units by in use () the number of options,</span>
<a name="l09813"></a>09813 <span class="comment">   *    so that the "most restrictive" options are checked first.</span>
<a name="l09814"></a>09814 <span class="comment">   */</span>
<a name="l09815"></a>09815   <a class="code" href="lmdes2__customizer_8c.html#7633a9393e597832a6f16c70d882d3b5">format_reservation_tables</a> (md);
<a name="l09816"></a>09816 
<a name="l09817"></a>09817 
<a name="l09818"></a>09818   <span class="comment">/* Print static stats about this machine description </span>
<a name="l09819"></a>09819 <span class="comment">   * (Mainly for JCG's research)</span>
<a name="l09820"></a>09820 <span class="comment">   */</span>
<a name="l09821"></a>09821   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#0464ae67d9a81d2af58909687534f835">static_stats</a>)
<a name="l09822"></a>09822     {
<a name="l09823"></a>09823       <a class="code" href="lmdes2__customizer_8c.html#b970674a582a8ea1ad5140f669f34581">print_static_stats</a> (stdout, md);
<a name="l09824"></a>09824     }
<a name="l09825"></a>09825 
<a name="l09826"></a>09826 <span class="preprocessor">#if 0</span>
<a name="l09827"></a>09827 <span class="preprocessor"></span>  printf (<span class="stringliteral">"Suppressing renaming for debugging!\n"</span>);
<a name="l09828"></a>09828 <span class="preprocessor">#endif</span>
<a name="l09829"></a>09829 <span class="preprocessor"></span>
<a name="l09830"></a>09830   <span class="comment">/* Make MDES smaller by removing the transformation debug info field</span>
<a name="l09831"></a>09831 <span class="comment">   * 'original_name' and by renaming all the entries we have been</span>
<a name="l09832"></a>09832 <span class="comment">   * manipulating to short names.  (It is confusing to have an alternative</span>
<a name="l09833"></a>09833 <span class="comment">   * for a SUB on an ADD, etc.  So better to just blow away the names</span>
<a name="l09834"></a>09834 <span class="comment">   * that don't really aid in debugging.</span>
<a name="l09835"></a>09835 <span class="comment">   */</span>
<a name="l09836"></a>09836   <a class="code" href="lmdes2__customizer_8c.html#6747e11fe0efbbeea18472c8a80f3a2c">remove_original_name</a> (md);
<a name="l09837"></a>09837   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#20ad8b535e62b1a107e319b7d900a640">opti_level</a> &gt; 0)
<a name="l09838"></a>09838     {
<a name="l09839"></a>09839       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Usage"</span>, <span class="stringliteral">"R"</span>);
<a name="l09840"></a>09840       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Resource_Unit"</span>, <span class="stringliteral">"U"</span>);
<a name="l09841"></a>09841       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Table_Option"</span>, <span class="stringliteral">"O"</span>);
<a name="l09842"></a>09842       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Reservation_Table"</span>, <span class="stringliteral">"T"</span>);
<a name="l09843"></a>09843       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Scheduling_Alternative"</span>, <span class="stringliteral">"A"</span>);
<a name="l09844"></a>09844       <a class="code" href="lmdes2__customizer_8c.html#7c5c454e016c0ad79e30d314beb9f3fd">rename_section_entries</a> (md, <span class="stringliteral">"Operation"</span>, <span class="stringliteral">"op"</span>);
<a name="l09845"></a>09845     }
<a name="l09846"></a>09846 
<a name="l09847"></a>09847   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#34ea62a4bb6a61dc0899f0f65c9b8f46">print_trees</a>)
<a name="l09848"></a>09848     {
<a name="l09849"></a>09849       printf (<span class="stringliteral">"&gt; AND/OR trees in optimized mdes:\n"</span>);
<a name="l09850"></a>09850       <a class="code" href="lmdes2__customizer_8c.html#a2b1793d18fb89fc6b66c789c85cc39a">print_table_trees</a> (stdout, md);
<a name="l09851"></a>09851     }
<a name="l09852"></a>09852 
<a name="l09853"></a>09853   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a> &gt; 0)
<a name="l09854"></a>09854     {
<a name="l09855"></a>09855       <a class="code" href="lmdes2__customizer_8c.html#6efdeefd9e046fe3a6d8369c3a48758b">C_punt</a> (md,
<a name="l09856"></a>09856               <span class="stringliteral">"%i errors occurred during customization.\nCannot continue!"</span>,
<a name="l09857"></a>09857               <a class="code" href="lmdes2__customizer_8c.html#d3c82b27bc8b51337e625c1969a5e7bc">customization_errors</a>);
<a name="l09858"></a>09858 
<a name="l09859"></a>09859     }
<a name="l09860"></a>09860 
<a name="l09861"></a>09861   <span class="comment">/* Set the customization version info, etc. */</span>
<a name="l09862"></a>09862   <a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">CU_set_string_parm</a> (md, <span class="stringliteral">"customizer_version"</span>, <span class="stringliteral">"1.01"</span>);
<a name="l09863"></a>09863   <a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">CU_set_string_parm</a> (md, <span class="stringliteral">"compatible_with_version"</span>, <span class="stringliteral">"1.00"</span>);
<a name="l09864"></a>09864 
<a name="l09865"></a>09865   <span class="comment">/* Set default values for mdes2 parms if they don't exist */</span>
<a name="l09866"></a>09866   <span class="keywordflow">if</span> (!<a class="code" href="lmdes2__customizer_8c.html#77b3447d0de2a17ecaa97e21cad307d5">CU_parm_exists</a> (md, <span class="stringliteral">"check_resources_for_only_one_alt"</span>))
<a name="l09867"></a>09867     <a class="code" href="lmdes2__customizer_8c.html#81e61dd51203a0bd0d4756451d4b6c78">CU_set_string_parm</a> (md, <span class="stringliteral">"check_resources_for_only_one_alt"</span>, <span class="stringliteral">"no"</span>);
<a name="l09868"></a>09868 
<a name="l09869"></a>09869   <span class="comment">/* Free rename table if allocated */</span>
<a name="l09870"></a>09870   <span class="keywordflow">if</span> (<a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">rename_table</a> != NULL)
<a name="l09871"></a>09871     <a class="codeRef" doxygen="libimpact.tag:../../../library/html/" href="../../../library/html/string__symbol_8c.html#d4fa6d3a295ecc9c21da1cd8d828474e">STRING_delete_symbol_table</a> (<a class="code" href="lmdes2__customizer_8c.html#b4ce2bf45b0a0cbca226867bcee5970f">rename_table</a>, NULL);
<a name="l09872"></a>09872 
<a name="l09873"></a>09873 <span class="preprocessor">#if VERBOSE_OPTI</span>
<a name="l09874"></a>09874 <span class="preprocessor"></span>  printf (<span class="stringliteral">"&gt; Customization finished\n"</span>);
<a name="l09875"></a>09875   <a class="code" href="lmdes2__customizer_8c.html#0544d5712b0f4afe9036291b18aab413">print_time_stamp</a> (stdout);
<a name="l09876"></a>09876 <span class="preprocessor">#endif</span>
<a name="l09877"></a>09877 <span class="preprocessor"></span>
<a name="l09878"></a>09878 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Aug 30 17:58:50 2014 for lmdes2_customizer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
