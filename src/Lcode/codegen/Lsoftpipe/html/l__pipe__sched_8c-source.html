<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libsoftpipe: l_pipe_sched.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>l_pipe_sched.c</h1><a href="l__pipe__sched_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*****************************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *                    Illinois Open Source License</span>
<a name="l00004"></a>00004 <span class="comment"> *                     University of Illinois/NCSA</span>
<a name="l00005"></a>00005 <span class="comment"> *                         Open Source License</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (c) 2004, The University of Illinois at Urbana-Champaign.</span>
<a name="l00008"></a>00008 <span class="comment"> * All rights reserved.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Developed by:             </span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *              IMPACT Research Group</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *              University of Illinois at Urbana-Champaign</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *              http://www.crhc.uiuc.edu/IMPACT</span>
<a name="l00017"></a>00017 <span class="comment"> *              http://www.gelato.org</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * Permission is hereby granted, free of charge, to any person</span>
<a name="l00020"></a>00020 <span class="comment"> * obtaining a copy of this software and associated documentation</span>
<a name="l00021"></a>00021 <span class="comment"> * files (the "Software"), to deal with the Software without</span>
<a name="l00022"></a>00022 <span class="comment"> * restriction, including without limitation the rights to use, copy,</span>
<a name="l00023"></a>00023 <span class="comment"> * modify, merge, publish, distribute, sublicense, and/or sell copies</span>
<a name="l00024"></a>00024 <span class="comment"> * of the Software, and to permit persons to whom the Software is</span>
<a name="l00025"></a>00025 <span class="comment"> * furnished to do so, subject to the following conditions:</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * Redistributions of source code must retain the above copyright</span>
<a name="l00028"></a>00028 <span class="comment"> * notice, this list of conditions and the following disclaimers.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00031"></a>00031 <span class="comment"> * notice, this list of conditions and the following disclaimers in</span>
<a name="l00032"></a>00032 <span class="comment"> * the documentation and/or other materials provided with the</span>
<a name="l00033"></a>00033 <span class="comment"> * distribution.</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> * Neither the names of the IMPACT Research Group, the University of</span>
<a name="l00036"></a>00036 <span class="comment"> * Illinois, nor the names of its contributors may be used to endorse</span>
<a name="l00037"></a>00037 <span class="comment"> * or promote products derived from this Software without specific</span>
<a name="l00038"></a>00038 <span class="comment"> * prior written permission.  THE SOFTWARE IS PROVIDED "AS IS",</span>
<a name="l00039"></a>00039 <span class="comment"> * WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT</span>
<a name="l00040"></a>00040 <span class="comment"> * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A</span>
<a name="l00041"></a>00041 <span class="comment"> * PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE</span>
<a name="l00042"></a>00042 <span class="comment"> * CONTRIBUTORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES</span>
<a name="l00043"></a>00043 <span class="comment"> * OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<a name="l00044"></a>00044 <span class="comment"> * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE</span>
<a name="l00045"></a>00045 <span class="comment"> * OR THE USE OR OTHER DEALINGS WITH THE SOFTWARE.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment">\*****************************************************************************/</span>
<a name="l00048"></a>00048 <span class="comment">/*****************************************************************************\</span>
<a name="l00049"></a>00049 <span class="comment"> *      File: l_pipe_sched.c</span>
<a name="l00050"></a>00050 <span class="comment"> *      Description: Scheduler for single candidate II</span>
<a name="l00051"></a>00051 <span class="comment"> *      Creation Date: January, 1994</span>
<a name="l00052"></a>00052 <span class="comment"> *      Author: Daniel Lavery</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> *  Copyright (c) 1994-1997 Daniel Lavery, Wen-mei Hwu, and </span>
<a name="l00055"></a>00055 <span class="comment"> *                     The Board of Trustees of the University of Illinois.</span>
<a name="l00056"></a>00056 <span class="comment"> *                     All rights reserved.</span>
<a name="l00057"></a>00057 <span class="comment"> *      The University of Illinois Software License Agreement</span>
<a name="l00058"></a>00058 <span class="comment"> *      specifies the terms and conditions for redistribution.</span>
<a name="l00059"></a>00059 <span class="comment">\*****************************************************************************/</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">/* 10/29/02 REK Adding config.h */</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;alloca.h&gt;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include "<a class="code" href="l__softpipe__int_8h.html">l_softpipe_int.h</a>"</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include "<a class="code" href="l__pipe__sched_8h.html">l_pipe_sched.h</a>"</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include "<a class="code" href="l__mve_8h.html">l_mve.h</a>"</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/*****************************************************************************/</span>
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">00074</a> <span class="keyword">static</span> <a class="code" href="structQueue.html">Queue</a> *<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a> = NULL;
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="l__pipe__sched_8c.html#72e1d1d4b3243f4e7ec115f199298e34">00076</a> <span class="preprocessor">#define LARGE_NUMBER 1000       </span><span class="comment">/* An iteration should never be stretched</span>
<a name="l00077"></a>00077 <span class="comment">                                   over more than 1000 stages */</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/* Sort opers within each row of mrt to mimimize register pressure and</span>
<a name="l00080"></a>00080 <span class="comment">   speculation.  Use bubble sort because it is conceptually simple to</span>
<a name="l00081"></a>00081 <span class="comment">   interchange opers and swap slot numbers.  The number of opers in a</span>
<a name="l00082"></a>00082 <span class="comment">   row of the MRT is small. </span>
<a name="l00083"></a>00083 <span class="comment">   Overhauled by MCM for ITI. */</span>
<a name="l00084"></a>00084 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00085"></a><a class="code" href="l__pipe__sched_8c.html#8959fddf750d749cd097c00736be43c6">00085</a> <a class="code" href="l__pipe__sched_8c.html#8959fddf750d749cd097c00736be43c6">Lpipe_sort_MRT_rows</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087   <span class="keywordtype">int</span> row;                      <span class="comment">/* Current row of MRT for sorting */</span>
<a name="l00088"></a>00088   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html">SM_Oper_Qentry</a> *row_start, *row_end;  <span class="comment">/* Beginning and end of row */</span>
<a name="l00089"></a>00089   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html">SM_Oper_Qentry</a> *next_row_end; <span class="comment">/* Node being checked for inclusion in </span>
<a name="l00090"></a>00090 <span class="comment">                                   current row */</span>
<a name="l00091"></a>00091   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html">SM_Oper_Qentry</a> *last_unsorted_oper;   <span class="comment">/* All opers after this in queue</span>
<a name="l00092"></a>00092 <span class="comment">                                           are sorted */</span>
<a name="l00093"></a>00093   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html">SM_Oper_Qentry</a> *last_index;   <span class="comment">/* Last oper which was interchanged */</span>
<a name="l00094"></a>00094   <span class="keywordtype">int</span> pass_done;                <span class="comment">/* Flag indicating that</span>
<a name="l00095"></a>00095 <span class="comment">                                   last_unsorted_oper</span>
<a name="l00096"></a>00096 <span class="comment">                                   has been reached */</span>
<a name="l00097"></a>00097   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html">SM_Oper_Qentry</a> *q_opA, *q_opB;
<a name="l00098"></a>00098   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *temp_sm_opA;
<a name="l00099"></a>00099   L_Oper *lcode_opA, *lcode_opB;
<a name="l00100"></a>00100   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info_opA, *softpipe_info_opB;
<a name="l00101"></a>00101   <span class="keywordtype">int</span> A_sched_slot, A_sched_cycle;
<a name="l00102"></a>00102   <span class="keywordtype">int</span> B_sched_slot, B_sched_cycle;
<a name="l00103"></a>00103   <span class="keywordtype">int</span> ii = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="comment">/* sort each row of mrt */</span>
<a name="l00106"></a>00106   <span class="keywordflow">for</span> (row_start = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#8e754744130161765df739d3f6ed648a">kernel_queue</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Queue.html#7045e014fcca8fcbde2a616ddcde1ba5">first_qentry</a>; row_start;
<a name="l00107"></a>00107        row_start = row_end-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109       <span class="comment">/* what row are we in? */</span>
<a name="l00110"></a>00110       softpipe_info_opA = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (row_start-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00111"></a>00111       row = (row_start-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>) % ii;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113       <span class="comment">/* find end of row */</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115       <span class="keywordflow">for</span> (row_end = row_start, next_row_end = row_end-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00116"></a>00116            next_row_end &amp;&amp; (next_row_end-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> % ii == row);
<a name="l00117"></a>00117            row_end = next_row_end, next_row_end = row_end-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119       <span class="comment">/* bubble sort */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121       <span class="keywordflow">for</span> (last_unsorted_oper = row_end; last_unsorted_oper;
<a name="l00122"></a>00122            last_unsorted_oper = last_index)
<a name="l00123"></a>00123         {
<a name="l00124"></a>00124           last_index = NULL;
<a name="l00125"></a>00125           pass_done = 0;
<a name="l00126"></a>00126           q_opA = row_start;
<a name="l00127"></a>00127           <span class="keywordflow">while</span> (!pass_done &amp;&amp; row_start != last_unsorted_oper)
<a name="l00128"></a>00128             {
<a name="l00129"></a>00129               q_opB = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00130"></a>00130               if (q_opB == last_unsorted_oper)
<a name="l00131"></a>00131                 pass_done = 1;
<a name="l00132"></a>00132               lcode_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l00133"></a>00133               lcode_opB = q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l00134"></a>00134               softpipe_info_opA = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (lcode_opA);
<a name="l00135"></a>00135               softpipe_info_opB = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (lcode_opB);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00138"></a>00138                 printf (<span class="stringliteral">"Lpipe_sort_MRT_rows: comparing opers: %d %d\n"</span>,
<a name="l00139"></a>00139                         lcode_opA-&gt;id, lcode_opB-&gt;id);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141               <span class="comment">/* loop back branch must stay in its slot */</span>
<a name="l00142"></a>00142               <span class="keywordflow">if</span> (softpipe_info_opB-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#034c9bb438f63aa517f1ab2fc1a6a66b">loop_back_br</a>)
<a name="l00143"></a>00143                 {
<a name="l00144"></a>00144                   q_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00145"></a>00145                   <span class="keywordflow">continue</span>;
<a name="l00146"></a>00146                 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148               <span class="comment">/* handle processors which require branches </span>
<a name="l00149"></a>00149 <span class="comment">                 to be in last slots */</span>
<a name="l00150"></a>00150               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#5dfc4a9a1248286c8e15ad45456ddb90">Lpipe_fixed_slots_for_branches</a> &amp;&amp;
<a name="l00151"></a>00151                   (<a class="code" href="l__pipe__util_8h.html#ca99545f168fc106bfd5b1d32a442dd2">IS_MDES_FLAG_BR</a> (lcode_opA) ||
<a name="l00152"></a>00152                    <a class="code" href="l__pipe__util_8h.html#ca99545f168fc106bfd5b1d32a442dd2">IS_MDES_FLAG_BR</a> (lcode_opB)))
<a name="l00153"></a>00153                 {
<a name="l00154"></a>00154                   q_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00155"></a>00155                   <span class="keywordflow">continue</span>;
<a name="l00156"></a>00156                 }
<a name="l00157"></a>00157               <span class="comment">/* want latest issue times in the earliest slots */</span>
<a name="l00158"></a>00158               <span class="keywordflow">if</span> (q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> &gt; q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>)
<a name="l00159"></a>00159                 {
<a name="l00160"></a>00160                   q_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00161"></a>00161                   <span class="keywordflow">continue</span>;
<a name="l00162"></a>00162                 }
<a name="l00163"></a>00163               <span class="comment">/* wasted speculation - oper moved above branch, but issued in </span>
<a name="l00164"></a>00164 <span class="comment">                 same cycle */</span>
<a name="l00165"></a>00165               <span class="keywordflow">if</span> (q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> == q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> &amp;&amp;
<a name="l00166"></a>00166                   !(<a class="code" href="l__pipe__util_8h.html#ca99545f168fc106bfd5b1d32a442dd2">IS_MDES_FLAG_BR</a> (lcode_opB) &amp;&amp;
<a name="l00167"></a>00167                     softpipe_info_opA-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#15915ccd432c55617a5283f8cca8c558">home_block</a> &gt;
<a name="l00168"></a>00168                     softpipe_info_opB-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#15915ccd432c55617a5283f8cca8c558">home_block</a>)
<a name="l00169"></a>00169                   &amp;&amp; !<a class="code" href="l__pipe__util_8c.html#af2a384e21644ca71a0c7f4a3a524d8d">Lpipe_reordered_anti_dependent_ops</a> (q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>,
<a name="l00170"></a>00170                                                           q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>))
<a name="l00171"></a>00171                 {
<a name="l00172"></a>00172                   q_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00173"></a>00173                   <span class="keywordflow">continue</span>;
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00177"></a>00177                 printf (<span class="stringliteral">"Lpipe_sort_MRT_rows: swapping opers %d and %d.\n"</span>,
<a name="l00178"></a>00178                         lcode_opA-&gt;id, lcode_opB-&gt;id);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180               A_sched_cycle = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00181"></a>00181               A_sched_slot = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l00182"></a>00182               B_sched_cycle = q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00183"></a>00183               B_sched_slot = q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185               <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>, NULL);
<a name="l00186"></a>00186               <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>, NULL);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188               <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>, A_sched_cycle, 
<a name="l00189"></a>00189                                      B_sched_slot, B_sched_slot, 0))
<a name="l00190"></a>00190                 L_punt (<span class="stringliteral">"Lpipe_sort_MRT_rows: Can't reschedule opA!"</span>);
<a name="l00191"></a>00191               <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>, B_sched_cycle, 
<a name="l00192"></a>00192                                      A_sched_slot, A_sched_slot, 0))
<a name="l00193"></a>00193                 L_punt (<span class="stringliteral">"Lpipe_sort_MRT_rows: Can't reschedule opB!"</span>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195               <span class="comment">/* Swap qentries in SM_Oper_Queue */</span>
<a name="l00196"></a>00196               temp_sm_opA = q_opA-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#c7acbaad49f5d5dd9b0d9a20eab4ddc6">sm_op</a>;
<a name="l00197"></a>00197               <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#181d88a02e26e6a27dfd9b4a64cfefe0">SM_dequeue_oper</a> (q_opA);
<a name="l00198"></a>00198               <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#2c5f0266ce44105027317e9d3d08102d">SM_enqueue_oper_after</a> (sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#8e754744130161765df739d3f6ed648a">kernel_queue</a>, temp_sm_opA, q_opB);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200               <span class="comment">/* opA was the row start, then they both point to the</span>
<a name="l00201"></a>00201 <span class="comment">                 same invalid memory location! */</span>
<a name="l00202"></a>00202 
<a name="l00203"></a>00203               <span class="comment">/* keep track of start of row */</span>
<a name="l00204"></a>00204               <span class="keywordflow">if</span> (q_opA == row_start)
<a name="l00205"></a>00205                 row_start = q_opB;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207               q_opA = q_opB-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper__Qentry.html#18f8ae6743db367a6e487fa74ac19dde">next_qentry</a>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209               <span class="comment">/* keep track of end of row */</span>
<a name="l00210"></a>00210               <span class="keywordflow">if</span> (q_opB == row_end)
<a name="l00211"></a>00211                 row_end = q_opA;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213               <span class="comment">/* keep track of last unsorted oper */</span>
<a name="l00214"></a>00214               last_index = q_opB;
<a name="l00215"></a>00215             }
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="comment">/* Mark the chain of opers on which the loop back branch depends.  For </span>
<a name="l00222"></a>00222 <span class="comment">   counted loops without early exits, these</span>
<a name="l00223"></a>00223 <span class="comment">   opers may need to be speculatively executed to keep the recurrence</span>
<a name="l00224"></a>00224 <span class="comment">   associated with this dependence chain from limiting the MinII. </span>
<a name="l00225"></a>00225 <span class="comment">   Do not mark the start and stop nodes. */</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="keywordtype">void</span>
<a name="l00228"></a><a class="code" href="l__pipe__sched_8h.html#17a1a52d06eb95a93472c75b7d316989">00228</a> <a class="code" href="l__pipe__sched_8c.html#1f114627d53f0fcfd8f9b0b943d8750f">Lpipe_mark_branch_path_opers</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb, <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> * sm_loop_back_br)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sink_sm_op, *src_sm_op;
<a name="l00231"></a>00231   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *swp_info;
<a name="l00232"></a>00232   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html">SM_Reg_Action</a> *action;
<a name="l00233"></a>00233   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_in;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   swp_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_loop_back_br-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00236"></a>00236   swp_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7bee54feda7a0bfb08b607ed1515b812">branch_path_node</a> = 1;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">/* Determine the chain of opers on which the loop back branch depends */</span>
<a name="l00239"></a>00239   <span class="keywordflow">for</span> (sink_sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#72a08b1707e79a4ac78ad8ee2e1a2574">last_serial_op</a>; sink_sm_op;
<a name="l00240"></a>00240        sink_sm_op = sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#88143ecbdab16d214af38460be533d5a">prev_serial_op</a>)
<a name="l00241"></a>00241     {
<a name="l00242"></a>00242       <span class="comment">/* If oper is in the chain, then mark the instructions that this</span>
<a name="l00243"></a>00243 <span class="comment">         instruction is flow dependent on.  Do not follow cross-iteration</span>
<a name="l00244"></a>00244 <span class="comment">         dependences. */</span>
<a name="l00245"></a>00245       <span class="keywordflow">if</span> (!(swp_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>)) ||
<a name="l00246"></a>00246           !swp_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7bee54feda7a0bfb08b607ed1515b812">branch_path_node</a>)
<a name="l00247"></a>00247         <span class="keywordflow">continue</span>;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       <span class="keywordflow">for</span> (action = sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action;
<a name="l00250"></a>00250            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00251"></a>00251         {
<a name="l00252"></a>00252           <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in;
<a name="l00253"></a>00253                dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00254"></a>00254             {
<a name="l00255"></a>00255               <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a> || 
<a name="l00256"></a>00256                   (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> != 0) ||
<a name="l00257"></a>00257                   (((dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#6816b7a5b8cb7e6fcc2305b0c2147919">flags</a>) &amp; (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#4bd0796878efbf928852d0056b5df803">SM_REG_DEP</a> | <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a312013962761455a622b093085a6176">SM_FLOW_DEP</a>)) !=
<a name="l00258"></a>00258                    (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#4bd0796878efbf928852d0056b5df803">SM_REG_DEP</a> | <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a312013962761455a622b093085a6176">SM_FLOW_DEP</a>)))
<a name="l00259"></a>00259                 <span class="keywordflow">continue</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261               src_sm_op = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7986bc3d4adf6769d8bbfc26d6ad55b9">from_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263               <span class="keywordflow">if</span> (L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00264"></a>00264                 <span class="keywordflow">continue</span>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266               swp_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00267"></a>00267               swp_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7bee54feda7a0bfb08b607ed1515b812">branch_path_node</a> = 1;
<a name="l00268"></a>00268             }
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271   <span class="keywordflow">return</span>;
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">/* Opers in the dependence chain on which the loop back</span>
<a name="l00276"></a>00276 <span class="comment">   branch depends may have been scheduled later than they need</span>
<a name="l00277"></a>00277 <span class="comment">   to be.  Push this dependence chain to the top to avoid unnecessary</span>
<a name="l00278"></a>00278 <span class="comment">   speculation and shorten the schedule length. */</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00281"></a><a class="code" href="l__pipe__sched_8c.html#22d3a9898c3e6ce8efa572c7ac22c115">00281</a> <a class="code" href="l__pipe__sched_8c.html#22d3a9898c3e6ce8efa572c7ac22c115">Lpipe_do_compact_branch_path_opers</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb, <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> * sm_loop_back_br)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op, *src_sm_op;
<a name="l00284"></a>00284   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html">SM_Reg_Action</a> *action;
<a name="l00285"></a>00285   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_in;
<a name="l00286"></a>00286   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *sink_softpipe_info; <span class="comment">/* for oper at sink of dependence */</span>
<a name="l00287"></a>00287   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l00288"></a>00288   <span class="keywordtype">int</span> minslack;                 <span class="comment">/* min amount of slack that oper </span>
<a name="l00289"></a>00289 <span class="comment">                                   has to move up */</span>
<a name="l00290"></a>00290   <span class="keywordtype">int</span> tempslack;                <span class="comment">/* slack with respect to current dependence */</span>
<a name="l00291"></a>00291   <span class="keywordtype">int</span> issue_time, issue_slot;
<a name="l00292"></a>00292   <span class="keywordtype">int</span> earliest_issue_time;      <span class="comment">/* earliest possible issue time for </span>
<a name="l00293"></a>00293 <span class="comment">                                   oper at sink of dependence */</span>
<a name="l00294"></a>00294   <span class="keywordtype">int</span> earliest_non_spec_issue_time;     <span class="comment">/* issue time of the earliest oper</span>
<a name="l00295"></a>00295 <span class="comment">                                           which is not on the dependence chain</span>
<a name="l00296"></a>00296 <span class="comment">                                           leading to loop back branch */</span>
<a name="l00297"></a>00297   <span class="keywordtype">int</span> earliest_non_spec_stage;  <span class="comment">/* stage which contains the earliest oper</span>
<a name="l00298"></a>00298 <span class="comment">                                   which is not on the dependence chain</span>
<a name="l00299"></a>00299 <span class="comment">                                   leading to loop back branch */</span>
<a name="l00300"></a>00300   <span class="keywordtype">int</span> stage_diff;               <span class="comment">/* number of stages between the loop</span>
<a name="l00301"></a>00301 <span class="comment">                                   back branch and the earliest oper</span>
<a name="l00302"></a>00302 <span class="comment">                                   which is not on the dependence</span>
<a name="l00303"></a>00303 <span class="comment">                                   chain leading to loop back branch */</span>
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   earliest_non_spec_issue_time = <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#e84ecd39117474b57748ff3565e7aa5c">SM_MAX_CYCLE</a>;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">/* compact the dependence chain leading to the loop back branch */</span>
<a name="l00308"></a>00308   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op != NULL;
<a name="l00309"></a>00309        sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311       sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       <span class="comment">/* dependence chain is compacted starting from start node */</span>
<a name="l00314"></a>00314       <span class="keywordflow">if</span> (L_START_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00315"></a>00315         <span class="keywordflow">continue</span>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="comment">/* If oper is not in dependence chain leading to loop back branch,</span>
<a name="l00318"></a>00318 <span class="comment">         it does not have to be speculatively executed.  Find the earliest</span>
<a name="l00319"></a>00319 <span class="comment">         issue time among all such opers.  Find the latest issue time</span>
<a name="l00320"></a>00320 <span class="comment">         among all opers excluding the stop oper */</span>
<a name="l00321"></a>00321       <span class="keywordflow">if</span> (!sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7bee54feda7a0bfb08b607ed1515b812">branch_path_node</a>)
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323           <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> &lt; earliest_non_spec_issue_time)
<a name="l00324"></a>00324             {
<a name="l00325"></a>00325               earliest_non_spec_issue_time = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00326"></a>00326             }
<a name="l00327"></a>00327           <span class="keywordflow">continue</span>;
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330       minslack = <a class="code" href="l__pipe__sched_8h.html#c5c094a855c2acb6fc2483dfd24f5bf6">IMPOSSIBLE_SLACK</a>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <span class="comment">/* Find out how much earlier oper can be moved. */</span>
<a name="l00333"></a>00333       <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00334"></a>00334            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336           <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in != NULL;
<a name="l00337"></a>00337                dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00338"></a>00338             {
<a name="l00339"></a>00339 
<a name="l00340"></a>00340               <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00341"></a>00341                 <span class="keywordflow">continue</span>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343               src_sm_op = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7986bc3d4adf6769d8bbfc26d6ad55b9">from_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345               <span class="keywordflow">if</span> (src_sm_op == sm_op ||
<a name="l00346"></a>00346                   L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00347"></a>00347                 <span class="keywordflow">continue</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349               tempslack = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> -
<a name="l00350"></a>00350                 src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> - dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> +
<a name="l00351"></a>00351                 dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00352"></a>00352               <span class="keywordflow">if</span> (tempslack &lt; minslack)
<a name="l00353"></a>00353                 minslack = tempslack;
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357       <span class="comment">/* move oper earlier by a multiple of II cycles that is less than or</span>
<a name="l00358"></a>00358 <span class="comment">         equal to the slack */</span>
<a name="l00359"></a>00359       issue_time = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00360"></a>00360       earliest_issue_time = issue_time - minslack;
<a name="l00361"></a>00361       <span class="keywordflow">while</span> ((issue_time - sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>) &gt;= earliest_issue_time)
<a name="l00362"></a>00362         issue_time = issue_time - sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364       sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = issue_time;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366       issue_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368       <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00369"></a>00369         printf (<span class="stringliteral">"Lpipe_do_compact_branch_path_opers: "</span>
<a name="l00370"></a>00370                 <span class="stringliteral">"(1) move op %d from time %d to %d\n"</span>,
<a name="l00371"></a>00371                 sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>, issue_time);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sm_op, NULL);
<a name="l00374"></a>00374       <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, issue_time, issue_slot, issue_slot, 0))
<a name="l00375"></a>00375         L_punt (<span class="stringliteral">"Lpipe_do_compact_branch_path_opers: "</span>
<a name="l00376"></a>00376                 <span class="stringliteral">"(1) Can't reschedule sm_op!"</span>);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="comment">/* After the dependence chain has been compacted, push the whole chain up</span>
<a name="l00380"></a>00380 <span class="comment">     so that non-speculative operations are issued in the same stage as the</span>
<a name="l00381"></a>00381 <span class="comment">     loop back branch or later.  */</span>
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   earliest_non_spec_stage = earliest_non_spec_issue_time / sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00384"></a>00384   stage_diff =
<a name="l00385"></a>00385     earliest_non_spec_stage - sm_loop_back_br-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> / sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00386"></a>00386   <span class="keywordflow">if</span> (stage_diff &lt; 0)
<a name="l00387"></a>00387     {
<a name="l00388"></a>00388       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op != NULL;
<a name="l00389"></a>00389            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00390"></a>00390         {
<a name="l00391"></a>00391           softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00392"></a>00392           <span class="keywordflow">if</span> (softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7bee54feda7a0bfb08b607ed1515b812">branch_path_node</a>
<a name="l00393"></a>00393               &amp;&amp; !L_START_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00394"></a>00394             {
<a name="l00395"></a>00395               issue_time = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> + stage_diff * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00396"></a>00396               softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = issue_time;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00399"></a>00399                 printf (<span class="stringliteral">"Lpipe_do_compact_branch_path_opers: "</span>
<a name="l00400"></a>00400                         <span class="stringliteral">"(2) move op %d from time %d to %d\n"</span>,
<a name="l00401"></a>00401                         sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>, issue_time);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403               issue_slot = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#020d2854e972ae85a214b3012f8e023e">issue_slot</a>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405               <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sm_op, NULL);
<a name="l00406"></a>00406               <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, issue_time, issue_slot,
<a name="l00407"></a>00407                                      issue_slot, 0))
<a name="l00408"></a>00408                 L_punt (<span class="stringliteral">"Lpipe_do_compact_branch_path_opers: "</span>
<a name="l00409"></a>00409                         <span class="stringliteral">"(2) Can't reschedule sm_op!"</span>);
<a name="l00410"></a>00410             }
<a name="l00411"></a>00411         }
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="comment">/* Move operations with no incoming register flow dependences as late as</span>
<a name="l00417"></a>00417 <span class="comment">   possible in the schedule and operations with no outgoing dependences as</span>
<a name="l00418"></a>00418 <span class="comment">   early as possible in the schedule */</span>
<a name="l00419"></a>00419 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00420"></a><a class="code" href="l__pipe__sched_8c.html#6ea245db13fd3e44deea65c66ab25a8c">00420</a> <a class="code" href="l__pipe__sched_8c.html#6ea245db13fd3e44deea65c66ab25a8c">Lpipe_optimize_lifetimes</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l00423"></a>00423   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *src_softpipe_info;  <span class="comment">/* for oper at source of dependence */</span>
<a name="l00424"></a>00424   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *sink_softpipe_info; <span class="comment">/* for oper at sink of dependence */</span>
<a name="l00425"></a>00425   <span class="keywordtype">int</span> minslack;                 <span class="comment">/* minimum amount of slack that</span>
<a name="l00426"></a>00426 <span class="comment">                                   oper has to move */</span>
<a name="l00427"></a>00427   <span class="keywordtype">int</span> tempslack;                <span class="comment">/* slack with respect to current dependence */</span>
<a name="l00428"></a>00428   <span class="keywordtype">int</span> issue_time, issue_slot;
<a name="l00429"></a>00429   <span class="keywordtype">int</span> latest_issue_time;        <span class="comment">/* latest possible issue time for</span>
<a name="l00430"></a>00430 <span class="comment">                                   oper at source of dependence */</span>
<a name="l00431"></a>00431   <span class="keywordtype">int</span> earliest_issue_time;      <span class="comment">/* earliest possible issue time for</span>
<a name="l00432"></a>00432 <span class="comment">                                   oper at sink of dependence */</span>
<a name="l00433"></a>00433   <span class="keywordtype">int</span> num_outgoing_reg_deps;
<a name="l00434"></a>00434   <span class="keywordtype">int</span> num_incoming_reg_deps;
<a name="l00435"></a>00435   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html">SM_Reg_Action</a> *action;
<a name="l00436"></a>00436   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *src_sm_op, *sink_sm_op;
<a name="l00437"></a>00437   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_in, *dep_out;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l00440"></a>00440     {
<a name="l00441"></a>00441       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#72a08b1707e79a4ac78ad8ee2e1a2574">last_serial_op</a>; sm_op;
<a name="l00442"></a>00442            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#88143ecbdab16d214af38460be533d5a">prev_serial_op</a>)
<a name="l00443"></a>00443         {
<a name="l00444"></a>00444           sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446           <span class="keywordflow">if</span> (L_START_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>) ||
<a name="l00447"></a>00447               sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#034c9bb438f63aa517f1ab2fc1a6a66b">loop_back_br</a>)
<a name="l00448"></a>00448             <span class="keywordflow">continue</span>;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450           num_outgoing_reg_deps = 0;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452           <span class="comment">/* find opers with no outgoing register flow dependences */</span>
<a name="l00453"></a>00453           <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00454"></a>00454                action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00455"></a>00455             {
<a name="l00456"></a>00456               <span class="keywordflow">for</span> (dep_out = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#3171073306749483352a4c892cfc6221">first_dep_out</a>; dep_out != NULL;
<a name="l00457"></a>00457                    dep_out = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#b504e52138aeabdcedf0a11fffa105a4">next_dep_out</a>)
<a name="l00458"></a>00458                 {
<a name="l00459"></a>00459                   <span class="keywordflow">if</span> (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00460"></a>00460                     <span class="keywordflow">continue</span>;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                   <span class="keywordflow">if</span> ((dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#6816b7a5b8cb7e6fcc2305b0c2147919">flags</a> &amp; <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a312013962761455a622b093085a6176">SM_FLOW_DEP</a>) &amp;&amp;
<a name="l00463"></a>00463                       (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#6816b7a5b8cb7e6fcc2305b0c2147919">flags</a> &amp; <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#4bd0796878efbf928852d0056b5df803">SM_REG_DEP</a>))
<a name="l00464"></a>00464                     num_outgoing_reg_deps++;
<a name="l00465"></a>00465                 }
<a name="l00466"></a>00466             }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468           <span class="keywordflow">if</span> (num_outgoing_reg_deps != 0)
<a name="l00469"></a>00469             <span class="keywordflow">continue</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471           minslack = <a class="code" href="l__pipe__sched_8h.html#c5c094a855c2acb6fc2483dfd24f5bf6">IMPOSSIBLE_SLACK</a>;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473           <span class="comment">/* find out how much earlier oper can be moved */</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475           <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00476"></a>00476                action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00477"></a>00477             {
<a name="l00478"></a>00478               <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in != NULL;
<a name="l00479"></a>00479                    dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00480"></a>00480                 {
<a name="l00481"></a>00481                   <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00482"></a>00482                     <span class="keywordflow">continue</span>;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484                   src_sm_op = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7986bc3d4adf6769d8bbfc26d6ad55b9">from_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486                   src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488                   <span class="keywordflow">if</span> (L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00489"></a>00489                     <span class="keywordflow">continue</span>;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                   tempslack = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> -
<a name="l00492"></a>00492                     src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> - dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> +
<a name="l00493"></a>00493                     (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>);
<a name="l00494"></a>00494                   <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> == 0)
<a name="l00495"></a>00495                     {
<a name="l00496"></a>00496                       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> &lt; src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>)
<a name="l00497"></a>00497                         {
<a name="l00498"></a>00498                           <span class="comment">/* cannot move sink oper to same cycle as</span>
<a name="l00499"></a>00499 <span class="comment">                             source oper */</span>
<a name="l00500"></a>00500                           tempslack--;
<a name="l00501"></a>00501                         }
<a name="l00502"></a>00502                     }
<a name="l00503"></a>00503                   <span class="keywordflow">if</span> (tempslack &lt; minslack)
<a name="l00504"></a>00504                     minslack = tempslack;
<a name="l00505"></a>00505                 }
<a name="l00506"></a>00506             }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508           <span class="keywordflow">if</span> (minslack == <a class="code" href="l__pipe__sched_8h.html#c5c094a855c2acb6fc2483dfd24f5bf6">IMPOSSIBLE_SLACK</a>)
<a name="l00509"></a>00509             L_punt (<span class="stringliteral">"Lpipe_optimize_lifetimes:"</span>
<a name="l00510"></a>00510                     <span class="stringliteral">"minslack cannot be equal to IMPOSSIBLE_SLACK (op %d)."</span>,
<a name="l00511"></a>00511                     sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id);
<a name="l00512"></a>00512 
<a name="l00513"></a>00513           <span class="comment">/* move oper earlier by a multiple of II cycles that is less</span>
<a name="l00514"></a>00514 <span class="comment">             than or equal to the slack */</span>
<a name="l00515"></a>00515           issue_time = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00516"></a>00516           earliest_issue_time = issue_time - minslack;
<a name="l00517"></a>00517           <span class="keywordflow">while</span> ((issue_time - sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>) &gt;= earliest_issue_time)
<a name="l00518"></a>00518             issue_time = issue_time - sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520           <span class="keywordflow">if</span> (issue_time == sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>)
<a name="l00521"></a>00521             <span class="keywordflow">continue</span>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523           sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = issue_time;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525           issue_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00528"></a>00528             printf (<span class="stringliteral">"Lpipe_optimize_lifetimes(B): "</span>
<a name="l00529"></a>00529                     <span class="stringliteral">"move op %d from time %d to %d\n"</span>,
<a name="l00530"></a>00530                     sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>, issue_time);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532           <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sm_op, NULL);
<a name="l00533"></a>00533           <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, issue_time, issue_slot, issue_slot, 0))
<a name="l00534"></a>00534             L_punt (<span class="stringliteral">"Lpipe_optimize_lifetimes(B): Can't reschedule sm_op!"</span>);
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537   <span class="keywordflow">else</span>                          <span class="comment">/* forward scheduling */</span>
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op != NULL;
<a name="l00540"></a>00540            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00541"></a>00541         {
<a name="l00542"></a>00542           src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544           <span class="keywordflow">if</span> (L_START_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>) ||
<a name="l00545"></a>00545               src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#034c9bb438f63aa517f1ab2fc1a6a66b">loop_back_br</a>)
<a name="l00546"></a>00546             <span class="keywordflow">continue</span>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548           num_incoming_reg_deps = 0;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550           <span class="comment">/* find opers with no outgoing register flow dependences */</span>
<a name="l00551"></a>00551           <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00552"></a>00552                action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00553"></a>00553             {
<a name="l00554"></a>00554               <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in != NULL;
<a name="l00555"></a>00555                    dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00556"></a>00556                 {
<a name="l00557"></a>00557                   <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00558"></a>00558                     <span class="keywordflow">continue</span>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                   <span class="keywordflow">if</span> ((dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#6816b7a5b8cb7e6fcc2305b0c2147919">flags</a> &amp; <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a312013962761455a622b093085a6176">SM_FLOW_DEP</a>) &amp;&amp;
<a name="l00561"></a>00561                       (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#6816b7a5b8cb7e6fcc2305b0c2147919">flags</a> &amp; <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#4bd0796878efbf928852d0056b5df803">SM_REG_DEP</a>))
<a name="l00562"></a>00562                     num_incoming_reg_deps++;
<a name="l00563"></a>00563                 }
<a name="l00564"></a>00564             }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566           <span class="keywordflow">if</span> (num_incoming_reg_deps != 0)
<a name="l00567"></a>00567             <span class="keywordflow">continue</span>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569           minslack = <a class="code" href="l__pipe__sched_8h.html#c5c094a855c2acb6fc2483dfd24f5bf6">IMPOSSIBLE_SLACK</a>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571           <span class="comment">/* find out how much later oper can be moved */</span>
<a name="l00572"></a>00572           <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00573"></a>00573                action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00574"></a>00574             {
<a name="l00575"></a>00575               <span class="keywordflow">for</span> (dep_out = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#3171073306749483352a4c892cfc6221">first_dep_out</a>; dep_out != NULL;
<a name="l00576"></a>00576                    dep_out = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#b504e52138aeabdcedf0a11fffa105a4">next_dep_out</a>)
<a name="l00577"></a>00577                 {
<a name="l00578"></a>00578                   <span class="keywordflow">if</span> (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00579"></a>00579                     <span class="keywordflow">continue</span>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581                   sink_sm_op = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#27d6dcd9ece66927e168825df329e1c6">to_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                   sink_softpipe_info =
<a name="l00584"></a>00584                     <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586                   <span class="keywordflow">if</span> (L_START_STOP_NODE (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00587"></a>00587                     <span class="keywordflow">continue</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589                   tempslack = sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> -
<a name="l00590"></a>00590                     sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> - dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> +
<a name="l00591"></a>00591                     (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593                   <span class="keywordflow">if</span> (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> == 0)
<a name="l00594"></a>00594                     {
<a name="l00595"></a>00595                       <span class="keywordflow">if</span> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> &lt; sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>)
<a name="l00596"></a>00596                         {
<a name="l00597"></a>00597                           <span class="comment">/* cannot move source oper to same cycle as</span>
<a name="l00598"></a>00598 <span class="comment">                             sink oper */</span>
<a name="l00599"></a>00599                           tempslack--;
<a name="l00600"></a>00600                         }
<a name="l00601"></a>00601                     }
<a name="l00602"></a>00602                   <span class="keywordflow">if</span> (tempslack &lt; minslack)
<a name="l00603"></a>00603                     minslack = tempslack;
<a name="l00604"></a>00604                 }
<a name="l00605"></a>00605             }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607           <span class="comment">/* move oper later by a multiple of II cycles that is less</span>
<a name="l00608"></a>00608 <span class="comment">             than or equal to the slack */</span>
<a name="l00609"></a>00609           issue_time = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00610"></a>00610           latest_issue_time = issue_time + minslack;
<a name="l00611"></a>00611           <span class="keywordflow">while</span> ((issue_time + sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>) &lt;= latest_issue_time)
<a name="l00612"></a>00612             issue_time = issue_time + sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614           <span class="keywordflow">if</span> (issue_time == sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>)
<a name="l00615"></a>00615             <span class="keywordflow">continue</span>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617           src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = issue_time;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619           issue_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l00622"></a>00622             printf (<span class="stringliteral">"Lpipe_optimize_lifetimes(F): "</span>
<a name="l00623"></a>00623                     <span class="stringliteral">"move op %d from time %d to %d\n"</span>,
<a name="l00624"></a>00624                     sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>, issue_time);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626           <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sm_op, NULL);
<a name="l00627"></a>00627           <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, issue_time, issue_slot, issue_slot, 0))
<a name="l00628"></a>00628             L_punt (<span class="stringliteral">"Lpipe_optimize_lifetimes(F): Can't reschedule sm_op!"</span>);
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632   <span class="keywordflow">return</span>;
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">/*--------------------------------------------------------------------------</span>
<a name="l00637"></a>00637 <span class="comment">                    Priority calculation routines</span>
<a name="l00638"></a>00638 <span class="comment">  --------------------------------------------------------------------------*/</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="comment">/* Compute the earliest and latest start time and slack for each oper using</span>
<a name="l00641"></a>00641 <span class="comment">   MinDist */</span>
<a name="l00642"></a>00642 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00643"></a><a class="code" href="l__pipe__sched_8c.html#39d57844abbfbc77f2ddfa8f196c3ff1">00643</a> <a class="code" href="l__pipe__sched_8c.html#39d57844abbfbc77f2ddfa8f196c3ff1">Lpipe_compute_slack_time_using_MinDist</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb)
<a name="l00644"></a>00644 {
<a name="l00645"></a>00645   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l00646"></a>00646   L_Oper *l_oper;
<a name="l00647"></a>00647   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l00648"></a>00648   <span class="keywordtype">int</span> op_num = 0;
<a name="l00649"></a>00649   <span class="keywordtype">int</span> max = 0;                  <span class="comment">/* max dep height in loop body */</span>
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="comment">/* compute earliest issue time and find max height of dependence graph from</span>
<a name="l00652"></a>00652 <span class="comment">     top down */</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00655"></a>00655     {
<a name="l00656"></a>00656       l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l00657"></a>00657       <span class="keywordflow">if</span> (!(softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper)))
<a name="l00658"></a>00658         L_punt (<span class="stringliteral">"Lpipe_compute_slack_time_using_MinDist: oper has no "</span>
<a name="l00659"></a>00659                 <span class="stringliteral">"Softpipe_Op_Info structure\nCb = %d, Op = %d\n"</span>,
<a name="l00660"></a>00660                 sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b69cef60244b3cc923619329b3f8e622">lcode_cb</a>-&gt;id, l_oper-&gt;id);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662       <span class="keywordflow">if</span> (L_START_NODE (l_oper))
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a> = 0;
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666       <span class="keywordflow">else</span>
<a name="l00667"></a>00667         {
<a name="l00668"></a>00668           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a> = Lpipe_get_MinDist (0, op_num);
<a name="l00669"></a>00669           <span class="keywordflow">if</span> (softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a> &gt; max)
<a name="l00670"></a>00670             max = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a>;
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672       op_num++;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <a class="code" href="l__softpipe_8c.html#4dc68702d9b52f9ccb3dc704c3382dad">loop_dep_height</a> = max + 1;    <span class="comment">/* dependence height of original loop body */</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="comment">/* compute latest start time for each oper from the bottom up */</span>
<a name="l00678"></a>00678   op_num = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#84b62387724ee1dd859bdc3312269c78">op_count</a> - 1;
<a name="l00679"></a>00679   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#72a08b1707e79a4ac78ad8ee2e1a2574">last_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#88143ecbdab16d214af38460be533d5a">prev_serial_op</a>)
<a name="l00680"></a>00680     {
<a name="l00681"></a>00681       l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l00682"></a>00682       softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       <span class="keywordflow">if</span> (L_STOP_NODE (l_oper))
<a name="l00685"></a>00685         softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a> = max;
<a name="l00686"></a>00686       <span class="keywordflow">else</span>
<a name="l00687"></a>00687         softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a> =
<a name="l00688"></a>00688           max - Lpipe_get_MinDist (op_num, sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#84b62387724ee1dd859bdc3312269c78">op_count</a> - 1);
<a name="l00689"></a>00689       op_num--;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="comment">/* compute slack for each oper */</span>
<a name="l00693"></a>00693   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695       L_Attr *slack_attr;
<a name="l00696"></a>00696       softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00697"></a>00697       softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#ffee04f42974a52a0a393131c24e56f3">slack</a> = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a> - softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a>;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       <span class="keywordflow">if</span> (!(slack_attr = L_find_attr (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;attr, <span class="stringliteral">"slack"</span>)))
<a name="l00700"></a>00700         {
<a name="l00701"></a>00701           slack_attr = L_new_attr (<span class="stringliteral">"slack"</span>, 1);
<a name="l00702"></a>00702           sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;attr = L_concat_attr (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;attr,
<a name="l00703"></a>00703                                                  slack_attr);
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705       L_set_int_attr_field (slack_attr, 0, softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#ffee04f42974a52a0a393131c24e56f3">slack</a>);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* Compute height-based priorities for all the operations before </span>
<a name="l00711"></a>00711 <span class="comment">   scheduling.  */</span>
<a name="l00712"></a>00712 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00713"></a><a class="code" href="l__pipe__sched_8c.html#3cfd0f1b7275f44a71eed2c6048ad046">00713</a> <a class="code" href="l__pipe__sched_8c.html#3cfd0f1b7275f44a71eed2c6048ad046">Lpipe_compute_static_priorities</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l00716"></a>00716   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">/* For forward scheduling, the priority is equal to the</span>
<a name="l00719"></a>00719 <span class="comment">     latest start time for the operation.  A lower numerical value means</span>
<a name="l00720"></a>00720 <span class="comment">     a higher priority.  For backward scheduling, the priority is equal to</span>
<a name="l00721"></a>00721 <span class="comment">     the earliest start time.  A higher numerical value means a higher</span>
<a name="l00722"></a>00722 <span class="comment">     priority. */</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; 
<a name="l00727"></a>00727            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00728"></a>00728         {
<a name="l00729"></a>00729           <span class="keywordflow">if</span> (!(softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>)))
<a name="l00730"></a>00730             <span class="keywordflow">continue</span>;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> = 3 * softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#dcc3a8736b3d1269334af5fe728c232a">estart</a>;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734           <span class="keywordflow">if</span> (!softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#034c9bb438f63aa517f1ab2fc1a6a66b">loop_back_br</a>)
<a name="l00735"></a>00735             softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> += 128 / (1 + softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#ffee04f42974a52a0a393131c24e56f3">slack</a>);
<a name="l00736"></a>00736           <span class="keywordflow">else</span>
<a name="l00737"></a>00737             softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> += 128;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739           <span class="comment">/* Give higher priority for estart ties to the branches</span>
<a name="l00740"></a>00740 <span class="comment">             and stores. */</span>
<a name="l00741"></a>00741 
<a name="l00742"></a>00742           <span class="keywordflow">if</span> (L_is_control_oper (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>) ||
<a name="l00743"></a>00743               L_general_store_opcode (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00744"></a>00744             softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> += 2;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746           <span class="comment">/* Give higher priority for estart ties to the loads. */</span>
<a name="l00747"></a>00747           <span class="keywordflow">if</span> (L_general_load_opcode (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00748"></a>00748             softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> += 1;
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751   <span class="keywordflow">else</span>
<a name="l00752"></a>00752     {                           <span class="comment">/* forward scheduling */</span>
<a name="l00753"></a>00753       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op;
<a name="l00754"></a>00754            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l00755"></a>00755         {
<a name="l00756"></a>00756           <span class="keywordflow">if</span> ((softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>)))
<a name="l00757"></a>00757             softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a>;
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759     }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 <span class="preprocessor">#if 0</span>
<a name="l00762"></a>00762 <span class="preprocessor"></span>  <span class="comment">/* For giving higher priority to operations in earlier iterations for </span>
<a name="l00763"></a>00763 <span class="comment">     modulo scheduling of unrolled loops. */</span>
<a name="l00764"></a>00764   {
<a name="l00765"></a>00765     L_Attr *attr;
<a name="l00766"></a>00766     <span class="keywordtype">int</span> iter_num;
<a name="l00767"></a>00767     <span class="keywordtype">int</span> priority_adjust;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="keywordflow">if</span> ((attr = L_find_attr (oper-&gt;attr, <span class="stringliteral">"iter"</span>)))
<a name="l00770"></a>00770       {
<a name="l00771"></a>00771         iter_num = attr-&gt;field[0]-&gt;value.i - 1;
<a name="l00772"></a>00772         priority_adjust = (int) (((<span class="keywordtype">float</span>) iter_num) * ii_eff);
<a name="l00773"></a>00773         softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a> + priority_adjust;
<a name="l00774"></a>00774       }
<a name="l00775"></a>00775     <span class="keywordflow">else</span>
<a name="l00776"></a>00776       {
<a name="l00777"></a>00777         softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#2ff128cfe3a8287ec7b981c8259b7c55">lstart</a>;
<a name="l00778"></a>00778       }
<a name="l00779"></a>00779   }
<a name="l00780"></a>00780 <span class="preprocessor">#endif</span>
<a name="l00781"></a>00781 <span class="preprocessor"></span>
<a name="l00782"></a>00782   <span class="keywordflow">return</span>;
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="comment">/*----------------------------------------------------------------------</span>
<a name="l00787"></a>00787 <span class="comment">               Scheduling routines</span>
<a name="l00788"></a>00788 <span class="comment">  ----------------------------------------------------------------------*/</span>
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="comment">/* Compute the ready times for each of the operands and an overall ready</span>
<a name="l00791"></a>00791 <span class="comment">   time for the operation based on the scheduled predecessors/successors. */</span>
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00794"></a><a class="code" href="l__pipe__sched_8c.html#ef9658a964f588c28e39d72654ddfec8">00794</a> <a class="code" href="l__pipe__sched_8c.html#ef9658a964f588c28e39d72654ddfec8">Lpipe_compute_ready_time</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb, <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> * sm_op, <span class="keywordtype">int</span> init_ready_time)
<a name="l00795"></a>00795 {
<a name="l00796"></a>00796   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *src_softpipe_info;  <span class="comment">/* info for oper at source of</span>
<a name="l00797"></a>00797 <span class="comment">                                           the dependence */</span>
<a name="l00798"></a>00798   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *sink_softpipe_info; <span class="comment">/* info for oper at sink of</span>
<a name="l00799"></a>00799 <span class="comment">                                           the dependence */</span>
<a name="l00800"></a>00800   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html">SM_Reg_Action</a> *action;
<a name="l00801"></a>00801   <span class="keywordtype">int</span> temp_ready_time;          <span class="comment">/* ready time associated with the</span>
<a name="l00802"></a>00802 <span class="comment">                                   current dependence */</span>
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   <span class="comment">/* For forward scheduling, examine predecessors.  For reverse</span>
<a name="l00805"></a>00805 <span class="comment">     scheduling, examine the successors. */</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l00808"></a>00808     {
<a name="l00809"></a>00809       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sink_sm_op;
<a name="l00810"></a>00810       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_out;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812       src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00813"></a>00813 
<a name="l00814"></a>00814       src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a> = init_ready_time;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816       <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action;
<a name="l00817"></a>00817            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00818"></a>00818         {
<a name="l00819"></a>00819           <span class="keywordflow">for</span> (dep_out = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#3171073306749483352a4c892cfc6221">first_dep_out</a>; dep_out;
<a name="l00820"></a>00820                dep_out = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#b504e52138aeabdcedf0a11fffa105a4">next_dep_out</a>)
<a name="l00821"></a>00821             {
<a name="l00822"></a>00822               <span class="keywordflow">if</span> (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00823"></a>00823                 <span class="keywordflow">continue</span>;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825               sink_sm_op = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#27d6dcd9ece66927e168825df329e1c6">to_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827               sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829               <span class="comment">/* Do nothing if successor is not scheduled.  Also neatly</span>
<a name="l00830"></a>00830 <span class="comment">                 handles dependences from an operation to itself */</span>
<a name="l00831"></a>00831               <span class="keywordflow">if</span> (!sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> ||
<a name="l00832"></a>00832                   L_START_STOP_NODE (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00833"></a>00833                 <span class="keywordflow">continue</span>;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835               temp_ready_time = sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>
<a name="l00836"></a>00836                 - dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> + dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00837"></a>00837               <span class="comment">/* update ready time for source oper */</span>
<a name="l00838"></a>00838 
<a name="l00839"></a>00839               <span class="keywordflow">if</span> (temp_ready_time &lt; src_softpipe_info-&gt;ready_time)
<a name="l00840"></a>00840                 src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a> = temp_ready_time;
<a name="l00841"></a>00841             }
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844   <span class="keywordflow">else</span>                          <span class="comment">/* forward scheduling */</span>
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *src_sm_op;
<a name="l00847"></a>00847       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_in;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849       sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851       sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a> = init_ready_time;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853       <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action != NULL;
<a name="l00854"></a>00854            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00855"></a>00855         {
<a name="l00856"></a>00856           <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in != NULL;
<a name="l00857"></a>00857                dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00858"></a>00858             {
<a name="l00859"></a>00859               <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00860"></a>00860                 <span class="keywordflow">continue</span>;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862               src_sm_op = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7986bc3d4adf6769d8bbfc26d6ad55b9">from_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864               src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866               <span class="comment">/* Do nothing if predecessor is not scheduled.  Also neatly</span>
<a name="l00867"></a>00867 <span class="comment">                 handles dependences from an operation to itself */</span>
<a name="l00868"></a>00868               <span class="keywordflow">if</span> (!src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> ||
<a name="l00869"></a>00869                   L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00870"></a>00870                 <span class="keywordflow">continue</span>;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872               temp_ready_time = src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>
<a name="l00873"></a>00873                 + dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a> - dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875               <span class="comment">/* update ready time for sink oper */</span>
<a name="l00876"></a>00876 
<a name="l00877"></a>00877               <span class="keywordflow">if</span> (temp_ready_time &gt; sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a>)
<a name="l00878"></a>00878                 sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a> = temp_ready_time;
<a name="l00879"></a>00879             }
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   <span class="keywordflow">return</span>;
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="comment">/* Unschedule predecessors/successors if there is a dependence conflict </span>
<a name="l00888"></a>00888 <span class="comment">   and put them back in the queue to be scheduled again.</span>
<a name="l00889"></a>00889 <span class="comment">   Deps to unschedule in reverse mode are selected only if they are </span>
<a name="l00890"></a>00890 <span class="comment">   predecessors in the dependence graph and if the unschedulable oper</span>
<a name="l00891"></a>00891 <span class="comment">   can be placed in a cycle that will break the dependence.  Therefore,</span>
<a name="l00892"></a>00892 <span class="comment">   we want to know the earliest cycle that the unschedulable oper </span>
<a name="l00893"></a>00893 <span class="comment">   could be scheduled. For forward scheduling, use the lasted desired</span>
<a name="l00894"></a>00894 <span class="comment">   issue time for the smallest actual latency because the unschedulable</span>
<a name="l00895"></a>00895 <span class="comment">   oper is the source of the dependences. */</span>
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00898"></a><a class="code" href="l__pipe__sched_8c.html#3958328b214031e4b78c8b9e33cb4a03">00898</a> <a class="code" href="l__pipe__sched_8c.html#3958328b214031e4b78c8b9e33cb4a03">Lpipe_eject_opers_if_dependence_conflict</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> * sm_op, <span class="keywordtype">int</span> II,
<a name="l00899"></a>00899                                           <span class="keywordtype">int</span> desired_cycle)
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901   L_Oper *l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l00902"></a>00902   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html">SM_Reg_Action</a> *action;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *src_softpipe_info;  <span class="comment">/* info for oper at source of</span>
<a name="l00905"></a>00905 <span class="comment">                                           the dependence */</span>
<a name="l00906"></a>00906   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *sink_softpipe_info; <span class="comment">/* info for oper at sink of</span>
<a name="l00907"></a>00907 <span class="comment">                                           the dependence */</span>
<a name="l00908"></a>00908   <span class="keywordtype">int</span> actual_delay;             <span class="comment">/* difference in issue time between source and</span>
<a name="l00909"></a>00909 <span class="comment">                                   sink opers */</span>
<a name="l00910"></a>00910   <span class="keywordtype">int</span> required_delay;           <span class="comment">/* required separation in cycles</span>
<a name="l00911"></a>00911 <span class="comment">                                   between source and sink oper to statisfy</span>
<a name="l00912"></a>00912 <span class="comment">                                   dependence */</span>
<a name="l00913"></a>00913   <span class="keywordtype">int</span> eject_oper;               <span class="comment">/* flag to indicate that the source or</span>
<a name="l00914"></a>00914 <span class="comment">                                   sink oper has a dependence conflict</span>
<a name="l00915"></a>00915 <span class="comment">                                   with the oper that was just scheduled */</span>
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <span class="comment">/* For forward scheduling, examine successors.  For reverse</span>
<a name="l00918"></a>00918 <span class="comment">     scheduling, examine the predecessors. */</span>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l00921"></a>00921     {
<a name="l00922"></a>00922       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *src_sm_op;
<a name="l00923"></a>00923       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_in;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925       sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927       <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action;
<a name="l00928"></a>00928            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l00929"></a>00929         {
<a name="l00930"></a>00930           <span class="keywordflow">for</span> (dep_in = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#60b920d4ec6481af314c5d8a35b08e41">first_dep_in</a>; dep_in;
<a name="l00931"></a>00931                dep_in = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7db7e3db6b52d38f70d0a5e6d0b28b31">next_dep_in</a>)
<a name="l00932"></a>00932             {
<a name="l00933"></a>00933               <span class="keywordflow">if</span> (dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l00934"></a>00934                 <span class="keywordflow">continue</span>;
<a name="l00935"></a>00935 
<a name="l00936"></a>00936               src_sm_op = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#7986bc3d4adf6769d8bbfc26d6ad55b9">from_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938               src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l00939"></a>00939               eject_oper = 0;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941               <span class="comment">/* do nothing if predecessor is not scheduled */</span>
<a name="l00942"></a>00942               <span class="keywordflow">if</span> (!src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> ||
<a name="l00943"></a>00943                   L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00944"></a>00944                 <span class="keywordflow">continue</span>;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946               actual_delay = desired_cycle - src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948               <span class="comment">/* Compute delay required between the operations.  Treat start </span>
<a name="l00949"></a>00949 <span class="comment">                 and stop dummy nodes differently because they have no</span>
<a name="l00950"></a>00950 <span class="comment">                 Mdes information.  Also properly handles dependences from</span>
<a name="l00951"></a>00951 <span class="comment">                 an operation to itself. */</span>
<a name="l00952"></a>00952               <span class="keywordflow">if</span> (!L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>) &amp;&amp;
<a name="l00953"></a>00953                   !L_START_STOP_NODE (l_oper))
<a name="l00954"></a>00954                 {
<a name="l00955"></a>00955                   <span class="comment">/* find dest/src latency for operand associated with the </span>
<a name="l00956"></a>00956 <span class="comment">                     dependence */</span>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958                   required_delay = dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960                   <span class="keywordflow">if</span> (required_delay &lt; 0)
<a name="l00961"></a>00961                     required_delay = 0;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                   <span class="keywordflow">if</span> (actual_delay &lt; required_delay - dep_in-&gt;omega * II)
<a name="l00964"></a>00964                     {
<a name="l00965"></a>00965                       eject_oper = 1;
<a name="l00966"></a>00966                     }
<a name="l00967"></a>00967                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((required_delay == 0) &amp;&amp;
<a name="l00968"></a>00968                            (actual_delay ==
<a name="l00969"></a>00969                             required_delay - dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * II))
<a name="l00970"></a>00970                     {
<a name="l00971"></a>00971                       <span class="comment">/* if 0 cycle dependence and dependent opers</span>
<a name="l00972"></a>00972 <span class="comment">                         will execute in the same cycle, need to check</span>
<a name="l00973"></a>00973 <span class="comment">                         slot */</span>
<a name="l00974"></a>00974                       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> &lt; src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>)
<a name="l00975"></a>00975                         eject_oper = 1;
<a name="l00976"></a>00976                     }
<a name="l00977"></a>00977                 }
<a name="l00978"></a>00978               <span class="keywordflow">else</span>
<a name="l00979"></a>00979                 {
<a name="l00980"></a>00980                   <span class="keywordflow">if</span> (actual_delay &lt; dep_in-&gt;min_delay - dep_in-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * II)
<a name="l00981"></a>00981                     eject_oper = 1;
<a name="l00982"></a>00982                 }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984               <span class="keywordflow">if</span> (eject_oper &amp;&amp;
<a name="l00985"></a>00985                   !<a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>)-&gt;loop_back_br)
<a name="l00986"></a>00986                 {
<a name="l00987"></a>00987                   <span class="comment">/* unschedule operation, reinitialize Softpipe_Op_Info</span>
<a name="l00988"></a>00988 <span class="comment">                     fields, and throw it back in queue */</span>
<a name="l00989"></a>00989                   <span class="keywordflow">if</span> (!L_START_STOP_NODE (src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l00990"></a>00990                     {
<a name="l00991"></a>00991                       <span class="comment">/* Start and stop nodes never had resources allocated</span>
<a name="l00992"></a>00992 <span class="comment">                         to begin with. */</span>
<a name="l00993"></a>00993 
<a name="l00994"></a>00994                       <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l00995"></a>00995                         printf (<span class="stringliteral">"(XD) op %i ejected from cycle %i slot %i\n"</span>,
<a name="l00996"></a>00996                                 src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id,
<a name="l00997"></a>00997                                 src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>,
<a name="l00998"></a>00998                                 src_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000                       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (src_sm_op, NULL);
<a name="l01001"></a>01001                     }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003                   src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> = 0;
<a name="l01004"></a>01004                   src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#f69da927376f1a1b3c0b3fc0ed76fb65">issue_time</a> = -1;
<a name="l01005"></a>01005                   src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = -1;
<a name="l01006"></a>01006                   <a class="code" href="l__pipe__util_8c.html#8fcbbb02452d1ca7f1fb27f24bf23fc9">Q_priority_enqueue_decreasing</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>, src_sm_op,
<a name="l01007"></a>01007                                                  src_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>);
<a name="l01008"></a>01008                 }
<a name="l01009"></a>01009             }
<a name="l01010"></a>01010         }
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012   <span class="keywordflow">else</span>
<a name="l01013"></a>01013     {                           <span class="comment">/* forward scheduling */</span>
<a name="l01014"></a>01014       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sink_sm_op;
<a name="l01015"></a>01015       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html">SM_Dep</a> *dep_out;
<a name="l01016"></a>01016 
<a name="l01017"></a>01017       src_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019       <span class="keywordflow">for</span> (action = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#57586b443ee0ac219ebbdec855fd410d">first_op_action</a>; action;
<a name="l01020"></a>01020            action = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#006ea32b06272e80d00b880e2858a926">next_op_action</a>)
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022           <span class="keywordflow">for</span> (dep_out = action-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#3171073306749483352a4c892cfc6221">first_dep_out</a>; dep_out;
<a name="l01023"></a>01023                dep_out = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#b504e52138aeabdcedf0a11fffa105a4">next_dep_out</a>)
<a name="l01024"></a>01024             {
<a name="l01025"></a>01025               <span class="keywordflow">if</span> (dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#c86fd98a10649c5bc10931ef03c09bdf">ignore</a>)
<a name="l01026"></a>01026                 <span class="keywordflow">continue</span>;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028               sink_sm_op = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#27d6dcd9ece66927e168825df329e1c6">to_action</a>-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Reg__Action.html#870ffbe025aeb52318e352bf64d9d155">sm_op</a>;
<a name="l01029"></a>01029 
<a name="l01030"></a>01030               sink_softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l01031"></a>01031               eject_oper = 0;
<a name="l01032"></a>01032 
<a name="l01033"></a>01033               <span class="comment">/* do nothing if successor is not scheduled */</span>
<a name="l01034"></a>01034               <span class="keywordflow">if</span> (!sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> ||
<a name="l01035"></a>01035                   L_START_STOP_NODE (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l01036"></a>01036                 <span class="keywordflow">continue</span>;
<a name="l01037"></a>01037 
<a name="l01038"></a>01038               actual_delay = sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> - desired_cycle;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040               <span class="comment">/* Compute delay required between the operations.  Treat start </span>
<a name="l01041"></a>01041 <span class="comment">                 and stop dummy nodes differently because they have no</span>
<a name="l01042"></a>01042 <span class="comment">                 Mdes information.  Also properly handles dependences from</span>
<a name="l01043"></a>01043 <span class="comment">                 an operation to itself. */</span>
<a name="l01044"></a>01044               <span class="keywordflow">if</span> (!L_START_STOP_NODE (l_oper) &amp;&amp;
<a name="l01045"></a>01045                   !L_START_STOP_NODE (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l01046"></a>01046                 {
<a name="l01047"></a>01047                   <span class="comment">/* find dest/src latency for operand associated with the </span>
<a name="l01048"></a>01048 <span class="comment">                     dependence */</span>
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                   required_delay = dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#e239c4ea463b4cb1917c0b2aab2f5668">min_delay</a>;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052                   <span class="keywordflow">if</span> (required_delay &lt; 0)
<a name="l01053"></a>01053                     required_delay = 0;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055                   <span class="keywordflow">if</span> (actual_delay &lt; required_delay - dep_out-&gt;omega * II)
<a name="l01056"></a>01056                     {
<a name="l01057"></a>01057                       eject_oper = 1;
<a name="l01058"></a>01058                     }
<a name="l01059"></a>01059                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((required_delay == 0) &amp;&amp;
<a name="l01060"></a>01060                            (actual_delay ==
<a name="l01061"></a>01061                             required_delay - dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * II))
<a name="l01062"></a>01062                     {
<a name="l01063"></a>01063                       <span class="comment">/* if 0 cycle dependence and dependent opers</span>
<a name="l01064"></a>01064 <span class="comment">                         will execute in the same cycle, need to check</span>
<a name="l01065"></a>01065 <span class="comment">                         slot */</span>
<a name="l01066"></a>01066                       <span class="keywordflow">if</span> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> &lt; sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>)
<a name="l01067"></a>01067                         eject_oper = 1;
<a name="l01068"></a>01068                     }
<a name="l01069"></a>01069                 }
<a name="l01070"></a>01070               <span class="keywordflow">else</span>
<a name="l01071"></a>01071                 {
<a name="l01072"></a>01072                   <span class="keywordflow">if</span> (actual_delay &lt; dep_out-&gt;min_delay - dep_out-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Dep.html#50dec9504610cd1b38099707f7102e50">omega</a> * II)
<a name="l01073"></a>01073                     eject_oper = 1;
<a name="l01074"></a>01074                 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076               <span class="keywordflow">if</span> (eject_oper &amp;&amp;
<a name="l01077"></a>01077                   !<a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>)-&gt;loop_back_br)
<a name="l01078"></a>01078                 {
<a name="l01079"></a>01079 
<a name="l01080"></a>01080                   <span class="comment">/* unschedule operation, reinitialize Softpipe_Op_Info</span>
<a name="l01081"></a>01081 <span class="comment">                     fields, and throw it back in queue */</span>
<a name="l01082"></a>01082                   <span class="keywordflow">if</span> (!L_START_STOP_NODE (sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l01083"></a>01083                     {
<a name="l01084"></a>01084                       <span class="comment">/* Start and stop nodes never had resources allocated</span>
<a name="l01085"></a>01085 <span class="comment">                         to begin with. */</span>
<a name="l01086"></a>01086 
<a name="l01087"></a>01087                       <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01088"></a>01088                         printf (<span class="stringliteral">"(XD) op %i ejected from cycle %i slot %i\n"</span>,
<a name="l01089"></a>01089                                 sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id,
<a name="l01090"></a>01090                                 sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>,
<a name="l01091"></a>01091                                 sink_sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093                       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sink_sm_op, NULL);
<a name="l01094"></a>01094                     }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096                   sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> = 0;
<a name="l01097"></a>01097                   sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#f69da927376f1a1b3c0b3fc0ed76fb65">issue_time</a> = -1;
<a name="l01098"></a>01098                   sink_softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = -1;
<a name="l01099"></a>01099                   <a class="code" href="l__pipe__util_8c.html#5d0d8ff30543d84c18044af612092e86">Q_priority_enqueue_increasing</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>,
<a name="l01100"></a>01100                                                  sink_sm_op,
<a name="l01101"></a>01101                                                  sink_softpipe_info-&gt;
<a name="l01102"></a>01102                                                  priority);
<a name="l01103"></a>01103                 }
<a name="l01104"></a>01104             }
<a name="l01105"></a>01105         }
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107   <span class="keywordflow">return</span>;
<a name="l01108"></a>01108 }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01112"></a><a class="code" href="l__pipe__sched_8c.html#001f35671967efcad3bd24f4fd7aeb13">01112</a> <a class="code" href="l__pipe__sched_8c.html#001f35671967efcad3bd24f4fd7aeb13">Lpipe_eject_oper_for_resource_conflict</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> * sm_op)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l01115"></a>01115   L_Oper *l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l01118"></a>01118 
<a name="l01119"></a>01119   <span class="keywordflow">if</span> (softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#034c9bb438f63aa517f1ab2fc1a6a66b">loop_back_br</a>)
<a name="l01120"></a>01120     <span class="keywordflow">return</span>;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01123"></a>01123     printf (<span class="stringliteral">"(XR) op %i ejected from cycle %i slot %i\n"</span>,
<a name="l01124"></a>01124             sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a>, sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>);
<a name="l01125"></a>01125 
<a name="l01126"></a>01126   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#75f1913ac8d175b9dfd6ce15fd27ffc9">SM_unschedule_oper</a> (sm_op, NULL);
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> = 0;
<a name="l01129"></a>01129   softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#f69da927376f1a1b3c0b3fc0ed76fb65">issue_time</a> = -1;
<a name="l01130"></a>01130   softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = -1;
<a name="l01131"></a>01131 
<a name="l01132"></a>01132   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l01133"></a>01133     <a class="code" href="l__pipe__util_8c.html#8fcbbb02452d1ca7f1fb27f24bf23fc9">Q_priority_enqueue_decreasing</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>, sm_op,
<a name="l01134"></a>01134                                    softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>);
<a name="l01135"></a>01135   <span class="keywordflow">else</span>
<a name="l01136"></a>01136     <a class="code" href="l__pipe__util_8c.html#5d0d8ff30543d84c18044af612092e86">Q_priority_enqueue_increasing</a> (Lpipe_ready_queue, sm_op,
<a name="l01137"></a>01137                                    softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>);
<a name="l01138"></a>01138 
<a name="l01139"></a>01139   <span class="keywordflow">return</span>;
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01144"></a><a class="code" href="l__pipe__sched_8c.html#ab04f61e01f3019bf9d52500cbf990a0">01144</a> <a class="code" href="l__pipe__sched_8c.html#ab04f61e01f3019bf9d52500cbf990a0">Lpipe_eject_earlier_branches_and_last_slot</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb,
<a name="l01145"></a>01145                                             <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> last_slot)
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l01148"></a>01148   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *low_priority_oper = NULL;
<a name="l01149"></a>01149   L_Oper *l_oper;
<a name="l01150"></a>01150   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l01151"></a>01151   <span class="keywordtype">int</span> opers_in_row = 0;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   <span class="keywordtype">int</span> min_priority = 10000;     <span class="comment">/* higher numerical value is higher priority */</span>
<a name="l01154"></a>01154   <span class="keywordtype">int</span> min_slot = last_slot + 1;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l01157"></a>01157     {
<a name="l01158"></a>01158       l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160       softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162       <span class="keywordflow">if</span> (!softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> || L_START_STOP_NODE (l_oper))
<a name="l01163"></a>01163         <span class="keywordflow">continue</span>;
<a name="l01164"></a>01164 
<a name="l01165"></a>01165       <span class="keywordflow">if</span> ((sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> % sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>) != row)
<a name="l01166"></a>01166         <span class="keywordflow">continue</span>;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> == last_slot || <a class="code" href="l__pipe__util_8h.html#ca99545f168fc106bfd5b1d32a442dd2">IS_MDES_FLAG_BR</a> (l_oper))
<a name="l01169"></a>01169         {
<a name="l01170"></a>01170           <a class="code" href="l__pipe__sched_8c.html#001f35671967efcad3bd24f4fd7aeb13">Lpipe_eject_oper_for_resource_conflict</a> (sm_op);
<a name="l01171"></a>01171         }
<a name="l01172"></a>01172       <span class="keywordflow">else</span>
<a name="l01173"></a>01173         {
<a name="l01174"></a>01174           opers_in_row++;
<a name="l01175"></a>01175           <span class="keywordflow">if</span> (softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> &lt; min_priority ||
<a name="l01176"></a>01176               (softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a> == min_priority &amp;&amp;
<a name="l01177"></a>01177                sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> &lt; min_slot))
<a name="l01178"></a>01178             {
<a name="l01179"></a>01179               low_priority_oper = sm_op;
<a name="l01180"></a>01180               min_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a>;
<a name="l01181"></a>01181               min_priority = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>;
<a name="l01182"></a>01182             }
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186   <span class="keywordflow">if</span> (opers_in_row == <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a>)
<a name="l01187"></a>01187     <a class="code" href="l__pipe__sched_8c.html#001f35671967efcad3bd24f4fd7aeb13">Lpipe_eject_oper_for_resource_conflict</a> (low_priority_oper);
<a name="l01188"></a>01188   <span class="keywordflow">return</span>;
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 
<a name="l01192"></a>01192 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01193"></a><a class="code" href="l__pipe__sched_8c.html#0eaa7e805044e0128ed051caf6039ffb">01193</a> <a class="code" href="l__pipe__sched_8c.html#0eaa7e805044e0128ed051caf6039ffb">Lpipe_eject_opers_if_resource_conflict</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> * sm_cb, <span class="keywordtype">int</span> cycle)
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l01196"></a>01196   L_Oper *l_oper;
<a name="l01197"></a>01197   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l01200"></a>01200     {
<a name="l01201"></a>01201       l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203       softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205       <span class="keywordflow">if</span> (!softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> || L_START_STOP_NODE (l_oper))
<a name="l01206"></a>01206         <span class="keywordflow">continue</span>;
<a name="l01207"></a>01207 
<a name="l01208"></a>01208       <span class="keywordflow">if</span> ((sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#9adb1e3b27a12ac7ae0ed7ad7002dce2">sched_cycle</a> % sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>) == (cycle % sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b361d1c3725a5b52fca50c4f365091c3">II</a>))
<a name="l01209"></a>01209         <a class="code" href="l__pipe__sched_8c.html#001f35671967efcad3bd24f4fd7aeb13">Lpipe_eject_oper_for_resource_conflict</a> (sm_op);
<a name="l01210"></a>01210     }
<a name="l01211"></a>01211   <span class="keywordflow">return</span>;
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 
<a name="l01215"></a>01215 <span class="keywordtype">void</span>
<a name="l01216"></a><a class="code" href="l__pipe__sched_8h.html#c15a13771ee9ba2bcc09154f1dbed4f3">01216</a> <a class="code" href="l__pipe__sched_8c.html#dee91af7d1d223f216f3c892e3ec9c0f">Lpipe_sm_terminate</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> *sm_cb)
<a name="l01217"></a>01217 {
<a name="l01218"></a>01218   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#31ddcafff5a15dd2d9a9479f6ece561a">SM_unschedule_cb</a> (sm_cb);
<a name="l01219"></a>01219   <span class="keywordflow">return</span>;
<a name="l01220"></a>01220 }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 <span class="comment">/* Schedule loop body at the candidate II.  Return stage count if successful</span>
<a name="l01224"></a>01224 <span class="comment">   and 0 if not */</span>
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="keywordtype">int</span>
<a name="l01227"></a><a class="code" href="l__pipe__sched_8h.html#4a201d1e1f411d624841e0c211d4607f">01227</a> <a class="code" href="l__pipe__sched_8c.html#01e3114cfbc096dc1fce4b7ee4039a61">Lpipe_sm_schedule</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> *sm_cb, <span class="keywordtype">int</span> II, <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *loop_back_br, <span class="keywordtype">int</span> budget)
<a name="l01228"></a>01228 {
<a name="l01229"></a>01229   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html">SM_Oper</a> *sm_op;
<a name="l01230"></a>01230   L_Oper *l_oper;
<a name="l01231"></a>01231   <a class="code" href="struct__Softpipe__Op__Info.html">Softpipe_Op_Info</a> *softpipe_info;
<a name="l01232"></a>01232   <span class="keywordtype">int</span> init_ready_time;          <span class="comment">/* initialization value for oper ready time */</span>
<a name="l01233"></a>01233   <span class="keywordtype">int</span> test_slot;                <span class="comment">/* iterate through valid issue slots</span>
<a name="l01234"></a>01234 <span class="comment">                                   for operation */</span>
<a name="l01235"></a>01235   <span class="keywordtype">int</span> cycle = -1;               <span class="comment">/* candidate cycle for scheduling oper */</span>
<a name="l01236"></a>01236   <span class="keywordtype">int</span> ready_time, earliest_cycle, latest_cycle, success = 1;
<a name="l01237"></a>01237   <span class="keywordtype">int</span> sched_length;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="comment">/* Create scheduling queues */</span>
<a name="l01240"></a>01240   <a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a> = <a class="code" href="l__pipe__util_8c.html#cdc1d20712bda5896582534b68c4acbf">Q_create_queue</a> ();
<a name="l01241"></a>01241 
<a name="l01242"></a>01242   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#ea90a092c9a21248f1d58f320e5c2856">SM_set_cb_II</a> (sm_cb, II);
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="comment">/* initialize ready time for opers */</span>
<a name="l01245"></a>01245   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l01246"></a>01246     {
<a name="l01247"></a>01247       <span class="comment">/* The stop node is scheduled in the last row of the MRT.</span>
<a name="l01248"></a>01248 <span class="comment">         LARGE_NUMBER is chosen so that LARGE_NUMBER * ii is much</span>
<a name="l01249"></a>01249 <span class="comment">         longer than the maximum expected schedule length.  This keeps</span>
<a name="l01250"></a>01250 <span class="comment">         the candidate cycle for scheduling from becoming negative as</span>
<a name="l01251"></a>01251 <span class="comment">         the opers are scheduled from the bottom up.  For the</span>
<a name="l01252"></a>01252 <span class="comment">         candidate cycle to become negative, more than LARGE_NUMBER</span>
<a name="l01253"></a>01253 <span class="comment">         iterations have to be overlapped.  The stop node is scheduled</span>
<a name="l01254"></a>01254 <span class="comment">         at init_ready_time.  For each oper, the ready time is</span>
<a name="l01255"></a>01255 <span class="comment">         initialized to init_ready_time and decreased as the opers</span>
<a name="l01256"></a>01256 <span class="comment">         that depend on it are scheduled. */</span>
<a name="l01257"></a>01257       init_ready_time = <a class="code" href="l__pipe__sched_8c.html#72e1d1d4b3243f4e7ec115f199298e34">LARGE_NUMBER</a> * II - 1;
<a name="l01258"></a>01258     }
<a name="l01259"></a>01259   <span class="keywordflow">else</span>
<a name="l01260"></a>01260     {                           <span class="comment">/* forward scheduling */</span>
<a name="l01261"></a>01261       <span class="comment">/* The start node is scheduled in the first row of the MRT.</span>
<a name="l01262"></a>01262 <span class="comment">         LARGE_NUMBER is chosen so that LARGE_NUMBER * ii is much</span>
<a name="l01263"></a>01263 <span class="comment">         longer than the the maximum expected schedule length.  This</span>
<a name="l01264"></a>01264 <span class="comment">         keeps the candidate cycle for scheduling from becoming</span>
<a name="l01265"></a>01265 <span class="comment">         negative when there are cross-iteration dependences.  For</span>
<a name="l01266"></a>01266 <span class="comment">         each oper, the ready time is initialized to init_ready_time</span>
<a name="l01267"></a>01267 <span class="comment">         and decreased as the opers that it depends on are</span>
<a name="l01268"></a>01268 <span class="comment">         scheduled. */</span>
<a name="l01269"></a>01269       init_ready_time = <a class="code" href="l__pipe__sched_8c.html#72e1d1d4b3243f4e7ec115f199298e34">LARGE_NUMBER</a> * II;
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   <span class="comment">/* (re)initialize Softpipe_Op_Info for each oper */</span>
<a name="l01273"></a>01273   <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op; sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l01274"></a>01274     <a class="code" href="l__softpipe__info_8c.html#a1f243509717138e72fffec354e493a4">Lpipe_init_op_info</a> (sm_op, init_ready_time, 0);
<a name="l01275"></a>01275 
<a name="l01276"></a>01276   <a class="code" href="l__pipe__sched_8c.html#39d57844abbfbc77f2ddfa8f196c3ff1">Lpipe_compute_slack_time_using_MinDist</a> (sm_cb);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <a class="code" href="l__pipe__sched_8c.html#3cfd0f1b7275f44a71eed2c6048ad046">Lpipe_compute_static_priorities</a> (sm_cb);
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   <span class="comment">/* Initialize ready/priority list */</span>
<a name="l01281"></a>01281   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l01282"></a>01282     {
<a name="l01283"></a>01283       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#72a08b1707e79a4ac78ad8ee2e1a2574">last_serial_op</a>; sm_op;
<a name="l01284"></a>01284            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#88143ecbdab16d214af38460be533d5a">prev_serial_op</a>)
<a name="l01285"></a>01285         {
<a name="l01286"></a>01286           l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l01287"></a>01287           <span class="keywordflow">if</span> (!(softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper)))
<a name="l01288"></a>01288             L_punt (<span class="stringliteral">"Lpipe_sm_schedule(B): "</span>
<a name="l01289"></a>01289                     <span class="stringliteral">"oper %d has no Softpipe_Op_Info structure"</span>,
<a name="l01290"></a>01290                     l_oper-&gt;id);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292           <span class="comment">/* higher numerical value is higher priority */</span>
<a name="l01293"></a>01293           <a class="code" href="l__pipe__util_8c.html#8fcbbb02452d1ca7f1fb27f24bf23fc9">Q_priority_enqueue_decreasing</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>, sm_op,
<a name="l01294"></a>01294                                          softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>);
<a name="l01295"></a>01295         }
<a name="l01296"></a>01296     }
<a name="l01297"></a>01297   <span class="keywordflow">else</span>
<a name="l01298"></a>01298     {                           <span class="comment">/* forward scheduling */</span>
<a name="l01299"></a>01299       <span class="keywordflow">for</span> (sm_op = sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#a89868f9a5bb0dabe28a9c74d44a6286">first_serial_op</a>; sm_op;
<a name="l01300"></a>01300            sm_op = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#c7c35fc98ddf3d343118f16a6bfd0f99">next_serial_op</a>)
<a name="l01301"></a>01301         {
<a name="l01302"></a>01302           l_oper = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>;
<a name="l01303"></a>01303           <span class="keywordflow">if</span> (!(softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (l_oper)))
<a name="l01304"></a>01304             L_punt (<span class="stringliteral">"Lpipe_sm_schedule(F): "</span>
<a name="l01305"></a>01305                     <span class="stringliteral">"oper %d has no Softpipe_Op_Info structure"</span>,
<a name="l01306"></a>01306                     l_oper-&gt;id);
<a name="l01307"></a>01307 
<a name="l01308"></a>01308           <span class="comment">/* lower numerical value is higher priority */</span>
<a name="l01309"></a>01309           <a class="code" href="l__pipe__util_8c.html#5d0d8ff30543d84c18044af612092e86">Q_priority_enqueue_increasing</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>, sm_op,
<a name="l01310"></a>01310                                          softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#894628085295a2ff6742a3c68cf73761">priority</a>);
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313                                                                                
<a name="l01314"></a>01314   <span class="comment">/* schedule all operations */</span>
<a name="l01315"></a>01315   <span class="keywordflow">while</span> ((sm_op = <a class="code" href="l__pipe__util_8c.html#133e3cf36bdcb5c8bd8a22cf3d73dc36">Q_dequeue</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>)) &amp;&amp; (budget &gt; 0) &amp;&amp; success)
<a name="l01316"></a>01316     {
<a name="l01317"></a>01317       <a class="code" href="l__pipe__sched_8c.html#ef9658a964f588c28e39d72654ddfec8">Lpipe_compute_ready_time</a> (sm_cb, sm_op, init_ready_time);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319       softpipe_info = <a class="code" href="l__softpipe__int_8h.html#50a06a5d593647c987ffc62034b61991">SOFTPIPE_OP_INFO</a> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>);
<a name="l01320"></a>01320       ready_time = softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#245284eb1dba24400c1d117c8cbed493">ready_time</a>;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322       <span class="comment">/* Fake things for start or stop node.  Do not want to allocate</span>
<a name="l01323"></a>01323 <span class="comment">         resources for them. */</span>
<a name="l01324"></a>01324       <span class="keywordflow">if</span> (L_START_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>))
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#36a815a8c5d408f4e7c86d0c5df13ab4">scheduled</a> = 1;
<a name="l01327"></a>01327           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#7d7e64bcab97f4fccde857ee7430b6ec">intra_iter_issue_time</a> = ready_time;
<a name="l01328"></a>01328 
<a name="l01329"></a>01329           <span class="comment">/* set issue slot such that it does not restrict the</span>
<a name="l01330"></a>01330 <span class="comment">             dependent ops */</span>
<a name="l01331"></a>01331 
<a name="l01332"></a>01332           softpipe_info-&gt;<a class="code" href="struct__Softpipe__Op__Info.html#020d2854e972ae85a214b3012f8e023e">issue_slot</a> = L_STOP_NODE (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>) ?
<a name="l01333"></a>01333             <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> : -1;
<a name="l01334"></a>01334         }
<a name="l01335"></a>01335       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sm_op == loop_back_br)
<a name="l01336"></a>01336         {
<a name="l01337"></a>01337           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l01338"></a>01338             {
<a name="l01339"></a>01339               <span class="keywordtype">int</span> br_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01340"></a>01340 <span class="preprocessor">#if 0</span>
<a name="l01341"></a>01341 <span class="preprocessor"></span>              <span class="comment">/* MCM Always put the loop back in the last cycle for now. */</span>
<a name="l01342"></a>01342 
<a name="l01343"></a>01343               <span class="comment">/* Try ii + 1 cycles.  Because of 0-cycle dependences, all the</span>
<a name="l01344"></a>01344 <span class="comment">                 slots in the first cycle may not have been checked. */</span>
<a name="l01345"></a>01345               earliest_cycle = ready_time - ii;
<a name="l01346"></a>01346 
<a name="l01347"></a>01347               <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a> &gt; (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1))
<a name="l01348"></a>01348                 br_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01349"></a>01349               <span class="keywordflow">else</span>
<a name="l01350"></a>01350                 br_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a>;
<a name="l01351"></a>01351 
<a name="l01352"></a>01352               <span class="comment">/* compute real ready time and earliest slot for branch */</span>
<a name="l01353"></a>01353               <span class="keywordflow">if</span> (br_slot != <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1)
<a name="l01354"></a>01354                 {
<a name="l01355"></a>01355                   cycle = ready_time - 1;
<a name="l01356"></a>01356                   br_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01357"></a>01357                 }
<a name="l01358"></a>01358               <span class="keywordflow">else</span>
<a name="l01359"></a>01359                 {
<a name="l01360"></a>01360                   cycle = ready_time;
<a name="l01361"></a>01361                 }
<a name="l01362"></a>01362 <span class="preprocessor">#endif</span>
<a name="l01363"></a>01363 <span class="preprocessor"></span>
<a name="l01364"></a>01364               cycle = ready_time;
<a name="l01365"></a>01365               br_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367               <span class="keywordflow">if</span> (cycle != init_ready_time)
<a name="l01368"></a>01368                 {
<a name="l01369"></a>01369                   <a class="code" href="l__pipe__sched_8c.html#3958328b214031e4b78c8b9e33cb4a03">Lpipe_eject_opers_if_dependence_conflict</a> (sm_op, II, cycle);
<a name="l01370"></a>01370                   cycle = init_ready_time;
<a name="l01371"></a>01371                 }
<a name="l01372"></a>01372 
<a name="l01373"></a>01373               <span class="comment">/* remove any branches in earlier slots and any oper in</span>
<a name="l01374"></a>01374 <span class="comment">                 last slot */</span>
<a name="l01375"></a>01375               <a class="code" href="l__pipe__sched_8c.html#ab04f61e01f3019bf9d52500cbf990a0">Lpipe_eject_earlier_branches_and_last_slot</a> (sm_cb, cycle % II,
<a name="l01376"></a>01376                                                           br_slot);
<a name="l01377"></a>01377               <span class="comment">/* schedule loop back branch in last slot */</span>
<a name="l01378"></a>01378               <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, cycle, br_slot, br_slot, 0))
<a name="l01379"></a>01379                 {
<a name="l01380"></a>01380                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01381"></a>01381                     printf (<span class="stringliteral">"(LB) op %i placed in cycle %i slot %i\n"</span>,
<a name="l01382"></a>01382                             sm_op-&gt;lcode_op-&gt;id, cycle, sm_op-&gt;sched_slot);
<a name="l01383"></a>01383                 }
<a name="l01384"></a>01384               <span class="keywordflow">else</span>
<a name="l01385"></a>01385                 {
<a name="l01386"></a>01386                   L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01387"></a>01387                           <span class="stringliteral">"Incrementing II (from %d) - "</span>
<a name="l01388"></a>01388                           <span class="stringliteral">"Unable to schedule loop back branch "</span>
<a name="l01389"></a>01389                           <span class="stringliteral">"(function %s, cb %d, oper %d)\n"</span>,
<a name="l01390"></a>01390                           II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id,
<a name="l01391"></a>01391                           loop_back_br-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#3f5397d6d9a8bf4c7d31e4dd0219f6a9">lcode_op</a>-&gt;id);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l01394"></a>01394                     <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a83bf74e00d42409c45844d6694eca13">SM_print_map</a> (stdout, sm_cb-&gt;sm_mdes, sm_cb);
<a name="l01395"></a>01395 
<a name="l01396"></a>01396                   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#31ddcafff5a15dd2d9a9479f6ece561a">SM_unschedule_cb</a> (sm_cb);
<a name="l01397"></a>01397                   <span class="keywordflow">return</span> 0;
<a name="l01398"></a>01398                 }
<a name="l01399"></a>01399             }
<a name="l01400"></a>01400           <span class="keywordflow">else</span>
<a name="l01401"></a>01401             {
<a name="l01402"></a>01402               L_punt (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01403"></a>01403                       <span class="stringliteral">"Forward scheduling not yet completely implemented."</span>);
<a name="l01404"></a>01404             }
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406       <span class="keywordflow">else</span>                      <span class="comment">/* Not the loop back branch */</span>
<a name="l01407"></a>01407         {
<a name="l01408"></a>01408           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1ed5180823f3e497dbc3becd928690f5">Lpipe_backward_sched</a>)
<a name="l01409"></a>01409             {
<a name="l01410"></a>01410               <span class="comment">/* Try ii + 1 cycles.  Because of 0-cycle dependences, all the</span>
<a name="l01411"></a>01411 <span class="comment">                 slots in the first cycle may not have been checked. */</span>
<a name="l01412"></a>01412               earliest_cycle = ready_time - II;
<a name="l01413"></a>01413 
<a name="l01414"></a>01414               <span class="comment">/* try II candidate cycles */</span>
<a name="l01415"></a>01415               <span class="keywordflow">for</span> (cycle = ready_time; cycle &gt;= earliest_cycle; cycle--)
<a name="l01416"></a>01416                 {
<a name="l01417"></a>01417                   <span class="comment">/* When scheduled, sched_slot will be changed from </span>
<a name="l01418"></a>01418 <span class="comment">                     SM_MAX_SLOT (65535) to real slot */</span>
<a name="l01419"></a>01419                   <span class="comment">/* 20030731 SZU</span>
<a name="l01420"></a>01420 <span class="comment">                   * Help reduce scheduling time.</span>
<a name="l01421"></a>01421 <span class="comment">                   * New MCKINLEY, or IPF template bundling algorithm (SZU)</span>
<a name="l01422"></a>01422 <span class="comment">                   * automatically tries all slots.</span>
<a name="l01423"></a>01423 <span class="comment">                   */</span>
<a name="l01424"></a>01424                   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#d9c780f4de4ccbbea7c2e754d2954c64">SM_do_template_bundling</a>)
<a name="l01425"></a>01425                     {
<a name="l01426"></a>01426                       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, cycle, 0, 
<a name="l01427"></a>01427                                             (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1), 0))
<a name="l01428"></a>01428                         {
<a name="l01429"></a>01429                           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01430"></a>01430                             printf (<span class="stringliteral">"(1B) op %i placed in cycle %i slot %i\n"</span>,
<a name="l01431"></a>01431                                     sm_op-&gt;lcode_op-&gt;id,
<a name="l01432"></a>01432                                     cycle, sm_op-&gt;sched_slot);
<a name="l01433"></a>01433                           <span class="keywordflow">break</span>;
<a name="l01434"></a>01434                         }
<a name="l01435"></a>01435                     }
<a name="l01436"></a>01436                   <span class="keywordflow">else</span>
<a name="l01437"></a>01437                     {
<a name="l01438"></a>01438                       <span class="keywordtype">int</span> earliest_slot, latest_slot;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440                       <span class="comment">/* If ready cycle, start slot search at last</span>
<a name="l01441"></a>01441 <span class="comment">                         available slot based on dependences.  If</span>
<a name="l01442"></a>01442 <span class="comment">                         other cycles, successor dependences are met</span>
<a name="l01443"></a>01443 <span class="comment">                         as of the ready cycle, so try all.  Also</span>
<a name="l01444"></a>01444 <span class="comment">                         ASSUME that the last slot is currently</span>
<a name="l01445"></a>01445 <span class="comment">                         reserved for a potential branch. */</span>
<a name="l01446"></a>01446 
<a name="l01447"></a>01447                       <span class="keywordflow">if</span> (cycle == ready_time)
<a name="l01448"></a>01448                         {
<a name="l01449"></a>01449                           <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a> &gt;
<a name="l01450"></a>01450                               (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2))
<a name="l01451"></a>01451                             latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2;
<a name="l01452"></a>01452                           <span class="keywordflow">else</span>
<a name="l01453"></a>01453                             latest_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a>;
<a name="l01454"></a>01454                         }
<a name="l01455"></a>01455                       <span class="keywordflow">else</span>
<a name="l01456"></a>01456                         {
<a name="l01457"></a>01457                           latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01458"></a>01458                         }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460                       earliest_slot = 0;
<a name="l01461"></a>01461 
<a name="l01462"></a>01462                       <span class="keywordflow">for</span> (test_slot = latest_slot; test_slot &gt;= earliest_slot;
<a name="l01463"></a>01463                            test_slot--)
<a name="l01464"></a>01464                         {
<a name="l01465"></a>01465                           <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01466"></a>01466                               (sm_op, cycle, test_slot, test_slot, 0))
<a name="l01467"></a>01467                             {
<a name="l01468"></a>01468                               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01469"></a>01469                                 printf (<span class="stringliteral">"(1B) op %i placed in cycle %i "</span>
<a name="l01470"></a>01470                                         <span class="stringliteral">"slot %i\n"</span>,
<a name="l01471"></a>01471                                         sm_op-&gt;lcode_op-&gt;id,
<a name="l01472"></a>01472                                         cycle, sm_op-&gt;sched_slot);
<a name="l01473"></a>01473                               <span class="keywordflow">break</span>;
<a name="l01474"></a>01474                             }
<a name="l01475"></a>01475                         }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477                       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a> &amp;&amp; 
<a name="l01478"></a>01478                           cycle == ready_time)
<a name="l01479"></a>01479                         {
<a name="l01480"></a>01480                           if (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01481"></a>01481                               (sm_op, cycle, (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1),
<a name="l01482"></a>01482                                (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1), 0))
<a name="l01483"></a>01483                             {
<a name="l01484"></a>01484                               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01485"></a>01485                                 printf (<span class="stringliteral">"(1L) op %i placed in cycle %i "</span>
<a name="l01486"></a>01486                                         <span class="stringliteral">"slot %i\n"</span>,
<a name="l01487"></a>01487                                         sm_op-&gt;lcode_op-&gt;id,
<a name="l01488"></a>01488                                         cycle, sm_op-&gt;sched_slot);
<a name="l01489"></a>01489                             }
<a name="l01490"></a>01490                         }
<a name="l01491"></a>01491                     }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493                   <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> != <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01494"></a>01494                     <span class="keywordflow">break</span>;      <span class="comment">/* If scheduled, do not try any more cycles. */</span>
<a name="l01495"></a>01495                 }
<a name="l01496"></a>01496               <span class="comment">/* If scheduling attempts were unsuccessful, delete</span>
<a name="l01497"></a>01497 <span class="comment">                 dependent opers and put them back into the queue,</span>
<a name="l01498"></a>01498 <span class="comment">                 then scheduled this oper. */</span>
<a name="l01499"></a>01499               <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01500"></a>01500                 {
<a name="l01501"></a>01501                   <span class="comment">/* try II candidate cycles */</span>
<a name="l01502"></a>01502                   for (cycle = ready_time; cycle &gt;= earliest_cycle; cycle--)
<a name="l01503"></a>01503                     {
<a name="l01504"></a>01504                       <a class="code" href="l__pipe__sched_8c.html#3958328b214031e4b78c8b9e33cb4a03">Lpipe_eject_opers_if_dependence_conflict</a> (sm_op, II,
<a name="l01505"></a>01505                                                                 cycle);
<a name="l01506"></a>01506 
<a name="l01507"></a>01507                       <span class="comment">/* When scheduled, sched_slot will be changed from </span>
<a name="l01508"></a>01508 <span class="comment">                         SM_MAX_SLOT (65535) to real slot */</span>
<a name="l01509"></a>01509                       <span class="comment">/* 20030731 SZU</span>
<a name="l01510"></a>01510 <span class="comment">                       * Help reduce scheduling time.</span>
<a name="l01511"></a>01511 <span class="comment">                       * New MCKINLEY, or IPF template bundling algorithm (SZU)</span>
<a name="l01512"></a>01512 <span class="comment">                       * automatically tries all slots.</span>
<a name="l01513"></a>01513 <span class="comment">                       */</span>
<a name="l01514"></a>01514                       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#d9c780f4de4ccbbea7c2e754d2954c64">SM_do_template_bundling</a>)
<a name="l01515"></a>01515                         {
<a name="l01516"></a>01516                           <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, cycle, 0, 
<a name="l01517"></a>01517                                                 <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1,
<a name="l01518"></a>01518                                                 0))
<a name="l01519"></a>01519                             {
<a name="l01520"></a>01520                               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01521"></a>01521                                 printf (<span class="stringliteral">"(2B) op %i placed in cycle %i "</span>
<a name="l01522"></a>01522                                         <span class="stringliteral">"slot %i\n"</span>,
<a name="l01523"></a>01523                                         sm_op-&gt;lcode_op-&gt;id,
<a name="l01524"></a>01524                                         cycle, sm_op-&gt;sched_slot);
<a name="l01525"></a>01525                               <span class="keywordflow">break</span>;
<a name="l01526"></a>01526                             }
<a name="l01527"></a>01527                         }
<a name="l01528"></a>01528                       <span class="keywordflow">else</span>
<a name="l01529"></a>01529                         {
<a name="l01530"></a>01530                           <span class="keywordtype">int</span> earliest_slot, latest_slot;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532                           <span class="comment">/* If ready cycle, start slot search at last</span>
<a name="l01533"></a>01533 <span class="comment">                             available slot based on dependences.  If</span>
<a name="l01534"></a>01534 <span class="comment">                             other cycles, successor dependences are met</span>
<a name="l01535"></a>01535 <span class="comment">                             as of the ready cycle, so try all. */</span>
<a name="l01536"></a>01536 
<a name="l01537"></a>01537                           <span class="keywordflow">if</span> (cycle == ready_time)
<a name="l01538"></a>01538                             {
<a name="l01539"></a>01539                               <span class="keywordflow">if</span> (sm_op-&gt;slot_upper_bound &gt;
<a name="l01540"></a>01540                                   (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2))
<a name="l01541"></a>01541                                 latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2;
<a name="l01542"></a>01542                               <span class="keywordflow">else</span>
<a name="l01543"></a>01543                                 latest_slot = sm_op-&gt;slot_upper_bound;
<a name="l01544"></a>01544                             }
<a name="l01545"></a>01545                           <span class="keywordflow">else</span>
<a name="l01546"></a>01546                             {
<a name="l01547"></a>01547                               latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01548"></a>01548                             }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550                           earliest_slot = 0;
<a name="l01551"></a>01551 
<a name="l01552"></a>01552                           <span class="keywordflow">for</span> (test_slot = latest_slot;
<a name="l01553"></a>01553                                test_slot &gt;= earliest_slot; test_slot--)
<a name="l01554"></a>01554                             {
<a name="l01555"></a>01555                               <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01556"></a>01556                                   (sm_op, cycle, test_slot, test_slot, 0))
<a name="l01557"></a>01557                                 {
<a name="l01558"></a>01558                                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01559"></a>01559                                     printf
<a name="l01560"></a>01560                                       (<span class="stringliteral">"(2B) op %i placed in cycle %i "</span>
<a name="l01561"></a>01561                                        <span class="stringliteral">"slot %i\n"</span>,
<a name="l01562"></a>01562                                        sm_op-&gt;lcode_op-&gt;id, cycle,
<a name="l01563"></a>01563                                        sm_op-&gt;sched_slot);
<a name="l01564"></a>01564                                   <span class="keywordflow">break</span>;
<a name="l01565"></a>01565                                 }
<a name="l01566"></a>01566                             }
<a name="l01567"></a>01567                           <span class="keywordflow">if</span> (sm_op-&gt;sched_slot == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>
<a name="l01568"></a>01568                               &amp;&amp; cycle == ready_time)
<a name="l01569"></a>01569                             {
<a name="l01570"></a>01570                               if (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, cycle, 
<a name="l01571"></a>01571                                                <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1,
<a name="l01572"></a>01572                                    <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1, 0))
<a name="l01573"></a>01573                                 {
<a name="l01574"></a>01574                                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01575"></a>01575                                     printf (<span class="stringliteral">"(2L) op %i placed in cycle %i "</span>
<a name="l01576"></a>01576                                             <span class="stringliteral">"slot %i\n"</span>, sm_op-&gt;lcode_op-&gt;id,
<a name="l01577"></a>01577                                             cycle, sm_op-&gt;sched_slot);
<a name="l01578"></a>01578                                 }
<a name="l01579"></a>01579                             }
<a name="l01580"></a>01580                         }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582                       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> != <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01583"></a>01583                         <span class="keywordflow">break</span>;  <span class="comment">/* If scheduled, do not try any more cycles. */</span>
<a name="l01584"></a>01584                     }
<a name="l01585"></a>01585                 }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587               <span class="comment">/* If scheduling attempts were unsuccessful, delete</span>
<a name="l01588"></a>01588 <span class="comment">                 dependent opers and put them back into the queue,</span>
<a name="l01589"></a>01589 <span class="comment">                 then scheduled this oper. */</span>
<a name="l01590"></a>01590               <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01591"></a>01591                 {
<a name="l01592"></a>01592                   <span class="comment">/* try II candidate cycles */</span>
<a name="l01593"></a>01593                   for (cycle = ready_time; cycle &gt;= earliest_cycle; cycle--)
<a name="l01594"></a>01594                     {
<a name="l01595"></a>01595                       <a class="code" href="l__pipe__sched_8c.html#0eaa7e805044e0128ed051caf6039ffb">Lpipe_eject_opers_if_resource_conflict</a> (sm_cb, cycle);
<a name="l01596"></a>01596 
<a name="l01597"></a>01597                       <span class="comment">/* When scheduled, sched_slot will be changed from </span>
<a name="l01598"></a>01598 <span class="comment">                         SM_MAX_SLOT (65535) to real slot */</span>
<a name="l01599"></a>01599                       <span class="comment">/* 20030731 SZU</span>
<a name="l01600"></a>01600 <span class="comment">                       * Help reduce scheduling time.</span>
<a name="l01601"></a>01601 <span class="comment">                       * New MCKINLEY, or IPF template bundling algorithm (SZU)</span>
<a name="l01602"></a>01602 <span class="comment">                       * automatically tries all slots.</span>
<a name="l01603"></a>01603 <span class="comment">                       */</span>
<a name="l01604"></a>01604                       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#d9c780f4de4ccbbea7c2e754d2954c64">SM_do_template_bundling</a>)
<a name="l01605"></a>01605                         {
<a name="l01606"></a>01606                           <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a> (sm_op, cycle, 0,
<a name="l01607"></a>01607                                                 (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1),
<a name="l01608"></a>01608                                                 0))
<a name="l01609"></a>01609                             {
<a name="l01610"></a>01610                               <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01611"></a>01611                                 printf (<span class="stringliteral">"(1B) op %i placed in cycle %i "</span>
<a name="l01612"></a>01612                                         <span class="stringliteral">"slot %i\n"</span>,
<a name="l01613"></a>01613                                         sm_op-&gt;lcode_op-&gt;id,
<a name="l01614"></a>01614                                         cycle, sm_op-&gt;sched_slot);
<a name="l01615"></a>01615                               <span class="keywordflow">break</span>;
<a name="l01616"></a>01616                             }
<a name="l01617"></a>01617                         }
<a name="l01618"></a>01618                       <span class="keywordflow">else</span>
<a name="l01619"></a>01619                         {
<a name="l01620"></a>01620                           <span class="keywordtype">int</span> earliest_slot, latest_slot;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622                           <span class="comment">/* If ready cycle, start slot search at last</span>
<a name="l01623"></a>01623 <span class="comment">                             available slot based on dependences.  If</span>
<a name="l01624"></a>01624 <span class="comment">                             other cycles, successor dependences are met</span>
<a name="l01625"></a>01625 <span class="comment">                             as of the ready cycle, so try all. */</span>
<a name="l01626"></a>01626 
<a name="l01627"></a>01627                           <span class="keywordflow">if</span> (cycle == ready_time)
<a name="l01628"></a>01628                             {
<a name="l01629"></a>01629                               <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a> &gt;
<a name="l01630"></a>01630                                   (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2))
<a name="l01631"></a>01631                                 latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 2;
<a name="l01632"></a>01632                               <span class="keywordflow">else</span>
<a name="l01633"></a>01633                                 latest_slot = sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#cecc21a58ca12155be0c3983bfab50b1">slot_upper_bound</a>;
<a name="l01634"></a>01634                             }
<a name="l01635"></a>01635                           <span class="keywordflow">else</span>
<a name="l01636"></a>01636                             latest_slot = <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1;
<a name="l01637"></a>01637 
<a name="l01638"></a>01638                           earliest_slot = 0;
<a name="l01639"></a>01639 
<a name="l01640"></a>01640                           <span class="keywordflow">for</span> (test_slot = latest_slot;
<a name="l01641"></a>01641                                test_slot &gt;= earliest_slot; test_slot--)
<a name="l01642"></a>01642                             {
<a name="l01643"></a>01643                               <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01644"></a>01644                                   (sm_op, cycle, test_slot, test_slot, 0))
<a name="l01645"></a>01645                                 {
<a name="l01646"></a>01646                                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01647"></a>01647                                     printf
<a name="l01648"></a>01648                                       (<span class="stringliteral">"(2B) op %i placed in cycle %i "</span>
<a name="l01649"></a>01649                                        <span class="stringliteral">"slot %i\n"</span>,
<a name="l01650"></a>01650                                        sm_op-&gt;lcode_op-&gt;id, cycle,
<a name="l01651"></a>01651                                        sm_op-&gt;sched_slot);
<a name="l01652"></a>01652                                   <span class="keywordflow">break</span>;
<a name="l01653"></a>01653                                 }
<a name="l01654"></a>01654                             }
<a name="l01655"></a>01655                           <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>
<a name="l01656"></a>01656                               &amp;&amp; cycle == ready_time)
<a name="l01657"></a>01657                             {
<a name="l01658"></a>01658                               if (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01659"></a>01659                                   (sm_op, cycle, (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1),
<a name="l01660"></a>01660                                    (<a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1), 0))
<a name="l01661"></a>01661                                 {
<a name="l01662"></a>01662                                   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01663"></a>01663                                     printf
<a name="l01664"></a>01664                                       (<span class="stringliteral">"(2L) op %i placed in cycle %i "</span>
<a name="l01665"></a>01665                                        <span class="stringliteral">"slot %i\n"</span>,
<a name="l01666"></a>01666                                        sm_op-&gt;lcode_op-&gt;id, cycle,
<a name="l01667"></a>01667                                        sm_op-&gt;sched_slot);
<a name="l01668"></a>01668                                 }
<a name="l01669"></a>01669                             }
<a name="l01670"></a>01670                         }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672                       <span class="keywordflow">if</span> (sm_op-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Oper.html#76c47ef1a4635d5f4a6abf01561b9b6d">sched_slot</a> != <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01673"></a>01673                         <span class="keywordflow">break</span>;  <span class="comment">/* If scheduled, do not try any more cycles. */</span>
<a name="l01674"></a>01674                     }
<a name="l01675"></a>01675                 }
<a name="l01676"></a>01676               <span class="keywordflow">if</span> (sm_op-&gt;sched_slot == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01677"></a>01677                 {
<a name="l01678"></a>01678                   L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01679"></a>01679                           <span class="stringliteral">"Incrementing II (from %d) - "</span>
<a name="l01680"></a>01680                           <span class="stringliteral">"Unable to schedule inst even though dep op "</span>
<a name="l01681"></a>01681                           <span class="stringliteral">"unscheduled (function %s, cb %d, oper %d)\n"</span>,
<a name="l01682"></a>01682                           II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id,
<a name="l01683"></a>01683                           sm_op-&gt;lcode_op-&gt;id);
<a name="l01684"></a>01684 
<a name="l01685"></a>01685                   if (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l01686"></a>01686                     <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#a83bf74e00d42409c45844d6694eca13">SM_print_map</a> (stdout, sm_cb-&gt;sm_mdes, sm_cb);
<a name="l01687"></a>01687 
<a name="l01688"></a>01688                   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#31ddcafff5a15dd2d9a9479f6ece561a">SM_unschedule_cb</a> (sm_cb);
<a name="l01689"></a>01689                   <span class="keywordflow">return</span> 0;
<a name="l01690"></a>01690                 }
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692           <span class="keywordflow">else</span>                  <span class="comment">/* forward scheduling */</span>
<a name="l01693"></a>01693             {
<a name="l01694"></a>01694               <span class="comment">/* Try ii + 1 cycles.  Because of 0-cycle dependences, all the</span>
<a name="l01695"></a>01695 <span class="comment">                 slots in the first cycle may not have been checked. */</span>
<a name="l01696"></a>01696               latest_cycle = ready_time + II;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698               <span class="comment">/* try II candidate cycles */</span>
<a name="l01699"></a>01699               <span class="keywordflow">for</span> (cycle = ready_time; cycle &lt;= latest_cycle; cycle++)
<a name="l01700"></a>01700                 {
<a name="l01701"></a>01701                   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01702"></a>01702                       (sm_op, cycle, 0, <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1, 0))
<a name="l01703"></a>01703                     {
<a name="l01704"></a>01704                       <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01705"></a>01705                         printf (<span class="stringliteral">"(1F) op %i placed in cycle %i slot %i\n"</span>,
<a name="l01706"></a>01706                                 sm_op-&gt;lcode_op-&gt;id,
<a name="l01707"></a>01707                                 cycle, sm_op-&gt;sched_slot);
<a name="l01708"></a>01708                       <span class="keywordflow">break</span>;
<a name="l01709"></a>01709                     }
<a name="l01710"></a>01710                 }
<a name="l01711"></a>01711 
<a name="l01712"></a>01712               <span class="comment">/* If scheduling attempts were unsuccessful, delete</span>
<a name="l01713"></a>01713 <span class="comment">                 dependent opers and put them back into the queue,</span>
<a name="l01714"></a>01714 <span class="comment">                 then scheduled this oper. */</span>
<a name="l01715"></a>01715               <span class="keywordflow">if</span> (sm_op-&gt;sched_slot == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01716"></a>01716                 {
<a name="l01717"></a>01717                   <a class="code" href="l__pipe__sched_8c.html#3958328b214031e4b78c8b9e33cb4a03">Lpipe_eject_opers_if_dependence_conflict</a> (sm_op, II,
<a name="l01718"></a>01718                                                             latest_cycle);
<a name="l01719"></a>01719 
<a name="l01720"></a>01720                   <span class="comment">/* try II candidate cycles */</span>
<a name="l01721"></a>01721                   <span class="keywordflow">for</span> (cycle = ready_time; cycle &lt;= latest_cycle; cycle++)
<a name="l01722"></a>01722                     {
<a name="l01723"></a>01723                       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#602f5c3eff20faea9a4949f2273feafb">SM_schedule_oper</a>
<a name="l01724"></a>01724                           (sm_op, cycle, 0, <a class="code" href="l__softpipe_8c.html#377860f550eb8f35543d1b7c4a931268">Lpipe_total_issue_slots</a> - 1, 0))
<a name="l01725"></a>01725                         {
<a name="l01726"></a>01726                           <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01727"></a>01727                             printf (<span class="stringliteral">"(2F) op %i placed in cycle %i slot %i\n"</span>,
<a name="l01728"></a>01728                                     sm_op-&gt;lcode_op-&gt;id,
<a name="l01729"></a>01729                                     cycle, sm_op-&gt;sched_slot);
<a name="l01730"></a>01730                           <span class="keywordflow">break</span>;
<a name="l01731"></a>01731                         }
<a name="l01732"></a>01732                     }
<a name="l01733"></a>01733                   <span class="keywordflow">if</span> (sm_op-&gt;sched_slot == <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01734"></a>01734                     L_punt (<span class="stringliteral">"Lpipe_sm_schedule(F):"</span>
<a name="l01735"></a>01735                             <span class="stringliteral">"Unable to schedule inst even though "</span>
<a name="l01736"></a>01736                             <span class="stringliteral">"dependent ops unscheduled."</span>);
<a name="l01737"></a>01737                 }
<a name="l01738"></a>01738             }                   <span class="comment">/* end forward or backward scheduling</span>
<a name="l01739"></a>01739 <span class="comment">                                   attempt on real instruction */</span>
<a name="l01740"></a>01740         }                       <span class="comment">/* end schedule oper */</span>
<a name="l01741"></a>01741 
<a name="l01742"></a>01742       <span class="comment">/* Check for any real operation */</span>
<a name="l01743"></a>01743       <span class="keywordflow">if</span> (sm_op-&gt;sched_slot != <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8h.html#24171cfb8faee5635d96d731e30b59f0">SM_MAX_SLOT</a>)
<a name="l01744"></a>01744         {
<a name="l01745"></a>01745           softpipe_info-&gt;scheduled = 1;
<a name="l01746"></a>01746           budget--;
<a name="l01747"></a>01747           softpipe_info-&gt;issue_time = cycle;
<a name="l01748"></a>01748           softpipe_info-&gt;intra_iter_issue_time = cycle;
<a name="l01749"></a>01749         }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751       <span class="comment">/* Current instruction could not be scheduled. */</span>
<a name="l01752"></a>01752       <span class="keywordflow">if</span> (!softpipe_info-&gt;scheduled)
<a name="l01753"></a>01753         {
<a name="l01754"></a>01754           L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01755"></a>01755                   <span class="stringliteral">"Incrementing II (from %d) - could not find a "</span>
<a name="l01756"></a>01756                   <span class="stringliteral">"slot without resource conflict "</span>
<a name="l01757"></a>01757                   <span class="stringliteral">"(function %s, cb %d)\n"</span>,
<a name="l01758"></a>01758                   II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id);
<a name="l01759"></a>01759           success = 0;
<a name="l01760"></a>01760         }
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762 
<a name="l01763"></a>01763   <a class="code" href="l__pipe__util_8c.html#942148e69d79ed6f032311fc5f673ec1">Q_delete_queue</a> (<a class="code" href="l__pipe__sched_8c.html#d3571bda1f4af9f3c27d5c33ba538a2c">Lpipe_ready_queue</a>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765   <span class="comment">/* If exhaust budget before scheduling all opers, inc II and try again */</span>
<a name="l01766"></a>01766   <span class="keywordflow">if</span> (success)
<a name="l01767"></a>01767     {
<a name="l01768"></a>01768       <span class="keywordflow">if</span> (sm_op)
<a name="l01769"></a>01769         {
<a name="l01770"></a>01770           L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01771"></a>01771                   <span class="stringliteral">"Incrementing II (from %d) - "</span>
<a name="l01772"></a>01772                   <span class="stringliteral">"budget exhausted (function %s, cb %d)\n"</span>,
<a name="l01773"></a>01773                   II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id);
<a name="l01774"></a>01774           success = 0;
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776       <span class="keywordflow">else</span>
<a name="l01777"></a>01777         {
<a name="l01778"></a>01778           sched_length = (sm_cb-&gt;last_sched_op-&gt;sched_cycle -
<a name="l01779"></a>01779                           sm_cb-&gt;first_sched_op-&gt;sched_cycle);
<a name="l01780"></a>01780 
<a name="l01781"></a>01781           <span class="comment">/* This test controls the maximum number of stages.  When the</span>
<a name="l01782"></a>01782 <span class="comment">             number of stages gets too large, the register pressure becomes</span>
<a name="l01783"></a>01783 <span class="comment">             unmanagable.  Consider a register that is live from top to bottom</span>
<a name="l01784"></a>01784 <span class="comment">             of the schedule...it uses num_stages number of registers. */</span>
<a name="l01785"></a>01785   
<a name="l01786"></a>01786           <span class="keywordflow">if</span> ((sched_length / sm_cb-&gt;II) &gt; <a class="code" href="l__pipe__util_8c.html#d36c8bdff7baceb8d1cb7853c908bf03">Lpipe_max_stages</a>)
<a name="l01787"></a>01787             {
<a name="l01788"></a>01788               L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01789"></a>01789                       <span class="stringliteral">"Incrementing II (from %d) - too many stages "</span>
<a name="l01790"></a>01790                       <span class="stringliteral">"(function %s, cb %d)\n"</span>,
<a name="l01791"></a>01791                       II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id);
<a name="l01792"></a>01792               success = 0;
<a name="l01793"></a>01793             }
<a name="l01794"></a>01794         }
<a name="l01795"></a>01795     }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797   <span class="keywordflow">if</span> (success)
<a name="l01798"></a>01798     {
<a name="l01799"></a>01799       <span class="keywordtype">int</span> unroll;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801       <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#2ac7c1af255f6338383d14a62ab6677a">SM_construct_temp_kernel_queue</a> (sm_cb);
<a name="l01802"></a>01802       <a class="code" href="l__softpipe__info_8c.html#2f8e0402029878eba06bf8e9c870bf9b">Lpipe_copy_sched_info</a> (sm_cb);
<a name="l01803"></a>01803 
<a name="l01804"></a>01804       unroll = <a class="code" href="l__mve_8c.html#66180998b7a313e243cc0cef7058723e">Lpipe_analyze_lr</a> (sm_cb, 1);
<a name="l01805"></a>01805 
<a name="l01806"></a>01806       <span class="keywordflow">if</span> (unroll == -1)
<a name="l01807"></a>01807         {
<a name="l01808"></a>01808           L_warn (<span class="stringliteral">"Lpipe_sm_schedule: "</span>
<a name="l01809"></a>01809                   <span class="stringliteral">"Incrementing II (from %d) - not enough "</span>
<a name="l01810"></a>01810                   <span class="stringliteral">"available rotating registers "</span>
<a name="l01811"></a>01811                   <span class="stringliteral">"(function %s, cb %d)\n"</span>,
<a name="l01812"></a>01812                   sm_cb-&gt;II, L_fn-&gt;name, sm_cb-&gt;lcode_cb-&gt;id);
<a name="l01813"></a>01813           success = 0;
<a name="l01814"></a>01814         }
<a name="l01815"></a>01815       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((unroll &gt; 1) &amp;&amp; 
<a name="l01816"></a>01816                (<a class="code" href="l__pipe__util_8c.html#9929661b757af9845e6325f4752a7d87">Lpipe_schema</a> == <a class="code" href="l__pipe__util_8h.html#50a9671342717fc27f66fbb4178f4827">MULTI_EPI</a>) &amp;&amp;
<a name="l01817"></a>01817                loop_back_br-&gt;lcode_op-&gt;pred[0] &amp;&amp;
<a name="l01818"></a>01818                L_cond_branch_opcode (loop_back_br-&gt;lcode_op))
<a name="l01819"></a>01819         {
<a name="l01820"></a>01820           L_warn (<span class="stringliteral">"Lpipe_sm_schedule: unable to reverse pbr in cb %d"</span>,
<a name="l01821"></a>01821                   sm_cb-&gt;lcode_cb-&gt;id);
<a name="l01822"></a>01822           success = 0;
<a name="l01823"></a>01823         }
<a name="l01824"></a>01824     }
<a name="l01825"></a>01825 
<a name="l01826"></a>01826   <span class="keywordflow">if</span> (!success)
<a name="l01827"></a>01827     {
<a name="l01828"></a>01828       <a class="code" href="l__pipe__sched_8c.html#dee91af7d1d223f216f3c892e3ec9c0f">Lpipe_sm_terminate</a> (sm_cb);
<a name="l01829"></a>01829       <span class="keywordflow">return</span> 0;
<a name="l01830"></a>01830     }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832   <span class="comment">/* Issue chain of opers leading to loop back branch as early as</span>
<a name="l01833"></a>01833 <span class="comment">     possible to avoid speculation of operations that the loop back</span>
<a name="l01834"></a>01834 <span class="comment">     branch does not depend on.  Can only be done for counted loops</span>
<a name="l01835"></a>01835 <span class="comment">     without early exits. */</span>
<a name="l01836"></a>01836   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#86f23e88bb2635324fa313d64bb50971">Lpipe_compact_branch_path_opers</a> &amp;&amp; <a class="code" href="l__softpipe_8c.html#e41610bb03edbaeb7c02cfcc7fc4467b">Lpipe_counted_loop</a>)
<a name="l01837"></a>01837     <a class="code" href="l__pipe__sched_8c.html#22d3a9898c3e6ce8efa572c7ac22c115">Lpipe_do_compact_branch_path_opers</a> (sm_cb, loop_back_br);
<a name="l01838"></a>01838 
<a name="l01839"></a>01839   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 1)
<a name="l01840"></a>01840     {
<a name="l01841"></a>01841       printf (<span class="stringliteral">"Pipelining successful for II = %d (function %s, cb %d)\n"</span>,
<a name="l01842"></a>01842               II, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id);
<a name="l01843"></a>01843       <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#ad83dd0fea79c90886829873235d97be">Lpipe_debug</a> &gt;= 2)
<a name="l01844"></a>01844         <a class="code" href="l__pipe__util_8c.html#b586f12896d4906e0e7015d4ea36b61e">Lpipe_print_cb_schedule</a> (stdout, L_fn, sm_cb);
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846 
<a name="l01847"></a>01847   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#0b64713f1a54406156072dd81814ea25">Lpipe_print_schedules_for_debug</a>)
<a name="l01848"></a>01848     {
<a name="l01849"></a>01849       fprintf (<a class="code" href="l__softpipe_8c.html#dfcefa1a772012ef80d3b8f14f3f150b">sched_file</a>,
<a name="l01850"></a>01850                <span class="stringliteral">"\n\nPrinting cb schedule before mrt optimizations %s:"</span>
<a name="l01851"></a>01851                <span class="stringliteral">"cb %d\n\n"</span>, sm_cb-&gt;lcode_fn-&gt;name, <a class="code" href="l__softpipe_8c.html#91e84fa9645e4d3beb7b8b6c150da74b">header_cb</a>-&gt;id);
<a name="l01852"></a>01852       <a class="code" href="l__pipe__util_8c.html#b586f12896d4906e0e7015d4ea36b61e">Lpipe_print_cb_schedule</a> (<a class="code" href="l__softpipe_8c.html#dfcefa1a772012ef80d3b8f14f3f150b">sched_file</a>, L_fn, sm_cb);
<a name="l01853"></a>01853     }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="libmspec.tag:../../../../machine/Mspec/html/" href="../../../../machine/Mspec/html/m__spec_8h.html#459f82172b68fe91c09e0c89d4d55cfa">M_arch</a> != <a class="codeRef" doxygen="libmspec.tag:../../../../machine/Mspec/html/" href="../../../../machine/Mspec/html/m__spec_8h.html#87ce108f22b58ab0e2e9408702ced941">M_TAHOE</a>)
<a name="l01856"></a>01856     {
<a name="l01857"></a>01857       <span class="comment">/* MCM Disable for Tahoe at this point. */</span>
<a name="l01858"></a>01858 
<a name="l01859"></a>01859       <span class="comment">/* move operations with no incoming register dependence arcs as</span>
<a name="l01860"></a>01860 <span class="comment">         late as possible and opers with no outgoing dependence arcs</span>
<a name="l01861"></a>01861 <span class="comment">         as early as possible to save registers */</span>
<a name="l01862"></a>01862       <a class="code" href="l__pipe__sched_8c.html#6ea245db13fd3e44deea65c66ab25a8c">Lpipe_optimize_lifetimes</a> (sm_cb);
<a name="l01863"></a>01863     }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#2ac7c1af255f6338383d14a62ab6677a">SM_construct_temp_kernel_queue</a> (sm_cb);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#1fd08397fdb9c8be171e9e45a1d811aa">Lpipe_sort_mrt_rows</a>)
<a name="l01868"></a>01868     <a class="code" href="l__pipe__sched_8c.html#8959fddf750d749cd097c00736be43c6">Lpipe_sort_MRT_rows</a> (sm_cb);
<a name="l01869"></a>01869 
<a name="l01870"></a>01870   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#3717231690ad643569cefb30c7b678a0">SM_set_sched_cycle_offset</a> (sm_cb);
<a name="l01871"></a>01871                  
<a name="l01872"></a>01872   <span class="keywordflow">return</span> 1;
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 
<a name="l01876"></a>01876 <span class="keywordtype">void</span>
<a name="l01877"></a><a class="code" href="l__pipe__sched_8h.html#dd7366875dda49d931f80947bf3a2dda">01877</a> <a class="code" href="l__pipe__sched_8c.html#9d49fd9203ffb941ebcc7e0d5dca5140">Lpipe_sm_commit</a> (<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html">SM_Cb</a> *sm_cb)
<a name="l01878"></a>01878 {
<a name="l01879"></a>01879   <span class="keywordflow">if</span> (<a class="code" href="l__pipe__util_8c.html#2b86b75abb1973402ba2363621a03bb3">Lpipe_dump_dot</a>)
<a name="l01880"></a>01880     {
<a name="l01881"></a>01881       <span class="keywordtype">char</span> *buf = alloca (strlen (L_fn-&gt;name) + 32);
<a name="l01882"></a>01882       sprintf (buf, <span class="stringliteral">"PipeDAG-%s-%d.dot"</span>, L_fn-&gt;name, sm_cb-&gt;<a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/structSM__Cb.html#b69cef60244b3cc923619329b3f8e622">lcode_cb</a>-&gt;id);
<a name="l01883"></a>01883 <span class="preprocessor">#if 0</span>
<a name="l01884"></a>01884 <span class="preprocessor"></span>      <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm__dep_8c.html#637923635a2da477634e82f5a0fba872">SM_print_cb_dot_graph</a> (sm_cb, buf);
<a name="l01885"></a>01885 <span class="preprocessor">#endif</span>
<a name="l01886"></a>01886 <span class="preprocessor"></span>    }
<a name="l01887"></a>01887 
<a name="l01888"></a>01888   <span class="comment">/* Commit the cb's schedule */</span>
<a name="l01889"></a>01889   <a class="codeRef" doxygen="libsm.tag:../../../sched/SM/html/" href="../../../sched/SM/html/sm_8c.html#e52798e66e79a170b5bb050ad226bc42">SM_commit_cb</a> (sm_cb);
<a name="l01890"></a>01890 
<a name="l01891"></a>01891   <a class="code" href="l__softpipe__info_8c.html#2f8e0402029878eba06bf8e9c870bf9b">Lpipe_copy_sched_info</a> (sm_cb);
<a name="l01892"></a>01892   <a class="code" href="l__pipe__util_8c.html#d0e4be247037cc75bcca0eeebb56dc71">Lpipe_cb_set_iter</a> (sm_cb);
<a name="l01893"></a>01893   <a class="code" href="l__pipe__util_8c.html#0b7f0cae0da09da3e5d8b982be9873e0">Lpipe_cb_set_issue_time</a> (sm_cb);
<a name="l01894"></a>01894 
<a name="l01895"></a>01895   <span class="keywordflow">return</span>;
<a name="l01896"></a>01896 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Aug 30 17:59:22 2014 for libsoftpipe by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
